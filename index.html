<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2026 to 2050 </title>
  <!-- Simple relative path to the JS entry point -->
  
  <link rel="stylesheet" href="./phase3-styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script type="module" crossorigin>
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Nt(t){return t+.5|0}const De=(t,e,a)=>Math.max(Math.min(t,a),e);function Mt(t){return De(Nt(t*2.55),0,255)}function Ye(t){return De(Nt(t*255),0,255)}function Me(t){return De(Nt(t/2.55)/100,0,1)}function ji(t){return De(Nt(t*100),0,100)}const de={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},ja=[..."0123456789ABCDEF"],ns=t=>ja[t&15],os=t=>ja[(t&240)>>4]+ja[t&15],Gt=t=>(t&240)>>4===(t&15),rs=t=>Gt(t.r)&&Gt(t.g)&&Gt(t.b)&&Gt(t.a);function ss(t){var e=t.length,a;return t[0]==="#"&&(e===4||e===5?a={r:255&de[t[1]]*17,g:255&de[t[2]]*17,b:255&de[t[3]]*17,a:e===5?de[t[4]]*17:255}:(e===7||e===9)&&(a={r:de[t[1]]<<4|de[t[2]],g:de[t[3]]<<4|de[t[4]],b:de[t[5]]<<4|de[t[6]],a:e===9?de[t[7]]<<4|de[t[8]]:255})),a}const ls=(t,e)=>t<255?e(t):"";function cs(t){var e=rs(t)?ns:os;return t?"#"+e(t.r)+e(t.g)+e(t.b)+ls(t.a,e):void 0}const ds=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function xo(t,e,a){const i=e*Math.min(a,1-a),n=(o,r=(o+t/30)%12)=>a-i*Math.max(Math.min(r-3,9-r,1),-1);return[n(0),n(8),n(4)]}function ps(t,e,a){const i=(n,o=(n+t/60)%6)=>a-a*e*Math.max(Math.min(o,4-o,1),0);return[i(5),i(3),i(1)]}function us(t,e,a){const i=xo(t,1,.5);let n;for(e+a>1&&(n=1/(e+a),e*=n,a*=n),n=0;n<3;n++)i[n]*=1-e-a,i[n]+=e;return i}function hs(t,e,a,i,n){return t===n?(e-a)/i+(e<a?6:0):e===n?(a-t)/i+2:(t-e)/i+4}function ui(t){const a=t.r/255,i=t.g/255,n=t.b/255,o=Math.max(a,i,n),r=Math.min(a,i,n),s=(o+r)/2;let l,c,d;return o!==r&&(d=o-r,c=s>.5?d/(2-o-r):d/(o+r),l=hs(a,i,n,d,o),l=l*60+.5),[l|0,c||0,s]}function hi(t,e,a,i){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,a,i)).map(Ye)}function fi(t,e,a){return hi(xo,t,e,a)}function fs(t,e,a){return hi(us,t,e,a)}function ms(t,e,a){return hi(ps,t,e,a)}function Co(t){return(t%360+360)%360}function _s(t){const e=ds.exec(t);let a=255,i;if(!e)return;e[5]!==i&&(a=e[6]?Mt(+e[5]):Ye(+e[5]));const n=Co(+e[2]),o=+e[3]/100,r=+e[4]/100;return e[1]==="hwb"?i=fs(n,o,r):e[1]==="hsv"?i=ms(n,o,r):i=fi(n,o,r),{r:i[0],g:i[1],b:i[2],a}}function gs(t,e){var a=ui(t);a[0]=Co(a[0]+e),a=fi(a),t.r=a[0],t.g=a[1],t.b=a[2]}function bs(t){if(!t)return;const e=ui(t),a=e[0],i=ji(e[1]),n=ji(e[2]);return t.a<255?`hsla(${a}, ${i}%, ${n}%, ${Me(t.a)})`:`hsl(${a}, ${i}%, ${n}%)`}const qi={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Ui={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function vs(){const t={},e=Object.keys(Ui),a=Object.keys(qi);let i,n,o,r,s;for(i=0;i<e.length;i++){for(r=s=e[i],n=0;n<a.length;n++)o=a[n],s=s.replace(o,qi[o]);o=parseInt(Ui[r],16),t[s]=[o>>16&255,o>>8&255,o&255]}return t}let Kt;function ws(t){Kt||(Kt=vs(),Kt.transparent=[0,0,0,0]);const e=Kt[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const ys=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function xs(t){const e=ys.exec(t);let a=255,i,n,o;if(e){if(e[7]!==i){const r=+e[7];a=e[8]?Mt(r):De(r*255,0,255)}return i=+e[1],n=+e[3],o=+e[5],i=255&(e[2]?Mt(i):De(i,0,255)),n=255&(e[4]?Mt(n):De(n,0,255)),o=255&(e[6]?Mt(o):De(o,0,255)),{r:i,g:n,b:o,a}}}function Cs(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${Me(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}const Ia=t=>t<=.0031308?t*12.92:Math.pow(t,1/2.4)*1.055-.055,nt=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function Ms(t,e,a){const i=nt(Me(t.r)),n=nt(Me(t.g)),o=nt(Me(t.b));return{r:Ye(Ia(i+a*(nt(Me(e.r))-i))),g:Ye(Ia(n+a*(nt(Me(e.g))-n))),b:Ye(Ia(o+a*(nt(Me(e.b))-o))),a:t.a+a*(e.a-t.a)}}function Xt(t,e,a){if(t){let i=ui(t);i[e]=Math.max(0,Math.min(i[e]+i[e]*a,e===0?360:1)),i=fi(i),t.r=i[0],t.g=i[1],t.b=i[2]}}function Mo(t,e){return t&&Object.assign(e||{},t)}function Gi(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=Ye(t[3]))):(e=Mo(t,{r:0,g:0,b:0,a:1}),e.a=Ye(e.a)),e}function Ss(t){return t.charAt(0)==="r"?xs(t):_s(t)}class It{constructor(e){if(e instanceof It)return e;const a=typeof e;let i;a==="object"?i=Gi(e):a==="string"&&(i=ss(e)||ws(e)||Ss(e)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var e=Mo(this._rgb);return e&&(e.a=Me(e.a)),e}set rgb(e){this._rgb=Gi(e)}rgbString(){return this._valid?Cs(this._rgb):void 0}hexString(){return this._valid?cs(this._rgb):void 0}hslString(){return this._valid?bs(this._rgb):void 0}mix(e,a){if(e){const i=this.rgb,n=e.rgb;let o;const r=a===o?.5:a,s=2*r-1,l=i.a-n.a,c=((s*l===-1?s:(s+l)/(1+s*l))+1)/2;o=1-c,i.r=255&c*i.r+o*n.r+.5,i.g=255&c*i.g+o*n.g+.5,i.b=255&c*i.b+o*n.b+.5,i.a=r*i.a+(1-r)*n.a,this.rgb=i}return this}interpolate(e,a){return e&&(this._rgb=Ms(this._rgb,e._rgb,a)),this}clone(){return new It(this.rgb)}alpha(e){return this._rgb.a=Ye(e),this}clearer(e){const a=this._rgb;return a.a*=1-e,this}greyscale(){const e=this._rgb,a=Nt(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=a,this}opaquer(e){const a=this._rgb;return a.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Xt(this._rgb,2,e),this}darken(e){return Xt(this._rgb,2,-e),this}saturate(e){return Xt(this._rgb,1,e),this}desaturate(e){return Xt(this._rgb,1,-e),this}rotate(e){return gs(this._rgb,e),this}}/*!
 * Chart.js v4.4.8
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function ye(){}const Es=(()=>{let t=0;return()=>t++})();function B(t){return t==null}function z(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function T(t){return t!==null&&Object.prototype.toString.call(t)==="[object Object]"}function q(t){return(typeof t=="number"||t instanceof Number)&&isFinite(+t)}function se(t,e){return q(t)?t:e}function I(t,e){return typeof t>"u"?e:t}const ks=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100:+t/e,So=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100*e:+t;function N(t,e,a){if(t&&typeof t.call=="function")return t.apply(a,e)}function F(t,e,a,i){let n,o,r;if(z(t))if(o=t.length,i)for(n=o-1;n>=0;n--)e.call(a,t[n],n);else for(n=0;n<o;n++)e.call(a,t[n],n);else if(T(t))for(r=Object.keys(t),o=r.length,n=0;n<o;n++)e.call(a,t[r[n]],r[n])}function pa(t,e){let a,i,n,o;if(!t||!e||t.length!==e.length)return!1;for(a=0,i=t.length;a<i;++a)if(n=t[a],o=e[a],n.datasetIndex!==o.datasetIndex||n.index!==o.index)return!1;return!0}function ua(t){if(z(t))return t.map(ua);if(T(t)){const e=Object.create(null),a=Object.keys(t),i=a.length;let n=0;for(;n<i;++n)e[a[n]]=ua(t[a[n]]);return e}return t}function Eo(t){return["__proto__","prototype","constructor"].indexOf(t)===-1}function Ps(t,e,a,i){if(!Eo(t))return;const n=e[t],o=a[t];T(n)&&T(o)?Bt(n,o,i):e[t]=ua(o)}function Bt(t,e,a){const i=z(e)?e:[e],n=i.length;if(!T(t))return t;a=a||{};const o=a.merger||Ps;let r;for(let s=0;s<n;++s){if(r=i[s],!T(r))continue;const l=Object.keys(r);for(let c=0,d=l.length;c<d;++c)o(l[c],t,r,a)}return t}function Pt(t,e){return Bt(t,e,{merger:Ls})}function Ls(t,e,a){if(!Eo(t))return;const i=e[t],n=a[t];T(i)&&T(n)?Pt(i,n):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=ua(n))}const Ki={"":t=>t,x:t=>t.x,y:t=>t.y};function As(t){const e=t.split("."),a=[];let i="";for(const n of e)i+=n,i.endsWith("\\")?i=i.slice(0,-1)+".":(a.push(i),i="");return a}function Ds(t){const e=As(t);return a=>{for(const i of e){if(i==="")break;a=a&&a[i]}return a}}function Oe(t,e){return(Ki[e]||(Ki[e]=Ds(e)))(t)}function mi(t){return t.charAt(0).toUpperCase()+t.slice(1)}const Tt=t=>typeof t<"u",Fe=t=>typeof t=="function",Xi=(t,e)=>{if(t.size!==e.size)return!1;for(const a of t)if(!e.has(a))return!1;return!0};function Is(t){return t.type==="mouseup"||t.type==="click"||t.type==="contextmenu"}const H=Math.PI,W=2*H,Bs=W+H,ha=Number.POSITIVE_INFINITY,Ts=H/180,U=H/2,He=H/4,Ji=H*2/3,Ie=Math.log10,be=Math.sign;function Lt(t,e,a){return Math.abs(t-e)<a}function Zi(t){const e=Math.round(t);t=Lt(t,e,t/1e3)?e:t;const a=Math.pow(10,Math.floor(Ie(t))),i=t/a;return(i<=1?1:i<=2?2:i<=5?5:10)*a}function Ys(t){const e=[],a=Math.sqrt(t);let i;for(i=1;i<a;i++)t%i===0&&(e.push(i),e.push(t/i));return a===(a|0)&&e.push(a),e.sort((n,o)=>n-o).pop(),e}function Rs(t){return typeof t=="symbol"||typeof t=="object"&&t!==null&&!(Symbol.toPrimitive in t||"toString"in t||"valueOf"in t)}function ct(t){return!Rs(t)&&!isNaN(parseFloat(t))&&isFinite(t)}function Os(t,e){const a=Math.round(t);return a-e<=t&&a+e>=t}function ko(t,e,a){let i,n,o;for(i=0,n=t.length;i<n;i++)o=t[i][a],isNaN(o)||(e.min=Math.min(e.min,o),e.max=Math.max(e.max,o))}function pe(t){return t*(H/180)}function _i(t){return t*(180/H)}function Qi(t){if(!q(t))return;let e=1,a=0;for(;Math.round(t*e)/e!==t;)e*=10,a++;return a}function Po(t,e){const a=e.x-t.x,i=e.y-t.y,n=Math.sqrt(a*a+i*i);let o=Math.atan2(i,a);return o<-.5*H&&(o+=W),{angle:o,distance:n}}function qa(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Fs(t,e){return(t-e+Bs)%W-H}function le(t){return(t%W+W)%W}function Yt(t,e,a,i){const n=le(t),o=le(e),r=le(a),s=le(o-n),l=le(r-n),c=le(n-o),d=le(n-r);return n===o||n===r||i&&o===r||s>l&&c<d}function Z(t,e,a){return Math.max(e,Math.min(a,t))}function $s(t){return Z(t,-32768,32767)}function Se(t,e,a,i=1e-6){return t>=Math.min(e,a)-i&&t<=Math.max(e,a)+i}function gi(t,e,a){a=a||(r=>t[r]<e);let i=t.length-1,n=0,o;for(;i-n>1;)o=n+i>>1,a(o)?n=o:i=o;return{lo:n,hi:i}}const Ee=(t,e,a,i)=>gi(t,a,i?n=>{const o=t[n][e];return o<a||o===a&&t[n+1][e]===a}:n=>t[n][e]<a),Ns=(t,e,a)=>gi(t,a,i=>t[i][e]>=a);function zs(t,e,a){let i=0,n=t.length;for(;i<n&&t[i]<e;)i++;for(;n>i&&t[n-1]>a;)n--;return i>0||n<t.length?t.slice(i,n):t}const Lo=["push","pop","shift","splice","unshift"];function Ws(t,e){if(t._chartjs){t._chartjs.listeners.push(e);return}Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),Lo.forEach(a=>{const i="_onData"+mi(a),n=t[a];Object.defineProperty(t,a,{configurable:!0,enumerable:!1,value(...o){const r=n.apply(this,o);return t._chartjs.listeners.forEach(s=>{typeof s[i]=="function"&&s[i](...o)}),r}})})}function en(t,e){const a=t._chartjs;if(!a)return;const i=a.listeners,n=i.indexOf(e);n!==-1&&i.splice(n,1),!(i.length>0)&&(Lo.forEach(o=>{delete t[o]}),delete t._chartjs)}function Ao(t){const e=new Set(t);return e.size===t.length?t:Array.from(e)}const Do=function(){return typeof window>"u"?function(t){return t()}:window.requestAnimationFrame}();function Io(t,e){let a=[],i=!1;return function(...n){a=n,i||(i=!0,Do.call(window,()=>{i=!1,t.apply(e,a)}))}}function Hs(t,e){let a;return function(...i){return e?(clearTimeout(a),a=setTimeout(t,e,i)):t.apply(this,i),e}}const bi=t=>t==="start"?"left":t==="end"?"right":"center",te=(t,e,a)=>t==="start"?e:t==="end"?a:(e+a)/2,Vs=(t,e,a,i)=>t===(i?"left":"right")?a:t==="center"?(e+a)/2:e;function Bo(t,e,a){const i=e.length;let n=0,o=i;if(t._sorted){const{iScale:r,vScale:s,_parsed:l}=t,c=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null,d=r.axis,{min:p,max:u,minDefined:h,maxDefined:f}=r.getUserBounds();if(h){if(n=Math.min(Ee(l,d,p).lo,a?i:Ee(e,d,r.getPixelForValue(p)).lo),c){const m=l.slice(0,n+1).reverse().findIndex(_=>!B(_[s.axis]));n-=Math.max(0,m)}n=Z(n,0,i-1)}if(f){let m=Math.max(Ee(l,r.axis,u,!0).hi+1,a?0:Ee(e,d,r.getPixelForValue(u),!0).hi+1);if(c){const _=l.slice(m-1).findIndex(g=>!B(g[s.axis]));m+=Math.max(0,_)}o=Z(m,n,i)-n}else o=i-n}return{start:n,count:o}}function To(t){const{xScale:e,yScale:a,_scaleRanges:i}=t,n={xmin:e.min,xmax:e.max,ymin:a.min,ymax:a.max};if(!i)return t._scaleRanges=n,!0;const o=i.xmin!==e.min||i.xmax!==e.max||i.ymin!==a.min||i.ymax!==a.max;return Object.assign(i,n),o}const Jt=t=>t===0||t===1,tn=(t,e,a)=>-(Math.pow(2,10*(t-=1))*Math.sin((t-e)*W/a)),an=(t,e,a)=>Math.pow(2,-10*t)*Math.sin((t-e)*W/a)+1,At={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>-Math.cos(t*U)+1,easeOutSine:t=>Math.sin(t*U),easeInOutSine:t=>-.5*(Math.cos(H*t)-1),easeInExpo:t=>t===0?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>t===1?1:-Math.pow(2,-10*t)+1,easeInOutExpo:t=>Jt(t)?t:t<.5?.5*Math.pow(2,10*(t*2-1)):.5*(-Math.pow(2,-10*(t*2-1))+2),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>Jt(t)?t:tn(t,.075,.3),easeOutElastic:t=>Jt(t)?t:an(t,.075,.3),easeInOutElastic(t){return Jt(t)?t:t<.5?.5*tn(t*2,.1125,.45):.5+.5*an(t*2-1,.1125,.45)},easeInBack(t){return t*t*((1.70158+1)*t-1.70158)},easeOutBack(t){return(t-=1)*t*((1.70158+1)*t+1.70158)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},easeInBounce:t=>1-At.easeOutBounce(1-t),easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInOutBounce:t=>t<.5?At.easeInBounce(t*2)*.5:At.easeOutBounce(t*2-1)*.5+.5};function vi(t){if(t&&typeof t=="object"){const e=t.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function nn(t){return vi(t)?t:new It(t)}function Ba(t){return vi(t)?t:new It(t).saturate(.5).darken(.1).hexString()}const js=["x","y","borderWidth","radius","tension"],qs=["color","borderColor","backgroundColor"];function Us(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),t.set("animations",{colors:{type:"color",properties:qs},numbers:{type:"number",properties:js}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function Gs(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const on=new Map;function Ks(t,e){e=e||{};const a=t+JSON.stringify(e);let i=on.get(a);return i||(i=new Intl.NumberFormat(t,e),on.set(a,i)),i}function zt(t,e,a){return Ks(e,a).format(t)}const Yo={values(t){return z(t)?t:""+t},numeric(t,e,a){if(t===0)return"0";const i=this.chart.options.locale;let n,o=t;if(a.length>1){const c=Math.max(Math.abs(a[0].value),Math.abs(a[a.length-1].value));(c<1e-4||c>1e15)&&(n="scientific"),o=Xs(t,a)}const r=Ie(Math.abs(o)),s=isNaN(r)?1:Math.max(Math.min(-1*Math.floor(r),20),0),l={notation:n,minimumFractionDigits:s,maximumFractionDigits:s};return Object.assign(l,this.options.ticks.format),zt(t,i,l)},logarithmic(t,e,a){if(t===0)return"0";const i=a[e].significand||t/Math.pow(10,Math.floor(Ie(t)));return[1,2,3,5,10,15].includes(i)||e>.8*a.length?Yo.numeric.call(this,t,e,a):""}};function Xs(t,e){let a=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(a)>=1&&t!==Math.floor(t)&&(a=t-Math.floor(t)),a}var Ca={formatters:Yo};function Js(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,a)=>a.lineWidth,tickColor:(e,a)=>a.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Ca.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const Qe=Object.create(null),Ua=Object.create(null);function Dt(t,e){if(!e)return t;const a=e.split(".");for(let i=0,n=a.length;i<n;++i){const o=a[i];t=t[o]||(t[o]=Object.create(null))}return t}function Ta(t,e,a){return typeof e=="string"?Bt(Dt(t,e),a):Bt(Dt(t,""),e)}class Zs{constructor(e,a){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,n)=>Ba(n.backgroundColor),this.hoverBorderColor=(i,n)=>Ba(n.borderColor),this.hoverColor=(i,n)=>Ba(n.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(a)}set(e,a){return Ta(this,e,a)}get(e){return Dt(this,e)}describe(e,a){return Ta(Ua,e,a)}override(e,a){return Ta(Qe,e,a)}route(e,a,i,n){const o=Dt(this,e),r=Dt(this,i),s="_"+a;Object.defineProperties(o,{[s]:{value:o[a],writable:!0},[a]:{enumerable:!0,get(){const l=this[s],c=r[n];return T(l)?Object.assign({},c,l):I(l,c)},set(l){this[s]=l}}})}apply(e){e.forEach(a=>a(this))}}var j=new Zs({_scriptable:t=>!t.startsWith("on"),_indexable:t=>t!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Us,Gs,Js]);function Qs(t){return!t||B(t.size)||B(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function fa(t,e,a,i,n){let o=e[n];return o||(o=e[n]=t.measureText(n).width,a.push(n)),o>i&&(i=o),i}function el(t,e,a,i){i=i||{};let n=i.data=i.data||{},o=i.garbageCollect=i.garbageCollect||[];i.font!==e&&(n=i.data={},o=i.garbageCollect=[],i.font=e),t.save(),t.font=e;let r=0;const s=a.length;let l,c,d,p,u;for(l=0;l<s;l++)if(p=a[l],p!=null&&!z(p))r=fa(t,n,o,r,p);else if(z(p))for(c=0,d=p.length;c<d;c++)u=p[c],u!=null&&!z(u)&&(r=fa(t,n,o,r,u));t.restore();const h=o.length/2;if(h>a.length){for(l=0;l<h;l++)delete n[o[l]];o.splice(0,h)}return r}function Ve(t,e,a){const i=t.currentDevicePixelRatio,n=a!==0?Math.max(a/2,.5):0;return Math.round((e-n)*i)/i+n}function rn(t,e){!e&&!t||(e=e||t.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore())}function Ga(t,e,a,i){Ro(t,e,a,i,null)}function Ro(t,e,a,i,n){let o,r,s,l,c,d,p,u;const h=e.pointStyle,f=e.rotation,m=e.radius;let _=(f||0)*Ts;if(h&&typeof h=="object"&&(o=h.toString(),o==="[object HTMLImageElement]"||o==="[object HTMLCanvasElement]")){t.save(),t.translate(a,i),t.rotate(_),t.drawImage(h,-h.width/2,-h.height/2,h.width,h.height),t.restore();return}if(!(isNaN(m)||m<=0)){switch(t.beginPath(),h){default:n?t.ellipse(a,i,n/2,m,0,0,W):t.arc(a,i,m,0,W),t.closePath();break;case"triangle":d=n?n/2:m,t.moveTo(a+Math.sin(_)*d,i-Math.cos(_)*m),_+=Ji,t.lineTo(a+Math.sin(_)*d,i-Math.cos(_)*m),_+=Ji,t.lineTo(a+Math.sin(_)*d,i-Math.cos(_)*m),t.closePath();break;case"rectRounded":c=m*.516,l=m-c,r=Math.cos(_+He)*l,p=Math.cos(_+He)*(n?n/2-c:l),s=Math.sin(_+He)*l,u=Math.sin(_+He)*(n?n/2-c:l),t.arc(a-p,i-s,c,_-H,_-U),t.arc(a+u,i-r,c,_-U,_),t.arc(a+p,i+s,c,_,_+U),t.arc(a-u,i+r,c,_+U,_+H),t.closePath();break;case"rect":if(!f){l=Math.SQRT1_2*m,d=n?n/2:l,t.rect(a-d,i-l,2*d,2*l);break}_+=He;case"rectRot":p=Math.cos(_)*(n?n/2:m),r=Math.cos(_)*m,s=Math.sin(_)*m,u=Math.sin(_)*(n?n/2:m),t.moveTo(a-p,i-s),t.lineTo(a+u,i-r),t.lineTo(a+p,i+s),t.lineTo(a-u,i+r),t.closePath();break;case"crossRot":_+=He;case"cross":p=Math.cos(_)*(n?n/2:m),r=Math.cos(_)*m,s=Math.sin(_)*m,u=Math.sin(_)*(n?n/2:m),t.moveTo(a-p,i-s),t.lineTo(a+p,i+s),t.moveTo(a+u,i-r),t.lineTo(a-u,i+r);break;case"star":p=Math.cos(_)*(n?n/2:m),r=Math.cos(_)*m,s=Math.sin(_)*m,u=Math.sin(_)*(n?n/2:m),t.moveTo(a-p,i-s),t.lineTo(a+p,i+s),t.moveTo(a+u,i-r),t.lineTo(a-u,i+r),_+=He,p=Math.cos(_)*(n?n/2:m),r=Math.cos(_)*m,s=Math.sin(_)*m,u=Math.sin(_)*(n?n/2:m),t.moveTo(a-p,i-s),t.lineTo(a+p,i+s),t.moveTo(a+u,i-r),t.lineTo(a-u,i+r);break;case"line":r=n?n/2:Math.cos(_)*m,s=Math.sin(_)*m,t.moveTo(a-r,i-s),t.lineTo(a+r,i+s);break;case"dash":t.moveTo(a,i),t.lineTo(a+Math.cos(_)*(n?n/2:m),i+Math.sin(_)*m);break;case!1:t.closePath();break}t.fill(),e.borderWidth>0&&t.stroke()}}function ke(t,e,a){return a=a||.5,!e||t&&t.x>e.left-a&&t.x<e.right+a&&t.y>e.top-a&&t.y<e.bottom+a}function Ma(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function Sa(t){t.restore()}function tl(t,e,a,i,n){if(!e)return t.lineTo(a.x,a.y);if(n==="middle"){const o=(e.x+a.x)/2;t.lineTo(o,e.y),t.lineTo(o,a.y)}else n==="after"!=!!i?t.lineTo(e.x,a.y):t.lineTo(a.x,e.y);t.lineTo(a.x,a.y)}function al(t,e,a,i){if(!e)return t.lineTo(a.x,a.y);t.bezierCurveTo(i?e.cp1x:e.cp2x,i?e.cp1y:e.cp2y,i?a.cp2x:a.cp1x,i?a.cp2y:a.cp1y,a.x,a.y)}function il(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),B(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}function nl(t,e,a,i,n){if(n.strikethrough||n.underline){const o=t.measureText(i),r=e-o.actualBoundingBoxLeft,s=e+o.actualBoundingBoxRight,l=a-o.actualBoundingBoxAscent,c=a+o.actualBoundingBoxDescent,d=n.strikethrough?(l+c)/2:c;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=n.decorationWidth||2,t.moveTo(r,d),t.lineTo(s,d),t.stroke()}}function ol(t,e){const a=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=a}function et(t,e,a,i,n,o={}){const r=z(e)?e:[e],s=o.strokeWidth>0&&o.strokeColor!=="";let l,c;for(t.save(),t.font=n.string,il(t,o),l=0;l<r.length;++l)c=r[l],o.backdrop&&ol(t,o.backdrop),s&&(o.strokeColor&&(t.strokeStyle=o.strokeColor),B(o.strokeWidth)||(t.lineWidth=o.strokeWidth),t.strokeText(c,a,i,o.maxWidth)),t.fillText(c,a,i,o.maxWidth),nl(t,a,i,c,o),i+=Number(n.lineHeight);t.restore()}function Rt(t,e){const{x:a,y:i,w:n,h:o,radius:r}=e;t.arc(a+r.topLeft,i+r.topLeft,r.topLeft,1.5*H,H,!0),t.lineTo(a,i+o-r.bottomLeft),t.arc(a+r.bottomLeft,i+o-r.bottomLeft,r.bottomLeft,H,U,!0),t.lineTo(a+n-r.bottomRight,i+o),t.arc(a+n-r.bottomRight,i+o-r.bottomRight,r.bottomRight,U,0,!0),t.lineTo(a+n,i+r.topRight),t.arc(a+n-r.topRight,i+r.topRight,r.topRight,0,-U,!0),t.lineTo(a+r.topLeft,i)}const rl=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,sl=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function ll(t,e){const a=(""+t).match(rl);if(!a||a[1]==="normal")return e*1.2;switch(t=+a[2],a[3]){case"px":return t;case"%":t/=100;break}return e*t}const cl=t=>+t||0;function wi(t,e){const a={},i=T(e),n=i?Object.keys(e):e,o=T(t)?i?r=>I(t[r],t[e[r]]):r=>t[r]:()=>t;for(const r of n)a[r]=cl(o(r));return a}function Oo(t){return wi(t,{top:"y",right:"x",bottom:"y",left:"x"})}function Xe(t){return wi(t,["topLeft","topRight","bottomLeft","bottomRight"])}function ie(t){const e=Oo(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function J(t,e){t=t||{},e=e||j.font;let a=I(t.size,e.size);typeof a=="string"&&(a=parseInt(a,10));let i=I(t.style,e.style);i&&!(""+i).match(sl)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const n={family:I(t.family,e.family),lineHeight:ll(I(t.lineHeight,e.lineHeight),a),size:a,style:i,weight:I(t.weight,e.weight),string:""};return n.string=Qs(n),n}function St(t,e,a,i){let n=!0,o,r,s;for(o=0,r=t.length;o<r;++o)if(s=t[o],s!==void 0&&(e!==void 0&&typeof s=="function"&&(s=s(e),n=!1),a!==void 0&&z(s)&&(s=s[a%s.length],n=!1),s!==void 0))return i&&!n&&(i.cacheable=!1),s}function dl(t,e,a){const{min:i,max:n}=t,o=So(e,(n-i)/2),r=(s,l)=>a&&s===0?0:s+l;return{min:r(i,-Math.abs(o)),max:r(n,o)}}function $e(t,e){return Object.assign(Object.create(t),e)}function yi(t,e=[""],a,i,n=()=>t[0]){const o=a||t;typeof i>"u"&&(i=zo("_fallback",t));const r={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:o,_fallback:i,_getTarget:n,override:s=>yi([s,...t],e,o,i)};return new Proxy(r,{deleteProperty(s,l){return delete s[l],delete s._keys,delete t[0][l],!0},get(s,l){return $o(s,l,()=>bl(l,e,t,s))},getOwnPropertyDescriptor(s,l){return Reflect.getOwnPropertyDescriptor(s._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(t[0])},has(s,l){return ln(s).includes(l)},ownKeys(s){return ln(s)},set(s,l,c){const d=s._storage||(s._storage=n());return s[l]=d[l]=c,delete s._keys,!0}})}function dt(t,e,a,i){const n={_cacheable:!1,_proxy:t,_context:e,_subProxy:a,_stack:new Set,_descriptors:Fo(t,i),setContext:o=>dt(t,o,a,i),override:o=>dt(t.override(o),e,a,i)};return new Proxy(n,{deleteProperty(o,r){return delete o[r],delete t[r],!0},get(o,r,s){return $o(o,r,()=>ul(o,r,s))},getOwnPropertyDescriptor(o,r){return o._descriptors.allKeys?Reflect.has(t,r)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,r)},getPrototypeOf(){return Reflect.getPrototypeOf(t)},has(o,r){return Reflect.has(t,r)},ownKeys(){return Reflect.ownKeys(t)},set(o,r,s){return t[r]=s,delete o[r],!0}})}function Fo(t,e={scriptable:!0,indexable:!0}){const{_scriptable:a=e.scriptable,_indexable:i=e.indexable,_allKeys:n=e.allKeys}=t;return{allKeys:n,scriptable:a,indexable:i,isScriptable:Fe(a)?a:()=>a,isIndexable:Fe(i)?i:()=>i}}const pl=(t,e)=>t?t+mi(e):e,xi=(t,e)=>T(e)&&t!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function $o(t,e,a){if(Object.prototype.hasOwnProperty.call(t,e)||e==="constructor")return t[e];const i=a();return t[e]=i,i}function ul(t,e,a){const{_proxy:i,_context:n,_subProxy:o,_descriptors:r}=t;let s=i[e];return Fe(s)&&r.isScriptable(e)&&(s=hl(e,s,t,a)),z(s)&&s.length&&(s=fl(e,s,t,r.isIndexable)),xi(e,s)&&(s=dt(s,n,o&&o[e],r)),s}function hl(t,e,a,i){const{_proxy:n,_context:o,_subProxy:r,_stack:s}=a;if(s.has(t))throw new Error("Recursion detected: "+Array.from(s).join("->")+"->"+t);s.add(t);let l=e(o,r||i);return s.delete(t),xi(t,l)&&(l=Ci(n._scopes,n,t,l)),l}function fl(t,e,a,i){const{_proxy:n,_context:o,_subProxy:r,_descriptors:s}=a;if(typeof o.index<"u"&&i(t))return e[o.index%e.length];if(T(e[0])){const l=e,c=n._scopes.filter(d=>d!==l);e=[];for(const d of l){const p=Ci(c,n,t,d);e.push(dt(p,o,r&&r[t],s))}}return e}function No(t,e,a){return Fe(t)?t(e,a):t}const ml=(t,e)=>t===!0?e:typeof t=="string"?Oe(e,t):void 0;function _l(t,e,a,i,n){for(const o of e){const r=ml(a,o);if(r){t.add(r);const s=No(r._fallback,a,n);if(typeof s<"u"&&s!==a&&s!==i)return s}else if(r===!1&&typeof i<"u"&&a!==i)return null}return!1}function Ci(t,e,a,i){const n=e._rootScopes,o=No(e._fallback,a,i),r=[...t,...n],s=new Set;s.add(i);let l=sn(s,r,a,o||a,i);return l===null||typeof o<"u"&&o!==a&&(l=sn(s,r,o,l,i),l===null)?!1:yi(Array.from(s),[""],n,o,()=>gl(e,a,i))}function sn(t,e,a,i,n){for(;a;)a=_l(t,e,a,i,n);return a}function gl(t,e,a){const i=t._getTarget();e in i||(i[e]={});const n=i[e];return z(n)&&T(a)?a:n||{}}function bl(t,e,a,i){let n;for(const o of e)if(n=zo(pl(o,t),a),typeof n<"u")return xi(t,n)?Ci(a,i,t,n):n}function zo(t,e){for(const a of e){if(!a)continue;const i=a[t];if(typeof i<"u")return i}}function ln(t){let e=t._keys;return e||(e=t._keys=vl(t._scopes)),e}function vl(t){const e=new Set;for(const a of t)for(const i of Object.keys(a).filter(n=>!n.startsWith("_")))e.add(i);return Array.from(e)}function Wo(t,e,a,i){const{iScale:n}=t,{key:o="r"}=this._parsing,r=new Array(i);let s,l,c,d;for(s=0,l=i;s<l;++s)c=s+a,d=e[c],r[s]={r:n.parse(Oe(d,o),c)};return r}const wl=Number.EPSILON||1e-14,pt=(t,e)=>e<t.length&&!t[e].skip&&t[e],Ho=t=>t==="x"?"y":"x";function yl(t,e,a,i){const n=t.skip?e:t,o=e,r=a.skip?e:a,s=qa(o,n),l=qa(r,o);let c=s/(s+l),d=l/(s+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const p=i*c,u=i*d;return{previous:{x:o.x-p*(r.x-n.x),y:o.y-p*(r.y-n.y)},next:{x:o.x+u*(r.x-n.x),y:o.y+u*(r.y-n.y)}}}function xl(t,e,a){const i=t.length;let n,o,r,s,l,c=pt(t,0);for(let d=0;d<i-1;++d)if(l=c,c=pt(t,d+1),!(!l||!c)){if(Lt(e[d],0,wl)){a[d]=a[d+1]=0;continue}n=a[d]/e[d],o=a[d+1]/e[d],s=Math.pow(n,2)+Math.pow(o,2),!(s<=9)&&(r=3/Math.sqrt(s),a[d]=n*r*e[d],a[d+1]=o*r*e[d])}}function Cl(t,e,a="x"){const i=Ho(a),n=t.length;let o,r,s,l=pt(t,0);for(let c=0;c<n;++c){if(r=s,s=l,l=pt(t,c+1),!s)continue;const d=s[a],p=s[i];r&&(o=(d-r[a])/3,s[`cp1${a}`]=d-o,s[`cp1${i}`]=p-o*e[c]),l&&(o=(l[a]-d)/3,s[`cp2${a}`]=d+o,s[`cp2${i}`]=p+o*e[c])}}function Ml(t,e="x"){const a=Ho(e),i=t.length,n=Array(i).fill(0),o=Array(i);let r,s,l,c=pt(t,0);for(r=0;r<i;++r)if(s=l,l=c,c=pt(t,r+1),!!l){if(c){const d=c[e]-l[e];n[r]=d!==0?(c[a]-l[a])/d:0}o[r]=s?c?be(n[r-1])!==be(n[r])?0:(n[r-1]+n[r])/2:n[r-1]:n[r]}xl(t,n,o),Cl(t,o,e)}function Zt(t,e,a){return Math.max(Math.min(t,a),e)}function Sl(t,e){let a,i,n,o,r,s=ke(t[0],e);for(a=0,i=t.length;a<i;++a)r=o,o=s,s=a<i-1&&ke(t[a+1],e),o&&(n=t[a],r&&(n.cp1x=Zt(n.cp1x,e.left,e.right),n.cp1y=Zt(n.cp1y,e.top,e.bottom)),s&&(n.cp2x=Zt(n.cp2x,e.left,e.right),n.cp2y=Zt(n.cp2y,e.top,e.bottom)))}function El(t,e,a,i,n){let o,r,s,l;if(e.spanGaps&&(t=t.filter(c=>!c.skip)),e.cubicInterpolationMode==="monotone")Ml(t,n);else{let c=i?t[t.length-1]:t[0];for(o=0,r=t.length;o<r;++o)s=t[o],l=yl(c,s,t[Math.min(o+1,r-(i?0:1))%r],e.tension),s.cp1x=l.previous.x,s.cp1y=l.previous.y,s.cp2x=l.next.x,s.cp2y=l.next.y,c=s}e.capBezierPoints&&Sl(t,a)}function Mi(){return typeof window<"u"&&typeof document<"u"}function Si(t){let e=t.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function ma(t,e,a){let i;return typeof t=="string"?(i=parseInt(t,10),t.indexOf("%")!==-1&&(i=i/100*e.parentNode[a])):i=t,i}const Ea=t=>t.ownerDocument.defaultView.getComputedStyle(t,null);function kl(t,e){return Ea(t).getPropertyValue(e)}const Pl=["top","right","bottom","left"];function Je(t,e,a){const i={};a=a?"-"+a:"";for(let n=0;n<4;n++){const o=Pl[n];i[o]=parseFloat(t[e+"-"+o+a])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const Ll=(t,e,a)=>(t>0||e>0)&&(!a||!a.shadowRoot);function Al(t,e){const a=t.touches,i=a&&a.length?a[0]:t,{offsetX:n,offsetY:o}=i;let r=!1,s,l;if(Ll(n,o,t.target))s=n,l=o;else{const c=e.getBoundingClientRect();s=i.clientX-c.left,l=i.clientY-c.top,r=!0}return{x:s,y:l,box:r}}function Ue(t,e){if("native"in t)return t;const{canvas:a,currentDevicePixelRatio:i}=e,n=Ea(a),o=n.boxSizing==="border-box",r=Je(n,"padding"),s=Je(n,"border","width"),{x:l,y:c,box:d}=Al(t,a),p=r.left+(d&&s.left),u=r.top+(d&&s.top);let{width:h,height:f}=e;return o&&(h-=r.width+s.width,f-=r.height+s.height),{x:Math.round((l-p)/h*a.width/i),y:Math.round((c-u)/f*a.height/i)}}function Dl(t,e,a){let i,n;if(e===void 0||a===void 0){const o=t&&Si(t);if(!o)e=t.clientWidth,a=t.clientHeight;else{const r=o.getBoundingClientRect(),s=Ea(o),l=Je(s,"border","width"),c=Je(s,"padding");e=r.width-c.width-l.width,a=r.height-c.height-l.height,i=ma(s.maxWidth,o,"clientWidth"),n=ma(s.maxHeight,o,"clientHeight")}}return{width:e,height:a,maxWidth:i||ha,maxHeight:n||ha}}const Qt=t=>Math.round(t*10)/10;function Il(t,e,a,i){const n=Ea(t),o=Je(n,"margin"),r=ma(n.maxWidth,t,"clientWidth")||ha,s=ma(n.maxHeight,t,"clientHeight")||ha,l=Dl(t,e,a);let{width:c,height:d}=l;if(n.boxSizing==="content-box"){const u=Je(n,"border","width"),h=Je(n,"padding");c-=h.width+u.width,d-=h.height+u.height}return c=Math.max(0,c-o.width),d=Math.max(0,i?c/i:d-o.height),c=Qt(Math.min(c,r,l.maxWidth)),d=Qt(Math.min(d,s,l.maxHeight)),c&&!d&&(d=Qt(c/2)),(e!==void 0||a!==void 0)&&i&&l.height&&d>l.height&&(d=l.height,c=Qt(Math.floor(d*i))),{width:c,height:d}}function cn(t,e,a){const i=e||1,n=Math.floor(t.height*i),o=Math.floor(t.width*i);t.height=Math.floor(t.height),t.width=Math.floor(t.width);const r=t.canvas;return r.style&&(a||!r.style.height&&!r.style.width)&&(r.style.height=`${t.height}px`,r.style.width=`${t.width}px`),t.currentDevicePixelRatio!==i||r.height!==n||r.width!==o?(t.currentDevicePixelRatio=i,r.height=n,r.width=o,t.ctx.setTransform(i,0,0,i,0,0),!0):!1}const Bl=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};Mi()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return t}();function dn(t,e){const a=kl(t,e),i=a&&a.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function Ge(t,e,a,i){return{x:t.x+a*(e.x-t.x),y:t.y+a*(e.y-t.y)}}function Tl(t,e,a,i){return{x:t.x+a*(e.x-t.x),y:i==="middle"?a<.5?t.y:e.y:i==="after"?a<1?t.y:e.y:a>0?e.y:t.y}}function Yl(t,e,a,i){const n={x:t.cp2x,y:t.cp2y},o={x:e.cp1x,y:e.cp1y},r=Ge(t,n,a),s=Ge(n,o,a),l=Ge(o,e,a),c=Ge(r,s,a),d=Ge(s,l,a);return Ge(c,d,a)}const Rl=function(t,e){return{x(a){return t+t+e-a},setWidth(a){e=a},textAlign(a){return a==="center"?a:a==="right"?"left":"right"},xPlus(a,i){return a-i},leftForLtr(a,i){return a-i}}},Ol=function(){return{x(t){return t},setWidth(t){},textAlign(t){return t},xPlus(t,e){return t+e},leftForLtr(t,e){return t}}};function lt(t,e,a){return t?Rl(e,a):Ol()}function Vo(t,e){let a,i;(e==="ltr"||e==="rtl")&&(a=t.canvas.style,i=[a.getPropertyValue("direction"),a.getPropertyPriority("direction")],a.setProperty("direction",e,"important"),t.prevTextDirection=i)}function jo(t,e){e!==void 0&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function qo(t){return t==="angle"?{between:Yt,compare:Fs,normalize:le}:{between:Se,compare:(e,a)=>e-a,normalize:e=>e}}function pn({start:t,end:e,count:a,loop:i,style:n}){return{start:t%a,end:e%a,loop:i&&(e-t+1)%a===0,style:n}}function Fl(t,e,a){const{property:i,start:n,end:o}=a,{between:r,normalize:s}=qo(i),l=e.length;let{start:c,end:d,loop:p}=t,u,h;if(p){for(c+=l,d+=l,u=0,h=l;u<h&&r(s(e[c%l][i]),n,o);++u)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:p,style:t.style}}function Uo(t,e,a){if(!a)return[t];const{property:i,start:n,end:o}=a,r=e.length,{compare:s,between:l,normalize:c}=qo(i),{start:d,end:p,loop:u,style:h}=Fl(t,e,a),f=[];let m=!1,_=null,g,b,w;const y=()=>l(n,w,g)&&s(n,w)!==0,v=()=>s(o,g)===0||l(o,w,g),M=()=>m||y(),S=()=>!m||v();for(let x=d,C=d;x<=p;++x)b=e[x%r],!b.skip&&(g=c(b[i]),g!==w&&(m=l(g,n,o),_===null&&M()&&(_=s(g,n)===0?x:C),_!==null&&S()&&(f.push(pn({start:_,end:x,loop:u,count:r,style:h})),_=null),C=x,w=g));return _!==null&&f.push(pn({start:_,end:p,loop:u,count:r,style:h})),f}function Go(t,e){const a=[],i=t.segments;for(let n=0;n<i.length;n++){const o=Uo(i[n],t.points,e);o.length&&a.push(...o)}return a}function $l(t,e,a,i){let n=0,o=e-1;if(a&&!i)for(;n<e&&!t[n].skip;)n++;for(;n<e&&t[n].skip;)n++;for(n%=e,a&&(o+=n);o>n&&t[o%e].skip;)o--;return o%=e,{start:n,end:o}}function Nl(t,e,a,i){const n=t.length,o=[];let r=e,s=t[e],l;for(l=e+1;l<=a;++l){const c=t[l%n];c.skip||c.stop?s.skip||(i=!1,o.push({start:e%n,end:(l-1)%n,loop:i}),e=r=c.stop?l:null):(r=l,s.skip&&(e=l)),s=c}return r!==null&&o.push({start:e%n,end:r%n,loop:i}),o}function zl(t,e){const a=t.points,i=t.options.spanGaps,n=a.length;if(!n)return[];const o=!!t._loop,{start:r,end:s}=$l(a,n,o,i);if(i===!0)return un(t,[{start:r,end:s,loop:o}],a,e);const l=s<r?s+n:s,c=!!t._fullLoop&&r===0&&s===n-1;return un(t,Nl(a,r,l,c),a,e)}function un(t,e,a,i){return!i||!i.setContext||!a?e:Wl(t,e,a,i)}function Wl(t,e,a,i){const n=t._chart.getContext(),o=hn(t.options),{_datasetIndex:r,options:{spanGaps:s}}=t,l=a.length,c=[];let d=o,p=e[0].start,u=p;function h(f,m,_,g){const b=s?-1:1;if(f!==m){for(f+=l;a[f%l].skip;)f-=b;for(;a[m%l].skip;)m+=b;f%l!==m%l&&(c.push({start:f%l,end:m%l,loop:_,style:g}),d=g,p=m%l)}}for(const f of e){p=s?p:f.start;let m=a[p%l],_;for(u=p+1;u<=f.end;u++){const g=a[u%l];_=hn(i.setContext($e(n,{type:"segment",p0:m,p1:g,p0DataIndex:(u-1)%l,p1DataIndex:u%l,datasetIndex:r}))),Hl(_,d)&&h(p,u-1,f.loop,d),m=g,d=_}p<u-1&&h(p,u-1,f.loop,d)}return c}function hn(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function Hl(t,e){if(!e)return!1;const a=[],i=function(n,o){return vi(o)?(a.includes(o)||a.push(o),a.indexOf(o)):o};return JSON.stringify(t,i)!==JSON.stringify(e,i)}/*!
 * Chart.js v4.4.8
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class Vl{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,a,i,n){const o=a.listeners[n],r=a.duration;o.forEach(s=>s({chart:e,initial:a.initial,numSteps:r,currentStep:Math.min(i-a.start,r)}))}_refresh(){this._request||(this._running=!0,this._request=Do.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let a=0;this._charts.forEach((i,n)=>{if(!i.running||!i.items.length)return;const o=i.items;let r=o.length-1,s=!1,l;for(;r>=0;--r)l=o[r],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(e),s=!0):(o[r]=o[o.length-1],o.pop());s&&(n.draw(),this._notify(n,i,e,"progress")),o.length||(i.running=!1,this._notify(n,i,e,"complete"),i.initial=!1),a+=o.length}),this._lastDate=e,a===0&&(this._running=!1)}_getAnims(e){const a=this._charts;let i=a.get(e);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},a.set(e,i)),i}listen(e,a,i){this._getAnims(e).listeners[a].push(i)}add(e,a){!a||!a.length||this._getAnims(e).items.push(...a)}has(e){return this._getAnims(e).items.length>0}start(e){const a=this._charts.get(e);a&&(a.running=!0,a.start=Date.now(),a.duration=a.items.reduce((i,n)=>Math.max(i,n._duration),0),this._refresh())}running(e){if(!this._running)return!1;const a=this._charts.get(e);return!(!a||!a.running||!a.items.length)}stop(e){const a=this._charts.get(e);if(!a||!a.items.length)return;const i=a.items;let n=i.length-1;for(;n>=0;--n)i[n].cancel();a.items=[],this._notify(e,a,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var xe=new Vl;const fn="transparent",jl={boolean(t,e,a){return a>.5?e:t},color(t,e,a){const i=nn(t||fn),n=i.valid&&nn(e||fn);return n&&n.valid?n.mix(i,a).hexString():e},number(t,e,a){return t+(e-t)*a}};class ql{constructor(e,a,i,n){const o=a[i];n=St([e.to,n,o,e.from]);const r=St([e.from,o,n]);this._active=!0,this._fn=e.fn||jl[e.type||typeof r],this._easing=At[e.easing]||At.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=a,this._prop=i,this._from=r,this._to=n,this._promises=void 0}active(){return this._active}update(e,a,i){if(this._active){this._notify(!1);const n=this._target[this._prop],o=i-this._start,r=this._duration-o;this._start=i,this._duration=Math.floor(Math.max(r,e.duration)),this._total+=o,this._loop=!!e.loop,this._to=St([e.to,a,n,e.from]),this._from=St([e.from,n,a])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const a=e-this._start,i=this._duration,n=this._prop,o=this._from,r=this._loop,s=this._to;let l;if(this._active=o!==s&&(r||a<i),!this._active){this._target[n]=s,this._notify(!0);return}if(a<0){this._target[n]=o;return}l=a/i%2,l=r&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[n]=this._fn(o,s,l)}wait(){const e=this._promises||(this._promises=[]);return new Promise((a,i)=>{e.push({res:a,rej:i})})}_notify(e){const a=e?"res":"rej",i=this._promises||[];for(let n=0;n<i.length;n++)i[n][a]()}}class Ko{constructor(e,a){this._chart=e,this._properties=new Map,this.configure(a)}configure(e){if(!T(e))return;const a=Object.keys(j.animation),i=this._properties;Object.getOwnPropertyNames(e).forEach(n=>{const o=e[n];if(!T(o))return;const r={};for(const s of a)r[s]=o[s];(z(o.properties)&&o.properties||[n]).forEach(s=>{(s===n||!i.has(s))&&i.set(s,r)})})}_animateOptions(e,a){const i=a.options,n=Gl(e,i);if(!n)return[];const o=this._createAnimations(n,i);return i.$shared&&Ul(e.options.$animations,i).then(()=>{e.options=i},()=>{}),o}_createAnimations(e,a){const i=this._properties,n=[],o=e.$animations||(e.$animations={}),r=Object.keys(a),s=Date.now();let l;for(l=r.length-1;l>=0;--l){const c=r[l];if(c.charAt(0)==="$")continue;if(c==="options"){n.push(...this._animateOptions(e,a));continue}const d=a[c];let p=o[c];const u=i.get(c);if(p)if(u&&p.active()){p.update(u,d,s);continue}else p.cancel();if(!u||!u.duration){e[c]=d;continue}o[c]=p=new ql(u,e,c,d),n.push(p)}return n}update(e,a){if(this._properties.size===0){Object.assign(e,a);return}const i=this._createAnimations(e,a);if(i.length)return xe.add(this._chart,i),!0}}function Ul(t,e){const a=[],i=Object.keys(e);for(let n=0;n<i.length;n++){const o=t[i[n]];o&&o.active()&&a.push(o.wait())}return Promise.all(a)}function Gl(t,e){if(!e)return;let a=t.options;if(!a){t.options=e;return}return a.$shared&&(t.options=a=Object.assign({},a,{$shared:!1,$animations:{}})),a}function mn(t,e){const a=t&&t.options||{},i=a.reverse,n=a.min===void 0?e:0,o=a.max===void 0?e:0;return{start:i?o:n,end:i?n:o}}function Kl(t,e,a){if(a===!1)return!1;const i=mn(t,a),n=mn(e,a);return{top:n.end,right:i.end,bottom:n.start,left:i.start}}function Xl(t){let e,a,i,n;return T(t)?(e=t.top,a=t.right,i=t.bottom,n=t.left):e=a=i=n=t,{top:e,right:a,bottom:i,left:n,disabled:t===!1}}function Xo(t,e){const a=[],i=t._getSortedDatasetMetas(e);let n,o;for(n=0,o=i.length;n<o;++n)a.push(i[n].index);return a}function _n(t,e,a,i={}){const n=t.keys,o=i.mode==="single";let r,s,l,c;if(e===null)return;let d=!1;for(r=0,s=n.length;r<s;++r){if(l=+n[r],l===a){if(d=!0,i.all)continue;break}c=t.values[l],q(c)&&(o||e===0||be(e)===be(c))&&(e+=c)}return!d&&!i.all?0:e}function Jl(t,e){const{iScale:a,vScale:i}=e,n=a.axis==="x"?"x":"y",o=i.axis==="x"?"x":"y",r=Object.keys(t),s=new Array(r.length);let l,c,d;for(l=0,c=r.length;l<c;++l)d=r[l],s[l]={[n]:d,[o]:t[d]};return s}function Ya(t,e){const a=t&&t.options.stacked;return a||a===void 0&&e.stack!==void 0}function Zl(t,e,a){return`${t.id}.${e.id}.${a.stack||a.type}`}function Ql(t){const{min:e,max:a,minDefined:i,maxDefined:n}=t.getUserBounds();return{min:i?e:Number.NEGATIVE_INFINITY,max:n?a:Number.POSITIVE_INFINITY}}function ec(t,e,a){const i=t[e]||(t[e]={});return i[a]||(i[a]={})}function gn(t,e,a,i){for(const n of e.getMatchingVisibleMetas(i).reverse()){const o=t[n.index];if(a&&o>0||!a&&o<0)return n.index}return null}function bn(t,e){const{chart:a,_cachedMeta:i}=t,n=a._stacks||(a._stacks={}),{iScale:o,vScale:r,index:s}=i,l=o.axis,c=r.axis,d=Zl(o,r,i),p=e.length;let u;for(let h=0;h<p;++h){const f=e[h],{[l]:m,[c]:_}=f,g=f._stacks||(f._stacks={});u=g[c]=ec(n,d,m),u[s]=_,u._top=gn(u,r,!0,i.type),u._bottom=gn(u,r,!1,i.type);const b=u._visualValues||(u._visualValues={});b[s]=_}}function Ra(t,e){const a=t.scales;return Object.keys(a).filter(i=>a[i].axis===e).shift()}function tc(t,e){return $e(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function ac(t,e,a){return $e(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:a,index:e,mode:"default",type:"data"})}function vt(t,e){const a=t.controller.index,i=t.vScale&&t.vScale.axis;if(i){e=e||t._parsed;for(const n of e){const o=n._stacks;if(!o||o[i]===void 0||o[i][a]===void 0)return;delete o[i][a],o[i]._visualValues!==void 0&&o[i]._visualValues[a]!==void 0&&delete o[i]._visualValues[a]}}}const Oa=t=>t==="reset"||t==="none",vn=(t,e)=>e?t:Object.assign({},t),ic=(t,e,a)=>t&&!e.hidden&&e._stacked&&{keys:Xo(a,!0),values:null};class Ne{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,a){this.chart=e,this._ctx=e.ctx,this.index=a,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=Ya(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&vt(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,a=this._cachedMeta,i=this.getDataset(),n=(p,u,h,f)=>p==="x"?u:p==="r"?f:h,o=a.xAxisID=I(i.xAxisID,Ra(e,"x")),r=a.yAxisID=I(i.yAxisID,Ra(e,"y")),s=a.rAxisID=I(i.rAxisID,Ra(e,"r")),l=a.indexAxis,c=a.iAxisID=n(l,o,r,s),d=a.vAxisID=n(l,r,o,s);a.xScale=this.getScaleForId(o),a.yScale=this.getScaleForId(r),a.rScale=this.getScaleForId(s),a.iScale=this.getScaleForId(c),a.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const a=this._cachedMeta;return e===a.iScale?a.vScale:a.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&en(this._data,this),e._stacked&&vt(e)}_dataCheck(){const e=this.getDataset(),a=e.data||(e.data=[]),i=this._data;if(T(a)){const n=this._cachedMeta;this._data=Jl(a,n)}else if(i!==a){if(i){en(i,this);const n=this._cachedMeta;vt(n),n._parsed=[]}a&&Object.isExtensible(a)&&Ws(a,this),this._syncList=[],this._data=a}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const a=this._cachedMeta,i=this.getDataset();let n=!1;this._dataCheck();const o=a._stacked;a._stacked=Ya(a.vScale,a),a.stack!==i.stack&&(n=!0,vt(a),a.stack=i.stack),this._resyncElements(e),(n||o!==a._stacked)&&(bn(this,a._parsed),a._stacked=Ya(a.vScale,a))}configure(){const e=this.chart.config,a=e.datasetScopeKeys(this._type),i=e.getOptionScopes(this.getDataset(),a,!0);this.options=e.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,a){const{_cachedMeta:i,_data:n}=this,{iScale:o,_stacked:r}=i,s=o.axis;let l=e===0&&a===n.length?!0:i._sorted,c=e>0&&i._parsed[e-1],d,p,u;if(this._parsing===!1)i._parsed=n,i._sorted=!0,u=n;else{z(n[e])?u=this.parseArrayData(i,n,e,a):T(n[e])?u=this.parseObjectData(i,n,e,a):u=this.parsePrimitiveData(i,n,e,a);const h=()=>p[s]===null||c&&p[s]<c[s];for(d=0;d<a;++d)i._parsed[d+e]=p=u[d],l&&(h()&&(l=!1),c=p);i._sorted=l}r&&bn(this,u)}parsePrimitiveData(e,a,i,n){const{iScale:o,vScale:r}=e,s=o.axis,l=r.axis,c=o.getLabels(),d=o===r,p=new Array(n);let u,h,f;for(u=0,h=n;u<h;++u)f=u+i,p[u]={[s]:d||o.parse(c[f],f),[l]:r.parse(a[f],f)};return p}parseArrayData(e,a,i,n){const{xScale:o,yScale:r}=e,s=new Array(n);let l,c,d,p;for(l=0,c=n;l<c;++l)d=l+i,p=a[d],s[l]={x:o.parse(p[0],d),y:r.parse(p[1],d)};return s}parseObjectData(e,a,i,n){const{xScale:o,yScale:r}=e,{xAxisKey:s="x",yAxisKey:l="y"}=this._parsing,c=new Array(n);let d,p,u,h;for(d=0,p=n;d<p;++d)u=d+i,h=a[u],c[d]={x:o.parse(Oe(h,s),u),y:r.parse(Oe(h,l),u)};return c}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,a,i){const n=this.chart,o=this._cachedMeta,r=a[e.axis],s={keys:Xo(n,!0),values:a._stacks[e.axis]._visualValues};return _n(s,r,o.index,{mode:i})}updateRangeFromParsed(e,a,i,n){const o=i[a.axis];let r=o===null?NaN:o;const s=n&&i._stacks[a.axis];n&&s&&(n.values=s,r=_n(n,o,this._cachedMeta.index)),e.min=Math.min(e.min,r),e.max=Math.max(e.max,r)}getMinMax(e,a){const i=this._cachedMeta,n=i._parsed,o=i._sorted&&e===i.iScale,r=n.length,s=this._getOtherScale(e),l=ic(a,i,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:p}=Ql(s);let u,h;function f(){h=n[u];const m=h[s.axis];return!q(h[e.axis])||d>m||p<m}for(u=0;u<r&&!(!f()&&(this.updateRangeFromParsed(c,e,h,l),o));++u);if(o){for(u=r-1;u>=0;--u)if(!f()){this.updateRangeFromParsed(c,e,h,l);break}}return c}getAllParsedValues(e){const a=this._cachedMeta._parsed,i=[];let n,o,r;for(n=0,o=a.length;n<o;++n)r=a[n][e.axis],q(r)&&i.push(r);return i}getMaxOverflow(){return!1}getLabelAndValue(e){const a=this._cachedMeta,i=a.iScale,n=a.vScale,o=this.getParsed(e);return{label:i?""+i.getLabelForValue(o[i.axis]):"",value:n?""+n.getLabelForValue(o[n.axis]):""}}_update(e){const a=this._cachedMeta;this.update(e||"default"),a._clip=Xl(I(this.options.clip,Kl(a.xScale,a.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,a=this.chart,i=this._cachedMeta,n=i.data||[],o=a.chartArea,r=[],s=this._drawStart||0,l=this._drawCount||n.length-s,c=this.options.drawActiveElementsOnTop;let d;for(i.dataset&&i.dataset.draw(e,o,s,l),d=s;d<s+l;++d){const p=n[d];p.hidden||(p.active&&c?r.push(p):p.draw(e,o))}for(d=0;d<r.length;++d)r[d].draw(e,o)}getStyle(e,a){const i=a?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(e||0,i)}getContext(e,a,i){const n=this.getDataset();let o;if(e>=0&&e<this._cachedMeta.data.length){const r=this._cachedMeta.data[e];o=r.$context||(r.$context=ac(this.getContext(),e,r)),o.parsed=this.getParsed(e),o.raw=n.data[e],o.index=o.dataIndex=e}else o=this.$context||(this.$context=tc(this.chart.getContext(),this.index)),o.dataset=n,o.index=o.datasetIndex=this.index;return o.active=!!a,o.mode=i,o}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,a){return this._resolveElementOptions(this.dataElementType.id,a,e)}_resolveElementOptions(e,a="default",i){const n=a==="active",o=this._cachedDataOpts,r=e+"-"+a,s=o[r],l=this.enableOptionSharing&&Tt(i);if(s)return vn(s,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,e),p=n?[`${e}Hover`,"hover",e,""]:[e,""],u=c.getOptionScopes(this.getDataset(),d),h=Object.keys(j.elements[e]),f=()=>this.getContext(i,n,a),m=c.resolveNamedOptions(u,h,f,p);return m.$shared&&(m.$shared=l,o[r]=Object.freeze(vn(m,l))),m}_resolveAnimations(e,a,i){const n=this.chart,o=this._cachedDataOpts,r=`animation-${a}`,s=o[r];if(s)return s;let l;if(n.options.animation!==!1){const d=this.chart.config,p=d.datasetAnimationScopeKeys(this._type,a),u=d.getOptionScopes(this.getDataset(),p);l=d.createResolver(u,this.getContext(e,i,a))}const c=new Ko(n,l&&l.animations);return l&&l._cacheable&&(o[r]=Object.freeze(c)),c}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,a){return!a||Oa(e)||this.chart._animationsDisabled}_getSharedOptions(e,a){const i=this.resolveDataElementOptions(e,a),n=this._sharedOptions,o=this.getSharedOptions(i),r=this.includeOptions(a,o)||o!==n;return this.updateSharedOptions(o,a,i),{sharedOptions:o,includeOptions:r}}updateElement(e,a,i,n){Oa(n)?Object.assign(e,i):this._resolveAnimations(a,n).update(e,i)}updateSharedOptions(e,a,i){e&&!Oa(a)&&this._resolveAnimations(void 0,a).update(e,i)}_setStyle(e,a,i,n){e.active=n;const o=this.getStyle(a,n);this._resolveAnimations(a,i,n).update(e,{options:!n&&this.getSharedOptions(o)||o})}removeHoverStyle(e,a,i){this._setStyle(e,i,"active",!1)}setHoverStyle(e,a,i){this._setStyle(e,i,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const a=this._data,i=this._cachedMeta.data;for(const[s,l,c]of this._syncList)this[s](l,c);this._syncList=[];const n=i.length,o=a.length,r=Math.min(o,n);r&&this.parse(0,r),o>n?this._insertElements(n,o-n,e):o<n&&this._removeElements(o,n-o)}_insertElements(e,a,i=!0){const n=this._cachedMeta,o=n.data,r=e+a;let s;const l=c=>{for(c.length+=a,s=c.length-1;s>=r;s--)c[s]=c[s-a]};for(l(o),s=e;s<r;++s)o[s]=new this.dataElementType;this._parsing&&l(n._parsed),this.parse(e,a),i&&this.updateElements(o,e,a,"reset")}updateElements(e,a,i,n){}_removeElements(e,a){const i=this._cachedMeta;if(this._parsing){const n=i._parsed.splice(e,a);i._stacked&&vt(i,n)}i.data.splice(e,a)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[a,i,n]=e;this[a](i,n)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,a){a&&this._sync(["_removeElements",e,a]);const i=arguments.length-2;i&&this._sync(["_insertElements",e,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function nc(t,e){if(!t._cache.$bar){const a=t.getMatchingVisibleMetas(e);let i=[];for(let n=0,o=a.length;n<o;n++)i=i.concat(a[n].controller.getAllParsedValues(t));t._cache.$bar=Ao(i.sort((n,o)=>n-o))}return t._cache.$bar}function oc(t){const e=t.iScale,a=nc(e,t.type);let i=e._length,n,o,r,s;const l=()=>{r===32767||r===-32768||(Tt(s)&&(i=Math.min(i,Math.abs(r-s)||i)),s=r)};for(n=0,o=a.length;n<o;++n)r=e.getPixelForValue(a[n]),l();for(s=void 0,n=0,o=e.ticks.length;n<o;++n)r=e.getPixelForTick(n),l();return i}function rc(t,e,a,i){const n=a.barThickness;let o,r;return B(n)?(o=e.min*a.categoryPercentage,r=a.barPercentage):(o=n*i,r=1),{chunk:o/i,ratio:r,start:e.pixels[t]-o/2}}function sc(t,e,a,i){const n=e.pixels,o=n[t];let r=t>0?n[t-1]:null,s=t<n.length-1?n[t+1]:null;const l=a.categoryPercentage;r===null&&(r=o-(s===null?e.end-e.start:s-o)),s===null&&(s=o+o-r);const c=o-(o-Math.min(r,s))/2*l;return{chunk:Math.abs(s-r)/2*l/i,ratio:a.barPercentage,start:c}}function lc(t,e,a,i){const n=a.parse(t[0],i),o=a.parse(t[1],i),r=Math.min(n,o),s=Math.max(n,o);let l=r,c=s;Math.abs(r)>Math.abs(s)&&(l=s,c=r),e[a.axis]=c,e._custom={barStart:l,barEnd:c,start:n,end:o,min:r,max:s}}function Jo(t,e,a,i){return z(t)?lc(t,e,a,i):e[a.axis]=a.parse(t,i),e}function wn(t,e,a,i){const n=t.iScale,o=t.vScale,r=n.getLabels(),s=n===o,l=[];let c,d,p,u;for(c=a,d=a+i;c<d;++c)u=e[c],p={},p[n.axis]=s||n.parse(r[c],c),l.push(Jo(u,p,o,c));return l}function Fa(t){return t&&t.barStart!==void 0&&t.barEnd!==void 0}function cc(t,e,a){return t!==0?be(t):(e.isHorizontal()?1:-1)*(e.min>=a?1:-1)}function dc(t){let e,a,i,n,o;return t.horizontal?(e=t.base>t.x,a="left",i="right"):(e=t.base<t.y,a="bottom",i="top"),e?(n="end",o="start"):(n="start",o="end"),{start:a,end:i,reverse:e,top:n,bottom:o}}function pc(t,e,a,i){let n=e.borderSkipped;const o={};if(!n){t.borderSkipped=o;return}if(n===!0){t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:r,end:s,reverse:l,top:c,bottom:d}=dc(t);n==="middle"&&a&&(t.enableBorderRadius=!0,(a._top||0)===i?n=c:(a._bottom||0)===i?n=d:(o[yn(d,r,s,l)]=!0,n=c)),o[yn(n,r,s,l)]=!0,t.borderSkipped=o}function yn(t,e,a,i){return i?(t=uc(t,e,a),t=xn(t,a,e)):t=xn(t,e,a),t}function uc(t,e,a){return t===e?a:t===a?e:t}function xn(t,e,a){return t==="start"?e:t==="end"?a:t}function hc(t,{inflateAmount:e},a){t.inflateAmount=e==="auto"?a===1?.33:0:e}class fc extends Ne{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(e,a,i,n){return wn(e,a,i,n)}parseArrayData(e,a,i,n){return wn(e,a,i,n)}parseObjectData(e,a,i,n){const{iScale:o,vScale:r}=e,{xAxisKey:s="x",yAxisKey:l="y"}=this._parsing,c=o.axis==="x"?s:l,d=r.axis==="x"?s:l,p=[];let u,h,f,m;for(u=i,h=i+n;u<h;++u)m=a[u],f={},f[o.axis]=o.parse(Oe(m,c),u),p.push(Jo(Oe(m,d),f,r,u));return p}updateRangeFromParsed(e,a,i,n){super.updateRangeFromParsed(e,a,i,n);const o=i._custom;o&&a===this._cachedMeta.vScale&&(e.min=Math.min(e.min,o.min),e.max=Math.max(e.max,o.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const a=this._cachedMeta,{iScale:i,vScale:n}=a,o=this.getParsed(e),r=o._custom,s=Fa(r)?"["+r.start+", "+r.end+"]":""+n.getLabelForValue(o[n.axis]);return{label:""+i.getLabelForValue(o[i.axis]),value:s}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const a=this._cachedMeta;this.updateElements(a.data,0,a.data.length,e)}updateElements(e,a,i,n){const o=n==="reset",{index:r,_cachedMeta:{vScale:s}}=this,l=s.getBasePixel(),c=s.isHorizontal(),d=this._getRuler(),{sharedOptions:p,includeOptions:u}=this._getSharedOptions(a,n);for(let h=a;h<a+i;h++){const f=this.getParsed(h),m=o||B(f[s.axis])?{base:l,head:l}:this._calculateBarValuePixels(h),_=this._calculateBarIndexPixels(h,d),g=(f._stacks||{})[s.axis],b={horizontal:c,base:m.base,enableBorderRadius:!g||Fa(f._custom)||r===g._top||r===g._bottom,x:c?m.head:_.center,y:c?_.center:m.head,height:c?_.size:Math.abs(m.size),width:c?Math.abs(m.size):_.size};u&&(b.options=p||this.resolveDataElementOptions(h,e[h].active?"active":n));const w=b.options||e[h].options;pc(b,w,g,r),hc(b,w,d.ratio),this.updateElement(e[h],h,b,n)}}_getStacks(e,a){const{iScale:i}=this._cachedMeta,n=i.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),o=i.options.stacked,r=[],s=this._cachedMeta.controller.getParsed(a),l=s&&s[i.axis],c=d=>{const p=d._parsed.find(h=>h[i.axis]===l),u=p&&p[d.vScale.axis];if(B(u)||isNaN(u))return!0};for(const d of n)if(!(a!==void 0&&c(d))&&((o===!1||r.indexOf(d.stack)===-1||o===void 0&&d.stack===void 0)&&r.push(d.stack),d.index===e))break;return r.length||r.push(void 0),r}_getStackCount(e){return this._getStacks(void 0,e).length}_getStackIndex(e,a,i){const n=this._getStacks(e,i),o=a!==void 0?n.indexOf(a):-1;return o===-1?n.length-1:o}_getRuler(){const e=this.options,a=this._cachedMeta,i=a.iScale,n=[];let o,r;for(o=0,r=a.data.length;o<r;++o)n.push(i.getPixelForValue(this.getParsed(o)[i.axis],o));const s=e.barThickness;return{min:s||oc(a),pixels:n,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:e.grouped,ratio:s?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:a,_stacked:i,index:n},options:{base:o,minBarLength:r}}=this,s=o||0,l=this.getParsed(e),c=l._custom,d=Fa(c);let p=l[a.axis],u=0,h=i?this.applyStack(a,l,i):p,f,m;h!==p&&(u=h-p,h=p),d&&(p=c.barStart,h=c.barEnd-c.barStart,p!==0&&be(p)!==be(c.barEnd)&&(u=0),u+=p);const _=!B(o)&&!d?o:u;let g=a.getPixelForValue(_);if(this.chart.getDataVisibility(e)?f=a.getPixelForValue(u+h):f=g,m=f-g,Math.abs(m)<r){m=cc(m,a,s)*r,p===s&&(g-=m/2);const b=a.getPixelForDecimal(0),w=a.getPixelForDecimal(1),y=Math.min(b,w),v=Math.max(b,w);g=Math.max(Math.min(g,v),y),f=g+m,i&&!d&&(l._stacks[a.axis]._visualValues[n]=a.getValueForPixel(f)-a.getValueForPixel(g))}if(g===a.getPixelForValue(s)){const b=be(m)*a.getLineWidthForValue(s)/2;g+=b,m-=b}return{size:m,base:g,head:f,center:f+m/2}}_calculateBarIndexPixels(e,a){const i=a.scale,n=this.options,o=n.skipNull,r=I(n.maxBarThickness,1/0);let s,l;if(a.grouped){const c=o?this._getStackCount(e):a.stackCount,d=n.barThickness==="flex"?sc(e,a,n,c):rc(e,a,n,c),p=this._getStackIndex(this.index,this._cachedMeta.stack,o?e:void 0);s=d.start+d.chunk*p+d.chunk/2,l=Math.min(r,d.chunk*d.ratio)}else s=i.getPixelForValue(this.getParsed(e)[i.axis],e),l=Math.min(r,a.min*a.ratio);return{base:s-l/2,head:s+l/2,center:s,size:l}}draw(){const e=this._cachedMeta,a=e.vScale,i=e.data,n=i.length;let o=0;for(;o<n;++o)this.getParsed(o)[a.axis]!==null&&!i[o].hidden&&i[o].draw(this._ctx)}}class mc extends Ne{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,a,i,n){const o=super.parsePrimitiveData(e,a,i,n);for(let r=0;r<o.length;r++)o[r]._custom=this.resolveDataElementOptions(r+i).radius;return o}parseArrayData(e,a,i,n){const o=super.parseArrayData(e,a,i,n);for(let r=0;r<o.length;r++){const s=a[i+r];o[r]._custom=I(s[2],this.resolveDataElementOptions(r+i).radius)}return o}parseObjectData(e,a,i,n){const o=super.parseObjectData(e,a,i,n);for(let r=0;r<o.length;r++){const s=a[i+r];o[r]._custom=I(s&&s.r&&+s.r,this.resolveDataElementOptions(r+i).radius)}return o}getMaxOverflow(){const e=this._cachedMeta.data;let a=0;for(let i=e.length-1;i>=0;--i)a=Math.max(a,e[i].size(this.resolveDataElementOptions(i))/2);return a>0&&a}getLabelAndValue(e){const a=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:o}=a,r=this.getParsed(e),s=n.getLabelForValue(r.x),l=o.getLabelForValue(r.y),c=r._custom;return{label:i[e]||"",value:"("+s+", "+l+(c?", "+c:"")+")"}}update(e){const a=this._cachedMeta.data;this.updateElements(a,0,a.length,e)}updateElements(e,a,i,n){const o=n==="reset",{iScale:r,vScale:s}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(a,n),d=r.axis,p=s.axis;for(let u=a;u<a+i;u++){const h=e[u],f=!o&&this.getParsed(u),m={},_=m[d]=o?r.getPixelForDecimal(.5):r.getPixelForValue(f[d]),g=m[p]=o?s.getBasePixel():s.getPixelForValue(f[p]);m.skip=isNaN(_)||isNaN(g),c&&(m.options=l||this.resolveDataElementOptions(u,h.active?"active":n),o&&(m.options.radius=0)),this.updateElement(h,u,m,n)}}resolveDataElementOptions(e,a){const i=this.getParsed(e);let n=super.resolveDataElementOptions(e,a);n.$shared&&(n=Object.assign({},n,{$shared:!1}));const o=n.radius;return a!=="active"&&(n.radius=0),n.radius+=I(i&&i._custom,o),n}}function _c(t,e,a){let i=1,n=1,o=0,r=0;if(e<W){const s=t,l=s+e,c=Math.cos(s),d=Math.sin(s),p=Math.cos(l),u=Math.sin(l),h=(w,y,v)=>Yt(w,s,l,!0)?1:Math.max(y,y*a,v,v*a),f=(w,y,v)=>Yt(w,s,l,!0)?-1:Math.min(y,y*a,v,v*a),m=h(0,c,p),_=h(U,d,u),g=f(H,c,p),b=f(H+U,d,u);i=(m-g)/2,n=(_-b)/2,o=-(m+g)/2,r=-(_+b)/2}return{ratioX:i,ratioY:n,offsetX:o,offsetY:r}}class Ei extends Ne{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:e=>e!=="spacing",_indexable:e=>e!=="spacing"&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const a=e.data;if(a.labels.length&&a.datasets.length){const{labels:{pointStyle:i,color:n}}=e.legend.options;return a.labels.map((o,r)=>{const l=e.getDatasetMeta(0).controller.getStyle(r);return{text:o,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:n,lineWidth:l.borderWidth,pointStyle:i,hidden:!e.getDataVisibility(r),index:r}})}return[]}},onClick(e,a,i){i.chart.toggleDataVisibility(a.index),i.chart.update()}}}};constructor(e,a){super(e,a),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,a){const i=this.getDataset().data,n=this._cachedMeta;if(this._parsing===!1)n._parsed=i;else{let o=l=>+i[l];if(T(i[e])){const{key:l="value"}=this._parsing;o=c=>+Oe(i[c],l)}let r,s;for(r=e,s=e+a;r<s;++r)n._parsed[r]=o(r)}}_getRotation(){return pe(this.options.rotation-90)}_getCircumference(){return pe(this.options.circumference)}_getRotationExtents(){let e=W,a=-W;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const n=this.chart.getDatasetMeta(i).controller,o=n._getRotation(),r=n._getCircumference();e=Math.min(e,o),a=Math.max(a,o+r)}return{rotation:e,circumference:a-e}}update(e){const a=this.chart,{chartArea:i}=a,n=this._cachedMeta,o=n.data,r=this.getMaxBorderWidth()+this.getMaxOffset(o)+this.options.spacing,s=Math.max((Math.min(i.width,i.height)-r)/2,0),l=Math.min(ks(this.options.cutout,s),1),c=this._getRingWeight(this.index),{circumference:d,rotation:p}=this._getRotationExtents(),{ratioX:u,ratioY:h,offsetX:f,offsetY:m}=_c(p,d,l),_=(i.width-r)/u,g=(i.height-r)/h,b=Math.max(Math.min(_,g)/2,0),w=So(this.options.radius,b),y=Math.max(w*l,0),v=(w-y)/this._getVisibleDatasetWeightTotal();this.offsetX=f*w,this.offsetY=m*w,n.total=this.calculateTotal(),this.outerRadius=w-v*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-v*c,0),this.updateElements(o,0,o.length,e)}_circumference(e,a){const i=this.options,n=this._cachedMeta,o=this._getCircumference();return a&&i.animation.animateRotate||!this.chart.getDataVisibility(e)||n._parsed[e]===null||n.data[e].hidden?0:this.calculateCircumference(n._parsed[e]*o/W)}updateElements(e,a,i,n){const o=n==="reset",r=this.chart,s=r.chartArea,c=r.options.animation,d=(s.left+s.right)/2,p=(s.top+s.bottom)/2,u=o&&c.animateScale,h=u?0:this.innerRadius,f=u?0:this.outerRadius,{sharedOptions:m,includeOptions:_}=this._getSharedOptions(a,n);let g=this._getRotation(),b;for(b=0;b<a;++b)g+=this._circumference(b,o);for(b=a;b<a+i;++b){const w=this._circumference(b,o),y=e[b],v={x:d+this.offsetX,y:p+this.offsetY,startAngle:g,endAngle:g+w,circumference:w,outerRadius:f,innerRadius:h};_&&(v.options=m||this.resolveDataElementOptions(b,y.active?"active":n)),g+=w,this.updateElement(y,b,v,n)}}calculateTotal(){const e=this._cachedMeta,a=e.data;let i=0,n;for(n=0;n<a.length;n++){const o=e._parsed[n];o!==null&&!isNaN(o)&&this.chart.getDataVisibility(n)&&!a[n].hidden&&(i+=Math.abs(o))}return i}calculateCircumference(e){const a=this._cachedMeta.total;return a>0&&!isNaN(e)?W*(Math.abs(e)/a):0}getLabelAndValue(e){const a=this._cachedMeta,i=this.chart,n=i.data.labels||[],o=zt(a._parsed[e],i.options.locale);return{label:n[e]||"",value:o}}getMaxBorderWidth(e){let a=0;const i=this.chart;let n,o,r,s,l;if(!e){for(n=0,o=i.data.datasets.length;n<o;++n)if(i.isDatasetVisible(n)){r=i.getDatasetMeta(n),e=r.data,s=r.controller;break}}if(!e)return 0;for(n=0,o=e.length;n<o;++n)l=s.resolveDataElementOptions(n),l.borderAlign!=="inner"&&(a=Math.max(a,l.borderWidth||0,l.hoverBorderWidth||0));return a}getMaxOffset(e){let a=0;for(let i=0,n=e.length;i<n;++i){const o=this.resolveDataElementOptions(i);a=Math.max(a,o.offset||0,o.hoverOffset||0)}return a}_getRingWeightOffset(e){let a=0;for(let i=0;i<e;++i)this.chart.isDatasetVisible(i)&&(a+=this._getRingWeight(i));return a}_getRingWeight(e){return Math.max(I(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class gc extends Ne{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const a=this._cachedMeta,{dataset:i,data:n=[],_dataset:o}=a,r=this.chart._animationsDisabled;let{start:s,count:l}=Bo(a,n,r);this._drawStart=s,this._drawCount=l,To(a)&&(s=0,l=n.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!o._decimated,i.points=n;const c=this.resolveDatasetElementOptions(e);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(i,void 0,{animated:!r,options:c},e),this.updateElements(n,s,l,e)}updateElements(e,a,i,n){const o=n==="reset",{iScale:r,vScale:s,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:p}=this._getSharedOptions(a,n),u=r.axis,h=s.axis,{spanGaps:f,segment:m}=this.options,_=ct(f)?f:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||o||n==="none",b=a+i,w=e.length;let y=a>0&&this.getParsed(a-1);for(let v=0;v<w;++v){const M=e[v],S=g?M:{};if(v<a||v>=b){S.skip=!0;continue}const x=this.getParsed(v),C=B(x[h]),E=S[u]=r.getPixelForValue(x[u],v),P=S[h]=o||C?s.getBasePixel():s.getPixelForValue(l?this.applyStack(s,x,l):x[h],v);S.skip=isNaN(E)||isNaN(P)||C,S.stop=v>0&&Math.abs(x[u]-y[u])>_,m&&(S.parsed=x,S.raw=c.data[v]),p&&(S.options=d||this.resolveDataElementOptions(v,M.active?"active":n)),g||this.updateElement(M,v,S,n),y=x}}getMaxOverflow(){const e=this._cachedMeta,a=e.dataset,i=a.options&&a.options.borderWidth||0,n=e.data||[];if(!n.length)return i;const o=n[0].size(this.resolveDataElementOptions(0)),r=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(i,o,r)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}class Zo extends Ne{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const a=e.data;if(a.labels.length&&a.datasets.length){const{labels:{pointStyle:i,color:n}}=e.legend.options;return a.labels.map((o,r)=>{const l=e.getDatasetMeta(0).controller.getStyle(r);return{text:o,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:n,lineWidth:l.borderWidth,pointStyle:i,hidden:!e.getDataVisibility(r),index:r}})}return[]}},onClick(e,a,i){i.chart.toggleDataVisibility(a.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(e,a){super(e,a),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const a=this._cachedMeta,i=this.chart,n=i.data.labels||[],o=zt(a._parsed[e].r,i.options.locale);return{label:n[e]||"",value:o}}parseObjectData(e,a,i,n){return Wo.bind(this)(e,a,i,n)}update(e){const a=this._cachedMeta.data;this._updateRadius(),this.updateElements(a,0,a.length,e)}getMinMax(){const e=this._cachedMeta,a={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((i,n)=>{const o=this.getParsed(n).r;!isNaN(o)&&this.chart.getDataVisibility(n)&&(o<a.min&&(a.min=o),o>a.max&&(a.max=o))}),a}_updateRadius(){const e=this.chart,a=e.chartArea,i=e.options,n=Math.min(a.right-a.left,a.bottom-a.top),o=Math.max(n/2,0),r=Math.max(i.cutoutPercentage?o/100*i.cutoutPercentage:1,0),s=(o-r)/e.getVisibleDatasetCount();this.outerRadius=o-s*this.index,this.innerRadius=this.outerRadius-s}updateElements(e,a,i,n){const o=n==="reset",r=this.chart,l=r.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,p=c.yCenter,u=c.getIndexAngle(0)-.5*H;let h=u,f;const m=360/this.countVisibleElements();for(f=0;f<a;++f)h+=this._computeAngle(f,n,m);for(f=a;f<a+i;f++){const _=e[f];let g=h,b=h+this._computeAngle(f,n,m),w=r.getDataVisibility(f)?c.getDistanceFromCenterForValue(this.getParsed(f).r):0;h=b,o&&(l.animateScale&&(w=0),l.animateRotate&&(g=b=u));const y={x:d,y:p,innerRadius:0,outerRadius:w,startAngle:g,endAngle:b,options:this.resolveDataElementOptions(f,_.active?"active":n)};this.updateElement(_,f,y,n)}}countVisibleElements(){const e=this._cachedMeta;let a=0;return e.data.forEach((i,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&a++}),a}_computeAngle(e,a,i){return this.chart.getDataVisibility(e)?pe(this.resolveDataElementOptions(e,a).angle||i):0}}class bc extends Ei{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}class vc extends Ne{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(e){const a=this._cachedMeta.vScale,i=this.getParsed(e);return{label:a.getLabels()[e],value:""+a.getLabelForValue(i[a.axis])}}parseObjectData(e,a,i,n){return Wo.bind(this)(e,a,i,n)}update(e){const a=this._cachedMeta,i=a.dataset,n=a.data||[],o=a.iScale.getLabels();if(i.points=n,e!=="resize"){const r=this.resolveDatasetElementOptions(e);this.options.showLine||(r.borderWidth=0);const s={_loop:!0,_fullLoop:o.length===n.length,options:r};this.updateElement(i,void 0,s,e)}this.updateElements(n,0,n.length,e)}updateElements(e,a,i,n){const o=this._cachedMeta.rScale,r=n==="reset";for(let s=a;s<a+i;s++){const l=e[s],c=this.resolveDataElementOptions(s,l.active?"active":n),d=o.getPointPositionForValue(s,this.getParsed(s).r),p=r?o.xCenter:d.x,u=r?o.yCenter:d.y,h={x:p,y:u,angle:d.angle,skip:isNaN(p)||isNaN(u),options:c};this.updateElement(l,s,h,n)}}}class wc extends Ne{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(e){const a=this._cachedMeta,i=this.chart.data.labels||[],{xScale:n,yScale:o}=a,r=this.getParsed(e),s=n.getLabelForValue(r.x),l=o.getLabelForValue(r.y);return{label:i[e]||"",value:"("+s+", "+l+")"}}update(e){const a=this._cachedMeta,{data:i=[]}=a,n=this.chart._animationsDisabled;let{start:o,count:r}=Bo(a,i,n);if(this._drawStart=o,this._drawCount=r,To(a)&&(o=0,r=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:s,_dataset:l}=a;s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!l._decimated,s.points=i;const c=this.resolveDatasetElementOptions(e);c.segment=this.options.segment,this.updateElement(s,void 0,{animated:!n,options:c},e)}else this.datasetElementType&&(delete a.dataset,this.datasetElementType=!1);this.updateElements(i,o,r,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,a,i,n){const o=n==="reset",{iScale:r,vScale:s,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(a,n),p=this.getSharedOptions(d),u=this.includeOptions(n,p),h=r.axis,f=s.axis,{spanGaps:m,segment:_}=this.options,g=ct(m)?m:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||o||n==="none";let w=a>0&&this.getParsed(a-1);for(let y=a;y<a+i;++y){const v=e[y],M=this.getParsed(y),S=b?v:{},x=B(M[f]),C=S[h]=r.getPixelForValue(M[h],y),E=S[f]=o||x?s.getBasePixel():s.getPixelForValue(l?this.applyStack(s,M,l):M[f],y);S.skip=isNaN(C)||isNaN(E)||x,S.stop=y>0&&Math.abs(M[h]-w[h])>g,_&&(S.parsed=M,S.raw=c.data[y]),u&&(S.options=p||this.resolveDataElementOptions(y,v.active?"active":n)),b||this.updateElement(v,y,S,n),w=M}this.updateSharedOptions(p,n,d)}getMaxOverflow(){const e=this._cachedMeta,a=e.data||[];if(!this.options.showLine){let s=0;for(let l=a.length-1;l>=0;--l)s=Math.max(s,a[l].size(this.resolveDataElementOptions(l))/2);return s>0&&s}const i=e.dataset,n=i.options&&i.options.borderWidth||0;if(!a.length)return n;const o=a[0].size(this.resolveDataElementOptions(0)),r=a[a.length-1].size(this.resolveDataElementOptions(a.length-1));return Math.max(n,o,r)/2}}var yc=Object.freeze({__proto__:null,BarController:fc,BubbleController:mc,DoughnutController:Ei,LineController:gc,PieController:bc,PolarAreaController:Zo,RadarController:vc,ScatterController:wc});function je(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class ki{static override(e){Object.assign(ki.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return je()}parse(){return je()}format(){return je()}add(){return je()}diff(){return je()}startOf(){return je()}endOf(){return je()}}var xc={_date:ki};function Cc(t,e,a,i){const{controller:n,data:o,_sorted:r}=t,s=n._cachedMeta.iScale,l=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null;if(s&&e===s.axis&&e!=="r"&&r&&o.length){const c=s._reversePixels?Ns:Ee;if(i){if(n._sharedOptions){const d=o[0],p=typeof d.getRange=="function"&&d.getRange(e);if(p){const u=c(o,e,a-p),h=c(o,e,a+p);return{lo:u.lo,hi:h.hi}}}}else{const d=c(o,e,a);if(l){const{vScale:p}=n._cachedMeta,{_parsed:u}=t,h=u.slice(0,d.lo+1).reverse().findIndex(m=>!B(m[p.axis]));d.lo-=Math.max(0,h);const f=u.slice(d.hi).findIndex(m=>!B(m[p.axis]));d.hi+=Math.max(0,f)}return d}}return{lo:0,hi:o.length-1}}function Wt(t,e,a,i,n){const o=t.getSortedVisibleDatasetMetas(),r=a[e];for(let s=0,l=o.length;s<l;++s){const{index:c,data:d}=o[s],{lo:p,hi:u}=Cc(o[s],e,r,n);for(let h=p;h<=u;++h){const f=d[h];f.skip||i(f,c,h)}}}function Mc(t){const e=t.indexOf("x")!==-1,a=t.indexOf("y")!==-1;return function(i,n){const o=e?Math.abs(i.x-n.x):0,r=a?Math.abs(i.y-n.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(r,2))}}function $a(t,e,a,i,n){const o=[];return!n&&!t.isPointInArea(e)||Wt(t,a,e,function(s,l,c){!n&&!ke(s,t.chartArea,0)||s.inRange(e.x,e.y,i)&&o.push({element:s,datasetIndex:l,index:c})},!0),o}function Sc(t,e,a,i){let n=[];function o(r,s,l){const{startAngle:c,endAngle:d}=r.getProps(["startAngle","endAngle"],i),{angle:p}=Po(r,{x:e.x,y:e.y});Yt(p,c,d)&&n.push({element:r,datasetIndex:s,index:l})}return Wt(t,a,e,o),n}function Ec(t,e,a,i,n,o){let r=[];const s=Mc(a);let l=Number.POSITIVE_INFINITY;function c(d,p,u){const h=d.inRange(e.x,e.y,n);if(i&&!h)return;const f=d.getCenterPoint(n);if(!(!!o||t.isPointInArea(f))&&!h)return;const _=s(e,f);_<l?(r=[{element:d,datasetIndex:p,index:u}],l=_):_===l&&r.push({element:d,datasetIndex:p,index:u})}return Wt(t,a,e,c),r}function Na(t,e,a,i,n,o){return!o&&!t.isPointInArea(e)?[]:a==="r"&&!i?Sc(t,e,a,n):Ec(t,e,a,i,n,o)}function Cn(t,e,a,i,n){const o=[],r=a==="x"?"inXRange":"inYRange";let s=!1;return Wt(t,a,e,(l,c,d)=>{l[r]&&l[r](e[a],n)&&(o.push({element:l,datasetIndex:c,index:d}),s=s||l.inRange(e.x,e.y,n))}),i&&!s?[]:o}var kc={evaluateInteractionItems:Wt,modes:{index(t,e,a,i){const n=Ue(e,t),o=a.axis||"x",r=a.includeInvisible||!1,s=a.intersect?$a(t,n,o,i,r):Na(t,n,o,!1,i,r),l=[];return s.length?(t.getSortedVisibleDatasetMetas().forEach(c=>{const d=s[0].index,p=c.data[d];p&&!p.skip&&l.push({element:p,datasetIndex:c.index,index:d})}),l):[]},dataset(t,e,a,i){const n=Ue(e,t),o=a.axis||"xy",r=a.includeInvisible||!1;let s=a.intersect?$a(t,n,o,i,r):Na(t,n,o,!1,i,r);if(s.length>0){const l=s[0].datasetIndex,c=t.getDatasetMeta(l).data;s=[];for(let d=0;d<c.length;++d)s.push({element:c[d],datasetIndex:l,index:d})}return s},point(t,e,a,i){const n=Ue(e,t),o=a.axis||"xy",r=a.includeInvisible||!1;return $a(t,n,o,i,r)},nearest(t,e,a,i){const n=Ue(e,t),o=a.axis||"xy",r=a.includeInvisible||!1;return Na(t,n,o,a.intersect,i,r)},x(t,e,a,i){const n=Ue(e,t);return Cn(t,n,"x",a.intersect,i)},y(t,e,a,i){const n=Ue(e,t);return Cn(t,n,"y",a.intersect,i)}}};const Qo=["left","top","right","bottom"];function wt(t,e){return t.filter(a=>a.pos===e)}function Mn(t,e){return t.filter(a=>Qo.indexOf(a.pos)===-1&&a.box.axis===e)}function yt(t,e){return t.sort((a,i)=>{const n=e?i:a,o=e?a:i;return n.weight===o.weight?n.index-o.index:n.weight-o.weight})}function Pc(t){const e=[];let a,i,n,o,r,s;for(a=0,i=(t||[]).length;a<i;++a)n=t[a],{position:o,options:{stack:r,stackWeight:s=1}}=n,e.push({index:a,box:n,pos:o,horizontal:n.isHorizontal(),weight:n.weight,stack:r&&o+r,stackWeight:s});return e}function Lc(t){const e={};for(const a of t){const{stack:i,pos:n,stackWeight:o}=a;if(!i||!Qo.includes(n))continue;const r=e[i]||(e[i]={count:0,placed:0,weight:0,size:0});r.count++,r.weight+=o}return e}function Ac(t,e){const a=Lc(t),{vBoxMaxWidth:i,hBoxMaxHeight:n}=e;let o,r,s;for(o=0,r=t.length;o<r;++o){s=t[o];const{fullSize:l}=s.box,c=a[s.stack],d=c&&s.stackWeight/c.weight;s.horizontal?(s.width=d?d*i:l&&e.availableWidth,s.height=n):(s.width=i,s.height=d?d*n:l&&e.availableHeight)}return a}function Dc(t){const e=Pc(t),a=yt(e.filter(c=>c.box.fullSize),!0),i=yt(wt(e,"left"),!0),n=yt(wt(e,"right")),o=yt(wt(e,"top"),!0),r=yt(wt(e,"bottom")),s=Mn(e,"x"),l=Mn(e,"y");return{fullSize:a,leftAndTop:i.concat(o),rightAndBottom:n.concat(l).concat(r).concat(s),chartArea:wt(e,"chartArea"),vertical:i.concat(n).concat(l),horizontal:o.concat(r).concat(s)}}function Sn(t,e,a,i){return Math.max(t[a],e[a])+Math.max(t[i],e[i])}function er(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function Ic(t,e,a,i){const{pos:n,box:o}=a,r=t.maxPadding;if(!T(n)){a.size&&(t[n]-=a.size);const p=i[a.stack]||{size:0,count:1};p.size=Math.max(p.size,a.horizontal?o.height:o.width),a.size=p.size/p.count,t[n]+=a.size}o.getPadding&&er(r,o.getPadding());const s=Math.max(0,e.outerWidth-Sn(r,t,"left","right")),l=Math.max(0,e.outerHeight-Sn(r,t,"top","bottom")),c=s!==t.w,d=l!==t.h;return t.w=s,t.h=l,a.horizontal?{same:c,other:d}:{same:d,other:c}}function Bc(t){const e=t.maxPadding;function a(i){const n=Math.max(e[i]-t[i],0);return t[i]+=n,n}t.y+=a("top"),t.x+=a("left"),a("right"),a("bottom")}function Tc(t,e){const a=e.maxPadding;function i(n){const o={left:0,top:0,right:0,bottom:0};return n.forEach(r=>{o[r]=Math.max(e[r],a[r])}),o}return i(t?["left","right"]:["top","bottom"])}function Et(t,e,a,i){const n=[];let o,r,s,l,c,d;for(o=0,r=t.length,c=0;o<r;++o){s=t[o],l=s.box,l.update(s.width||e.w,s.height||e.h,Tc(s.horizontal,e));const{same:p,other:u}=Ic(e,a,s,i);c|=p&&n.length,d=d||u,l.fullSize||n.push(s)}return c&&Et(n,e,a,i)||d}function ea(t,e,a,i,n){t.top=a,t.left=e,t.right=e+i,t.bottom=a+n,t.width=i,t.height=n}function En(t,e,a,i){const n=a.padding;let{x:o,y:r}=e;for(const s of t){const l=s.box,c=i[s.stack]||{count:1,placed:0,weight:1},d=s.stackWeight/c.weight||1;if(s.horizontal){const p=e.w*d,u=c.size||l.height;Tt(c.start)&&(r=c.start),l.fullSize?ea(l,n.left,r,a.outerWidth-n.right-n.left,u):ea(l,e.left+c.placed,r,p,u),c.start=r,c.placed+=p,r=l.bottom}else{const p=e.h*d,u=c.size||l.width;Tt(c.start)&&(o=c.start),l.fullSize?ea(l,o,n.top,u,a.outerHeight-n.bottom-n.top):ea(l,o,e.top+c.placed,u,p),c.start=o,c.placed+=p,o=l.right}}e.x=o,e.y=r}var ae={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(a){e.draw(a)}}]},t.boxes.push(e)},removeBox(t,e){const a=t.boxes?t.boxes.indexOf(e):-1;a!==-1&&t.boxes.splice(a,1)},configure(t,e,a){e.fullSize=a.fullSize,e.position=a.position,e.weight=a.weight},update(t,e,a,i){if(!t)return;const n=ie(t.options.layout.padding),o=Math.max(e-n.width,0),r=Math.max(a-n.height,0),s=Dc(t.boxes),l=s.vertical,c=s.horizontal;F(t.boxes,m=>{typeof m.beforeLayout=="function"&&m.beforeLayout()});const d=l.reduce((m,_)=>_.box.options&&_.box.options.display===!1?m:m+1,0)||1,p=Object.freeze({outerWidth:e,outerHeight:a,padding:n,availableWidth:o,availableHeight:r,vBoxMaxWidth:o/2/d,hBoxMaxHeight:r/2}),u=Object.assign({},n);er(u,ie(i));const h=Object.assign({maxPadding:u,w:o,h:r,x:n.left,y:n.top},n),f=Ac(l.concat(c),p);Et(s.fullSize,h,p,f),Et(l,h,p,f),Et(c,h,p,f)&&Et(l,h,p,f),Bc(h),En(s.leftAndTop,h,p,f),h.x+=h.w,h.y+=h.h,En(s.rightAndBottom,h,p,f),t.chartArea={left:h.left,top:h.top,right:h.left+h.w,bottom:h.top+h.h,height:h.h,width:h.w},F(s.chartArea,m=>{const _=m.box;Object.assign(_,t.chartArea),_.update(h.w,h.h,{left:0,top:0,right:0,bottom:0})})}};class tr{acquireContext(e,a){}releaseContext(e){return!1}addEventListener(e,a,i){}removeEventListener(e,a,i){}getDevicePixelRatio(){return 1}getMaximumSize(e,a,i,n){return a=Math.max(0,a||e.width),i=i||e.height,{width:a,height:Math.max(0,n?Math.floor(a/n):i)}}isAttached(e){return!0}updateConfig(e){}}class Yc extends tr{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const la="$chartjs",Rc={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},kn=t=>t===null||t==="";function Oc(t,e){const a=t.style,i=t.getAttribute("height"),n=t.getAttribute("width");if(t[la]={initial:{height:i,width:n,style:{display:a.display,height:a.height,width:a.width}}},a.display=a.display||"block",a.boxSizing=a.boxSizing||"border-box",kn(n)){const o=dn(t,"width");o!==void 0&&(t.width=o)}if(kn(i))if(t.style.height==="")t.height=t.width/(e||2);else{const o=dn(t,"height");o!==void 0&&(t.height=o)}return t}const ar=Bl?{passive:!0}:!1;function Fc(t,e,a){t&&t.addEventListener(e,a,ar)}function $c(t,e,a){t&&t.canvas&&t.canvas.removeEventListener(e,a,ar)}function Nc(t,e){const a=Rc[t.type]||t.type,{x:i,y:n}=Ue(t,e);return{type:a,chart:e,native:t,x:i!==void 0?i:null,y:n!==void 0?n:null}}function _a(t,e){for(const a of t)if(a===e||a.contains(e))return!0}function zc(t,e,a){const i=t.canvas,n=new MutationObserver(o=>{let r=!1;for(const s of o)r=r||_a(s.addedNodes,i),r=r&&!_a(s.removedNodes,i);r&&a()});return n.observe(document,{childList:!0,subtree:!0}),n}function Wc(t,e,a){const i=t.canvas,n=new MutationObserver(o=>{let r=!1;for(const s of o)r=r||_a(s.removedNodes,i),r=r&&!_a(s.addedNodes,i);r&&a()});return n.observe(document,{childList:!0,subtree:!0}),n}const Ot=new Map;let Pn=0;function ir(){const t=window.devicePixelRatio;t!==Pn&&(Pn=t,Ot.forEach((e,a)=>{a.currentDevicePixelRatio!==t&&e()}))}function Hc(t,e){Ot.size||window.addEventListener("resize",ir),Ot.set(t,e)}function Vc(t){Ot.delete(t),Ot.size||window.removeEventListener("resize",ir)}function jc(t,e,a){const i=t.canvas,n=i&&Si(i);if(!n)return;const o=Io((s,l)=>{const c=n.clientWidth;a(s,l),c<n.clientWidth&&a()},window),r=new ResizeObserver(s=>{const l=s[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||o(c,d)});return r.observe(n),Hc(t,o),r}function za(t,e,a){a&&a.disconnect(),e==="resize"&&Vc(t)}function qc(t,e,a){const i=t.canvas,n=Io(o=>{t.ctx!==null&&a(Nc(o,t))},t);return Fc(i,e,n),n}class Uc extends tr{acquireContext(e,a){const i=e&&e.getContext&&e.getContext("2d");return i&&i.canvas===e?(Oc(e,a),i):null}releaseContext(e){const a=e.canvas;if(!a[la])return!1;const i=a[la].initial;["height","width"].forEach(o=>{const r=i[o];B(r)?a.removeAttribute(o):a.setAttribute(o,r)});const n=i.style||{};return Object.keys(n).forEach(o=>{a.style[o]=n[o]}),a.width=a.width,delete a[la],!0}addEventListener(e,a,i){this.removeEventListener(e,a);const n=e.$proxies||(e.$proxies={}),r={attach:zc,detach:Wc,resize:jc}[a]||qc;n[a]=r(e,a,i)}removeEventListener(e,a){const i=e.$proxies||(e.$proxies={}),n=i[a];if(!n)return;({attach:za,detach:za,resize:za}[a]||$c)(e,a,n),i[a]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,a,i,n){return Il(e,a,i,n)}isAttached(e){const a=e&&Si(e);return!!(a&&a.isConnected)}}function Gc(t){return!Mi()||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas?Yc:Uc}class Le{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){const{x:a,y:i}=this.getProps(["x","y"],e);return{x:a,y:i}}hasValue(){return ct(this.x)&&ct(this.y)}getProps(e,a){const i=this.$animations;if(!a||!i)return this;const n={};return e.forEach(o=>{n[o]=i[o]&&i[o].active()?i[o]._to:this[o]}),n}}function Kc(t,e){const a=t.options.ticks,i=Xc(t),n=Math.min(a.maxTicksLimit||i,i),o=a.major.enabled?Zc(e):[],r=o.length,s=o[0],l=o[r-1],c=[];if(r>n)return Qc(e,c,o,r/n),c;const d=Jc(o,e,n);if(r>0){let p,u;const h=r>1?Math.round((l-s)/(r-1)):null;for(ta(e,c,d,B(h)?0:s-h,s),p=0,u=r-1;p<u;p++)ta(e,c,d,o[p],o[p+1]);return ta(e,c,d,l,B(h)?e.length:l+h),c}return ta(e,c,d),c}function Xc(t){const e=t.options.offset,a=t._tickSize(),i=t._length/a+(e?0:1),n=t._maxLength/a;return Math.floor(Math.min(i,n))}function Jc(t,e,a){const i=ed(t),n=e.length/a;if(!i)return Math.max(n,1);const o=Ys(i);for(let r=0,s=o.length-1;r<s;r++){const l=o[r];if(l>n)return l}return Math.max(n,1)}function Zc(t){const e=[];let a,i;for(a=0,i=t.length;a<i;a++)t[a].major&&e.push(a);return e}function Qc(t,e,a,i){let n=0,o=a[0],r;for(i=Math.ceil(i),r=0;r<t.length;r++)r===o&&(e.push(t[r]),n++,o=a[n*i])}function ta(t,e,a,i,n){const o=I(i,0),r=Math.min(I(n,t.length),t.length);let s=0,l,c,d;for(a=Math.ceil(a),n&&(l=n-i,a=l/Math.floor(l/a)),d=o;d<0;)s++,d=Math.round(o+s*a);for(c=Math.max(o,0);c<r;c++)c===d&&(e.push(t[c]),s++,d=Math.round(o+s*a))}function ed(t){const e=t.length;let a,i;if(e<2)return!1;for(i=t[0],a=1;a<e;++a)if(t[a]-t[a-1]!==i)return!1;return i}const td=t=>t==="left"?"right":t==="right"?"left":t,Ln=(t,e,a)=>e==="top"||e==="left"?t[e]+a:t[e]-a,An=(t,e)=>Math.min(e||t,t);function Dn(t,e){const a=[],i=t.length/e,n=t.length;let o=0;for(;o<n;o+=i)a.push(t[Math.floor(o)]);return a}function ad(t,e,a){const i=t.ticks.length,n=Math.min(e,i-1),o=t._startPixel,r=t._endPixel,s=1e-6;let l=t.getPixelForTick(n),c;if(!(a&&(i===1?c=Math.max(l-o,r-l):e===0?c=(t.getPixelForTick(1)-l)/2:c=(l-t.getPixelForTick(n-1))/2,l+=n<e?c:-c,l<o-s||l>r+s)))return l}function id(t,e){F(t,a=>{const i=a.gc,n=i.length/2;let o;if(n>e){for(o=0;o<n;++o)delete a.data[i[o]];i.splice(0,n)}})}function xt(t){return t.drawTicks?t.tickLength:0}function In(t,e){if(!t.display)return 0;const a=J(t.font,e),i=ie(t.padding);return(z(t.text)?t.text.length:1)*a.lineHeight+i.height}function nd(t,e){return $e(t,{scale:e,type:"scale"})}function od(t,e,a){return $e(t,{tick:a,index:e,type:"tick"})}function rd(t,e,a){let i=bi(t);return(a&&e!=="right"||!a&&e==="right")&&(i=td(i)),i}function sd(t,e,a,i){const{top:n,left:o,bottom:r,right:s,chart:l}=t,{chartArea:c,scales:d}=l;let p=0,u,h,f;const m=r-n,_=s-o;if(t.isHorizontal()){if(h=te(i,o,s),T(a)){const g=Object.keys(a)[0],b=a[g];f=d[g].getPixelForValue(b)+m-e}else a==="center"?f=(c.bottom+c.top)/2+m-e:f=Ln(t,a,e);u=s-o}else{if(T(a)){const g=Object.keys(a)[0],b=a[g];h=d[g].getPixelForValue(b)-_+e}else a==="center"?h=(c.left+c.right)/2-_+e:h=Ln(t,a,e);f=te(i,r,n),p=a==="left"?-U:U}return{titleX:h,titleY:f,maxWidth:u,rotation:p}}class tt extends Le{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,a){return e}getUserBounds(){let{_userMin:e,_userMax:a,_suggestedMin:i,_suggestedMax:n}=this;return e=se(e,Number.POSITIVE_INFINITY),a=se(a,Number.NEGATIVE_INFINITY),i=se(i,Number.POSITIVE_INFINITY),n=se(n,Number.NEGATIVE_INFINITY),{min:se(e,i),max:se(a,n),minDefined:q(e),maxDefined:q(a)}}getMinMax(e){let{min:a,max:i,minDefined:n,maxDefined:o}=this.getUserBounds(),r;if(n&&o)return{min:a,max:i};const s=this.getMatchingVisibleMetas();for(let l=0,c=s.length;l<c;++l)r=s[l].controller.getMinMax(this,e),n||(a=Math.min(a,r.min)),o||(i=Math.max(i,r.max));return a=o&&a>i?i:a,i=n&&a>i?a:i,{min:se(a,se(i,a)),max:se(i,se(a,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){N(this.options.beforeUpdate,[this])}update(e,a,i){const{beginAtZero:n,grace:o,ticks:r}=this.options,s=r.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=a,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=dl(this,o,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=s<this.ticks.length;this._convertTicksToLabels(l?Dn(this.ticks,s):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),r.display&&(r.autoSkip||r.source==="auto")&&(this.ticks=Kc(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,a,i;this.isHorizontal()?(a=this.left,i=this.right):(a=this.top,i=this.bottom,e=!e),this._startPixel=a,this._endPixel=i,this._reversePixels=e,this._length=i-a,this._alignToPixels=this.options.alignToPixels}afterUpdate(){N(this.options.afterUpdate,[this])}beforeSetDimensions(){N(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){N(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),N(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){N(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const a=this.options.ticks;let i,n,o;for(i=0,n=e.length;i<n;i++)o=e[i],o.label=N(a.callback,[o.value,i,e],this)}afterTickToLabelConversion(){N(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){N(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,a=e.ticks,i=An(this.ticks.length,e.ticks.maxTicksLimit),n=a.minRotation||0,o=a.maxRotation;let r=n,s,l,c;if(!this._isVisible()||!a.display||n>=o||i<=1||!this.isHorizontal()){this.labelRotation=n;return}const d=this._getLabelSizes(),p=d.widest.width,u=d.highest.height,h=Z(this.chart.width-p,0,this.maxWidth);s=e.offset?this.maxWidth/i:h/(i-1),p+6>s&&(s=h/(i-(e.offset?.5:1)),l=this.maxHeight-xt(e.grid)-a.padding-In(e.title,this.chart.options.font),c=Math.sqrt(p*p+u*u),r=_i(Math.min(Math.asin(Z((d.highest.height+6)/s,-1,1)),Math.asin(Z(l/c,-1,1))-Math.asin(Z(u/c,-1,1)))),r=Math.max(n,Math.min(o,r))),this.labelRotation=r}afterCalculateLabelRotation(){N(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){N(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:a,options:{ticks:i,title:n,grid:o}}=this,r=this._isVisible(),s=this.isHorizontal();if(r){const l=In(n,a.options.font);if(s?(e.width=this.maxWidth,e.height=xt(o)+l):(e.height=this.maxHeight,e.width=xt(o)+l),i.display&&this.ticks.length){const{first:c,last:d,widest:p,highest:u}=this._getLabelSizes(),h=i.padding*2,f=pe(this.labelRotation),m=Math.cos(f),_=Math.sin(f);if(s){const g=i.mirror?0:_*p.width+m*u.height;e.height=Math.min(this.maxHeight,e.height+g+h)}else{const g=i.mirror?0:m*p.width+_*u.height;e.width=Math.min(this.maxWidth,e.width+g+h)}this._calculatePadding(c,d,_,m)}}this._handleMargins(),s?(this.width=this._length=a.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=a.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,a,i,n){const{ticks:{align:o,padding:r},position:s}=this.options,l=this.labelRotation!==0,c=s!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,p=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,h=0;l?c?(u=n*e.width,h=i*a.height):(u=i*e.height,h=n*a.width):o==="start"?h=a.width:o==="end"?u=e.width:o!=="inner"&&(u=e.width/2,h=a.width/2),this.paddingLeft=Math.max((u-d+r)*this.width/(this.width-d),0),this.paddingRight=Math.max((h-p+r)*this.width/(this.width-p),0)}else{let d=a.height/2,p=e.height/2;o==="start"?(d=0,p=e.height):o==="end"&&(d=a.height,p=0),this.paddingTop=d+r,this.paddingBottom=p+r}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){N(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:a}=this.options;return a==="top"||a==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let a,i;for(a=0,i=e.length;a<i;a++)B(e[a].label)&&(e.splice(a,1),i--,a--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const a=this.options.ticks.sampleSize;let i=this.ticks;a<i.length&&(i=Dn(i,a)),this._labelSizes=e=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,a,i){const{ctx:n,_longestTextCache:o}=this,r=[],s=[],l=Math.floor(a/An(a,i));let c=0,d=0,p,u,h,f,m,_,g,b,w,y,v;for(p=0;p<a;p+=l){if(f=e[p].label,m=this._resolveTickFontOptions(p),n.font=_=m.string,g=o[_]=o[_]||{data:{},gc:[]},b=m.lineHeight,w=y=0,!B(f)&&!z(f))w=fa(n,g.data,g.gc,w,f),y=b;else if(z(f))for(u=0,h=f.length;u<h;++u)v=f[u],!B(v)&&!z(v)&&(w=fa(n,g.data,g.gc,w,v),y+=b);r.push(w),s.push(y),c=Math.max(w,c),d=Math.max(y,d)}id(o,a);const M=r.indexOf(c),S=s.indexOf(d),x=C=>({width:r[C]||0,height:s[C]||0});return{first:x(0),last:x(a-1),widest:x(M),highest:x(S),widths:r,heights:s}}getLabelForValue(e){return e}getPixelForValue(e,a){return NaN}getValueForPixel(e){}getPixelForTick(e){const a=this.ticks;return e<0||e>a.length-1?null:this.getPixelForValue(a[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const a=this._startPixel+e*this._length;return $s(this._alignToPixels?Ve(this.chart,a,0):a)}getDecimalForPixel(e){const a=(e-this._startPixel)/this._length;return this._reversePixels?1-a:a}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:a}=this;return e<0&&a<0?a:e>0&&a>0?e:0}getContext(e){const a=this.ticks||[];if(e>=0&&e<a.length){const i=a[e];return i.$context||(i.$context=od(this.getContext(),e,i))}return this.$context||(this.$context=nd(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,a=pe(this.labelRotation),i=Math.abs(Math.cos(a)),n=Math.abs(Math.sin(a)),o=this._getLabelSizes(),r=e.autoSkipPadding||0,s=o?o.widest.width+r:0,l=o?o.highest.height+r:0;return this.isHorizontal()?l*i>s*n?s/i:l/n:l*n<s*i?l/i:s/n}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const a=this.axis,i=this.chart,n=this.options,{grid:o,position:r,border:s}=n,l=o.offset,c=this.isHorizontal(),p=this.ticks.length+(l?1:0),u=xt(o),h=[],f=s.setContext(this.getContext()),m=f.display?f.width:0,_=m/2,g=function($){return Ve(i,$,m)};let b,w,y,v,M,S,x,C,E,P,A,R;if(r==="top")b=g(this.bottom),S=this.bottom-u,C=b-_,P=g(e.top)+_,R=e.bottom;else if(r==="bottom")b=g(this.top),P=e.top,R=g(e.bottom)-_,S=b+_,C=this.top+u;else if(r==="left")b=g(this.right),M=this.right-u,x=b-_,E=g(e.left)+_,A=e.right;else if(r==="right")b=g(this.left),E=e.left,A=g(e.right)-_,M=b+_,x=this.left+u;else if(a==="x"){if(r==="center")b=g((e.top+e.bottom)/2+.5);else if(T(r)){const $=Object.keys(r)[0],V=r[$];b=g(this.chart.scales[$].getPixelForValue(V))}P=e.top,R=e.bottom,S=b+_,C=S+u}else if(a==="y"){if(r==="center")b=g((e.left+e.right)/2);else if(T(r)){const $=Object.keys(r)[0],V=r[$];b=g(this.chart.scales[$].getPixelForValue(V))}M=b-_,x=M-u,E=e.left,A=e.right}const O=I(n.ticks.maxTicksLimit,p),L=Math.max(1,Math.ceil(p/O));for(w=0;w<p;w+=L){const $=this.getContext(w),V=o.setContext($),G=s.setContext($),K=V.lineWidth,ve=V.color,it=G.dash||[],Ae=G.dashOffset,we=V.tickWidth,ze=V.tickColor,bt=V.tickBorderDash||[],We=V.tickBorderDashOffset;y=ad(this,w,l),y!==void 0&&(v=Ve(i,y,K),c?M=x=E=A=v:S=C=P=R=v,h.push({tx1:M,ty1:S,tx2:x,ty2:C,x1:E,y1:P,x2:A,y2:R,width:K,color:ve,borderDash:it,borderDashOffset:Ae,tickWidth:we,tickColor:ze,tickBorderDash:bt,tickBorderDashOffset:We}))}return this._ticksLength=p,this._borderValue=b,h}_computeLabelItems(e){const a=this.axis,i=this.options,{position:n,ticks:o}=i,r=this.isHorizontal(),s=this.ticks,{align:l,crossAlign:c,padding:d,mirror:p}=o,u=xt(i.grid),h=u+d,f=p?-d:h,m=-pe(this.labelRotation),_=[];let g,b,w,y,v,M,S,x,C,E,P,A,R="middle";if(n==="top")M=this.bottom-f,S=this._getXAxisLabelAlignment();else if(n==="bottom")M=this.top+f,S=this._getXAxisLabelAlignment();else if(n==="left"){const L=this._getYAxisLabelAlignment(u);S=L.textAlign,v=L.x}else if(n==="right"){const L=this._getYAxisLabelAlignment(u);S=L.textAlign,v=L.x}else if(a==="x"){if(n==="center")M=(e.top+e.bottom)/2+h;else if(T(n)){const L=Object.keys(n)[0],$=n[L];M=this.chart.scales[L].getPixelForValue($)+h}S=this._getXAxisLabelAlignment()}else if(a==="y"){if(n==="center")v=(e.left+e.right)/2-h;else if(T(n)){const L=Object.keys(n)[0],$=n[L];v=this.chart.scales[L].getPixelForValue($)}S=this._getYAxisLabelAlignment(u).textAlign}a==="y"&&(l==="start"?R="top":l==="end"&&(R="bottom"));const O=this._getLabelSizes();for(g=0,b=s.length;g<b;++g){w=s[g],y=w.label;const L=o.setContext(this.getContext(g));x=this.getPixelForTick(g)+o.labelOffset,C=this._resolveTickFontOptions(g),E=C.lineHeight,P=z(y)?y.length:1;const $=P/2,V=L.color,G=L.textStrokeColor,K=L.textStrokeWidth;let ve=S;r?(v=x,S==="inner"&&(g===b-1?ve=this.options.reverse?"left":"right":g===0?ve=this.options.reverse?"right":"left":ve="center"),n==="top"?c==="near"||m!==0?A=-P*E+E/2:c==="center"?A=-O.highest.height/2-$*E+E:A=-O.highest.height+E/2:c==="near"||m!==0?A=E/2:c==="center"?A=O.highest.height/2-$*E:A=O.highest.height-P*E,p&&(A*=-1),m!==0&&!L.showLabelBackdrop&&(v+=E/2*Math.sin(m))):(M=x,A=(1-P)*E/2);let it;if(L.showLabelBackdrop){const Ae=ie(L.backdropPadding),we=O.heights[g],ze=O.widths[g];let bt=A-Ae.top,We=0-Ae.left;switch(R){case"middle":bt-=we/2;break;case"bottom":bt-=we;break}switch(S){case"center":We-=ze/2;break;case"right":We-=ze;break;case"inner":g===b-1?We-=ze:g>0&&(We-=ze/2);break}it={left:We,top:bt,width:ze+Ae.width,height:we+Ae.height,color:L.backdropColor}}_.push({label:y,font:C,textOffset:A,options:{rotation:m,color:V,strokeColor:G,strokeWidth:K,textAlign:ve,textBaseline:R,translation:[v,M],backdrop:it}})}return _}_getXAxisLabelAlignment(){const{position:e,ticks:a}=this.options;if(-pe(this.labelRotation))return e==="top"?"left":"right";let n="center";return a.align==="start"?n="left":a.align==="end"?n="right":a.align==="inner"&&(n="inner"),n}_getYAxisLabelAlignment(e){const{position:a,ticks:{crossAlign:i,mirror:n,padding:o}}=this.options,r=this._getLabelSizes(),s=e+o,l=r.widest.width;let c,d;return a==="left"?n?(d=this.right+o,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-s,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d=this.left)):a==="right"?n?(d=this.left+o,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+s,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,a=this.options.position;if(a==="left"||a==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(a==="top"||a==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:a},left:i,top:n,width:o,height:r}=this;a&&(e.save(),e.fillStyle=a,e.fillRect(i,n,o,r),e.restore())}getLineWidthForValue(e){const a=this.options.grid;if(!this._isVisible()||!a.display)return 0;const n=this.ticks.findIndex(o=>o.value===e);return n>=0?a.setContext(this.getContext(n)).lineWidth:0}drawGrid(e){const a=this.options.grid,i=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let o,r;const s=(l,c,d)=>{!d.width||!d.color||(i.save(),i.lineWidth=d.width,i.strokeStyle=d.color,i.setLineDash(d.borderDash||[]),i.lineDashOffset=d.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(c.x,c.y),i.stroke(),i.restore())};if(a.display)for(o=0,r=n.length;o<r;++o){const l=n[o];a.drawOnChartArea&&s({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),a.drawTicks&&s({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:a,options:{border:i,grid:n}}=this,o=i.setContext(this.getContext()),r=i.display?o.width:0;if(!r)return;const s=n.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,p,u;this.isHorizontal()?(c=Ve(e,this.left,r)-r/2,d=Ve(e,this.right,s)+s/2,p=u=l):(p=Ve(e,this.top,r)-r/2,u=Ve(e,this.bottom,s)+s/2,c=d=l),a.save(),a.lineWidth=o.width,a.strokeStyle=o.color,a.beginPath(),a.moveTo(c,p),a.lineTo(d,u),a.stroke(),a.restore()}drawLabels(e){if(!this.options.ticks.display)return;const i=this.ctx,n=this._computeLabelArea();n&&Ma(i,n);const o=this.getLabelItems(e);for(const r of o){const s=r.options,l=r.font,c=r.label,d=r.textOffset;et(i,c,0,d,l,s)}n&&Sa(i)}drawTitle(){const{ctx:e,options:{position:a,title:i,reverse:n}}=this;if(!i.display)return;const o=J(i.font),r=ie(i.padding),s=i.align;let l=o.lineHeight/2;a==="bottom"||a==="center"||T(a)?(l+=r.bottom,z(i.text)&&(l+=o.lineHeight*(i.text.length-1))):l+=r.top;const{titleX:c,titleY:d,maxWidth:p,rotation:u}=sd(this,l,a,s);et(e,i.text,0,0,o,{color:i.color,maxWidth:p,rotation:u,textAlign:rd(s,a,n),textBaseline:"middle",translation:[c,d]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,a=e.ticks&&e.ticks.z||0,i=I(e.grid&&e.grid.z,-1),n=I(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==tt.prototype.draw?[{z:a,draw:o=>{this.draw(o)}}]:[{z:i,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:a,draw:o=>{this.drawLabels(o)}}]}getMatchingVisibleMetas(e){const a=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",n=[];let o,r;for(o=0,r=a.length;o<r;++o){const s=a[o];s[i]===this.id&&(!e||s.type===e)&&n.push(s)}return n}_resolveTickFontOptions(e){const a=this.options.ticks.setContext(this.getContext(e));return J(a.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class aa{constructor(e,a,i){this.type=e,this.scope=a,this.override=i,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const a=Object.getPrototypeOf(e);let i;dd(a)&&(i=this.register(a));const n=this.items,o=e.id,r=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+e);return o in n||(n[o]=e,ld(e,r,i),this.override&&j.override(e.id,e.overrides)),r}get(e){return this.items[e]}unregister(e){const a=this.items,i=e.id,n=this.scope;i in a&&delete a[i],n&&i in j[n]&&(delete j[n][i],this.override&&delete Qe[i])}}function ld(t,e,a){const i=Bt(Object.create(null),[a?j.get(a):{},j.get(e),t.defaults]);j.set(e,i),t.defaultRoutes&&cd(e,t.defaultRoutes),t.descriptors&&j.describe(e,t.descriptors)}function cd(t,e){Object.keys(e).forEach(a=>{const i=a.split("."),n=i.pop(),o=[t].concat(i).join("."),r=e[a].split("."),s=r.pop(),l=r.join(".");j.route(o,n,l,s)})}function dd(t){return"id"in t&&"defaults"in t}class pd{constructor(){this.controllers=new aa(Ne,"datasets",!0),this.elements=new aa(Le,"elements"),this.plugins=new aa(Object,"plugins"),this.scales=new aa(tt,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,a,i){[...a].forEach(n=>{const o=i||this._getRegistryForType(n);i||o.isForType(n)||o===this.plugins&&n.id?this._exec(e,o,n):F(n,r=>{const s=i||this._getRegistryForType(r);this._exec(e,s,r)})})}_exec(e,a,i){const n=mi(e);N(i["before"+n],[],i),a[e](i),N(i["after"+n],[],i)}_getRegistryForType(e){for(let a=0;a<this._typedRegistries.length;a++){const i=this._typedRegistries[a];if(i.isForType(e))return i}return this.plugins}_get(e,a,i){const n=a.get(e);if(n===void 0)throw new Error('"'+e+'" is not a registered '+i+".");return n}}var fe=new pd;class ud{constructor(){this._init=[]}notify(e,a,i,n){a==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const o=n?this._descriptors(e).filter(n):this._descriptors(e),r=this._notify(o,e,a,i);return a==="afterDestroy"&&(this._notify(o,e,"stop"),this._notify(this._init,e,"uninstall")),r}_notify(e,a,i,n){n=n||{};for(const o of e){const r=o.plugin,s=r[i],l=[a,n,o.options];if(N(s,l,r)===!1&&n.cancelable)return!1}return!0}invalidate(){B(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const a=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),a}_createDescriptors(e,a){const i=e&&e.config,n=I(i.options&&i.options.plugins,{}),o=hd(i);return n===!1&&!a?[]:md(e,o,n,a)}_notifyStateChanges(e){const a=this._oldCache||[],i=this._cache,n=(o,r)=>o.filter(s=>!r.some(l=>s.plugin.id===l.plugin.id));this._notify(n(a,i),e,"stop"),this._notify(n(i,a),e,"start")}}function hd(t){const e={},a=[],i=Object.keys(fe.plugins.items);for(let o=0;o<i.length;o++)a.push(fe.getPlugin(i[o]));const n=t.plugins||[];for(let o=0;o<n.length;o++){const r=n[o];a.indexOf(r)===-1&&(a.push(r),e[r.id]=!0)}return{plugins:a,localIds:e}}function fd(t,e){return!e&&t===!1?null:t===!0?{}:t}function md(t,{plugins:e,localIds:a},i,n){const o=[],r=t.getContext();for(const s of e){const l=s.id,c=fd(i[l],n);c!==null&&o.push({plugin:s,options:_d(t.config,{plugin:s,local:a[l]},c,r)})}return o}function _d(t,{plugin:e,local:a},i,n){const o=t.pluginScopeKeys(e),r=t.getOptionScopes(i,o);return a&&e.defaults&&r.push(e.defaults),t.createResolver(r,n,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Ka(t,e){const a=j.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||a.indexAxis||"x"}function gd(t,e){let a=t;return t==="_index_"?a=e:t==="_value_"&&(a=e==="x"?"y":"x"),a}function bd(t,e){return t===e?"_index_":"_value_"}function Bn(t){if(t==="x"||t==="y"||t==="r")return t}function vd(t){if(t==="top"||t==="bottom")return"x";if(t==="left"||t==="right")return"y"}function Xa(t,...e){if(Bn(t))return t;for(const a of e){const i=a.axis||vd(a.position)||t.length>1&&Bn(t[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${t}' axis. Please provide 'axis' or 'position' option.`)}function Tn(t,e,a){if(a[e+"AxisID"]===t)return{axis:e}}function wd(t,e){if(e.data&&e.data.datasets){const a=e.data.datasets.filter(i=>i.xAxisID===t||i.yAxisID===t);if(a.length)return Tn(t,"x",a[0])||Tn(t,"y",a[0])}return{}}function yd(t,e){const a=Qe[t.type]||{scales:{}},i=e.scales||{},n=Ka(t.type,e),o=Object.create(null);return Object.keys(i).forEach(r=>{const s=i[r];if(!T(s))return console.error(`Invalid scale configuration for scale: ${r}`);if(s._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${r}`);const l=Xa(r,s,wd(r,t),j.scales[s.type]),c=bd(l,n),d=a.scales||{};o[r]=Pt(Object.create(null),[{axis:l},s,d[l],d[c]])}),t.data.datasets.forEach(r=>{const s=r.type||t.type,l=r.indexAxis||Ka(s,e),d=(Qe[s]||{}).scales||{};Object.keys(d).forEach(p=>{const u=gd(p,l),h=r[u+"AxisID"]||u;o[h]=o[h]||Object.create(null),Pt(o[h],[{axis:u},i[h],d[p]])})}),Object.keys(o).forEach(r=>{const s=o[r];Pt(s,[j.scales[s.type],j.scale])}),o}function nr(t){const e=t.options||(t.options={});e.plugins=I(e.plugins,{}),e.scales=yd(t,e)}function or(t){return t=t||{},t.datasets=t.datasets||[],t.labels=t.labels||[],t}function xd(t){return t=t||{},t.data=or(t.data),nr(t),t}const Yn=new Map,rr=new Set;function ia(t,e){let a=Yn.get(t);return a||(a=e(),Yn.set(t,a),rr.add(a)),a}const Ct=(t,e,a)=>{const i=Oe(e,a);i!==void 0&&t.add(i)};class Cd{constructor(e){this._config=xd(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=or(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),nr(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return ia(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,a){return ia(`${e}.transition.${a}`,()=>[[`datasets.${e}.transitions.${a}`,`transitions.${a}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,a){return ia(`${e}-${a}`,()=>[[`datasets.${e}.elements.${a}`,`datasets.${e}`,`elements.${a}`,""]])}pluginScopeKeys(e){const a=e.id,i=this.type;return ia(`${i}-plugin-${a}`,()=>[[`plugins.${a}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,a){const i=this._scopeCache;let n=i.get(e);return(!n||a)&&(n=new Map,i.set(e,n)),n}getOptionScopes(e,a,i){const{options:n,type:o}=this,r=this._cachedScopes(e,i),s=r.get(a);if(s)return s;const l=new Set;a.forEach(d=>{e&&(l.add(e),d.forEach(p=>Ct(l,e,p))),d.forEach(p=>Ct(l,n,p)),d.forEach(p=>Ct(l,Qe[o]||{},p)),d.forEach(p=>Ct(l,j,p)),d.forEach(p=>Ct(l,Ua,p))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),rr.has(a)&&r.set(a,c),c}chartOptionScopes(){const{options:e,type:a}=this;return[e,Qe[a]||{},j.datasets[a]||{},{type:a},j,Ua]}resolveNamedOptions(e,a,i,n=[""]){const o={$shared:!0},{resolver:r,subPrefixes:s}=Rn(this._resolverCache,e,n);let l=r;if(Sd(r,a)){o.$shared=!1,i=Fe(i)?i():i;const c=this.createResolver(e,i,s);l=dt(r,i,c)}for(const c of a)o[c]=l[c];return o}createResolver(e,a,i=[""],n){const{resolver:o}=Rn(this._resolverCache,e,i);return T(a)?dt(o,a,void 0,n):o}}function Rn(t,e,a){let i=t.get(e);i||(i=new Map,t.set(e,i));const n=a.join();let o=i.get(n);return o||(o={resolver:yi(e,a),subPrefixes:a.filter(s=>!s.toLowerCase().includes("hover"))},i.set(n,o)),o}const Md=t=>T(t)&&Object.getOwnPropertyNames(t).some(e=>Fe(t[e]));function Sd(t,e){const{isScriptable:a,isIndexable:i}=Fo(t);for(const n of e){const o=a(n),r=i(n),s=(r||o)&&t[n];if(o&&(Fe(s)||Md(s))||r&&z(s))return!0}return!1}var Ed="4.4.8";const kd=["top","bottom","left","right","chartArea"];function On(t,e){return t==="top"||t==="bottom"||kd.indexOf(t)===-1&&e==="x"}function Fn(t,e){return function(a,i){return a[t]===i[t]?a[e]-i[e]:a[t]-i[t]}}function $n(t){const e=t.chart,a=e.options.animation;e.notifyPlugins("afterRender"),N(a&&a.onComplete,[t],e)}function Pd(t){const e=t.chart,a=e.options.animation;N(a&&a.onProgress,[t],e)}function sr(t){return Mi()&&typeof t=="string"?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const ca={},Nn=t=>{const e=sr(t);return Object.values(ca).filter(a=>a.canvas===e).pop()};function Ld(t,e,a){const i=Object.keys(t);for(const n of i){const o=+n;if(o>=e){const r=t[n];delete t[n],(a>0||o>e)&&(t[o+a]=r)}}}function Ad(t,e,a,i){return!a||t.type==="mouseout"?null:i?e:t}function na(t,e,a){return t.options.clip?t[a]:e[a]}function Dd(t,e){const{xScale:a,yScale:i}=t;return a&&i?{left:na(a,e,"left"),right:na(a,e,"right"),top:na(i,e,"top"),bottom:na(i,e,"bottom")}:e}let Pi=class{static defaults=j;static instances=ca;static overrides=Qe;static registry=fe;static version=Ed;static getChart=Nn;static register(...e){fe.add(...e),zn()}static unregister(...e){fe.remove(...e),zn()}constructor(e,a){const i=this.config=new Cd(a),n=sr(e),o=Nn(n);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const r=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||Gc(n)),this.platform.updateConfig(i);const s=this.platform.acquireContext(n,r.aspectRatio),l=s&&s.canvas,c=l&&l.height,d=l&&l.width;if(this.id=Es(),this.ctx=s,this.canvas=l,this.width=d,this.height=c,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new ud,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Hs(p=>this.update(p),r.resizeDelay||0),this._dataChanges=[],ca[this.id]=this,!s||!l){console.error("Failed to create chart: can't acquire context from the given item");return}xe.listen(this,"complete",$n),xe.listen(this,"progress",Pd),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:a},width:i,height:n,_aspectRatio:o}=this;return B(e)?a&&o?o:n?i/n:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return fe}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():cn(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return rn(this.canvas,this.ctx),this}stop(){return xe.stop(this),this}resize(e,a){xe.running(this)?this._resizeBeforeDraw={width:e,height:a}:this._resize(e,a)}_resize(e,a){const i=this.options,n=this.canvas,o=i.maintainAspectRatio&&this.aspectRatio,r=this.platform.getMaximumSize(n,e,a,o),s=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=r.width,this.height=r.height,this._aspectRatio=this.aspectRatio,cn(this,s,!0)&&(this.notifyPlugins("resize",{size:r}),N(i.onResize,[this,r],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const a=this.options.scales||{};F(a,(i,n)=>{i.id=n})}buildOrUpdateScales(){const e=this.options,a=e.scales,i=this.scales,n=Object.keys(i).reduce((r,s)=>(r[s]=!1,r),{});let o=[];a&&(o=o.concat(Object.keys(a).map(r=>{const s=a[r],l=Xa(r,s),c=l==="r",d=l==="x";return{options:s,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),F(o,r=>{const s=r.options,l=s.id,c=Xa(l,s),d=I(s.type,r.dtype);(s.position===void 0||On(s.position,c)!==On(r.dposition))&&(s.position=r.dposition),n[l]=!0;let p=null;if(l in i&&i[l].type===d)p=i[l];else{const u=fe.getScale(d);p=new u({id:l,type:d,ctx:this.ctx,chart:this}),i[p.id]=p}p.init(s,e)}),F(n,(r,s)=>{r||delete i[s]}),F(i,r=>{ae.configure(this,r,r.options),ae.addBox(this,r)})}_updateMetasets(){const e=this._metasets,a=this.data.datasets.length,i=e.length;if(e.sort((n,o)=>n.index-o.index),i>a){for(let n=a;n<i;++n)this._destroyDatasetMeta(n);e.splice(a,i-a)}this._sortedMetasets=e.slice(0).sort(Fn("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:a}}=this;e.length>a.length&&delete this._stacks,e.forEach((i,n)=>{a.filter(o=>o===i._dataset).length===0&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const e=[],a=this.data.datasets;let i,n;for(this._removeUnreferencedMetasets(),i=0,n=a.length;i<n;i++){const o=a[i];let r=this.getDatasetMeta(i);const s=o.type||this.config.type;if(r.type&&r.type!==s&&(this._destroyDatasetMeta(i),r=this.getDatasetMeta(i)),r.type=s,r.indexAxis=o.indexAxis||Ka(s,this.options),r.order=o.order||0,r.index=i,r.label=""+o.label,r.visible=this.isDatasetVisible(i),r.controller)r.controller.updateIndex(i),r.controller.linkScales();else{const l=fe.getController(s),{datasetElementType:c,dataElementType:d}=j.datasets[s];Object.assign(l,{dataElementType:fe.getElement(d),datasetElementType:c&&fe.getElement(c)}),r.controller=new l(this,i),e.push(r.controller)}}return this._updateMetasets(),e}_resetElements(){F(this.data.datasets,(e,a)=>{this.getDatasetMeta(a).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const a=this.config;a.update();const i=this._options=a.createResolver(a.chartOptionScopes(),this.getContext()),n=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const o=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let r=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:p}=this.getDatasetMeta(c),u=!n&&o.indexOf(p)===-1;p.buildOrUpdateElements(u),r=Math.max(+p.getMaxOverflow(),r)}r=this._minPadding=i.layout.autoPadding?r:0,this._updateLayout(r),n||F(o,c=>{c.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(Fn("z","_idx"));const{_active:s,_lastEvent:l}=this;l?this._eventHandler(l,!0):s.length&&this._updateHoverStyles(s,s,!0),this.render()}_updateScales(){F(this.scales,e=>{ae.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,a=new Set(Object.keys(this._listeners)),i=new Set(e.events);(!Xi(a,i)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,a=this._getUniformDataChanges()||[];for(const{method:i,start:n,count:o}of a){const r=i==="_removeElements"?-o:o;Ld(e,n,r)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const a=this.data.datasets.length,i=o=>new Set(e.filter(r=>r[0]===o).map((r,s)=>s+","+r.splice(1).join(","))),n=i(0);for(let o=1;o<a;o++)if(!Xi(n,i(o)))return;return Array.from(n).map(o=>o.split(",")).map(o=>({method:o[1],start:+o[2],count:+o[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;ae.update(this,this.width,this.height,e);const a=this.chartArea,i=a.width<=0||a.height<=0;this._layers=[],F(this.boxes,n=>{i&&n.position==="chartArea"||(n.configure&&n.configure(),this._layers.push(...n._layers()))},this),this._layers.forEach((n,o)=>{n._idx=o}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let a=0,i=this.data.datasets.length;a<i;++a)this.getDatasetMeta(a).controller.configure();for(let a=0,i=this.data.datasets.length;a<i;++a)this._updateDataset(a,Fe(e)?e({datasetIndex:a}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,a){const i=this.getDatasetMeta(e),n={meta:i,index:e,mode:a,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",n)!==!1&&(i.controller._update(a),n.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",n))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(xe.has(this)?this.attached&&!xe.running(this)&&xe.start(this):(this.draw(),$n({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:i,height:n}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,n)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const a=this._layers;for(e=0;e<a.length&&a[e].z<=0;++e)a[e].draw(this.chartArea);for(this._drawDatasets();e<a.length;++e)a[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const a=this._sortedMetasets,i=[];let n,o;for(n=0,o=a.length;n<o;++n){const r=a[n];(!e||r.visible)&&i.push(r)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let a=e.length-1;a>=0;--a)this._drawDataset(e[a]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const a=this.ctx,i=e._clip,n=!i.disabled,o=Dd(e,this.chartArea),r={meta:e,index:e.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",r)!==!1&&(n&&Ma(a,{left:i.left===!1?0:o.left-i.left,right:i.right===!1?this.width:o.right+i.right,top:i.top===!1?0:o.top-i.top,bottom:i.bottom===!1?this.height:o.bottom+i.bottom}),e.controller.draw(),n&&Sa(a),r.cancelable=!1,this.notifyPlugins("afterDatasetDraw",r))}isPointInArea(e){return ke(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,a,i,n){const o=kc.modes[a];return typeof o=="function"?o(this,e,i,n):[]}getDatasetMeta(e){const a=this.data.datasets[e],i=this._metasets;let n=i.filter(o=>o&&o._dataset===a).pop();return n||(n={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:a&&a.order||0,index:e,_dataset:a,_parsed:[],_sorted:!1},i.push(n)),n}getContext(){return this.$context||(this.$context=$e(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const a=this.data.datasets[e];if(!a)return!1;const i=this.getDatasetMeta(e);return typeof i.hidden=="boolean"?!i.hidden:!a.hidden}setDatasetVisibility(e,a){const i=this.getDatasetMeta(e);i.hidden=!a}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,a,i){const n=i?"show":"hide",o=this.getDatasetMeta(e),r=o.controller._resolveAnimations(void 0,n);Tt(a)?(o.data[a].hidden=!i,this.update()):(this.setDatasetVisibility(e,i),r.update(o,{visible:i}),this.update(s=>s.datasetIndex===e?n:void 0))}hide(e,a){this._updateVisibility(e,a,!1)}show(e,a){this._updateVisibility(e,a,!0)}_destroyDatasetMeta(e){const a=this._metasets[e];a&&a.controller&&a.controller._destroy(),delete this._metasets[e]}_stop(){let e,a;for(this.stop(),xe.remove(this),e=0,a=this.data.datasets.length;e<a;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:a}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),rn(e,a),this.platform.releaseContext(a),this.canvas=null,this.ctx=null),delete ca[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,a=this.platform,i=(o,r)=>{a.addEventListener(this,o,r),e[o]=r},n=(o,r,s)=>{o.offsetX=r,o.offsetY=s,this._eventHandler(o)};F(this.options.events,o=>i(o,n))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,a=this.platform,i=(l,c)=>{a.addEventListener(this,l,c),e[l]=c},n=(l,c)=>{e[l]&&(a.removeEventListener(this,l,c),delete e[l])},o=(l,c)=>{this.canvas&&this.resize(l,c)};let r;const s=()=>{n("attach",s),this.attached=!0,this.resize(),i("resize",o),i("detach",r)};r=()=>{this.attached=!1,n("resize",o),this._stop(),this._resize(0,0),i("attach",s)},a.isAttached(this.canvas)?s():r()}unbindEvents(){F(this._listeners,(e,a)=>{this.platform.removeEventListener(this,a,e)}),this._listeners={},F(this._responsiveListeners,(e,a)=>{this.platform.removeEventListener(this,a,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,a,i){const n=i?"set":"remove";let o,r,s,l;for(a==="dataset"&&(o=this.getDatasetMeta(e[0].datasetIndex),o.controller["_"+n+"DatasetHoverStyle"]()),s=0,l=e.length;s<l;++s){r=e[s];const c=r&&this.getDatasetMeta(r.datasetIndex).controller;c&&c[n+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const a=this._active||[],i=e.map(({datasetIndex:o,index:r})=>{const s=this.getDatasetMeta(o);if(!s)throw new Error("No dataset found at index "+o);return{datasetIndex:o,element:s.data[r],index:r}});!pa(i,a)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,a))}notifyPlugins(e,a,i){return this._plugins.notify(this,e,a,i)}isPluginEnabled(e){return this._plugins._cache.filter(a=>a.plugin.id===e).length===1}_updateHoverStyles(e,a,i){const n=this.options.hover,o=(l,c)=>l.filter(d=>!c.some(p=>d.datasetIndex===p.datasetIndex&&d.index===p.index)),r=o(a,e),s=i?e:o(e,a);r.length&&this.updateHoverStyle(r,n.mode,!1),s.length&&n.mode&&this.updateHoverStyle(s,n.mode,!0)}_eventHandler(e,a){const i={event:e,replay:a,cancelable:!0,inChartArea:this.isPointInArea(e)},n=r=>(r.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",i,n)===!1)return;const o=this._handleEvent(e,a,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,n),(o||i.changed)&&this.render(),this}_handleEvent(e,a,i){const{_active:n=[],options:o}=this,r=a,s=this._getActiveElements(e,n,i,r),l=Is(e),c=Ad(e,this._lastEvent,i,l);i&&(this._lastEvent=null,N(o.onHover,[e,s,this],this),l&&N(o.onClick,[e,s,this],this));const d=!pa(s,n);return(d||a)&&(this._active=s,this._updateHoverStyles(s,n,a)),this._lastEvent=c,d}_getActiveElements(e,a,i,n){if(e.type==="mouseout")return[];if(!i)return a;const o=this.options.hover;return this.getElementsAtEventForMode(e,o.mode,o,n)}};function zn(){return F(Pi.instances,t=>t._plugins.invalidate())}function Id(t,e,a){const{startAngle:i,pixelMargin:n,x:o,y:r,outerRadius:s,innerRadius:l}=e;let c=n/s;t.beginPath(),t.arc(o,r,s,i-c,a+c),l>n?(c=n/l,t.arc(o,r,l,a+c,i-c,!0)):t.arc(o,r,n,a+U,i-U),t.closePath(),t.clip()}function Bd(t){return wi(t,["outerStart","outerEnd","innerStart","innerEnd"])}function Td(t,e,a,i){const n=Bd(t.options.borderRadius),o=(a-e)/2,r=Math.min(o,i*e/2),s=l=>{const c=(a-Math.min(o,l))*i/2;return Z(l,0,Math.min(o,c))};return{outerStart:s(n.outerStart),outerEnd:s(n.outerEnd),innerStart:Z(n.innerStart,0,r),innerEnd:Z(n.innerEnd,0,r)}}function ot(t,e,a,i){return{x:a+t*Math.cos(e),y:i+t*Math.sin(e)}}function ga(t,e,a,i,n,o){const{x:r,y:s,startAngle:l,pixelMargin:c,innerRadius:d}=e,p=Math.max(e.outerRadius+i+a-c,0),u=d>0?d+i+a+c:0;let h=0;const f=n-l;if(i){const L=d>0?d-i:0,$=p>0?p-i:0,V=(L+$)/2,G=V!==0?f*V/(V+i):f;h=(f-G)/2}const m=Math.max(.001,f*p-a/H)/p,_=(f-m)/2,g=l+_+h,b=n-_-h,{outerStart:w,outerEnd:y,innerStart:v,innerEnd:M}=Td(e,u,p,b-g),S=p-w,x=p-y,C=g+w/S,E=b-y/x,P=u+v,A=u+M,R=g+v/P,O=b-M/A;if(t.beginPath(),o){const L=(C+E)/2;if(t.arc(r,s,p,C,L),t.arc(r,s,p,L,E),y>0){const K=ot(x,E,r,s);t.arc(K.x,K.y,y,E,b+U)}const $=ot(A,b,r,s);if(t.lineTo($.x,$.y),M>0){const K=ot(A,O,r,s);t.arc(K.x,K.y,M,b+U,O+Math.PI)}const V=(b-M/u+(g+v/u))/2;if(t.arc(r,s,u,b-M/u,V,!0),t.arc(r,s,u,V,g+v/u,!0),v>0){const K=ot(P,R,r,s);t.arc(K.x,K.y,v,R+Math.PI,g-U)}const G=ot(S,g,r,s);if(t.lineTo(G.x,G.y),w>0){const K=ot(S,C,r,s);t.arc(K.x,K.y,w,g-U,C)}}else{t.moveTo(r,s);const L=Math.cos(C)*p+r,$=Math.sin(C)*p+s;t.lineTo(L,$);const V=Math.cos(E)*p+r,G=Math.sin(E)*p+s;t.lineTo(V,G)}t.closePath()}function Yd(t,e,a,i,n){const{fullCircles:o,startAngle:r,circumference:s}=e;let l=e.endAngle;if(o){ga(t,e,a,i,l,n);for(let c=0;c<o;++c)t.fill();isNaN(s)||(l=r+(s%W||W))}return ga(t,e,a,i,l,n),t.fill(),l}function Rd(t,e,a,i,n){const{fullCircles:o,startAngle:r,circumference:s,options:l}=e,{borderWidth:c,borderJoinStyle:d,borderDash:p,borderDashOffset:u}=l,h=l.borderAlign==="inner";if(!c)return;t.setLineDash(p||[]),t.lineDashOffset=u,h?(t.lineWidth=c*2,t.lineJoin=d||"round"):(t.lineWidth=c,t.lineJoin=d||"bevel");let f=e.endAngle;if(o){ga(t,e,a,i,f,n);for(let m=0;m<o;++m)t.stroke();isNaN(s)||(f=r+(s%W||W))}h&&Id(t,e,f),o||(ga(t,e,a,i,f,n),t.stroke())}class Od extends Le{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,a,i){const n=this.getProps(["x","y"],i),{angle:o,distance:r}=Po(n,{x:e,y:a}),{startAngle:s,endAngle:l,innerRadius:c,outerRadius:d,circumference:p}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),u=(this.options.spacing+this.options.borderWidth)/2,h=I(p,l-s),f=Yt(o,s,l)&&s!==l,m=h>=W||f,_=Se(r,c+u,d+u);return m&&_}getCenterPoint(e){const{x:a,y:i,startAngle:n,endAngle:o,innerRadius:r,outerRadius:s}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:l,spacing:c}=this.options,d=(n+o)/2,p=(r+s+c+l)/2;return{x:a+Math.cos(d)*p,y:i+Math.sin(d)*p}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:a,circumference:i}=this,n=(a.offset||0)/4,o=(a.spacing||0)/2,r=a.circular;if(this.pixelMargin=a.borderAlign==="inner"?.33:0,this.fullCircles=i>W?Math.floor(i/W):0,i===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const s=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(s)*n,Math.sin(s)*n);const l=1-Math.sin(Math.min(H,i||0)),c=n*l;e.fillStyle=a.backgroundColor,e.strokeStyle=a.borderColor,Yd(e,this,c,o,r),Rd(e,this,c,o,r),e.restore()}}function lr(t,e,a=e){t.lineCap=I(a.borderCapStyle,e.borderCapStyle),t.setLineDash(I(a.borderDash,e.borderDash)),t.lineDashOffset=I(a.borderDashOffset,e.borderDashOffset),t.lineJoin=I(a.borderJoinStyle,e.borderJoinStyle),t.lineWidth=I(a.borderWidth,e.borderWidth),t.strokeStyle=I(a.borderColor,e.borderColor)}function Fd(t,e,a){t.lineTo(a.x,a.y)}function $d(t){return t.stepped?tl:t.tension||t.cubicInterpolationMode==="monotone"?al:Fd}function cr(t,e,a={}){const i=t.length,{start:n=0,end:o=i-1}=a,{start:r,end:s}=e,l=Math.max(n,r),c=Math.min(o,s),d=n<r&&o<r||n>s&&o>s;return{count:i,start:l,loop:e.loop,ilen:c<l&&!d?i+c-l:c-l}}function Nd(t,e,a,i){const{points:n,options:o}=e,{count:r,start:s,loop:l,ilen:c}=cr(n,a,i),d=$d(o);let{move:p=!0,reverse:u}=i||{},h,f,m;for(h=0;h<=c;++h)f=n[(s+(u?c-h:h))%r],!f.skip&&(p?(t.moveTo(f.x,f.y),p=!1):d(t,m,f,u,o.stepped),m=f);return l&&(f=n[(s+(u?c:0))%r],d(t,m,f,u,o.stepped)),!!l}function zd(t,e,a,i){const n=e.points,{count:o,start:r,ilen:s}=cr(n,a,i),{move:l=!0,reverse:c}=i||{};let d=0,p=0,u,h,f,m,_,g;const b=y=>(r+(c?s-y:y))%o,w=()=>{m!==_&&(t.lineTo(d,_),t.lineTo(d,m),t.lineTo(d,g))};for(l&&(h=n[b(0)],t.moveTo(h.x,h.y)),u=0;u<=s;++u){if(h=n[b(u)],h.skip)continue;const y=h.x,v=h.y,M=y|0;M===f?(v<m?m=v:v>_&&(_=v),d=(p*d+y)/++p):(w(),t.lineTo(y,v),f=M,p=0,m=_=v),g=v}w()}function Ja(t){const e=t.options,a=e.borderDash&&e.borderDash.length;return!t._decimated&&!t._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!a?zd:Nd}function Wd(t){return t.stepped?Tl:t.tension||t.cubicInterpolationMode==="monotone"?Yl:Ge}function Hd(t,e,a,i){let n=e._path;n||(n=e._path=new Path2D,e.path(n,a,i)&&n.closePath()),lr(t,e.options),t.stroke(n)}function Vd(t,e,a,i){const{segments:n,options:o}=e,r=Ja(e);for(const s of n)lr(t,o,s.style),t.beginPath(),r(t,e,s,{start:a,end:a+i-1})&&t.closePath(),t.stroke()}const jd=typeof Path2D=="function";function qd(t,e,a,i){jd&&!e.options.segment?Hd(t,e,a,i):Vd(t,e,a,i)}class ka extends Le{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,a){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const n=i.spanGaps?this._loop:this._fullLoop;El(this._points,i,e,n,a),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=zl(this,this.options.segment))}first(){const e=this.segments,a=this.points;return e.length&&a[e[0].start]}last(){const e=this.segments,a=this.points,i=e.length;return i&&a[e[i-1].end]}interpolate(e,a){const i=this.options,n=e[a],o=this.points,r=Go(this,{property:a,start:n,end:n});if(!r.length)return;const s=[],l=Wd(i);let c,d;for(c=0,d=r.length;c<d;++c){const{start:p,end:u}=r[c],h=o[p],f=o[u];if(h===f){s.push(h);continue}const m=Math.abs((n-h[a])/(f[a]-h[a])),_=l(h,f,m,i.stepped);_[a]=e[a],s.push(_)}return s.length===1?s[0]:s}pathSegment(e,a,i){return Ja(this)(e,this,a,i)}path(e,a,i){const n=this.segments,o=Ja(this);let r=this._loop;a=a||0,i=i||this.points.length-a;for(const s of n)r&=o(e,this,s,{start:a,end:a+i-1});return!!r}draw(e,a,i,n){const o=this.options||{};(this.points||[]).length&&o.borderWidth&&(e.save(),qd(e,this,i,n),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function Wn(t,e,a,i){const n=t.options,{[a]:o}=t.getProps([a],i);return Math.abs(e-o)<n.radius+n.hitRadius}class Ud extends Le{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,a,i){const n=this.options,{x:o,y:r}=this.getProps(["x","y"],i);return Math.pow(e-o,2)+Math.pow(a-r,2)<Math.pow(n.hitRadius+n.radius,2)}inXRange(e,a){return Wn(this,e,"x",a)}inYRange(e,a){return Wn(this,e,"y",a)}getCenterPoint(e){const{x:a,y:i}=this.getProps(["x","y"],e);return{x:a,y:i}}size(e){e=e||this.options||{};let a=e.radius||0;a=Math.max(a,a&&e.hoverRadius||0);const i=a&&e.borderWidth||0;return(a+i)*2}draw(e,a){const i=this.options;this.skip||i.radius<.1||!ke(this,a,this.size(i)/2)||(e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.fillStyle=i.backgroundColor,Ga(e,i,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}function dr(t,e){const{x:a,y:i,base:n,width:o,height:r}=t.getProps(["x","y","base","width","height"],e);let s,l,c,d,p;return t.horizontal?(p=r/2,s=Math.min(a,n),l=Math.max(a,n),c=i-p,d=i+p):(p=o/2,s=a-p,l=a+p,c=Math.min(i,n),d=Math.max(i,n)),{left:s,top:c,right:l,bottom:d}}function Be(t,e,a,i){return t?0:Z(e,a,i)}function Gd(t,e,a){const i=t.options.borderWidth,n=t.borderSkipped,o=Oo(i);return{t:Be(n.top,o.top,0,a),r:Be(n.right,o.right,0,e),b:Be(n.bottom,o.bottom,0,a),l:Be(n.left,o.left,0,e)}}function Kd(t,e,a){const{enableBorderRadius:i}=t.getProps(["enableBorderRadius"]),n=t.options.borderRadius,o=Xe(n),r=Math.min(e,a),s=t.borderSkipped,l=i||T(n);return{topLeft:Be(!l||s.top||s.left,o.topLeft,0,r),topRight:Be(!l||s.top||s.right,o.topRight,0,r),bottomLeft:Be(!l||s.bottom||s.left,o.bottomLeft,0,r),bottomRight:Be(!l||s.bottom||s.right,o.bottomRight,0,r)}}function Xd(t){const e=dr(t),a=e.right-e.left,i=e.bottom-e.top,n=Gd(t,a/2,i/2),o=Kd(t,a/2,i/2);return{outer:{x:e.left,y:e.top,w:a,h:i,radius:o},inner:{x:e.left+n.l,y:e.top+n.t,w:a-n.l-n.r,h:i-n.t-n.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(n.t,n.l)),topRight:Math.max(0,o.topRight-Math.max(n.t,n.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(n.b,n.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(n.b,n.r))}}}}function Wa(t,e,a,i){const n=e===null,o=a===null,s=t&&!(n&&o)&&dr(t,i);return s&&(n||Se(e,s.left,s.right))&&(o||Se(a,s.top,s.bottom))}function Jd(t){return t.topLeft||t.topRight||t.bottomLeft||t.bottomRight}function Zd(t,e){t.rect(e.x,e.y,e.w,e.h)}function Ha(t,e,a={}){const i=t.x!==a.x?-e:0,n=t.y!==a.y?-e:0,o=(t.x+t.w!==a.x+a.w?e:0)-i,r=(t.y+t.h!==a.y+a.h?e:0)-n;return{x:t.x+i,y:t.y+n,w:t.w+o,h:t.h+r,radius:t.radius}}class Qd extends Le{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:a,options:{borderColor:i,backgroundColor:n}}=this,{inner:o,outer:r}=Xd(this),s=Jd(r.radius)?Rt:Zd;e.save(),(r.w!==o.w||r.h!==o.h)&&(e.beginPath(),s(e,Ha(r,a,o)),e.clip(),s(e,Ha(o,-a,r)),e.fillStyle=i,e.fill("evenodd")),e.beginPath(),s(e,Ha(o,a)),e.fillStyle=n,e.fill(),e.restore()}inRange(e,a,i){return Wa(this,e,a,i)}inXRange(e,a){return Wa(this,e,null,a)}inYRange(e,a){return Wa(this,null,e,a)}getCenterPoint(e){const{x:a,y:i,base:n,horizontal:o}=this.getProps(["x","y","base","horizontal"],e);return{x:o?(a+n)/2:a,y:o?i:(i+n)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}var ep=Object.freeze({__proto__:null,ArcElement:Od,BarElement:Qd,LineElement:ka,PointElement:Ud});const Za=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Hn=Za.map(t=>t.replace("rgb(","rgba(").replace(")",", 0.5)"));function pr(t){return Za[t%Za.length]}function ur(t){return Hn[t%Hn.length]}function tp(t,e){return t.borderColor=pr(e),t.backgroundColor=ur(e),++e}function ap(t,e){return t.backgroundColor=t.data.map(()=>pr(e++)),e}function ip(t,e){return t.backgroundColor=t.data.map(()=>ur(e++)),e}function np(t){let e=0;return(a,i)=>{const n=t.getDatasetMeta(i).controller;n instanceof Ei?e=ap(a,e):n instanceof Zo?e=ip(a,e):n&&(e=tp(a,e))}}function Vn(t){let e;for(e in t)if(t[e].borderColor||t[e].backgroundColor)return!0;return!1}function op(t){return t&&(t.borderColor||t.backgroundColor)}function rp(){return j.borderColor!=="rgba(0,0,0,0.1)"||j.backgroundColor!=="rgba(0,0,0,0.1)"}var sp={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(t,e,a){if(!a.enabled)return;const{data:{datasets:i},options:n}=t.config,{elements:o}=n,r=Vn(i)||op(n)||o&&Vn(o)||rp();if(!a.forceOverride&&r)return;const s=np(t);i.forEach(s)}};function lp(t,e,a,i,n){const o=n.samples||i;if(o>=a)return t.slice(e,e+a);const r=[],s=(a-2)/(o-2);let l=0;const c=e+a-1;let d=e,p,u,h,f,m;for(r[l++]=t[d],p=0;p<o-2;p++){let _=0,g=0,b;const w=Math.floor((p+1)*s)+1+e,y=Math.min(Math.floor((p+2)*s)+1,a)+e,v=y-w;for(b=w;b<y;b++)_+=t[b].x,g+=t[b].y;_/=v,g/=v;const M=Math.floor(p*s)+1+e,S=Math.min(Math.floor((p+1)*s)+1,a)+e,{x,y:C}=t[d];for(h=f=-1,b=M;b<S;b++)f=.5*Math.abs((x-_)*(t[b].y-C)-(x-t[b].x)*(g-C)),f>h&&(h=f,u=t[b],m=b);r[l++]=u,d=m}return r[l++]=t[c],r}function cp(t,e,a,i){let n=0,o=0,r,s,l,c,d,p,u,h,f,m;const _=[],g=e+a-1,b=t[e].x,y=t[g].x-b;for(r=e;r<e+a;++r){s=t[r],l=(s.x-b)/y*i,c=s.y;const v=l|0;if(v===d)c<f?(f=c,p=r):c>m&&(m=c,u=r),n=(o*n+s.x)/++o;else{const M=r-1;if(!B(p)&&!B(u)){const S=Math.min(p,u),x=Math.max(p,u);S!==h&&S!==M&&_.push({...t[S],x:n}),x!==h&&x!==M&&_.push({...t[x],x:n})}r>0&&M!==h&&_.push(t[M]),_.push(s),d=v,o=0,f=m=c,p=u=h=r}}return _}function hr(t){if(t._decimated){const e=t._data;delete t._decimated,delete t._data,Object.defineProperty(t,"data",{configurable:!0,enumerable:!0,writable:!0,value:e})}}function jn(t){t.data.datasets.forEach(e=>{hr(e)})}function dp(t,e){const a=e.length;let i=0,n;const{iScale:o}=t,{min:r,max:s,minDefined:l,maxDefined:c}=o.getUserBounds();return l&&(i=Z(Ee(e,o.axis,r).lo,0,a-1)),c?n=Z(Ee(e,o.axis,s).hi+1,i,a)-i:n=a-i,{start:i,count:n}}var pp={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(t,e,a)=>{if(!a.enabled){jn(t);return}const i=t.width;t.data.datasets.forEach((n,o)=>{const{_data:r,indexAxis:s}=n,l=t.getDatasetMeta(o),c=r||n.data;if(St([s,t.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=t.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||t.options.parsing)return;let{start:p,count:u}=dp(l,c);const h=a.threshold||4*i;if(u<=h){hr(n);return}B(r)&&(n._data=c,delete n.data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(m){this._data=m}}));let f;switch(a.algorithm){case"lttb":f=lp(c,p,u,i,a);break;case"min-max":f=cp(c,p,u,i);break;default:throw new Error(`Unsupported decimation algorithm '${a.algorithm}'`)}n._decimated=f})},destroy(t){jn(t)}};function up(t,e,a){const i=t.segments,n=t.points,o=e.points,r=[];for(const s of i){let{start:l,end:c}=s;c=Li(l,c,n);const d=Qa(a,n[l],n[c],s.loop);if(!e.segments){r.push({source:s,target:d,start:n[l],end:n[c]});continue}const p=Go(e,d);for(const u of p){const h=Qa(a,o[u.start],o[u.end],u.loop),f=Uo(s,n,h);for(const m of f)r.push({source:m,target:u,start:{[a]:qn(d,h,"start",Math.max)},end:{[a]:qn(d,h,"end",Math.min)}})}}return r}function Qa(t,e,a,i){if(i)return;let n=e[t],o=a[t];return t==="angle"&&(n=le(n),o=le(o)),{property:t,start:n,end:o}}function hp(t,e){const{x:a=null,y:i=null}=t||{},n=e.points,o=[];return e.segments.forEach(({start:r,end:s})=>{s=Li(r,s,n);const l=n[r],c=n[s];i!==null?(o.push({x:l.x,y:i}),o.push({x:c.x,y:i})):a!==null&&(o.push({x:a,y:l.y}),o.push({x:a,y:c.y}))}),o}function Li(t,e,a){for(;e>t;e--){const i=a[e];if(!isNaN(i.x)&&!isNaN(i.y))break}return e}function qn(t,e,a,i){return t&&e?i(t[a],e[a]):t?t[a]:e?e[a]:0}function fr(t,e){let a=[],i=!1;return z(t)?(i=!0,a=t):a=hp(t,e),a.length?new ka({points:a,options:{tension:0},_loop:i,_fullLoop:i}):null}function Un(t){return t&&t.fill!==!1}function fp(t,e,a){let n=t[e].fill;const o=[e];let r;if(!a)return n;for(;n!==!1&&o.indexOf(n)===-1;){if(!q(n))return n;if(r=t[n],!r)return!1;if(r.visible)return n;o.push(n),n=r.fill}return!1}function mp(t,e,a){const i=vp(t);if(T(i))return isNaN(i.value)?!1:i;let n=parseFloat(i);return q(n)&&Math.floor(n)===n?_p(i[0],e,n,a):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function _p(t,e,a,i){return(t==="-"||t==="+")&&(a=e+a),a===e||a<0||a>=i?!1:a}function gp(t,e){let a=null;return t==="start"?a=e.bottom:t==="end"?a=e.top:T(t)?a=e.getPixelForValue(t.value):e.getBasePixel&&(a=e.getBasePixel()),a}function bp(t,e,a){let i;return t==="start"?i=a:t==="end"?i=e.options.reverse?e.min:e.max:T(t)?i=t.value:i=e.getBaseValue(),i}function vp(t){const e=t.options,a=e.fill;let i=I(a&&a.target,a);return i===void 0&&(i=!!e.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function wp(t){const{scale:e,index:a,line:i}=t,n=[],o=i.segments,r=i.points,s=yp(e,a);s.push(fr({x:null,y:e.bottom},i));for(let l=0;l<o.length;l++){const c=o[l];for(let d=c.start;d<=c.end;d++)xp(n,r[d],s)}return new ka({points:n,options:{}})}function yp(t,e){const a=[],i=t.getMatchingVisibleMetas("line");for(let n=0;n<i.length;n++){const o=i[n];if(o.index===e)break;o.hidden||a.unshift(o.dataset)}return a}function xp(t,e,a){const i=[];for(let n=0;n<a.length;n++){const o=a[n],{first:r,last:s,point:l}=Cp(o,e,"x");if(!(!l||r&&s)){if(r)i.unshift(l);else if(t.push(l),!s)break}}t.push(...i)}function Cp(t,e,a){const i=t.interpolate(e,a);if(!i)return{};const n=i[a],o=t.segments,r=t.points;let s=!1,l=!1;for(let c=0;c<o.length;c++){const d=o[c],p=r[d.start][a],u=r[d.end][a];if(Se(n,p,u)){s=n===p,l=n===u;break}}return{first:s,last:l,point:i}}class mr{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,a,i){const{x:n,y:o,radius:r}=this;return a=a||{start:0,end:W},e.arc(n,o,r,a.end,a.start,!0),!i.bounds}interpolate(e){const{x:a,y:i,radius:n}=this,o=e.angle;return{x:a+Math.cos(o)*n,y:i+Math.sin(o)*n,angle:o}}}function Mp(t){const{chart:e,fill:a,line:i}=t;if(q(a))return Sp(e,a);if(a==="stack")return wp(t);if(a==="shape")return!0;const n=Ep(t);return n instanceof mr?n:fr(n,i)}function Sp(t,e){const a=t.getDatasetMeta(e);return a&&t.isDatasetVisible(e)?a.dataset:null}function Ep(t){return(t.scale||{}).getPointPositionForValue?Pp(t):kp(t)}function kp(t){const{scale:e={},fill:a}=t,i=gp(a,e);if(q(i)){const n=e.isHorizontal();return{x:n?i:null,y:n?null:i}}return null}function Pp(t){const{scale:e,fill:a}=t,i=e.options,n=e.getLabels().length,o=i.reverse?e.max:e.min,r=bp(a,e,o),s=[];if(i.grid.circular){const l=e.getPointPositionForValue(0,o);return new mr({x:l.x,y:l.y,radius:e.getDistanceFromCenterForValue(r)})}for(let l=0;l<n;++l)s.push(e.getPointPositionForValue(l,r));return s}function Va(t,e,a){const i=Mp(e),{line:n,scale:o,axis:r}=e,s=n.options,l=s.fill,c=s.backgroundColor,{above:d=c,below:p=c}=l||{};i&&n.points.length&&(Ma(t,a),Lp(t,{line:n,target:i,above:d,below:p,area:a,scale:o,axis:r}),Sa(t))}function Lp(t,e){const{line:a,target:i,above:n,below:o,area:r,scale:s}=e,l=a._loop?"angle":e.axis;t.save(),l==="x"&&o!==n&&(Gn(t,i,r.top),Kn(t,{line:a,target:i,color:n,scale:s,property:l}),t.restore(),t.save(),Gn(t,i,r.bottom)),Kn(t,{line:a,target:i,color:o,scale:s,property:l}),t.restore()}function Gn(t,e,a){const{segments:i,points:n}=e;let o=!0,r=!1;t.beginPath();for(const s of i){const{start:l,end:c}=s,d=n[l],p=n[Li(l,c,n)];o?(t.moveTo(d.x,d.y),o=!1):(t.lineTo(d.x,a),t.lineTo(d.x,d.y)),r=!!e.pathSegment(t,s,{move:r}),r?t.closePath():t.lineTo(p.x,a)}t.lineTo(e.first().x,a),t.closePath(),t.clip()}function Kn(t,e){const{line:a,target:i,property:n,color:o,scale:r}=e,s=up(a,i,n);for(const{source:l,target:c,start:d,end:p}of s){const{style:{backgroundColor:u=o}={}}=l,h=i!==!0;t.save(),t.fillStyle=u,Ap(t,r,h&&Qa(n,d,p)),t.beginPath();const f=!!a.pathSegment(t,l);let m;if(h){f?t.closePath():Xn(t,i,p,n);const _=!!i.pathSegment(t,c,{move:f,reverse:!0});m=f&&_,m||Xn(t,i,d,n)}t.closePath(),t.fill(m?"evenodd":"nonzero"),t.restore()}}function Ap(t,e,a){const{top:i,bottom:n}=e.chart.chartArea,{property:o,start:r,end:s}=a||{};o==="x"&&(t.beginPath(),t.rect(r,i,s-r,n-i),t.clip())}function Xn(t,e,a,i){const n=e.interpolate(a,i);n&&t.lineTo(n.x,n.y)}var Dp={id:"filler",afterDatasetsUpdate(t,e,a){const i=(t.data.datasets||[]).length,n=[];let o,r,s,l;for(r=0;r<i;++r)o=t.getDatasetMeta(r),s=o.dataset,l=null,s&&s.options&&s instanceof ka&&(l={visible:t.isDatasetVisible(r),index:r,fill:mp(s,r,i),chart:t,axis:o.controller.options.indexAxis,scale:o.vScale,line:s}),o.$filler=l,n.push(l);for(r=0;r<i;++r)l=n[r],!(!l||l.fill===!1)&&(l.fill=fp(n,r,a.propagate))},beforeDraw(t,e,a){const i=a.drawTime==="beforeDraw",n=t.getSortedVisibleDatasetMetas(),o=t.chartArea;for(let r=n.length-1;r>=0;--r){const s=n[r].$filler;s&&(s.line.updateControlPoints(o,s.axis),i&&s.fill&&Va(t.ctx,s,o))}},beforeDatasetsDraw(t,e,a){if(a.drawTime!=="beforeDatasetsDraw")return;const i=t.getSortedVisibleDatasetMetas();for(let n=i.length-1;n>=0;--n){const o=i[n].$filler;Un(o)&&Va(t.ctx,o,t.chartArea)}},beforeDatasetDraw(t,e,a){const i=e.meta.$filler;!Un(i)||a.drawTime!=="beforeDatasetDraw"||Va(t.ctx,i,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Jn=(t,e)=>{let{boxHeight:a=e,boxWidth:i=e}=t;return t.usePointStyle&&(a=Math.min(a,e),i=t.pointStyleWidth||Math.min(i,e)),{boxWidth:i,boxHeight:a,itemHeight:Math.max(e,a)}},Ip=(t,e)=>t!==null&&e!==null&&t.datasetIndex===e.datasetIndex&&t.index===e.index;class Zn extends Le{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,a,i){this.maxWidth=e,this.maxHeight=a,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let a=N(e.generateLabels,[this.chart],this)||[];e.filter&&(a=a.filter(i=>e.filter(i,this.chart.data))),e.sort&&(a=a.sort((i,n)=>e.sort(i,n,this.chart.data))),this.options.reverse&&a.reverse(),this.legendItems=a}fit(){const{options:e,ctx:a}=this;if(!e.display){this.width=this.height=0;return}const i=e.labels,n=J(i.font),o=n.size,r=this._computeTitleHeight(),{boxWidth:s,itemHeight:l}=Jn(i,o);let c,d;a.font=n.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(r,o,s,l)+10):(d=this.maxHeight,c=this._fitCols(r,n,s,l)+10),this.width=Math.min(c,e.maxWidth||this.maxWidth),this.height=Math.min(d,e.maxHeight||this.maxHeight)}_fitRows(e,a,i,n){const{ctx:o,maxWidth:r,options:{labels:{padding:s}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=n+s;let p=e;o.textAlign="left",o.textBaseline="middle";let u=-1,h=-d;return this.legendItems.forEach((f,m)=>{const _=i+a/2+o.measureText(f.text).width;(m===0||c[c.length-1]+_+2*s>r)&&(p+=d,c[c.length-(m>0?0:1)]=0,h+=d,u++),l[m]={left:0,top:h,row:u,width:_,height:n},c[c.length-1]+=_+s}),p}_fitCols(e,a,i,n){const{ctx:o,maxHeight:r,options:{labels:{padding:s}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=r-e;let p=s,u=0,h=0,f=0,m=0;return this.legendItems.forEach((_,g)=>{const{itemWidth:b,itemHeight:w}=Bp(i,a,o,_,n);g>0&&h+w+2*s>d&&(p+=u+s,c.push({width:u,height:h}),f+=u+s,m++,u=h=0),l[g]={left:f,top:h,col:m,width:b,height:w},u=Math.max(u,b),h+=w+s}),p+=u,c.push({width:u,height:h}),p}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:a,options:{align:i,labels:{padding:n},rtl:o}}=this,r=lt(o,this.left,this.width);if(this.isHorizontal()){let s=0,l=te(i,this.left+n,this.right-this.lineWidths[s]);for(const c of a)s!==c.row&&(s=c.row,l=te(i,this.left+n,this.right-this.lineWidths[s])),c.top+=this.top+e+n,c.left=r.leftForLtr(r.x(l),c.width),l+=c.width+n}else{let s=0,l=te(i,this.top+e+n,this.bottom-this.columnSizes[s].height);for(const c of a)c.col!==s&&(s=c.col,l=te(i,this.top+e+n,this.bottom-this.columnSizes[s].height)),c.top=l,c.left+=this.left+n,c.left=r.leftForLtr(r.x(c.left),c.width),l+=c.height+n}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;Ma(e,this),this._draw(),Sa(e)}}_draw(){const{options:e,columnSizes:a,lineWidths:i,ctx:n}=this,{align:o,labels:r}=e,s=j.color,l=lt(e.rtl,this.left,this.width),c=J(r.font),{padding:d}=r,p=c.size,u=p/2;let h;this.drawTitle(),n.textAlign=l.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=c.string;const{boxWidth:f,boxHeight:m,itemHeight:_}=Jn(r,p),g=function(M,S,x){if(isNaN(f)||f<=0||isNaN(m)||m<0)return;n.save();const C=I(x.lineWidth,1);if(n.fillStyle=I(x.fillStyle,s),n.lineCap=I(x.lineCap,"butt"),n.lineDashOffset=I(x.lineDashOffset,0),n.lineJoin=I(x.lineJoin,"miter"),n.lineWidth=C,n.strokeStyle=I(x.strokeStyle,s),n.setLineDash(I(x.lineDash,[])),r.usePointStyle){const E={radius:m*Math.SQRT2/2,pointStyle:x.pointStyle,rotation:x.rotation,borderWidth:C},P=l.xPlus(M,f/2),A=S+u;Ro(n,E,P,A,r.pointStyleWidth&&f)}else{const E=S+Math.max((p-m)/2,0),P=l.leftForLtr(M,f),A=Xe(x.borderRadius);n.beginPath(),Object.values(A).some(R=>R!==0)?Rt(n,{x:P,y:E,w:f,h:m,radius:A}):n.rect(P,E,f,m),n.fill(),C!==0&&n.stroke()}n.restore()},b=function(M,S,x){et(n,x.text,M,S+_/2,c,{strikethrough:x.hidden,textAlign:l.textAlign(x.textAlign)})},w=this.isHorizontal(),y=this._computeTitleHeight();w?h={x:te(o,this.left+d,this.right-i[0]),y:this.top+d+y,line:0}:h={x:this.left+d,y:te(o,this.top+y+d,this.bottom-a[0].height),line:0},Vo(this.ctx,e.textDirection);const v=_+d;this.legendItems.forEach((M,S)=>{n.strokeStyle=M.fontColor,n.fillStyle=M.fontColor;const x=n.measureText(M.text).width,C=l.textAlign(M.textAlign||(M.textAlign=r.textAlign)),E=f+u+x;let P=h.x,A=h.y;l.setWidth(this.width),w?S>0&&P+E+d>this.right&&(A=h.y+=v,h.line++,P=h.x=te(o,this.left+d,this.right-i[h.line])):S>0&&A+v>this.bottom&&(P=h.x=P+a[h.line].width+d,h.line++,A=h.y=te(o,this.top+y+d,this.bottom-a[h.line].height));const R=l.x(P);if(g(R,A,M),P=Vs(C,P+f+u,w?P+E:this.right,e.rtl),b(l.x(P),A,M),w)h.x+=E+d;else if(typeof M.text!="string"){const O=c.lineHeight;h.y+=_r(M,O)+d}else h.y+=v}),jo(this.ctx,e.textDirection)}drawTitle(){const e=this.options,a=e.title,i=J(a.font),n=ie(a.padding);if(!a.display)return;const o=lt(e.rtl,this.left,this.width),r=this.ctx,s=a.position,l=i.size/2,c=n.top+l;let d,p=this.left,u=this.width;if(this.isHorizontal())u=Math.max(...this.lineWidths),d=this.top+c,p=te(e.align,p,this.right-u);else{const f=this.columnSizes.reduce((m,_)=>Math.max(m,_.height),0);d=c+te(e.align,this.top,this.bottom-f-e.labels.padding-this._computeTitleHeight())}const h=te(s,p,p+u);r.textAlign=o.textAlign(bi(s)),r.textBaseline="middle",r.strokeStyle=a.color,r.fillStyle=a.color,r.font=i.string,et(r,a.text,h,d,i)}_computeTitleHeight(){const e=this.options.title,a=J(e.font),i=ie(e.padding);return e.display?a.lineHeight+i.height:0}_getLegendItemAt(e,a){let i,n,o;if(Se(e,this.left,this.right)&&Se(a,this.top,this.bottom)){for(o=this.legendHitBoxes,i=0;i<o.length;++i)if(n=o[i],Se(e,n.left,n.left+n.width)&&Se(a,n.top,n.top+n.height))return this.legendItems[i]}return null}handleEvent(e){const a=this.options;if(!Rp(e.type,a))return;const i=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const n=this._hoveredItem,o=Ip(n,i);n&&!o&&N(a.onLeave,[e,n,this],this),this._hoveredItem=i,i&&!o&&N(a.onHover,[e,i,this],this)}else i&&N(a.onClick,[e,i,this],this)}}function Bp(t,e,a,i,n){const o=Tp(i,t,e,a),r=Yp(n,i,e.lineHeight);return{itemWidth:o,itemHeight:r}}function Tp(t,e,a,i){let n=t.text;return n&&typeof n!="string"&&(n=n.reduce((o,r)=>o.length>r.length?o:r)),e+a.size/2+i.measureText(n).width}function Yp(t,e,a){let i=t;return typeof e.text!="string"&&(i=_r(e,a)),i}function _r(t,e){const a=t.text?t.text.length:0;return e*a}function Rp(t,e){return!!((t==="mousemove"||t==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(t==="click"||t==="mouseup"))}var Op={id:"legend",_element:Zn,start(t,e,a){const i=t.legend=new Zn({ctx:t.ctx,options:a,chart:t});ae.configure(t,i,a),ae.addBox(t,i)},stop(t){ae.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,a){const i=t.legend;ae.configure(t,i,a),i.options=a},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,a){const i=e.datasetIndex,n=a.chart;n.isDatasetVisible(i)?(n.hide(i),e.hidden=!0):(n.show(i),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:a,pointStyle:i,textAlign:n,color:o,useBorderRadius:r,borderRadius:s}}=t.legend.options;return t._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(a?0:void 0),d=ie(c.borderWidth);return{text:e[l.index].label,fillStyle:c.backgroundColor,fontColor:o,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:i||c.pointStyle,rotation:c.rotation,textAlign:n||c.textAlign,borderRadius:r&&(s||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class Ai extends Le{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,a){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=a;const n=z(i.text)?i.text.length:1;this._padding=ie(i.padding);const o=n*J(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:a,left:i,bottom:n,right:o,options:r}=this,s=r.align;let l=0,c,d,p;return this.isHorizontal()?(d=te(s,i,o),p=a+e,c=o-i):(r.position==="left"?(d=i+e,p=te(s,n,a),l=H*-.5):(d=o-e,p=te(s,a,n),l=H*.5),c=n-a),{titleX:d,titleY:p,maxWidth:c,rotation:l}}draw(){const e=this.ctx,a=this.options;if(!a.display)return;const i=J(a.font),o=i.lineHeight/2+this._padding.top,{titleX:r,titleY:s,maxWidth:l,rotation:c}=this._drawArgs(o);et(e,a.text,0,0,i,{color:a.color,maxWidth:l,rotation:c,textAlign:bi(a.align),textBaseline:"middle",translation:[r,s]})}}function Fp(t,e){const a=new Ai({ctx:t.ctx,options:e,chart:t});ae.configure(t,a,e),ae.addBox(t,a),t.titleBlock=a}var $p={id:"title",_element:Ai,start(t,e,a){Fp(t,a)},stop(t){const e=t.titleBlock;ae.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,a){const i=t.titleBlock;ae.configure(t,i,a),i.options=a},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const oa=new WeakMap;var Np={id:"subtitle",start(t,e,a){const i=new Ai({ctx:t.ctx,options:a,chart:t});ae.configure(t,i,a),ae.addBox(t,i),oa.set(t,i)},stop(t){ae.removeBox(t,oa.get(t)),oa.delete(t)},beforeUpdate(t,e,a){const i=oa.get(t);ae.configure(t,i,a),i.options=a},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const kt={average(t){if(!t.length)return!1;let e,a,i=new Set,n=0,o=0;for(e=0,a=t.length;e<a;++e){const s=t[e].element;if(s&&s.hasValue()){const l=s.tooltipPosition();i.add(l.x),n+=l.y,++o}}return o===0||i.size===0?!1:{x:[...i].reduce((s,l)=>s+l)/i.size,y:n/o}},nearest(t,e){if(!t.length)return!1;let a=e.x,i=e.y,n=Number.POSITIVE_INFINITY,o,r,s;for(o=0,r=t.length;o<r;++o){const l=t[o].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=qa(e,c);d<n&&(n=d,s=l)}}if(s){const l=s.tooltipPosition();a=l.x,i=l.y}return{x:a,y:i}}};function he(t,e){return e&&(z(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function Ce(t){return(typeof t=="string"||t instanceof String)&&t.indexOf(`
`)>-1?t.split(`
`):t}function zp(t,e){const{element:a,datasetIndex:i,index:n}=e,o=t.getDatasetMeta(i).controller,{label:r,value:s}=o.getLabelAndValue(n);return{chart:t,label:r,parsed:o.getParsed(n),raw:t.data.datasets[i].data[n],formattedValue:s,dataset:o.getDataset(),dataIndex:n,datasetIndex:i,element:a}}function Qn(t,e){const a=t.chart.ctx,{body:i,footer:n,title:o}=t,{boxWidth:r,boxHeight:s}=e,l=J(e.bodyFont),c=J(e.titleFont),d=J(e.footerFont),p=o.length,u=n.length,h=i.length,f=ie(e.padding);let m=f.height,_=0,g=i.reduce((y,v)=>y+v.before.length+v.lines.length+v.after.length,0);if(g+=t.beforeBody.length+t.afterBody.length,p&&(m+=p*c.lineHeight+(p-1)*e.titleSpacing+e.titleMarginBottom),g){const y=e.displayColors?Math.max(s,l.lineHeight):l.lineHeight;m+=h*y+(g-h)*l.lineHeight+(g-1)*e.bodySpacing}u&&(m+=e.footerMarginTop+u*d.lineHeight+(u-1)*e.footerSpacing);let b=0;const w=function(y){_=Math.max(_,a.measureText(y).width+b)};return a.save(),a.font=c.string,F(t.title,w),a.font=l.string,F(t.beforeBody.concat(t.afterBody),w),b=e.displayColors?r+2+e.boxPadding:0,F(i,y=>{F(y.before,w),F(y.lines,w),F(y.after,w)}),b=0,a.font=d.string,F(t.footer,w),a.restore(),_+=f.width,{width:_,height:m}}function Wp(t,e){const{y:a,height:i}=e;return a<i/2?"top":a>t.height-i/2?"bottom":"center"}function Hp(t,e,a,i){const{x:n,width:o}=i,r=a.caretSize+a.caretPadding;if(t==="left"&&n+o+r>e.width||t==="right"&&n-o-r<0)return!0}function Vp(t,e,a,i){const{x:n,width:o}=a,{width:r,chartArea:{left:s,right:l}}=t;let c="center";return i==="center"?c=n<=(s+l)/2?"left":"right":n<=o/2?c="left":n>=r-o/2&&(c="right"),Hp(c,t,e,a)&&(c="center"),c}function eo(t,e,a){const i=a.yAlign||e.yAlign||Wp(t,a);return{xAlign:a.xAlign||e.xAlign||Vp(t,e,a,i),yAlign:i}}function jp(t,e){let{x:a,width:i}=t;return e==="right"?a-=i:e==="center"&&(a-=i/2),a}function qp(t,e,a){let{y:i,height:n}=t;return e==="top"?i+=a:e==="bottom"?i-=n+a:i-=n/2,i}function to(t,e,a,i){const{caretSize:n,caretPadding:o,cornerRadius:r}=t,{xAlign:s,yAlign:l}=a,c=n+o,{topLeft:d,topRight:p,bottomLeft:u,bottomRight:h}=Xe(r);let f=jp(e,s);const m=qp(e,l,c);return l==="center"?s==="left"?f+=c:s==="right"&&(f-=c):s==="left"?f-=Math.max(d,u)+n:s==="right"&&(f+=Math.max(p,h)+n),{x:Z(f,0,i.width-e.width),y:Z(m,0,i.height-e.height)}}function ra(t,e,a){const i=ie(a.padding);return e==="center"?t.x+t.width/2:e==="right"?t.x+t.width-i.right:t.x+i.left}function ao(t){return he([],Ce(t))}function Up(t,e,a){return $e(t,{tooltip:e,tooltipItems:a,type:"tooltip"})}function io(t,e){const a=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return a?t.override(a):t}const gr={beforeTitle:ye,title(t){if(t.length>0){const e=t[0],a=e.chart.data.labels,i=a?a.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(i>0&&e.dataIndex<i)return a[e.dataIndex]}return""},afterTitle:ye,beforeBody:ye,beforeLabel:ye,label(t){if(this&&this.options&&this.options.mode==="dataset")return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const a=t.formattedValue;return B(a)||(e+=a),e},labelColor(t){const a=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:a.borderColor,backgroundColor:a.backgroundColor,borderWidth:a.borderWidth,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const a=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:a.pointStyle,rotation:a.rotation}},afterLabel:ye,afterBody:ye,beforeFooter:ye,footer:ye,afterFooter:ye};function ne(t,e,a,i){const n=t[e].call(a,i);return typeof n>"u"?gr[e].call(a,i):n}class no extends Le{static positioners=kt;constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const a=this.chart,i=this.options.setContext(this.getContext()),n=i.enabled&&a.options.animation&&i.animations,o=new Ko(this.chart,n);return n._cacheable&&(this._cachedAnimations=Object.freeze(o)),o}getContext(){return this.$context||(this.$context=Up(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,a){const{callbacks:i}=a,n=ne(i,"beforeTitle",this,e),o=ne(i,"title",this,e),r=ne(i,"afterTitle",this,e);let s=[];return s=he(s,Ce(n)),s=he(s,Ce(o)),s=he(s,Ce(r)),s}getBeforeBody(e,a){return ao(ne(a.callbacks,"beforeBody",this,e))}getBody(e,a){const{callbacks:i}=a,n=[];return F(e,o=>{const r={before:[],lines:[],after:[]},s=io(i,o);he(r.before,Ce(ne(s,"beforeLabel",this,o))),he(r.lines,ne(s,"label",this,o)),he(r.after,Ce(ne(s,"afterLabel",this,o))),n.push(r)}),n}getAfterBody(e,a){return ao(ne(a.callbacks,"afterBody",this,e))}getFooter(e,a){const{callbacks:i}=a,n=ne(i,"beforeFooter",this,e),o=ne(i,"footer",this,e),r=ne(i,"afterFooter",this,e);let s=[];return s=he(s,Ce(n)),s=he(s,Ce(o)),s=he(s,Ce(r)),s}_createItems(e){const a=this._active,i=this.chart.data,n=[],o=[],r=[];let s=[],l,c;for(l=0,c=a.length;l<c;++l)s.push(zp(this.chart,a[l]));return e.filter&&(s=s.filter((d,p,u)=>e.filter(d,p,u,i))),e.itemSort&&(s=s.sort((d,p)=>e.itemSort(d,p,i))),F(s,d=>{const p=io(e.callbacks,d);n.push(ne(p,"labelColor",this,d)),o.push(ne(p,"labelPointStyle",this,d)),r.push(ne(p,"labelTextColor",this,d))}),this.labelColors=n,this.labelPointStyles=o,this.labelTextColors=r,this.dataPoints=s,s}update(e,a){const i=this.options.setContext(this.getContext()),n=this._active;let o,r=[];if(!n.length)this.opacity!==0&&(o={opacity:0});else{const s=kt[i.position].call(this,n,this._eventPosition);r=this._createItems(i),this.title=this.getTitle(r,i),this.beforeBody=this.getBeforeBody(r,i),this.body=this.getBody(r,i),this.afterBody=this.getAfterBody(r,i),this.footer=this.getFooter(r,i);const l=this._size=Qn(this,i),c=Object.assign({},s,l),d=eo(this.chart,i,c),p=to(i,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,o={opacity:1,x:p.x,y:p.y,width:l.width,height:l.height,caretX:s.x,caretY:s.y}}this._tooltipItems=r,this.$context=void 0,o&&this._resolveAnimations().update(this,o),e&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:a})}drawCaret(e,a,i,n){const o=this.getCaretPosition(e,i,n);a.lineTo(o.x1,o.y1),a.lineTo(o.x2,o.y2),a.lineTo(o.x3,o.y3)}getCaretPosition(e,a,i){const{xAlign:n,yAlign:o}=this,{caretSize:r,cornerRadius:s}=i,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:p}=Xe(s),{x:u,y:h}=e,{width:f,height:m}=a;let _,g,b,w,y,v;return o==="center"?(y=h+m/2,n==="left"?(_=u,g=_-r,w=y+r,v=y-r):(_=u+f,g=_+r,w=y-r,v=y+r),b=_):(n==="left"?g=u+Math.max(l,d)+r:n==="right"?g=u+f-Math.max(c,p)-r:g=this.caretX,o==="top"?(w=h,y=w-r,_=g-r,b=g+r):(w=h+m,y=w+r,_=g+r,b=g-r),v=w),{x1:_,x2:g,x3:b,y1:w,y2:y,y3:v}}drawTitle(e,a,i){const n=this.title,o=n.length;let r,s,l;if(o){const c=lt(i.rtl,this.x,this.width);for(e.x=ra(this,i.titleAlign,i),a.textAlign=c.textAlign(i.titleAlign),a.textBaseline="middle",r=J(i.titleFont),s=i.titleSpacing,a.fillStyle=i.titleColor,a.font=r.string,l=0;l<o;++l)a.fillText(n[l],c.x(e.x),e.y+r.lineHeight/2),e.y+=r.lineHeight+s,l+1===o&&(e.y+=i.titleMarginBottom-s)}}_drawColorBox(e,a,i,n,o){const r=this.labelColors[i],s=this.labelPointStyles[i],{boxHeight:l,boxWidth:c}=o,d=J(o.bodyFont),p=ra(this,"left",o),u=n.x(p),h=l<d.lineHeight?(d.lineHeight-l)/2:0,f=a.y+h;if(o.usePointStyle){const m={radius:Math.min(c,l)/2,pointStyle:s.pointStyle,rotation:s.rotation,borderWidth:1},_=n.leftForLtr(u,c)+c/2,g=f+l/2;e.strokeStyle=o.multiKeyBackground,e.fillStyle=o.multiKeyBackground,Ga(e,m,_,g),e.strokeStyle=r.borderColor,e.fillStyle=r.backgroundColor,Ga(e,m,_,g)}else{e.lineWidth=T(r.borderWidth)?Math.max(...Object.values(r.borderWidth)):r.borderWidth||1,e.strokeStyle=r.borderColor,e.setLineDash(r.borderDash||[]),e.lineDashOffset=r.borderDashOffset||0;const m=n.leftForLtr(u,c),_=n.leftForLtr(n.xPlus(u,1),c-2),g=Xe(r.borderRadius);Object.values(g).some(b=>b!==0)?(e.beginPath(),e.fillStyle=o.multiKeyBackground,Rt(e,{x:m,y:f,w:c,h:l,radius:g}),e.fill(),e.stroke(),e.fillStyle=r.backgroundColor,e.beginPath(),Rt(e,{x:_,y:f+1,w:c-2,h:l-2,radius:g}),e.fill()):(e.fillStyle=o.multiKeyBackground,e.fillRect(m,f,c,l),e.strokeRect(m,f,c,l),e.fillStyle=r.backgroundColor,e.fillRect(_,f+1,c-2,l-2))}e.fillStyle=this.labelTextColors[i]}drawBody(e,a,i){const{body:n}=this,{bodySpacing:o,bodyAlign:r,displayColors:s,boxHeight:l,boxWidth:c,boxPadding:d}=i,p=J(i.bodyFont);let u=p.lineHeight,h=0;const f=lt(i.rtl,this.x,this.width),m=function(x){a.fillText(x,f.x(e.x+h),e.y+u/2),e.y+=u+o},_=f.textAlign(r);let g,b,w,y,v,M,S;for(a.textAlign=r,a.textBaseline="middle",a.font=p.string,e.x=ra(this,_,i),a.fillStyle=i.bodyColor,F(this.beforeBody,m),h=s&&_!=="right"?r==="center"?c/2+d:c+2+d:0,y=0,M=n.length;y<M;++y){for(g=n[y],b=this.labelTextColors[y],a.fillStyle=b,F(g.before,m),w=g.lines,s&&w.length&&(this._drawColorBox(a,e,y,f,i),u=Math.max(p.lineHeight,l)),v=0,S=w.length;v<S;++v)m(w[v]),u=p.lineHeight;F(g.after,m)}h=0,u=p.lineHeight,F(this.afterBody,m),e.y-=o}drawFooter(e,a,i){const n=this.footer,o=n.length;let r,s;if(o){const l=lt(i.rtl,this.x,this.width);for(e.x=ra(this,i.footerAlign,i),e.y+=i.footerMarginTop,a.textAlign=l.textAlign(i.footerAlign),a.textBaseline="middle",r=J(i.footerFont),a.fillStyle=i.footerColor,a.font=r.string,s=0;s<o;++s)a.fillText(n[s],l.x(e.x),e.y+r.lineHeight/2),e.y+=r.lineHeight+i.footerSpacing}}drawBackground(e,a,i,n){const{xAlign:o,yAlign:r}=this,{x:s,y:l}=e,{width:c,height:d}=i,{topLeft:p,topRight:u,bottomLeft:h,bottomRight:f}=Xe(n.cornerRadius);a.fillStyle=n.backgroundColor,a.strokeStyle=n.borderColor,a.lineWidth=n.borderWidth,a.beginPath(),a.moveTo(s+p,l),r==="top"&&this.drawCaret(e,a,i,n),a.lineTo(s+c-u,l),a.quadraticCurveTo(s+c,l,s+c,l+u),r==="center"&&o==="right"&&this.drawCaret(e,a,i,n),a.lineTo(s+c,l+d-f),a.quadraticCurveTo(s+c,l+d,s+c-f,l+d),r==="bottom"&&this.drawCaret(e,a,i,n),a.lineTo(s+h,l+d),a.quadraticCurveTo(s,l+d,s,l+d-h),r==="center"&&o==="left"&&this.drawCaret(e,a,i,n),a.lineTo(s,l+p),a.quadraticCurveTo(s,l,s+p,l),a.closePath(),a.fill(),n.borderWidth>0&&a.stroke()}_updateAnimationTarget(e){const a=this.chart,i=this.$animations,n=i&&i.x,o=i&&i.y;if(n||o){const r=kt[e.position].call(this,this._active,this._eventPosition);if(!r)return;const s=this._size=Qn(this,e),l=Object.assign({},r,this._size),c=eo(a,e,l),d=to(e,l,c,a);(n._to!==d.x||o._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=s.width,this.height=s.height,this.caretX=r.x,this.caretY=r.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(e){const a=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(a);const n={width:this.width,height:this.height},o={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const r=ie(a.padding),s=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;a.enabled&&s&&(e.save(),e.globalAlpha=i,this.drawBackground(o,e,n,a),Vo(e,a.textDirection),o.y+=r.top,this.drawTitle(o,e,a),this.drawBody(o,e,a),this.drawFooter(o,e,a),jo(e,a.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,a){const i=this._active,n=e.map(({datasetIndex:s,index:l})=>{const c=this.chart.getDatasetMeta(s);if(!c)throw new Error("Cannot find a dataset at index "+s);return{datasetIndex:s,element:c.data[l],index:l}}),o=!pa(i,n),r=this._positionChanged(n,a);(o||r)&&(this._active=n,this._eventPosition=a,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,a,i=!0){if(a&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const n=this.options,o=this._active||[],r=this._getActiveElements(e,o,a,i),s=this._positionChanged(r,e),l=a||!pa(r,o)||s;return l&&(this._active=r,(n.enabled||n.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,a))),l}_getActiveElements(e,a,i,n){const o=this.options;if(e.type==="mouseout")return[];if(!n)return a.filter(s=>this.chart.data.datasets[s.datasetIndex]&&this.chart.getDatasetMeta(s.datasetIndex).controller.getParsed(s.index)!==void 0);const r=this.chart.getElementsAtEventForMode(e,o.mode,o,i);return o.reverse&&r.reverse(),r}_positionChanged(e,a){const{caretX:i,caretY:n,options:o}=this,r=kt[o.position].call(this,e,a);return r!==!1&&(i!==r.x||n!==r.y)}}var Gp={id:"tooltip",_element:no,positioners:kt,afterInit(t,e,a){a&&(t.tooltip=new no({chart:t,options:a}))},beforeUpdate(t,e,a){t.tooltip&&t.tooltip.initialize(a)},reset(t,e,a){t.tooltip&&t.tooltip.initialize(a)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const a={tooltip:e};if(t.notifyPlugins("beforeTooltipDraw",{...a,cancelable:!0})===!1)return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",a)}},afterEvent(t,e){if(t.tooltip){const a=e.replay;t.tooltip.handleEvent(e.event,a,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:gr},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>t!=="filter"&&t!=="itemSort"&&t!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Kp=Object.freeze({__proto__:null,Colors:sp,Decimation:pp,Filler:Dp,Legend:Op,SubTitle:Np,Title:$p,Tooltip:Gp});const Xp=(t,e,a,i)=>(typeof e=="string"?(a=t.push(e)-1,i.unshift({index:a,label:e})):isNaN(e)&&(a=null),a);function Jp(t,e,a,i){const n=t.indexOf(e);if(n===-1)return Xp(t,e,a,i);const o=t.lastIndexOf(e);return n!==o?a:n}const Zp=(t,e)=>t===null?null:Z(Math.round(t),0,e);function oo(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}class Qp extends tt{static id="category";static defaults={ticks:{callback:oo}};constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const a=this._addedLabels;if(a.length){const i=this.getLabels();for(const{index:n,label:o}of a)i[n]===o&&i.splice(n,1);this._addedLabels=[]}super.init(e)}parse(e,a){if(B(e))return null;const i=this.getLabels();return a=isFinite(a)&&i[a]===e?a:Jp(i,e,I(a,e),this._addedLabels),Zp(a,i.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:a}=this.getUserBounds();let{min:i,max:n}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(i=0),a||(n=this.getLabels().length-1)),this.min=i,this.max=n}buildTicks(){const e=this.min,a=this.max,i=this.options.offset,n=[];let o=this.getLabels();o=e===0&&a===o.length-1?o:o.slice(e,a+1),this._valueRange=Math.max(o.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let r=e;r<=a;r++)n.push({value:r});return n}getLabelForValue(e){return oo.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const a=this.ticks;return e<0||e>a.length-1?null:this.getPixelForValue(a[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function eu(t,e){const a=[],{bounds:n,step:o,min:r,max:s,precision:l,count:c,maxTicks:d,maxDigits:p,includeBounds:u}=t,h=o||1,f=d-1,{min:m,max:_}=e,g=!B(r),b=!B(s),w=!B(c),y=(_-m)/(p+1);let v=Zi((_-m)/f/h)*h,M,S,x,C;if(v<1e-14&&!g&&!b)return[{value:m},{value:_}];C=Math.ceil(_/v)-Math.floor(m/v),C>f&&(v=Zi(C*v/f/h)*h),B(l)||(M=Math.pow(10,l),v=Math.ceil(v*M)/M),n==="ticks"?(S=Math.floor(m/v)*v,x=Math.ceil(_/v)*v):(S=m,x=_),g&&b&&o&&Os((s-r)/o,v/1e3)?(C=Math.round(Math.min((s-r)/v,d)),v=(s-r)/C,S=r,x=s):w?(S=g?r:S,x=b?s:x,C=c-1,v=(x-S)/C):(C=(x-S)/v,Lt(C,Math.round(C),v/1e3)?C=Math.round(C):C=Math.ceil(C));const E=Math.max(Qi(v),Qi(S));M=Math.pow(10,B(l)?E:l),S=Math.round(S*M)/M,x=Math.round(x*M)/M;let P=0;for(g&&(u&&S!==r?(a.push({value:r}),S<r&&P++,Lt(Math.round((S+P*v)*M)/M,r,ro(r,y,t))&&P++):S<r&&P++);P<C;++P){const A=Math.round((S+P*v)*M)/M;if(b&&A>s)break;a.push({value:A})}return b&&u&&x!==s?a.length&&Lt(a[a.length-1].value,s,ro(s,y,t))?a[a.length-1].value=s:a.push({value:s}):(!b||x===s)&&a.push({value:x}),a}function ro(t,e,{horizontal:a,minRotation:i}){const n=pe(i),o=(a?Math.sin(n):Math.cos(n))||.001,r=.75*e*(""+t).length;return Math.min(e/o,r)}class ba extends tt{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,a){return B(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:a,maxDefined:i}=this.getUserBounds();let{min:n,max:o}=this;const r=l=>n=a?n:l,s=l=>o=i?o:l;if(e){const l=be(n),c=be(o);l<0&&c<0?s(0):l>0&&c>0&&r(0)}if(n===o){let l=o===0?1:Math.abs(o*.05);s(o+l),e||r(n-l)}this.min=n,this.max=o}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:a,stepSize:i}=e,n;return i?(n=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,n>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${n} ticks. Limiting to 1000.`),n=1e3)):(n=this.computeTickLimit(),a=a||11),a&&(n=Math.min(a,n)),n}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,a=e.ticks;let i=this.getTickLimit();i=Math.max(2,i);const n={maxTicks:i,bounds:e.bounds,min:e.min,max:e.max,precision:a.precision,step:a.stepSize,count:a.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:a.minRotation||0,includeBounds:a.includeBounds!==!1},o=this._range||this,r=eu(n,o);return e.bounds==="ticks"&&ko(r,this,"value"),e.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}configure(){const e=this.ticks;let a=this.min,i=this.max;if(super.configure(),this.options.offset&&e.length){const n=(i-a)/Math.max(e.length-1,1)/2;a-=n,i+=n}this._startValue=a,this._endValue=i,this._valueRange=i-a}getLabelForValue(e){return zt(e,this.chart.options.locale,this.options.ticks.format)}}class tu extends ba{static id="linear";static defaults={ticks:{callback:Ca.formatters.numeric}};determineDataLimits(){const{min:e,max:a}=this.getMinMax(!0);this.min=q(e)?e:0,this.max=q(a)?a:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),a=e?this.width:this.height,i=pe(this.options.ticks.minRotation),n=(e?Math.sin(i):Math.cos(i))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(a/Math.min(40,o.lineHeight/n))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}const Ft=t=>Math.floor(Ie(t)),qe=(t,e)=>Math.pow(10,Ft(t)+e);function so(t){return t/Math.pow(10,Ft(t))===1}function lo(t,e,a){const i=Math.pow(10,a),n=Math.floor(t/i);return Math.ceil(e/i)-n}function au(t,e){const a=e-t;let i=Ft(a);for(;lo(t,e,i)>10;)i++;for(;lo(t,e,i)<10;)i--;return Math.min(i,Ft(t))}function iu(t,{min:e,max:a}){e=se(t.min,e);const i=[],n=Ft(e);let o=au(e,a),r=o<0?Math.pow(10,Math.abs(o)):1;const s=Math.pow(10,o),l=n>o?Math.pow(10,n):0,c=Math.round((e-l)*r)/r,d=Math.floor((e-l)/s/10)*s*10;let p=Math.floor((c-d)/Math.pow(10,o)),u=se(t.min,Math.round((l+d+p*Math.pow(10,o))*r)/r);for(;u<a;)i.push({value:u,major:so(u),significand:p}),p>=10?p=p<15?15:20:p++,p>=20&&(o++,p=2,r=o>=0?1:r),u=Math.round((l+d+p*Math.pow(10,o))*r)/r;const h=se(t.max,u);return i.push({value:h,major:so(h),significand:p}),i}class nu extends tt{static id="logarithmic";static defaults={ticks:{callback:Ca.formatters.logarithmic,major:{enabled:!0}}};constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,a){const i=ba.prototype.parse.apply(this,[e,a]);if(i===0){this._zero=!0;return}return q(i)&&i>0?i:null}determineDataLimits(){const{min:e,max:a}=this.getMinMax(!0);this.min=q(e)?Math.max(0,e):null,this.max=q(a)?Math.max(0,a):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!q(this._userMin)&&(this.min=e===qe(this.min,0)?qe(this.min,-1):qe(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:a}=this.getUserBounds();let i=this.min,n=this.max;const o=s=>i=e?i:s,r=s=>n=a?n:s;i===n&&(i<=0?(o(1),r(10)):(o(qe(i,-1)),r(qe(n,1)))),i<=0&&o(qe(n,-1)),n<=0&&r(qe(i,1)),this.min=i,this.max=n}buildTicks(){const e=this.options,a={min:this._userMin,max:this._userMax},i=iu(a,this);return e.bounds==="ticks"&&ko(i,this,"value"),e.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(e){return e===void 0?"0":zt(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=Ie(e),this._valueRange=Ie(this.max)-Ie(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(Ie(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const a=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+a*this._valueRange)}}function ei(t){const e=t.ticks;if(e.display&&t.display){const a=ie(e.backdropPadding);return I(e.font&&e.font.size,j.font.size)+a.height}return 0}function ou(t,e,a){return a=z(a)?a:[a],{w:el(t,e.string,a),h:a.length*e.lineHeight}}function co(t,e,a,i,n){return t===i||t===n?{start:e-a/2,end:e+a/2}:t<i||t>n?{start:e-a,end:e}:{start:e,end:e+a}}function ru(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},a=Object.assign({},e),i=[],n=[],o=t._pointLabels.length,r=t.options.pointLabels,s=r.centerPointLabels?H/o:0;for(let l=0;l<o;l++){const c=r.setContext(t.getPointLabelContext(l));n[l]=c.padding;const d=t.getPointPosition(l,t.drawingArea+n[l],s),p=J(c.font),u=ou(t.ctx,p,t._pointLabels[l]);i[l]=u;const h=le(t.getIndexAngle(l)+s),f=Math.round(_i(h)),m=co(f,d.x,u.w,0,180),_=co(f,d.y,u.h,90,270);su(a,e,h,m,_)}t.setCenterPoint(e.l-a.l,a.r-e.r,e.t-a.t,a.b-e.b),t._pointLabelItems=du(t,i,n)}function su(t,e,a,i,n){const o=Math.abs(Math.sin(a)),r=Math.abs(Math.cos(a));let s=0,l=0;i.start<e.l?(s=(e.l-i.start)/o,t.l=Math.min(t.l,e.l-s)):i.end>e.r&&(s=(i.end-e.r)/o,t.r=Math.max(t.r,e.r+s)),n.start<e.t?(l=(e.t-n.start)/r,t.t=Math.min(t.t,e.t-l)):n.end>e.b&&(l=(n.end-e.b)/r,t.b=Math.max(t.b,e.b+l))}function lu(t,e,a){const i=t.drawingArea,{extra:n,additionalAngle:o,padding:r,size:s}=a,l=t.getPointPosition(e,i+n+r,o),c=Math.round(_i(le(l.angle+U))),d=hu(l.y,s.h,c),p=pu(c),u=uu(l.x,s.w,p);return{visible:!0,x:l.x,y:d,textAlign:p,left:u,top:d,right:u+s.w,bottom:d+s.h}}function cu(t,e){if(!e)return!0;const{left:a,top:i,right:n,bottom:o}=t;return!(ke({x:a,y:i},e)||ke({x:a,y:o},e)||ke({x:n,y:i},e)||ke({x:n,y:o},e))}function du(t,e,a){const i=[],n=t._pointLabels.length,o=t.options,{centerPointLabels:r,display:s}=o.pointLabels,l={extra:ei(o)/2,additionalAngle:r?H/n:0};let c;for(let d=0;d<n;d++){l.padding=a[d],l.size=e[d];const p=lu(t,d,l);i.push(p),s==="auto"&&(p.visible=cu(p,c),p.visible&&(c=p))}return i}function pu(t){return t===0||t===180?"center":t<180?"left":"right"}function uu(t,e,a){return a==="right"?t-=e:a==="center"&&(t-=e/2),t}function hu(t,e,a){return a===90||a===270?t-=e/2:(a>270||a<90)&&(t-=e),t}function fu(t,e,a){const{left:i,top:n,right:o,bottom:r}=a,{backdropColor:s}=e;if(!B(s)){const l=Xe(e.borderRadius),c=ie(e.backdropPadding);t.fillStyle=s;const d=i-c.left,p=n-c.top,u=o-i+c.width,h=r-n+c.height;Object.values(l).some(f=>f!==0)?(t.beginPath(),Rt(t,{x:d,y:p,w:u,h,radius:l}),t.fill()):t.fillRect(d,p,u,h)}}function mu(t,e){const{ctx:a,options:{pointLabels:i}}=t;for(let n=e-1;n>=0;n--){const o=t._pointLabelItems[n];if(!o.visible)continue;const r=i.setContext(t.getPointLabelContext(n));fu(a,r,o);const s=J(r.font),{x:l,y:c,textAlign:d}=o;et(a,t._pointLabels[n],l,c+s.lineHeight/2,s,{color:r.color,textAlign:d,textBaseline:"middle"})}}function br(t,e,a,i){const{ctx:n}=t;if(a)n.arc(t.xCenter,t.yCenter,e,0,W);else{let o=t.getPointPosition(0,e);n.moveTo(o.x,o.y);for(let r=1;r<i;r++)o=t.getPointPosition(r,e),n.lineTo(o.x,o.y)}}function _u(t,e,a,i,n){const o=t.ctx,r=e.circular,{color:s,lineWidth:l}=e;!r&&!i||!s||!l||a<0||(o.save(),o.strokeStyle=s,o.lineWidth=l,o.setLineDash(n.dash||[]),o.lineDashOffset=n.dashOffset,o.beginPath(),br(t,a,r,i),o.closePath(),o.stroke(),o.restore())}function gu(t,e,a){return $e(t,{label:a,index:e,type:"pointLabel"})}class bu extends ba{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Ca.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=ie(ei(this.options)/2),a=this.width=this.maxWidth-e.width,i=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+a/2+e.left),this.yCenter=Math.floor(this.top+i/2+e.top),this.drawingArea=Math.floor(Math.min(a,i)/2)}determineDataLimits(){const{min:e,max:a}=this.getMinMax(!1);this.min=q(e)&&!isNaN(e)?e:0,this.max=q(a)&&!isNaN(a)?a:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/ei(this.options))}generateTickLabels(e){ba.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((a,i)=>{const n=N(this.options.pointLabels.callback,[a,i],this);return n||n===0?n:""}).filter((a,i)=>this.chart.getDataVisibility(i))}fit(){const e=this.options;e.display&&e.pointLabels.display?ru(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,a,i,n){this.xCenter+=Math.floor((e-a)/2),this.yCenter+=Math.floor((i-n)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,a,i,n))}getIndexAngle(e){const a=W/(this._pointLabels.length||1),i=this.options.startAngle||0;return le(e*a+pe(i))}getDistanceFromCenterForValue(e){if(B(e))return NaN;const a=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*a:(e-this.min)*a}getValueForDistanceFromCenter(e){if(B(e))return NaN;const a=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-a:this.min+a}getPointLabelContext(e){const a=this._pointLabels||[];if(e>=0&&e<a.length){const i=a[e];return gu(this.getContext(),e,i)}}getPointPosition(e,a,i=0){const n=this.getIndexAngle(e)-U+i;return{x:Math.cos(n)*a+this.xCenter,y:Math.sin(n)*a+this.yCenter,angle:n}}getPointPositionForValue(e,a){return this.getPointPosition(e,this.getDistanceFromCenterForValue(a))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:a,top:i,right:n,bottom:o}=this._pointLabelItems[e];return{left:a,top:i,right:n,bottom:o}}drawBackground(){const{backgroundColor:e,grid:{circular:a}}=this.options;if(e){const i=this.ctx;i.save(),i.beginPath(),br(this,this.getDistanceFromCenterForValue(this._endValue),a,this._pointLabels.length),i.closePath(),i.fillStyle=e,i.fill(),i.restore()}}drawGrid(){const e=this.ctx,a=this.options,{angleLines:i,grid:n,border:o}=a,r=this._pointLabels.length;let s,l,c;if(a.pointLabels.display&&mu(this,r),n.display&&this.ticks.forEach((d,p)=>{if(p!==0||p===0&&this.min<0){l=this.getDistanceFromCenterForValue(d.value);const u=this.getContext(p),h=n.setContext(u),f=o.setContext(u);_u(this,h,l,r,f)}}),i.display){for(e.save(),s=r-1;s>=0;s--){const d=i.setContext(this.getPointLabelContext(s)),{color:p,lineWidth:u}=d;!u||!p||(e.lineWidth=u,e.strokeStyle=p,e.setLineDash(d.borderDash),e.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(a.reverse?this.min:this.max),c=this.getPointPosition(s,l),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(c.x,c.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,a=this.options,i=a.ticks;if(!i.display)return;const n=this.getIndexAngle(0);let o,r;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(n),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((s,l)=>{if(l===0&&this.min>=0&&!a.reverse)return;const c=i.setContext(this.getContext(l)),d=J(c.font);if(o=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){e.font=d.string,r=e.measureText(s.label).width,e.fillStyle=c.backdropColor;const p=ie(c.backdropPadding);e.fillRect(-r/2-p.left,-o-d.size/2-p.top,r+p.width,d.size+p.height)}et(e,s.label,0,-o,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),e.restore()}drawTitle(){}}const Pa={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},oe=Object.keys(Pa);function po(t,e){return t-e}function uo(t,e){if(B(e))return null;const a=t._adapter,{parser:i,round:n,isoWeekday:o}=t._parseOpts;let r=e;return typeof i=="function"&&(r=i(r)),q(r)||(r=typeof i=="string"?a.parse(r,i):a.parse(r)),r===null?null:(n&&(r=n==="week"&&(ct(o)||o===!0)?a.startOf(r,"isoWeek",o):a.startOf(r,n)),+r)}function ho(t,e,a,i){const n=oe.length;for(let o=oe.indexOf(t);o<n-1;++o){const r=Pa[oe[o]],s=r.steps?r.steps:Number.MAX_SAFE_INTEGER;if(r.common&&Math.ceil((a-e)/(s*r.size))<=i)return oe[o]}return oe[n-1]}function vu(t,e,a,i,n){for(let o=oe.length-1;o>=oe.indexOf(a);o--){const r=oe[o];if(Pa[r].common&&t._adapter.diff(n,i,r)>=e-1)return r}return oe[a?oe.indexOf(a):0]}function wu(t){for(let e=oe.indexOf(t)+1,a=oe.length;e<a;++e)if(Pa[oe[e]].common)return oe[e]}function fo(t,e,a){if(!a)t[e]=!0;else if(a.length){const{lo:i,hi:n}=gi(a,e),o=a[i]>=e?a[i]:a[n];t[o]=!0}}function yu(t,e,a,i){const n=t._adapter,o=+n.startOf(e[0].value,i),r=e[e.length-1].value;let s,l;for(s=o;s<=r;s=+n.add(s,1,i))l=a[s],l>=0&&(e[l].major=!0);return e}function mo(t,e,a){const i=[],n={},o=e.length;let r,s;for(r=0;r<o;++r)s=e[r],n[s]=r,i.push({value:s,major:!1});return o===0||!a?i:yu(t,i,n,a)}class ti extends tt{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,a={}){const i=e.time||(e.time={}),n=this._adapter=new xc._date(e.adapters.date);n.init(a),Pt(i.displayFormats,n.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(e),this._normalized=a.normalized}parse(e,a){return e===void 0?null:uo(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,a=this._adapter,i=e.time.unit||"day";let{min:n,max:o,minDefined:r,maxDefined:s}=this.getUserBounds();function l(c){!r&&!isNaN(c.min)&&(n=Math.min(n,c.min)),!s&&!isNaN(c.max)&&(o=Math.max(o,c.max))}(!r||!s)&&(l(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&l(this.getMinMax(!1))),n=q(n)&&!isNaN(n)?n:+a.startOf(Date.now(),i),o=q(o)&&!isNaN(o)?o:+a.endOf(Date.now(),i)+1,this.min=Math.min(n,o-1),this.max=Math.max(n+1,o)}_getLabelBounds(){const e=this.getLabelTimestamps();let a=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return e.length&&(a=e[0],i=e[e.length-1]),{min:a,max:i}}buildTicks(){const e=this.options,a=e.time,i=e.ticks,n=i.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const o=this.min,r=this.max,s=zs(n,o,r);return this._unit=a.unit||(i.autoSkip?ho(a.minUnit,this.min,this.max,this._getLabelCapacity(o)):vu(this,s.length,a.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:wu(this._unit),this.initOffsets(n),e.reverse&&s.reverse(),mo(this,s,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let a=0,i=0,n,o;this.options.offset&&e.length&&(n=this.getDecimalForValue(e[0]),e.length===1?a=1-n:a=(this.getDecimalForValue(e[1])-n)/2,o=this.getDecimalForValue(e[e.length-1]),e.length===1?i=o:i=(o-this.getDecimalForValue(e[e.length-2]))/2);const r=e.length<3?.5:.25;a=Z(a,0,r),i=Z(i,0,r),this._offsets={start:a,end:i,factor:1/(a+1+i)}}_generate(){const e=this._adapter,a=this.min,i=this.max,n=this.options,o=n.time,r=o.unit||ho(o.minUnit,a,i,this._getLabelCapacity(a)),s=I(n.ticks.stepSize,1),l=r==="week"?o.isoWeekday:!1,c=ct(l)||l===!0,d={};let p=a,u,h;if(c&&(p=+e.startOf(p,"isoWeek",l)),p=+e.startOf(p,c?"day":r),e.diff(i,a,r)>1e5*s)throw new Error(a+" and "+i+" are too far apart with stepSize of "+s+" "+r);const f=n.ticks.source==="data"&&this.getDataTimestamps();for(u=p,h=0;u<i;u=+e.add(u,s,r),h++)fo(d,u,f);return(u===i||n.bounds==="ticks"||h===1)&&fo(d,u,f),Object.keys(d).sort(po).map(m=>+m)}getLabelForValue(e){const a=this._adapter,i=this.options.time;return i.tooltipFormat?a.format(e,i.tooltipFormat):a.format(e,i.displayFormats.datetime)}format(e,a){const n=this.options.time.displayFormats,o=this._unit,r=a||n[o];return this._adapter.format(e,r)}_tickFormatFunction(e,a,i,n){const o=this.options,r=o.ticks.callback;if(r)return N(r,[e,a,i],this);const s=o.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&s[l],p=c&&s[c],u=i[a],h=c&&p&&u&&u.major;return this._adapter.format(e,n||(h?p:d))}generateTickLabels(e){let a,i,n;for(a=0,i=e.length;a<i;++a)n=e[a],n.label=this._tickFormatFunction(n.value,a,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const a=this._offsets,i=this.getDecimalForValue(e);return this.getPixelForDecimal((a.start+i)*a.factor)}getValueForPixel(e){const a=this._offsets,i=this.getDecimalForPixel(e)/a.factor-a.end;return this.min+i*(this.max-this.min)}_getLabelSize(e){const a=this.options.ticks,i=this.ctx.measureText(e).width,n=pe(this.isHorizontal()?a.maxRotation:a.minRotation),o=Math.cos(n),r=Math.sin(n),s=this._resolveTickFontOptions(0).size;return{w:i*o+s*r,h:i*r+s*o}}_getLabelCapacity(e){const a=this.options.time,i=a.displayFormats,n=i[a.unit]||i.millisecond,o=this._tickFormatFunction(e,0,mo(this,[e],this._majorUnit),n),r=this._getLabelSize(o),s=Math.floor(this.isHorizontal()?this.width/r.w:this.height/r.h)-1;return s>0?s:1}getDataTimestamps(){let e=this._cache.data||[],a,i;if(e.length)return e;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(a=0,i=n.length;a<i;++a)e=e.concat(n[a].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let a,i;if(e.length)return e;const n=this.getLabels();for(a=0,i=n.length;a<i;++a)e.push(uo(this,n[a]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return Ao(e.sort(po))}}function sa(t,e,a){let i=0,n=t.length-1,o,r,s,l;a?(e>=t[i].pos&&e<=t[n].pos&&({lo:i,hi:n}=Ee(t,"pos",e)),{pos:o,time:s}=t[i],{pos:r,time:l}=t[n]):(e>=t[i].time&&e<=t[n].time&&({lo:i,hi:n}=Ee(t,"time",e)),{time:o,pos:s}=t[i],{time:r,pos:l}=t[n]);const c=r-o;return c?s+(l-s)*(e-o)/c:s}class xu extends ti{static id="timeseries";static defaults=ti.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),a=this._table=this.buildLookupTable(e);this._minPos=sa(a,this.min),this._tableRange=sa(a,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:a,max:i}=this,n=[],o=[];let r,s,l,c,d;for(r=0,s=e.length;r<s;++r)c=e[r],c>=a&&c<=i&&n.push(c);if(n.length<2)return[{time:a,pos:0},{time:i,pos:1}];for(r=0,s=n.length;r<s;++r)d=n[r+1],l=n[r-1],c=n[r],Math.round((d+l)/2)!==c&&o.push({time:c,pos:r/(s-1)});return o}_generate(){const e=this.min,a=this.max;let i=super.getDataTimestamps();return(!i.includes(e)||!i.length)&&i.splice(0,0,e),(!i.includes(a)||i.length===1)&&i.push(a),i.sort((n,o)=>n-o)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const a=this.getDataTimestamps(),i=this.getLabelTimestamps();return a.length&&i.length?e=this.normalize(a.concat(i)):e=a.length?a:i,e=this._cache.all=e,e}getDecimalForValue(e){return(sa(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const a=this._offsets,i=this.getDecimalForPixel(e)/a.factor-a.end;return sa(this._table,i*this._tableRange+this._minPos,!0)}}var Cu=Object.freeze({__proto__:null,CategoryScale:Qp,LinearScale:tu,LogarithmicScale:nu,RadialLinearScale:bu,TimeScale:ti,TimeSeriesScale:xu});const Mu=[yc,ep,Kp,Cu];Pi.register(...Mu);function vr(){Su(),Eu(),wr(),ku(),Pu(),console.log("All accordions initialized successfully")}function Su(){if(document.getElementById("unified-accordion-styles"))return;const t=document.createElement("style");t.id="unified-accordion-styles",t.textContent=`
      /* ===== STANDARD ACCORDION STYLES ===== */
      
      /* Accordion section styling */
      .accordion-section {
        border: 1px solid var(--border);
        border-radius: 8px;
        overflow: hidden;
        transition: box-shadow 0.2s ease;
        margin-bottom: 0;
        height: 100%;
        display: flex;
        flex-direction: column;
      }
      
      .accordion-section:hover {
        box-shadow: var(--shadow-md);
      }
      
      /* Accordion header styling */
      .accordion-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        cursor: pointer;
        user-select: none;
        color: white;
      }
      
      .accordion-header h3 {
        margin: 0;
        font-size: 1.1rem;
        color: inherit;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .accordion-toggle {
        background: transparent;
        border: none;
        color: inherit;
        font-size: 1rem;
        cursor: pointer;
        padding: 5px;
        border-radius: 50%;
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s ease;
      }
      
      .accordion-toggle:hover {
        background-color: rgba(255, 255, 255, 0.2);
      }
      
      /* Accordion content styling */
      .accordion-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease, padding 0.3s ease;
        padding: 0 15px;
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      
      .accordion-content.expanded {
        max-height: 2000px; /* Large enough for all content */
        padding: 15px;
        overflow: visible;
      }
      
      /* ===== PROFILE ACCORDION STYLES ===== */
      
      /* Profile card styles */
      .profile-card {
        transition: box-shadow 0.3s ease;
        margin-bottom: 15px;
        border-radius: 8px;
        overflow: hidden;
      }
      
      .profile-card:hover {
        box-shadow: var(--shadow-lg);
      }
      
      /* Make the entire header clickable */
      .profile-card .accordion-header {
        cursor: pointer;
      }
      
      /* Properly handle nested elements in profile headers */
      .profile-card .accordion-header button:not(.accordion-toggle) {
        position: relative;
        z-index: 2;
      }
      
      /* Parameter groups within profiles */
      .param-group {
        border: 1px solid var(--border);
        border-radius: var(--radius);
        overflow: hidden;
        margin-bottom: 10px;
      }
      
      .param-group-header {
        padding: 8px 12px;
        font-weight: 600;
        color: white;
        font-size: 0.9rem;
      }
      
      .param-group-content {
        padding: 10px;
      }
      
      .param-item {
        margin-bottom: 8px;
        font-size: 0.9rem;
      }
      
      .param-item:last-child {
        margin-bottom: 0;
      }
      
      .param-label {
        font-weight: 500;
        color: var(--secondary);
      }
      
      .param-value {
        font-weight: 600;
      }
      
      /* Grid layout for card list and grid views */
      .profile-list-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
        gap: 20px;
      }
      
      .profile-list-list .profile-card {
        margin-bottom: 15px;
      }
      
      /* Input group styling for standard accordions */
      .accordion-content .input-group {
        display: flex;
        flex-direction: column;
        gap: 15px;
        flex: 1;
      }
      
      /* Grid layout for accordion containers */
      .accordion-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 24px;
        margin: 15px 0 30px 0;
      }
      
      /* Full width sections */
      .accordion-section.full-width {
        grid-column: 1 / -1;
      }
      
      /* Mobile responsiveness */
      @media (max-width: 768px) {
        .accordion-container {
          grid-template-columns: 1fr;
        }
        
        .accordion-header h3 {
          font-size: 1rem;
        }
        
        .profile-list-grid {
          grid-template-columns: 1fr;
        }
      }
      
      /* Tablet and small desktop */
      @media (min-width: 769px) and (max-width: 992px) {
        .accordion-container {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      
      /* Ensure gradient headers have white text */
      .finance-gradient, 
      .yield-gradient, 
      .adjustment-gradient, 
      .climate-gradient, 
      .sensitivity-gradient, 
      .profile-gradient,
      .financial-gradient {
        color: white !important;
      }
      
      .finance-gradient h3, 
      .yield-gradient h3, 
      .adjustment-gradient h3, 
      .climate-gradient h3, 
      .sensitivity-gradient h3, 
      .profile-gradient h3,
      .financial-gradient h3 {
        color: white !important;
      }
    `,document.head.appendChild(t)}function Eu(){function t(e,a,i=!1){i&&event.preventDefault();const n=e.querySelector(".accordion-content");n&&(n.classList.toggle("expanded"),a&&(a.classList.toggle("fa-chevron-down"),a.classList.toggle("fa-chevron-up")))}document.querySelectorAll(".accordion-section:not(.profile-card) .accordion-header").forEach(e=>{e._hasAccordionListener||(e.addEventListener("click",function(a){if(a.target.closest(".accordion-toggle"))return;const i=this.closest(".accordion-section"),n=this.querySelector(".accordion-toggle i");t(i,n,!0)}),e._hasAccordionListener=!0)}),document.querySelectorAll(".accordion-section:not(.profile-card) .accordion-toggle").forEach(e=>{e._hasAccordionListener||(e.addEventListener("click",function(a){a.stopPropagation();const i=this.closest(".accordion-section"),n=this.querySelector("i");t(i,n,!0)}),e._hasAccordionListener=!0)})}function wr(){function t(e,a,i=!1){i&&event.preventDefault();const n=e.querySelector(".accordion-content");n&&(n.classList.toggle("expanded"),a&&(a.classList.toggle("fa-chevron-down"),a.classList.toggle("fa-chevron-up")))}document.querySelectorAll(".profile-card .accordion-header").forEach(e=>{e._hasProfileAccordionListener||(e.addEventListener("click",function(a){if(a.target.closest("button:not(.accordion-toggle)"))return;const i=this.closest(".profile-card"),n=this.querySelector(".accordion-toggle i");t(i,n,!0)}),e._hasProfileAccordionListener=!0)}),document.querySelectorAll(".profile-card .accordion-toggle").forEach(e=>{e._hasProfileAccordionListener||(e.addEventListener("click",function(a){a.stopPropagation();const i=this.closest(".profile-card"),n=this.querySelector("i");t(i,n,!0)}),e._hasProfileAccordionListener=!0)})}function ku(){document.querySelectorAll(".accordion-section:not(.profile-card)").forEach((e,a)=>{const i=e.querySelector(".accordion-header");if(!i)return;const n=i.querySelector("h3")?.textContent.trim();n.includes("Sensitivity Analysis")?(e.id="sensitivityAnalysisSection",e.classList.add("full-width")):n.includes("Save Profile")?e.id="profileManagementSection":n.includes("Drought Settings")?(e.id="droughtSettingsSection",e.classList.add("full-width")):n.includes("Financial Position")?e.id="financialPositionSection":n.includes("Price and Operational")?e.id="priceAndCostsSection":n.includes("Base Yield")?e.id="baseYieldSection":n.includes("Yield Adjustments")&&(e.id="yieldAdjustmentsSection")})}function Pu(){document.querySelectorAll(".accordion-content.expanded").forEach(t=>{const a=(t.closest(".accordion-section")||t.closest(".profile-card")).querySelector(".accordion-toggle i");a&&a.classList.contains("fa-chevron-down")&&(a.classList.remove("fa-chevron-down"),a.classList.add("fa-chevron-up"))})}window.AccordionManager={init:vr,initProfiles:wr,toggle:function(t){const e=document.getElementById(t);if(!e)return;const a=e.querySelector(".accordion-content"),i=e.querySelector(".accordion-toggle i");a&&a.classList.toggle("expanded"),i&&(i.classList.toggle("fa-chevron-down"),i.classList.toggle("fa-chevron-up"))}};document.addEventListener("DOMContentLoaded",vr);let Te={2026:.85,2027:.55,2028:.75,2029:1.15,2030:.48,2031:1.18,2032:1.03,2033:1.02,2034:.82,2035:1.07,2036:1.06,2037:.98,2038:1.02,2039:1.18,2040:.84,2041:.91,2042:.89,2043:1.42,2044:1.11,2045:.87,2046:1.64,2047:1.3,2048:1,2049:.96,2050:1.12},Ke={rcp45:.87,rcp85:.72},va=[],Y={},Ht={basePrice:0,baseYield:0,opCost:0},Pe=null,ut={equity:null,netWorth:null,assetsLiabilities:null,debtToAsset:null};function ai(t,e){if(t<=2026)return 1;if(t>=2050)return e;const o=2050-2026,r=t-2026,l=1-(1-e)/o*r;return parseFloat(l.toFixed(3))}function me(t){return t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}function yr(){Y={calculateBtn:document.getElementById("calculateBtn"),yearlyTableBody:document.getElementById("yearlyTableBody"),cumulativeTableBody:document.getElementById("cumulativeTableBody"),sensitivityTableBody:document.getElementById("sensitivityTableBody"),tabs:document.querySelectorAll(".tab"),tabContents:document.querySelectorAll(".tab-content"),droughtYearsCheckboxes:document.getElementById("droughtYearsCheckboxes"),selectAllDroughtYearsBtn:document.getElementById("selectAllDroughtYears"),clearAllDroughtYearsBtn:document.getElementById("clearAllDroughtYears"),finalMarginDisplay:document.getElementById("finalMarginDisplay"),finalMarginValue:document.getElementById("finalMarginValue")},Lu()}function Lu(){Y.calculateBtn&&!Y.calculateBtn._hasClickListener&&(Y.calculateBtn.addEventListener("click",ue),Y.calculateBtn._hasClickListener=!0),Au(),Du(),Y.selectAllDroughtYearsBtn&&Y.selectAllDroughtYearsBtn.addEventListener("click",Iu),Y.clearAllDroughtYearsBtn&&Y.clearAllDroughtYearsBtn.addEventListener("click",Bu)}function Au(){const t=document.getElementById("saveProfileBtn");t&&!t._hasClickListener&&(t.addEventListener("click",function(){const e=document.getElementById("profileName").value.trim();if(!e){alert("Please enter a profile name before saving.");return}eh(e)}),t._hasClickListener=!0)}function Du(){Y.tabs&&Y.tabs.forEach(t=>{t._hasClickListener||(t.addEventListener("click",()=>{Y.tabs.forEach(a=>a.classList.remove("active")),Y.tabContents.forEach(a=>a.classList.remove("active")),t.classList.add("active");const e=t.getAttribute("data-tab");document.getElementById(`${e}Tab`).classList.add("active"),e==="profiles"&&window.refreshProfilesList&&window.refreshProfilesList(),e==="comparison"&&window.refreshComparisonView&&window.refreshComparisonView()}),t._hasClickListener=!0)})}function xr(){Y.droughtYearsCheckboxes&&(Y.droughtYearsCheckboxes.innerHTML="",Object.keys(Te).sort().forEach(t=>{const e=document.createElement("div");e.style.display="flex",e.style.alignItems="center";const a=document.createElement("input");a.type="checkbox",a.id=`drought-year-${t}`,a.value=t,a.style.marginRight="5px",a.style.cursor="pointer",a.addEventListener("change",La);const i=document.createElement("label");i.htmlFor=`drought-year-${t}`,i.textContent=t,i.style.fontSize="12px",i.style.cursor="pointer",e.appendChild(a),e.appendChild(i),Y.droughtYearsCheckboxes.appendChild(e)}))}function La(){if(va=[],!Y.droughtYearsCheckboxes)return;Y.droughtYearsCheckboxes.querySelectorAll('input[type="checkbox"]:checked').forEach(e=>{va.push(parseInt(e.value))}),Pe&&ue()}function Iu(){if(!Y.droughtYearsCheckboxes)return;Y.droughtYearsCheckboxes.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.checked=!0}),La()}function Bu(){if(!Y.droughtYearsCheckboxes)return;Y.droughtYearsCheckboxes.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.checked=!1}),La()}function Tu(t){Object.keys(Te).forEach(e=>{delete Te[e]}),Object.keys(t).forEach(e=>{Te[e]=t[e]}),console.log("Updated yieldMultipliers in calculator.js:",Te),xr()}function Yu(t){t&&typeof t=="object"?(Ke.rcp45=t.rcp45||Ke.rcp45,Ke.rcp85=t.rcp85||Ke.rcp85,console.log("RCP multipliers updated:",Ke)):console.error("Invalid RCP multipliers format:",t)}function Ru(t,e){Ht[t]=parseFloat(e);const a=document.getElementById(`${t}Adjustment`);a&&(a.textContent=`${e>0?"+":""}${e}%`),ue()}function Cr(){Ht={basePrice:0,baseYield:0,opCost:0},Ou(),ue()}function Ou(){const t={basePrice:document.getElementById("basePriceSlider"),baseYield:document.getElementById("baseYieldSlider"),opCost:document.getElementById("opCostSlider")},e={basePrice:document.getElementById("basePriceAdjustment"),baseYield:document.getElementById("baseYieldAdjustment"),opCost:document.getElementById("opCostAdjustment")};Object.keys(t).forEach(a=>{t[a]&&(t[a].value=0),e[a]&&(e[a].textContent="0%")})}function Fu(t,e=null){$u(t),Nu(t),zu(e||t.sensitivities),Wu(t.droughtYears),ue()}function $u(t){const e={meanYield:document.getElementById("meanYield"),basePrice:document.getElementById("basePrice"),baseYieldType:document.getElementById("baseYieldType"),annualIncreaseRate:document.getElementById("annualIncreaseRate"),droughtYield:document.getElementById("droughtYield"),opCost:document.getElementById("opCost"),netWorthHa:document.getElementById("netWorthHa"),equityPercent:document.getElementById("equityPercent"),landAppreciationRate:document.getElementById("landAppreciationRate"),criticalEquity:document.getElementById("criticalEquity"),stepChangeYear:document.getElementById("stepChangeYear"),stepChangeAmount:document.getElementById("stepChangeAmount")};Object.entries(e).forEach(([a,i])=>{i&&t[a]!==void 0&&(i.value=t[a])})}function Nu(t){const e={landValueAppreciation:{input:document.getElementById("landValueAppreciation"),toggle:document.getElementById("landValueAppreciationToggle"),label:document.getElementById("landValueAppreciationLabel")},variedYield:{input:document.getElementById("variedYield"),toggle:document.getElementById("variedYieldToggle"),label:document.getElementById("variedYieldLabel")},annualIncrease:{input:document.getElementById("annualIncrease"),toggle:document.getElementById("annualIncreaseToggle"),label:document.getElementById("annualIncreaseLabel")},stepChangeEnabled:{input:document.getElementById("stepChangeEnabled"),toggle:document.getElementById("stepChangeEnabledToggle"),label:document.getElementById("stepChangeEnabledLabel")}};Object.entries(e).forEach(([a,i])=>{if(i.input&&i.toggle&&t[a]!==void 0){const n=t[a]===!0||t[a]==="true";i.input.value=n.toString(),i.toggle.checked=n,i.label&&(i.label.textContent=n?"Yes":"No")}})}function zu(t){if(!t){Cr();return}Ht={...t},["basePrice","baseYield","opCost"].forEach(e=>{const a=t[e]||0,i=document.getElementById(`${e}Slider`),n=document.getElementById(`${e}Adjustment`);i&&n&&(i.value=a,n.textContent=`${a>0?"+":""}${a}%`,i.dispatchEvent(new Event("input",{bubbles:!0})))})}function Wu(t){if(!Y.droughtYearsCheckboxes)return;Y.droughtYearsCheckboxes.querySelectorAll('input[type="checkbox"]').forEach(a=>{a.checked=!1}),t&&Array.isArray(t)&&t.forEach(a=>{const i=document.getElementById(`drought-year-${a}`);i&&(i.checked=!0)}),La()}function Mr(t,e=null){const a=e||Di(),i=a.basePrice*(1+t.basePrice/100),n=a.meanYield*(1+t.baseYield/100),o=a.opCost*(1+t.opCost/100),r=Object.keys(Te).map(Number),s=[];let l=0,c=parseFloat(a.netWorthHa||1800),d=parseFloat(a.equityPercent||69)/100,p=c/d,u=p-c;return r.forEach(h=>{let f=n;a.baseYieldType==="rcp45"?f*=ai(h,Ke.rcp45):a.baseYieldType==="rcp85"&&(f*=ai(h,Ke.rcp85)),f=Hu(f,h,a);const m=f*i,_=o,g=m-_;l+=g;const b=Vu(c,p,u,g,a);c=b.netWorth,p=b.assets,u=b.liabilities,d=b.equityPercent,s.push({year:h,yield:f.toFixed(2),revenue:m.toFixed(2),costs:_.toFixed(2),grossMargin:g.toFixed(2),cumulativeGrossMargin:l.toFixed(2),assets:p.toFixed(2),liabilities:u.toFixed(2),netWorth:c.toFixed(2),equityPercent:(d*100).toFixed(1),belowCriticalEquity:d<parseFloat(a.criticalEquity||60)/100})}),s}function Hu(t,e,a){let i=t;if((a.variedYield===!0||a.variedYield==="true")&&(i*=Te[e]),a.annualIncrease===!0||a.annualIncrease==="true"){const o=e-2026;i*=Math.pow(1+parseFloat(a.annualIncreaseRate)/100,o)}return(a.stepChangeEnabled===!0||a.stepChangeEnabled==="true")&&e>=parseInt(a.stepChangeYear)&&(i*=1+parseFloat(a.stepChangeAmount)/100),(a.droughtYears||va).includes(e)&&(i=parseFloat(a.droughtYield)),i}function Vu(t,e,a,i,n){let o=0;if(n.landValueAppreciation===!0||n.landValueAppreciation==="true"){const c=parseFloat(n.landAppreciationRate||1)/100;o=e*c,e+=o}if(i<0)a+=Math.abs(i);else if(i<=a)a-=i;else{const c=i-a;a=0,e+=c}t=e-a;const r=Math.min(1,t/e),s=parseFloat(n.criticalEquity||60)/100,l=r<s;return{assets:e,liabilities:a,netWorth:t,equityPercent:r,belowCriticalEquity:l}}function Di(){return{meanYield:parseFloat(document.getElementById("meanYield")?.value||1.4),basePrice:parseFloat(document.getElementById("basePrice")?.value||350),baseYieldType:document.getElementById("baseYieldType")?.value||"mean",variedYield:document.getElementById("variedYield")?.value==="true",annualIncrease:document.getElementById("annualIncrease")?.value==="true",annualIncreaseRate:parseFloat(document.getElementById("annualIncreaseRate")?.value||1),stepChangeEnabled:document.getElementById("stepChangeEnabled")?.value==="true",stepChangeYear:parseInt(document.getElementById("stepChangeYear")?.value||2041),stepChangeAmount:parseFloat(document.getElementById("stepChangeAmount")?.value||10),droughtYears:[...va],droughtYield:parseFloat(document.getElementById("droughtYield")?.value||.53),opCost:parseFloat(document.getElementById("opCost")?.value||400),netWorthHa:parseFloat(document.getElementById("netWorthHa")?.value||1800),equityPercent:parseFloat(document.getElementById("equityPercent")?.value||69),landValueAppreciation:document.getElementById("landValueAppreciation")?.value==="true",landAppreciationRate:parseFloat(document.getElementById("landAppreciationRate")?.value||1),criticalEquity:parseFloat(document.getElementById("criticalEquity")?.value||60)}}function ue(){yr(),Pe=Mr(Ht),Y.yearlyTableBody&&(ju(Pe),Uu(Pe),qu(Pe))}function ju(t){Y.yearlyTableBody&&(Y.yearlyTableBody.innerHTML="",t.forEach(e=>{const a=document.createElement("tr"),i=e.belowCriticalEquity?"equity-warning":"equity-healthy";a.innerHTML=`
      <td>${e.year}</td>
      <td>${e.yield}</td>
      <td>$${me(parseFloat(e.revenue))}</td>
      <td>$${me(parseFloat(e.costs))}</td>
      <td class="${parseFloat(e.grossMargin)>=0?"positive":"negative"}">
        $${me(parseFloat(e.grossMargin))}
      </td>
      <td class="${parseFloat(e.cumulativeGrossMargin)>=0?"positive":"negative"}">
        $${me(parseFloat(e.cumulativeGrossMargin))}
      </td>
      <td>$${me(parseFloat(e.assets))}</td>
      <td>$${me(parseFloat(e.liabilities))}</td>
      <td>$${me(parseFloat(e.netWorth))}</td>
      <td class="${i}">${e.equityPercent}%${e.belowCriticalEquity?" ⚠️":""}</td>
    `,Y.yearlyTableBody.appendChild(a)}))}function qu(t){if(!Y.finalMarginDisplay||!Y.finalMarginValue)return;const e=parseFloat(t[t.length-1].cumulativeGrossMargin);Y.finalMarginDisplay.style.display="block",Y.finalMarginValue.textContent=`$${me(e)}`,Y.finalMarginValue.className=e>=0?"positive":"negative"}function Uu(t){Ku();const e=Gu(t),a=Di(),i=parseFloat(a.criticalEquity||60);Xu(e.years,e.equity,i),Ju(e.years,e.netWorth),Zu(e.years,e.assets,e.liabilities),Qu(e.years,e.debtToAsset)}function Gu(t){return{years:t.map(e=>e.year),equity:t.map(e=>parseFloat(e.equityPercent)),netWorth:t.map(e=>parseFloat(e.netWorth)),assets:t.map(e=>parseFloat(e.assets)),liabilities:t.map(e=>parseFloat(e.liabilities)),debtToAsset:t.map(e=>{const a=parseFloat(e.assets),i=parseFloat(e.liabilities);return a>0?i/a*100:0})}}function Ku(){Object.values(ut).forEach(t=>{t&&t.destroy()}),ut={equity:null,netWorth:null,assetsLiabilities:null,debtToAsset:null}}function Xu(t,e,a){const i=document.getElementById("equityChart")?.getContext("2d");i&&(ut.equity=new Chart(i,{type:"line",data:{labels:t,datasets:[{label:"Equity %",data:e,borderColor:"#4299e1",backgroundColor:"rgba(66, 153, 225, 0.2)",borderWidth:2,fill:!0},{label:"Critical Threshold",data:t.map(()=>a),borderColor:"#e53e3e",borderWidth:2,borderDash:[5,5],fill:!1,pointRadius:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Equity Percentage Over Time",font:{size:14}},tooltip:{callbacks:{label:function(n){return n.dataset.label==="Equity %"?`${n.dataset.label}: ${n.raw.toFixed(1)}%`:`${n.dataset.label}: ${n.raw}%`}}}},scales:{x:{title:{display:!0,text:"Year"}},y:{title:{display:!0,text:"Equity %"},min:0,max:100}}}}))}function Ju(t,e){const a=document.getElementById("netWorthChart")?.getContext("2d");a&&(ut.netWorth=new Chart(a,{type:"line",data:{labels:t,datasets:[{label:"Net Worth ($/ha)",data:e,borderColor:"#38a169",backgroundColor:"rgba(56, 161, 105, 0.2)",borderWidth:2,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Net Worth Per Hectare",font:{size:14}},tooltip:{callbacks:{label:function(i){return`${i.dataset.label}: $${me(i.raw)}`}}}},scales:{x:{title:{display:!0,text:"Year"}},y:{title:{display:!0,text:"$/ha"},ticks:{callback:function(i){return"$"+i.toLocaleString()}}}}}}))}function Zu(t,e,a){const i=document.getElementById("assetsLiabilitiesChart")?.getContext("2d");i&&(ut.assetsLiabilities=new Chart(i,{type:"bar",data:{labels:t,datasets:[{label:"Assets ($/ha)",data:e,backgroundColor:"rgba(66, 153, 225, 0.6)",borderColor:"#4299e1",borderWidth:1},{label:"Liabilities ($/ha)",data:a,backgroundColor:"rgba(237, 100, 166, 0.6)",borderColor:"#ed64a6",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Assets vs Liabilities",font:{size:14}},tooltip:{callbacks:{label:function(n){return`${n.dataset.label}: $${me(n.raw)}`}}}},scales:{x:{title:{display:!0,text:"Year"},stacked:!1},y:{title:{display:!0,text:"$/ha"},stacked:!1,ticks:{callback:function(n){return"$"+n.toLocaleString()}}}}}}))}function Qu(t,e){const a=document.getElementById("debtToAssetChart")?.getContext("2d");a&&(ut.debtToAsset=new Chart(a,{type:"line",data:{labels:t,datasets:[{label:"Debt-to-Asset Ratio (%)",data:e,borderColor:"#805ad5",backgroundColor:"rgba(128, 90, 213, 0.2)",borderWidth:2,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Debt-to-Asset Ratio",font:{size:14}},tooltip:{callbacks:{label:function(i){return`${i.dataset.label}: ${i.raw.toFixed(1)}%`}}}},scales:{x:{title:{display:!0,text:"Year"}},y:{title:{display:!0,text:"Ratio (%)"},min:0,max:100}}}}))}function eh(t){if(!window.addProfile){console.error("addProfile function not available");return}const e=Di();Pe||(console.error("No current results available"),ue());const a=parseFloat(Pe[Pe.length-1].cumulativeGrossMargin),i=JSON.parse(JSON.stringify(Pe)),n=document.getElementById("activeLocationSelect")?.value||"Merredin",o=document.getElementById("activeCropSelect")?.value||"Wheat",r={id:Date.now().toString(),name:t,params:e,createdAt:new Date().toISOString(),results:{finalCumulativeMargin:a},yearlyResults:i,sensitivities:{...Ht},location:n,crop:o};window.addProfile(r);const s=document.getElementById("profileName");s&&(s.value=""),setTimeout(()=>{alert(`Profile "${t}" has been saved!`)},100),document.querySelector('.tab[data-tab="profiles"]').classList.contains("active")&&window.refreshProfilesList&&window.refreshProfilesList()}function th(){["meanYield","basePrice","baseYieldType","variedYield","annualIncrease","annualIncreaseRate","stepChangeEnabled","stepChangeYear","stepChangeAmount","droughtYield","opCost","netWorthHa","equityPercent","landValueAppreciation","landAppreciationRate","criticalEquity"].forEach(i=>{const n=document.getElementById(i);n&&(n.addEventListener("input",ue),n.addEventListener("change",ue))});const e=document.getElementById("activeLocationSelect"),a=document.getElementById("activeCropSelect");e&&e.addEventListener("change",()=>{window.applyDefaultsToCalculator&&window.applyDefaultsToCalculator()}),a&&a.addEventListener("change",()=>{window.applyDefaultsToCalculator&&window.applyDefaultsToCalculator()})}function ii(){yr(),xr(),th(),ue()}window._calculatorInitialized||document.addEventListener("DOMContentLoaded",function(){ii(),window._calculatorInitialized=!0});const Sr="agCalculatorProfiles",Er="agCalculatorComparison";let k={};function _t(){try{const t=localStorage.getItem(Sr);if(!t)return[];const e=JSON.parse(t);return Array.isArray(e)?e:[]}catch(t){return console.error("Error getting profiles from localStorage:",t),[]}}function Ii(t){try{const e=JSON.stringify(t);localStorage.setItem(Sr,e)}catch(e){console.error("Error saving profiles to localStorage:",e),window.showNotification&&window.showNotification("Save Error","Failed to save profiles to browser storage","error")}}function ht(){try{const t=localStorage.getItem(Er);return t?JSON.parse(t):[]}catch(t){return console.error("Error getting comparison IDs:",t),[]}}function Vt(t){localStorage.setItem(Er,JSON.stringify(t))}function ah(t){const e=_t();e.push(t),Ii(e),window.showNotification&&window.showNotification("Profile Saved",`Profile "${t.name}" saved successfully`,"success")}function kr(t,e){const a=_t(),i=a.findIndex(n=>n.id===t);return i!==-1?(a[i]={...a[i],...e},Ii(a),!0):!1}function Pr(t){const e=_t(),a=e.filter(i=>i.id!==t);if(e.length!==a.length){Ii(a);const i=ht();return i.includes(t)&&Vt(i.filter(n=>n!==t)),!0}return!1}function jt(t){return _t().find(a=>a.id===t)||null}function Lr(t){if(t.yearlyResults)return t.yearlyResults;if(!window.calculateResults)return console.error("calculateResults function not available in global scope"),[];const e=window.calculateResults({basePrice:0,baseYield:0,opCost:0},t.params);return kr(t.id,{yearlyResults:e}),e}function ni(t,e={},a=""){const i=document.createElement(t);return Object.entries(e).forEach(([n,o])=>{n==="className"?i.className=o:n==="innerHTML"?i.innerHTML=o:n==="style"&&typeof o=="object"?Object.entries(o).forEach(([r,s])=>{i.style[r]=s}):i.setAttribute(n,o)}),a&&(typeof a=="string"?i.innerHTML=a:i.appendChild(a)),i}function Ar(t,e="comparison-actions"){const a=document.querySelector(t);if(!a)return null;let i=a.querySelector(`.${e}`);return i||(i=ni("div",{className:e}),a.appendChild(i)),i}function ih(t){try{const e=new Date(t);return`${e.toLocaleDateString()} ${e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}catch{return"Unknown date"}}function Dr(t){return{mean:"Mean Yield",rcp45:"RCP 4.5",rcp85:"RCP 8.5"}[t]||t}function Ir(t){if(!t||t==="none")return"No Drought";const e={single2034:"Drought in 2034",single2044:"Drought in 2044",period2032:"Drought 2032-2034",period2042:"Drought 2042-2044"};return e[t]?e[t]:Array.isArray(t)?t.length===0?"No Drought":t.length>4?"5+ drought years":`Drought in ${[...t].sort((i,n)=>i-n).join(", ")}`:"Custom Drought"}function re(t,e){return`${t},${e.join(",")}
`}function Bi(t,e={}){const i={...{minimumFractionDigits:0,maximumFractionDigits:0},...e};return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",...i}).format(t)}function nh(t,e){try{if(!t||!t.id||!t.name){console.warn("Invalid profile data:",t);return}const a=t.params||{},i=t.results||{},n=t.sensitivities||{},o=t.createdAt?ih(t.createdAt):"Unknown date",r=parseFloat(i.finalCumulativeMargin||0),s=r>=0?"positive":"negative",l=Bi(r),c=document.createElement("div");c.className="accordion-section profile-card elevation-2",c.style.marginBottom="15px",c.style.borderRadius="8px",c.style.overflow="hidden";const d=document.createElement("div");d.className="accordion-header profile-gradient",d.style.cursor="pointer";const p=document.createElement("div");p.style.display="flex",p.style.justifyContent="space-between",p.style.alignItems="center",p.style.width="100%",p.style.flexWrap="wrap";const u=document.createElement("div");u.style.display="flex",u.style.alignItems="center",u.style.minWidth="120px",u.style.marginRight="8px",u.innerHTML=`<h3><i class="fas fa-folder"></i> ${t.name}</h3>`;const h=document.createElement("div");if(h.style.display="flex",h.style.alignItems="center",h.style.gap="10px",t.location||t.crop){const b=document.createElement("div");b.className="status-chip elevation-1",b.style.backgroundColor="white",b.style.color="var(--dark)",b.style.margin="0",b.innerHTML=`
        <i class="fas fa-map-marker-alt"></i>
        <span>${t.location||"Unknown"} / ${t.crop||"Unknown"}</span>
      `,h.appendChild(b)}const f=document.createElement("div");f.className="final-margin elevation-1",f.style.margin="0",f.innerHTML=`Final: <span class="${s}">${l}</span>`,h.appendChild(f);const m=document.createElement("button");m.className="accordion-toggle",m.style.marginLeft="10px",m.innerHTML='<i class="fas fa-chevron-down"></i>',h.appendChild(m),p.appendChild(u),p.appendChild(h),d.appendChild(p),c.appendChild(d);const _=document.createElement("div");_.className="accordion-content",_.style.backgroundColor="white";let g=`
      <div style="padding: 5px;">
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; margin-bottom: 15px;">
          <!-- Financial Parameters -->
          <div class="param-group">
            <div class="param-group-header finance-gradient">
              <i class="fas fa-coins"></i> Financial
            </div>
            <div class="param-group-content">
              <div class="param-item">
                <span class="param-label">Base Price:</span> 
                <span class="param-value">$${a.basePrice||0}</span>
              </div>
              <div class="param-item">
                <span class="param-label">Operational Cost:</span> 
                <span class="param-value">$${a.opCost||0}</span>
              </div>
            </div>
          </div>
          
          <!-- Yield Parameters -->
          <div class="param-group">
            <div class="param-group-header yield-gradient">
              <i class="fas fa-seedling"></i> Yield
            </div>
            <div class="param-group-content">
              <div class="param-item">
                <span class="param-label">Mean Yield:</span> 
                <span class="param-value">${a.meanYield||0} t/ha</span>
              </div>
              <div class="param-item">
                <span class="param-label">Yield Type:</span> 
                <span class="param-value">${Dr(a.baseYieldType||"mean")}</span>
              </div>
            </div>
          </div>
          
          <!-- Sensitivity Adjustments -->
          ${oh(n)}
          
          <!-- Adjustments -->
          <div class="param-group">
            <div class="param-group-header adjustment-gradient">
              <i class="fas fa-chart-line"></i> Adjustments
            </div>
            <div class="param-group-content">
              <div class="param-item">
                <span class="param-label">Varied Yield:</span> 
                <span class="param-value">${a.variedYield?"Yes":"No"}</span>
              </div>
              <div class="param-item">
                <span class="param-label">Annual Increase:</span> 
                <span class="param-value">${a.annualIncrease?`Yes (${a.annualIncreaseRate||0}%)`:"No"}</span>
              </div>
              <div class="param-item">
                <span class="param-label">Step Change:</span> 
                <span class="param-value">${a.stepChangeEnabled?`Yes, ${a.stepChangeAmount||0}% in ${a.stepChangeYear||0}`:"No"}</span>
              </div>
            </div>
          </div>
          
          <!-- Drought Settings -->
          <div class="param-group">
            <div class="param-group-header climate-gradient">
              <i class="fas fa-cloud-sun-rain"></i> Drought
            </div>
            <div class="param-group-content">
              <div class="param-item">
                <span class="param-label">Drought Yield:</span> 
                <span class="param-value">${a.droughtYield||0} t/ha</span>
              </div>
              <div class="param-item">
                <span class="param-label">Scenario:</span> 
                <span class="param-value">${Ir(a.droughtYears||[])}</span>
              </div>
            </div>
          </div>
    `;(a.netWorthHa!==void 0||a.equityPercent!==void 0)&&(g+=`
          <!-- Financial Position Parameters -->
          <div class="param-group">
            <div class="param-group-header financial-gradient">
              <i class="fas fa-chart-line"></i> Financial Position
            </div>
            <div class="param-group-content">
              <div class="param-item">
                <span class="param-label">Initial Net Worth:</span> 
                <span class="param-value">$${a.netWorthHa||1800}/ha</span>
              </div>
              <div class="param-item">
                <span class="param-label">Initial Equity:</span> 
                <span class="param-value">${a.equityPercent||69}%</span>
              </div>
              <div class="param-item">
                <span class="param-label">Land Appreciation:</span> 
                <span class="param-value">${a.landValueAppreciation?`${a.landAppreciationRate||1}%/year`:"No"}</span>
              </div>
            </div>
          </div>
      `),g+="</div>",g+=`
        <!-- Metadata and Actions -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border);">
          <div class="status-chip elevation-1">
            <i class="fas fa-clock"></i>
            <span>Created: ${o}</span>
          </div>
          
          <div class="btn-group" style="margin-top: 0;">
            <button class="primary-btn elevation-1" onclick="loadProfileParams('${t.id}')" title="Load this profile parameters">
              <i class="fas fa-upload"></i> Load
            </button>
            <button class="danger-btn elevation-1" onclick="deleteProfileConfirm('${t.id}')" title="Delete this profile">
              <i class="fas fa-trash"></i> Delete
            </button>
          </div>
        </div>
      </div>
    `,_.innerHTML=g,c.appendChild(_),e.appendChild(c)}catch(a){console.error("Error rendering profile:",a);const i=document.createElement("div");i.className="accordion-section profile-card elevation-2",i.style.marginBottom="15px",i.style.padding="15px",i.innerHTML=`
      <h3>${t?t.name:"Unknown Profile"}</h3>
      <p style="color: #e53e3e;">Error displaying profile details. Try refreshing the page.</p>
      <div class="btn-group" style="margin-top: 10px;">
        <button class="primary-btn elevation-1" onclick="loadProfileParams('${t?t.id:""}')" title="Load this profile parameters">
          <i class="fas fa-upload"></i> Load
        </button>
        <button class="danger-btn elevation-1" onclick="deleteProfileConfirm('${t?t.id:""}')" title="Delete this profile">
          <i class="fas fa-trash"></i> Delete
        </button>
      </div>
    `,e.appendChild(i)}}function oh(t){if(!t)return"";const e=t.basePrice||t.baseYield||t.opCost;let a=`
    <div class="param-group">
      <div class="param-group-header sensitivity-gradient">
        <i class="fas fa-sliders-h"></i> Sensitivity Adjustments
      </div>
      <div class="param-group-content">
  `;return e?(t.basePrice!==void 0&&(a+=`
        <div class="param-item">
          <span class="param-label">Price:</span> 
          <span class="param-value ${t.basePrice>0?"positive":t.basePrice<0?"negative":"neutral"}">${t.basePrice>0?"+":""}${t.basePrice}%</span>
        </div>
      `),t.baseYield!==void 0&&(a+=`
        <div class="param-item">
          <span class="param-label">Yield:</span> 
          <span class="param-value ${t.baseYield>0?"positive":t.baseYield<0?"negative":"neutral"}">${t.baseYield>0?"+":""}${t.baseYield}%</span>
        </div>
      `),t.opCost!==void 0&&(a+=`
        <div class="param-item">
          <span class="param-label">Op Cost:</span> 
          <span class="param-value ${t.opCost>0?"negative":t.opCost<0?"positive":"neutral"}">${t.opCost>0?"+":""}${t.opCost}%</span>
        </div>
      `)):a+=`
      <div class="param-item">
        <span class="param-label">Status:</span> 
        <span class="param-value neutral">No adjustments</span>
      </div>
    `,a+=`
      </div>
    </div>
  `,a}function rh(){if(document.getElementById("profile-card-styles"))return;const t=document.createElement("style");t.id="profile-card-styles",t.textContent=`
    /* Profile card styles - more compact and consistent with input cards */
    .profile-card {
      transition: box-shadow 0.3s ease, transform 0.2s ease;
      margin-bottom: 12px;
      border-radius: 8px;
      overflow: hidden;
      background-color: white;
      border: 1px solid var(--border);
    }
    
    .profile-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }
    
    /* Compact header styling */
    .profile-card .accordion-header {
      padding: 10px 12px;
      min-height: 48px;
    }
    
    .profile-card .accordion-header h3 {
      font-size: 0.95rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 150px;
    }
    
    /* Status chip styling */
    .profile-card .status-chip {
      padding: 4px 8px;
      font-size: 0.75rem;
      white-space: nowrap;
    }
    
    /* Final margin display */
    .profile-card .final-margin {
      font-size: 0.85rem;
      padding: 4px 8px;
      white-space: nowrap;
    }
    
    /* Parameter groups - more compact */
    .param-group {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      margin-bottom: 8px;
    }
    
    .param-group-header {
      padding: 6px 10px;
      font-weight: 600;
      color: white;
      font-size: 0.8rem;
    }
    
    .param-group-content {
      padding: 8px;
    }
    
    .param-item {
      margin-bottom: 6px;
      font-size: 0.85rem;
      display: flex;
      justify-content: space-between;
    }
    
    .param-item:last-child {
      margin-bottom: 0;
    }
    
    .param-label {
      font-weight: 500;
      color: var(--secondary);
      margin-right: 8px;
    }
    
    .param-value {
      font-weight: 600;
      text-align: right;
    }
    
    /* Action buttons area */
    .profile-card .btn-group {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }
    
    .profile-card .btn-group button {
      font-size: 0.8rem;
      padding: 5px 10px;
    }
    
    /* Sensitivity items */
    .sensitivity-item {
      background-color: white;
      padding: 6px 10px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 0.8rem;
    }
    
    .sensitivity-label {
      font-weight: 500;
    }
    
    .sensitivity-value {
      font-weight: 600;
    }
    
    /* Grid layout optimizations */
    .profile-list-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 16px;
    }
    
    .profile-list-grid .profile-card {
      margin-bottom: 0;
      height: 100%;
    }
    
    /* Compact metadata */
    .profile-card .status-chip {
      margin: 0;
    }
    
    /* Mobile optimizations */
    @media (max-width: 480px) {
      /* Adjust grid to single column */
      .profile-list-grid {
        grid-template-columns: 1fr;
      }
      
      /* Make header more compact on mobile */
      .profile-card .accordion-header {
        flex-direction: column;
        align-items: flex-start;
        padding: 8px 10px;
      }
      
      .profile-card .accordion-header > div {
        width: 100%;
      }
      
      /* Stack header info section vertically on mobile */
      .profile-card .accordion-header > div:last-child {
        margin-top: 6px;
        flex-wrap: wrap;
      }
      
      /* Adjust title for mobile */
      .profile-card .accordion-header h3 {
        font-size: 0.9rem;
        max-width: 100%;
      }
      
      /* Adjust parameter grid for mobile */
      .profile-card [style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
      }
      
      /* Make buttons more touch-friendly */
      .profile-card .btn-group button {
        padding: 8px 12px;
      }
      
      /* Ensure toggle button is more accessible */
      .profile-card .accordion-toggle {
        width: 36px;
        height: 36px;
      }
    }
    
    /* Tablet optimizations */
    @media (min-width: 481px) and (max-width: 768px) {
      .profile-list-grid {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      }
      
      /* Adjust header elements spacing */
      .profile-card .accordion-header > div:last-child {
        gap: 6px;
      }
    }
  `,document.head.appendChild(t)}function ft(){if((!k.profilesList||!k.noProfilesMessage)&&(k.profilesList=document.getElementById("profilesList"),k.noProfilesMessage=document.getElementById("noProfilesMessage"),!k.profilesList||!k.noProfilesMessage)){console.error("Failed to find profile list DOM elements");return}rh();const t=_t();if(t.length===0){k.noProfilesMessage.style.display="block",k.profilesList.innerHTML="";return}k.noProfilesMessage.style.display="none",k.profilesList.innerHTML="";const e=document.querySelectorAll(".view-btn");let a="list";if(e.length){const i=Array.from(e).find(n=>n.classList.contains("active"));i&&(a=i.getAttribute("data-view")||"list")}k.profilesList.classList.remove("profile-list-grid","profile-list-list"),k.profilesList.classList.add(`profile-list-${a}`),t.forEach(i=>{nh(i,k.profilesList)}),window.AccordionManager&&window.AccordionManager.initProfiles()}function sh(t){const e=jt(t);if(e){if(e.location&&e.crop){const a=document.getElementById("activeLocationSelect"),i=document.getElementById("activeCropSelect");a&&i&&(a.value=e.location,i.value=e.crop,a.dispatchEvent(new Event("change")),i.dispatchEvent(new Event("change")))}window.loadParams?(window.loadParams(e.params,e.sensitivities),window.showNotification&&window.showNotification("Profile Loaded",`Profile "${e.name}" loaded successfully`,"success")):console.error("loadParams function not available in global scope"),Aa("yearly")}}function lh(t){const e=jt(t);e&&confirm(`Are you sure you want to delete the profile "${e.name}"?`)&&Pr(t)&&(ft(),document.querySelector('.tab[data-tab="comparison"]')?.classList.contains("active")&&(at(),window.refreshMetricsView&&window.refreshMetricsView()),window.showNotification&&window.showNotification("Profile Deleted",`Profile "${e.name}" deleted successfully`,"info"))}function Aa(t){document.querySelectorAll(".nav-link").forEach(n=>{n.classList.remove("active"),n.getAttribute("data-tab")===t&&n.classList.add("active")}),document.querySelectorAll(".mobile-tab").forEach(n=>{n.classList.remove("active"),n.getAttribute("data-tab")===t&&n.classList.add("active")}),document.querySelectorAll(".tab-content").forEach(n=>{n.classList.remove("active"),n.id===t+"Tab"&&n.classList.add("active")});const i=document.getElementById("currentBreadcrumb");if(i){let n="";switch(t){case"input":n="Input Parameters";break;case"yearly":n="Yearly Results";break;case"profiles":n="Profiles";break;case"comparison":n="Comparison";break;case"metrics":n="Metric Comparisons";break;default:n="Input Parameters"}i.textContent=n}}function Ti(){wa(),k.comparisonModal.style.display="flex"}function mt(){!k.comparisonModal&&(k.comparisonModal=document.getElementById("comparisonModal"),!k.comparisonModal)||(k.comparisonModal.style.display="none")}function wa(t=!1){if(!k.compareProfilesList&&(k.compareProfilesList=document.getElementById("compareProfilesList"),!k.compareProfilesList))return;const e=_t(),a=ht(),i=document.createElement("style");if(i.textContent=`
    .comparison-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background-color: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .selection-count {
      font-weight: 500;
      color: #4a5568;
      font-size: 16px;
    }
    
    .comparison-buttons {
      display: flex;
      gap: 10px;
    }
    
    .profile-item {
      padding: 15px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      align-items: flex-start;
    }
    
    .profile-content {
      flex: 1;
      margin-left: 10px;
    }
    
    .profile-name {
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 3px;
    }
    
    .profile-location {
      font-size: 14px;
      color: #718096;
      margin-bottom: 5px;
    }
    
    .profile-details {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }
    
    .profile-metric {
      font-size: 14px;
    }
    
    .yield-type-tag {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 4px;
      background-color: #e9d8fd;
      color: #6b46c1;
      font-size: 12px;
      margin-left: 8px;
    }
    
    .positive-margin {
      color: #38a169;
    }
    
    .negative-margin {
      color: #e53e3e;
    }
    
    .btn {
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 500;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }
    
    .clear-btn, .select-btn {
      background-color: #4a5568;
      color: white;
    }
    
    .delete-btn {
      background-color: #e53e3e;
      color: white;
    }
    
    .mode-toggle {
      display: flex;
      margin-top: 8px;
      justify-content: center;
      gap: 10px;
    }
    
    .mode-btn {
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 14px;
      background-color: #f8fafc;
      border: 1px solid #cbd5e0;
    }
    
    .mode-btn.active {
      background-color: #4a5568;
      color: white;
      border-color: #4a5568;
    }
    
    .modal-title {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      padding: 0 15px;
    }
    
    .modal-title h3 {
      margin: 0;
      font-size: 18px;
    }
    
    .delete-mode-indicator {
      display: inline-block;
      background-color: #fed7d7;
      color: #e53e3e;
      font-size: 14px;
      padding: 4px 8px;
      border-radius: 4px;
    }
    
    .filter-section {
      padding: 10px 15px;
      background-color: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .filter-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .filter-group {
      flex: 1;
      min-width: 150px;
    }
    
    .filter-label {
      display: block;
      font-size: 14px;
      margin-bottom: 4px;
      color: #4a5568;
    }
    
    .filter-select {
      width: 100%;
      padding: 8px;
      border: 1px solid #cbd5e0;
      border-radius: 4px;
      background-color: white;
    }
    
    .filter-badge {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      background-color: #ebf4ff;
      color: #4299e1;
      border-radius: 4px;
      font-size: 12px;
      margin-top: 8px;
      margin-right: 5px;
    }
    
    .filter-badge button {
      background: none;
      border: none;
      color: #4299e1;
      margin-left: 5px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .clear-filters {
      margin-left: auto;
      background-color: transparent;
      border: none;
      color: #4a5568;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      padding: 5px 8px;
    }
    
    .clear-filters:hover {
      text-decoration: underline;
    }
    
    .no-results {
      padding: 20px;
      text-align: center;
      color: #4a5568;
      font-style: italic;
    }
    
    .filter-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .filter-title {
      font-weight: 600;
      font-size: 14px;
      color: #4a5568;
    }
    
    .active-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 10px;
    }
  `,document.head.appendChild(i),k.compareProfilesList.innerHTML="",e.length===0){k.compareProfilesList.innerHTML='<p style="padding: 15px;">No profiles available for comparison. Please create profiles first.</p>';return}const n=document.createElement("div");n.className="modal-title",n.innerHTML=`
    <h3>Select Profiles</h3>
    ${t?'<span class="delete-mode-indicator"><i class="fas fa-trash"></i> Delete Mode</span>':""}
    <div class="mode-toggle">
      <button id="compareToggleBtn" class="mode-btn ${t?"":"active"}">Compare Mode</button>
      <button id="deleteToggleBtn" class="mode-btn ${t?"active":""}">Delete Mode</button>
    </div>
  `,k.compareProfilesList.appendChild(n);const o=new Set,r=new Set,s=new Set;e.forEach(C=>{if(C.location&&o.add(C.location),C.crop&&r.add(C.crop),C.params?.baseYieldType){const E=u(C.params.baseYieldType);s.add(E)}});const l=document.createElement("div");l.className="filter-section",l.innerHTML=`
    <div class="filter-header">
      <span class="filter-title">Filter Profiles</span>
      <button id="clearFiltersBtn" class="clear-filters" style="display: none">
        <i class="fas fa-times-circle"></i> Clear Filters
      </button>
    </div>
    <div class="filter-row">
      <div class="filter-group">
        <label class="filter-label" for="locationFilter">Location</label>
        <select id="locationFilter" class="filter-select">
          <option value="">All Locations</option>
          ${Array.from(o).sort().map(C=>`<option value="${C}">${C}</option>`).join("")}
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label" for="cropFilter">Crop</label>
        <select id="cropFilter" class="filter-select">
          <option value="">All Crops</option>
          ${Array.from(r).sort().map(C=>`<option value="${C}">${C}</option>`).join("")}
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label" for="yieldTypeFilter">Yield Type</label>
        <select id="yieldTypeFilter" class="filter-select">
          <option value="">All Yield Types</option>
          ${Array.from(s).sort().map(C=>`<option value="${C}">${C}</option>`).join("")}
        </select>
      </div>
    </div>
    <div class="active-filters" id="activeFilters"></div>
  `,k.compareProfilesList.appendChild(l);const c=document.createElement("div");c.className="comparison-header",t?c.innerHTML=`
      <div class="selection-count">0 profiles selected</div>
      <div class="comparison-buttons">
        <button id="clearAllComparisonsBtn" class="btn clear-btn">
          <i class="fas fa-times-circle"></i> Clear All
        </button>
        <button id="selectAllComparisonsBtn" class="btn select-btn">
          <i class="fas fa-check-circle"></i> Select All
        </button>
        <button id="deleteSelectedBtn" class="btn delete-btn" disabled>
          <i class="fas fa-trash"></i> Delete Selected
        </button>
      </div>
    `:c.innerHTML=`
      <div class="selection-count">${a.length} profiles selected</div>
      <div class="comparison-buttons">
        <button id="clearAllComparisonsBtn" class="btn clear-btn">
          <i class="fas fa-times-circle"></i> Clear All
        </button>
        <button id="selectAllComparisonsBtn" class="btn select-btn">
          <i class="fas fa-check-circle"></i> Select All
        </button>
      </div>
    `,k.compareProfilesList.appendChild(c);const d=document.createElement("div");d.className="profiles-list",d.id="profilesListContainer",k.compareProfilesList.appendChild(d);function p(C="",E="",P=""){d.innerHTML="";const A=e.filter(O=>!(C&&O.location!==C||E&&O.crop!==E||P&&u(O.params?.baseYieldType)!==P));if(A.length===0){d.innerHTML='<div class="no-results">No profiles match the selected filters.</div>';return}const R={};A.forEach(O=>{const L=O.location&&O.crop?`${O.location} / ${O.crop}`:"Other";R[L]||(R[L]=[]),R[L].push(O)}),Object.keys(R).sort().forEach(O=>{if(O!=="Other"){const L=document.createElement("div");L.style.padding="10px 15px",L.style.backgroundColor="#f1f5f9",L.style.fontWeight="bold",L.style.fontSize="14px",L.textContent=O,d.appendChild(L)}R[O].forEach(L=>{const $=t?!1:a.includes(L.id),V=parseFloat(L.results?.finalCumulativeMargin||0),G=document.createElement("div");G.className="profile-item",$&&(G.style.backgroundColor="#f0fff4");let K="";L.location&&L.crop&&O==="Other"&&(K=`<div class="profile-location">${L.location} / ${L.crop}</div>`);const ve=L.params?.baseYieldType,it=ve?`<span class="yield-type-tag">${u(ve)}</span>`:"";G.innerHTML=`
          <input type="checkbox" id="compare-${L.id}" value="${L.id}" ${$?"checked":""} 
                 style="width: 20px; height: 20px; margin-top: 3px;">
          <div class="profile-content">
            <div class="profile-name">${L.name}${it}</div>
            ${K}
            <div class="profile-details">
              <span class="profile-metric">Base: $${L.params?.basePrice||0}</span>
              <span class="profile-metric ${V>=0?"positive-margin":"negative-margin"}">
                Margin: ${Bi(V)}
              </span>
            </div>
          </div>
        `,G.addEventListener("click",Ae=>{if(Ae.target.type!=="checkbox"){const we=G.querySelector('input[type="checkbox"]');we.checked=!we.checked,M(),G.style.backgroundColor=we.checked?"#f0fff4":"",t&&S()}}),d.appendChild(G)})}),M(),t&&S()}function u(C){if(!C)return"Unknown";switch(C.toLowerCase()){case"mean":return"Mean Yield";case"rcp45":return"RCP 4.5";case"rcp85":return"RCP 8.5";default:return C.charAt(0).toUpperCase()+C.slice(1)}}const h=document.getElementById("locationFilter"),f=document.getElementById("cropFilter"),m=document.getElementById("yieldTypeFilter"),_=document.getElementById("clearFiltersBtn"),g=document.getElementById("activeFilters");let b={location:"",crop:"",yieldType:""};function w(){g.innerHTML="";let C=!1;b.location&&(g.innerHTML+=`
        <div class="filter-badge">
          Location: ${b.location}
          <button data-filter="location">×</button>
        </div>
      `,C=!0),b.crop&&(g.innerHTML+=`
        <div class="filter-badge">
          Crop: ${b.crop}
          <button data-filter="crop">×</button>
        </div>
      `,C=!0),b.yieldType&&(g.innerHTML+=`
        <div class="filter-badge">
          Yield Type: ${b.yieldType}
          <button data-filter="yieldType">×</button>
        </div>
      `,C=!0),_.style.display=C?"flex":"none",g.querySelectorAll("button").forEach(P=>{P.addEventListener("click",A=>{const R=A.target.getAttribute("data-filter");R&&(R==="location"&&(h.value=""),R==="crop"&&(f.value=""),R==="yieldType"&&(m.value=""),b[R]="",p(b.location,b.crop,b.yieldType),w())})})}h.addEventListener("change",()=>{b.location=h.value,p(b.location,b.crop,b.yieldType),w()}),f.addEventListener("change",()=>{b.crop=f.value,p(b.location,b.crop,b.yieldType),w()}),m.addEventListener("change",()=>{b.yieldType=m.value,p(b.location,b.crop,b.yieldType),w()}),_.addEventListener("click",()=>{h.value="",f.value="",m.value="",b={location:"",crop:"",yieldType:""},p("","",""),w()}),p(),document.getElementById("compareToggleBtn").addEventListener("click",()=>{t&&wa(!1)}),document.getElementById("deleteToggleBtn").addEventListener("click",()=>{t||wa(!0)}),document.getElementById("clearAllComparisonsBtn").addEventListener("click",()=>{d.querySelectorAll('input[type="checkbox"]').forEach(E=>{E.checked=!1,E.closest(".profile-item").style.backgroundColor=""}),M(),t&&S()}),document.getElementById("selectAllComparisonsBtn").addEventListener("click",()=>{d.querySelectorAll('input[type="checkbox"]').forEach(E=>{E.checked=!0,E.closest(".profile-item").style.backgroundColor="#f0fff4"}),M(),t&&S()}),t&&(document.getElementById("deleteSelectedBtn").addEventListener("click",x),S());const y=document.querySelector("#updateComparisonBtn");y&&(y.textContent=t?"Cancel Delete":"Update Comparison",y.style.backgroundColor=t?"#4a5568":"#38A169");const v=document.querySelector("#comparisonModal .modal-footer button:first-child");v&&(v.style.display=t?"none":"block");function M(){const C=document.querySelector(".selection-count"),E=d.querySelectorAll('input[type="checkbox"]:checked');C.textContent=`${E.length} profiles selected`}function S(){const C=document.getElementById("deleteSelectedBtn");if(C){const E=d.querySelectorAll('input[type="checkbox"]:checked');C.disabled=E.length===0}}function x(){const C=d.querySelectorAll('input[type="checkbox"]:checked'),E=Array.from(C).map(A=>A.value);if(E.length===0)return;const P=E.length===1?"Are you sure you want to delete 1 profile?":`Are you sure you want to delete ${E.length} profiles?`;if(confirm(P)){let A=0;E.forEach(L=>{Pr(L)&&A++}),window.showNotification&&window.showNotification("Profiles Deleted",`${A} profile${A!==1?"s":""} deleted successfully`,"success");const O=ht().filter(L=>!E.includes(L));Vt(O),mt(),ft(),at(),window.refreshMetricsView&&window.refreshMetricsView()}}}window.updateComparison=function(){const t=document.getElementById("deleteToggleBtn");if(t&&t.classList.contains("active")){mt();return}if(!k.compareProfilesList&&(k.compareProfilesList=document.getElementById("compareProfilesList"),!k.compareProfilesList))return;const a=k.compareProfilesList.querySelectorAll('input[type="checkbox"]:checked'),i=Array.from(a).map(n=>n.value);Vt(i),mt(),Yi(i),Aa("comparison"),at(),window.refreshMetricsView&&window.refreshMetricsView()};window.openComparisonModal=function(t=!1){wa(t),!(!k.comparisonModal&&(k.comparisonModal=document.getElementById("comparisonModal"),!k.comparisonModal))&&(k.comparisonModal.style.display="flex")};window.deleteSelectedProfiles=function(){const t=document.getElementById("deleteToggleBtn");t?t.click():Ti()};window.updateComparison=function(){if(!k.compareProfilesList&&(k.compareProfilesList=document.getElementById("compareProfilesList"),!k.compareProfilesList))return;const t=k.compareProfilesList.querySelectorAll('input[type="checkbox"]:checked'),e=Array.from(t).map(a=>a.value);Vt(e),mt(),Yi(e),Aa("comparison"),at(),window.refreshMetricsView&&window.refreshMetricsView()};function Br(){const t=document.getElementById("selectionCount");if(!t)return;const e=document.querySelectorAll('#compareProfilesList input[type="checkbox"]:checked');t.textContent=`${e.length} profiles selected`}function ch(){document.querySelectorAll('#compareProfilesList input[type="checkbox"]').forEach(e=>{e.checked=!1;const a=e.closest(".profile-item");a&&a.classList.remove("selected")}),Br()}function dh(){document.querySelectorAll('#compareProfilesList input[type="checkbox"]').forEach(e=>{e.checked=!0;const a=e.closest(".profile-item");a&&a.classList.add("selected")}),Br()}function ph(){if(!k.compareProfilesList&&(k.compareProfilesList=document.getElementById("compareProfilesList"),!k.compareProfilesList))return;const t=k.compareProfilesList.querySelectorAll('input[type="checkbox"]:checked'),e=Array.from(t).map(a=>a.value);Vt(e),mt(),Yi(e),Aa("comparison"),at(),window.refreshMetricsView&&window.refreshMetricsView()}function Yi(t){const e=document.getElementById("comparisonStatus");e&&(t.length===0?e.innerHTML='<i class="fas fa-exclamation-circle"></i><span>No profiles selected</span>':e.innerHTML=`<i class="fas fa-check-circle"></i><span>${t.length} profiles selected</span>`);const a=document.getElementById("metricsStatus");a&&(t.length===0?a.innerHTML='<i class="fas fa-exclamation-circle"></i><span>No profiles selected</span>':a.innerHTML=`<i class="fas fa-check-circle"></i><span>${t.length} profiles selected</span>`)}function at(){if((!k.noComparisonMessage||!k.comparisonContent||!k.comparisonTable)&&(k.noComparisonMessage=document.getElementById("noComparisonMessage"),k.comparisonContent=document.getElementById("comparisonContent"),k.comparisonTable=document.getElementById("comparisonTable"),!k.noComparisonMessage||!k.comparisonContent||!k.comparisonTable))return;const t=ht();if(t.length===0){k.noComparisonMessage.style.display="block",k.comparisonContent.style.display="none";return}k.noComparisonMessage.style.display="none",k.comparisonContent.style.display="block";const e=t.map(n=>jt(n)).filter(Boolean);k.comparisonContent.innerHTML="";const a=document.createElement("div");a.id="inlineUnderstandContent",a.className="elevation-1",a.style.marginBottom="20px";const i=document.createElement("div");i.className="comparison-table",i.innerHTML=`
    <h3><i class="fas fa-table"></i> Yearly Results Comparison</h3>
    <table id="comparisonTable" class="data-table elevation-1">
      <!-- Will be populated by JavaScript -->
    </table>
  `,k.comparisonContent.appendChild(a),k.comparisonContent.appendChild(i),uh(e),window.generateUnderstandContent?window.generateUnderstandContent(e,a):(a.innerHTML="<p>Understanding differences feature not available</p>",console.error("generateUnderstandContent function not found")),Tr(),hh()}function uh(t){const e=document.getElementById("comparisonTable");if(!e)return;e.innerHTML="";const a=document.createElement("thead"),i=document.createElement("tr");i.innerHTML="<th>Year</th>",t.forEach(l=>{const c=l.location&&l.crop?`<br><span style="font-size: 12px; font-weight: normal;">${l.location} / ${l.crop}</span>`:"";i.innerHTML+=`<th class="profile-column">${l.name}${c}</th>`}),a.appendChild(i),e.appendChild(a);const n=document.createElement("tbody"),o=t.map(l=>Lr(l)),r=window.yieldMultipliers||{};Object.keys(r).map(Number).forEach(l=>{const c=document.createElement("tr");c.className="year-row",c.innerHTML=`<td><strong>${l}</strong></td>`,t.forEach((d,p)=>{const h=o[p].find(f=>f.year===l);if(h){const f=parseFloat(h.yield).toFixed(2),m=parseFloat(h.cumulativeGrossMargin);c.innerHTML+=`<td>Yield: ${f} t/ha<br>Margin: <span class="${m>=0?"positive":"negative"}">${Bi(m)}</span></td>`}else c.innerHTML+="<td>N/A</td>"}),n.appendChild(c)}),e.appendChild(n)}function Tr(){const t=document.getElementById("manageComparisonBtn");if(!t)return;const e=Ar("#comparisonTab .card-header .header-actions");e&&(e.contains(t)||(t.remove(),e.prepend(t)))}function hh(){const t=Ar("#comparisonTab .card-header .header-actions");if(t){if(!document.getElementById("downloadComparisonBtn")){const e=ni("button",{id:"downloadComparisonBtn",className:"action-btn elevation-1",style:{marginLeft:"10px"},onclick:"downloadComparisonData()"});e.innerHTML='<i class="fas fa-download"></i> CSV',t.appendChild(e)}if(!document.getElementById("printComparisonBtn")){const e=ni("button",{id:"printComparisonBtn",className:"action-btn elevation-1",style:{marginLeft:"10px"},onclick:"printComparisonData()"});e.innerHTML='<i class="fas fa-file-pdf"></i> PDF',t.appendChild(e)}}}function fh(){const t=ht();if(t.length===0){window.showNotification?window.showNotification("No Profiles","No profiles selected for comparison","warning"):alert("No profiles selected for comparison. Please select profiles first.");return}const{profiles:e,profileResults:a,years:i,csvContent:n}=_h(t),o=encodeURI(n),r=document.createElement("a");r.setAttribute("href",o),r.setAttribute("download","comparison_data.csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.showNotification&&window.showNotification("CSV Downloaded","Comparison data has been downloaded as CSV","success")}function mh(){const t=document.querySelector("#comparisonTab");if(!t){console.error("Comparison tab not found.");return}const e=t.cloneNode(!0),a=window.open("","_blank");if(!a){console.error("Failed to open print window.");return}a.document.open(),a.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
          <title>Comparison Report</title>
          <style>
              /* Copy styles from the current page */
              ${Array.from(document.styleSheets).map(i=>{try{return Array.from(i.cssRules).map(n=>n.cssText).join(`
`)}catch{return""}}).join(`
`)}
              /* Additional styles for print formatting */
              body {
                  margin: 0;
                  padding: 20px;
                  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
                  background-color: white;
              }
              #comparisonTab {
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                  gap: 20px;
              }
              .comparison-table {
                  width: 100%;
                  border-collapse: collapse;
              }
              .comparison-table th, .comparison-table td {
                  border: 1px solid #ddd;
                  padding: 8px;
                  text-align: left;
              }
              .comparison-table th {
                  background-color: #f4f4f4;
                  font-weight: bold;
              }
              .container {
                  page-break-inside: avoid; /* Prevent containers from breaking across pages */
                  break-inside: avoid; /* Modern browsers */
                  margin-bottom: 20px;
              }
              @media print {
                  body {
                      -webkit-print-color-adjust: exact;
                      print-color-adjust: exact;
                      zoom: 0.8; /* Adjust zoom for better fit */
                  }
                  #comparisonTab {
                      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Wider columns for print */
                  }
              }
          </style>
      </head>
      <body>
          ${e.outerHTML}
      </body>
      </html>
  `),a.document.close(),a.focus(),a.print(),a.onafterprint=()=>{a.close()}}function _h(t){const e=t.map(l=>jt(l)).filter(Boolean),a=e.map(l=>Lr(l)),i=window.yieldMultipliers||{},n=Object.keys(i).map(Number),o=e.map(l=>{const c=l.location&&l.crop?` (${l.location}/${l.crop})`:"";return l.name+c});let r="data:text/csv;charset=utf-8,";return r+="Comparison Data,"+o.join(",")+`

`,r+=`INPUT PARAMETERS
`,r+=re("Base Price ($/tonne)",e.map(l=>l.params?.basePrice||0)),r+=re("Mean Yield (t/ha)",e.map(l=>l.params?.meanYield||0)),r+=re("Base Yield Type",e.map(l=>Dr(l.params?.baseYieldType||"mean"))),r+=re("Varied Yield",e.map(l=>l.params?.variedYield?"Yes":"No")),r+=re("Annual Yield Increase",e.map(l=>l.params?.annualIncrease?"Yes":"No")),r+=re("Annual Increase Rate (%)",e.map(l=>l.params?.annualIncreaseRate||0)),r+=re("Drought Scenario",e.map(l=>Ir(l.params?.droughtScenario))),r+=re("Drought Yield (t/ha)",e.map(l=>l.params?.droughtYield||0)),r+=re("Operational Cost ($/ha)",e.map(l=>l.params?.opCost||0)),r+=`
`,r+=`SUMMARY RESULTS
`,r+=re("Final Cumulative Margin ($)",e.map(l=>l.results?.finalCumulativeMargin||0)),r+=`
`,e.some(l=>l.sensitivities&&(l.sensitivities.basePrice!==0||l.sensitivities.baseYield!==0||l.sensitivities.opCost!==0))&&(r+=`SENSITIVITY ADJUSTMENTS
`,r+=re("Price Adjustment (%)",e.map(l=>l.sensitivities?.basePrice||0)),r+=re("Yield Adjustment (%)",e.map(l=>l.sensitivities?.baseYield||0)),r+=re("Op Cost Adjustment (%)",e.map(l=>l.sensitivities?.opCost||0)),r+=`
`),r+=gh(n,e,a,o),{profiles:e,profileResults:a,years:n,csvContent:r}}function gh(t,e,a,i){let n=`YEARLY RESULTS
`;return n+="Year,"+i.join(",")+`
`,n+=`Yearly Yield (t/ha)
`,t.forEach(o=>{let r=o.toString();e.forEach((s,l)=>{const d=a[l].find(p=>p.year===o);r+=","+(d?d.yield:"N/A")}),n+=r+`
`}),n+=`
`,n+=`Yearly Revenue ($)
`,t.forEach(o=>{let r=o.toString();e.forEach((s,l)=>{const d=a[l].find(p=>p.year===o);r+=","+(d?d.revenue:"N/A")}),n+=r+`
`}),n+=`
`,n+=`Yearly Costs ($)
`,t.forEach(o=>{let r=o.toString();e.forEach((s,l)=>{const d=a[l].find(p=>p.year===o);r+=","+(d?d.costs:"N/A")}),n+=r+`
`}),n+=`
`,n+=`Yearly Gross Margin ($)
`,t.forEach(o=>{let r=o.toString();e.forEach((s,l)=>{const d=a[l].find(p=>p.year===o);r+=","+(d?d.grossMargin:"N/A")}),n+=r+`
`}),n+=`
`,n+=`Yearly Cumulative Gross Margin ($)
`,t.forEach(o=>{let r=o.toString();e.forEach((s,l)=>{const d=a[l].find(p=>p.year===o);r+=","+(d?d.cumulativeGrossMargin:"N/A")}),n+=r+`
`}),n}function _o(){bh(),vh(),ft(),document.querySelector('.tab[data-tab="comparison"]')?.classList.contains("active")&&at(),Tr()}function bh(){k={profilesList:document.getElementById("profilesList"),noProfilesMessage:document.getElementById("noProfilesMessage"),compareProfilesList:document.getElementById("compareProfilesList"),comparisonModal:document.getElementById("comparisonModal"),manageComparisonBtn:document.getElementById("manageComparisonBtn"),noComparisonMessage:document.getElementById("noComparisonMessage"),comparisonContent:document.getElementById("comparisonContent"),comparisonTable:document.getElementById("comparisonTable")}}function vh(){k.manageComparisonBtn&&k.manageComparisonBtn.addEventListener("click",Ti),wh()}function wh(){document.querySelectorAll(".nav-link").forEach(a=>{a.addEventListener("click",function(){this.getAttribute("data-tab")==="profiles"&&setTimeout(ft,50)})}),document.querySelectorAll(".mobile-tab").forEach(a=>{a.addEventListener("click",function(){this.getAttribute("data-tab")==="profiles"&&setTimeout(ft,50)})})}window.downloadComparisonData=fh;window.printComparisonData=mh;window.clearAllComparisons=ch;window.selectAllComparisons=dh;const Ri="agCalculatorDefaults",yh={locations:["Merredin","Moora"],crops:["Wheat","Canola","Barley"],defaultValues:{Merredin:{Wheat:{meanYield:1.64,basePrice:350,baseYieldType:"mean",variedYield:!1,annualIncrease:!1,annualIncreaseRate:1,droughtYield:.53,opCost:400,baseYieldMultipliers:{rcp45:.87,rcp85:.72},yieldMultipliers:{2026:.85,2027:.55,2028:.75,2029:1.15,2030:.48,2031:1.18,2032:1.03,2033:1.02,2034:.82,2035:1.07,2036:1.06,2037:.98,2038:1.02,2039:1.18,2040:.84,2041:.91,2042:.89,2043:1.42,2044:1.11,2045:.87,2046:1.64,2047:1.3,2048:1,2049:.96,2050:1.12}},Canola:{meanYield:.85,basePrice:611,baseYieldType:"mean",variedYield:!1,annualIncrease:!1,annualIncreaseRate:1,droughtYield:.35,opCost:400,baseYieldMultipliers:{rcp45:.87,rcp85:.72},yieldMultipliers:{2026:1.12,2027:1.24,2028:.93,2029:1,2030:.86,2031:1.27,2032:.93,2033:1.29,2034:1.13,2035:1.28,2036:1.13,2037:1.23,2038:.95,2039:1.31,2040:1.2,2041:1.29,2042:.99,2043:1.01,2044:.85,2045:1.03,2046:.98,2047:1.2,2048:.96,2049:1.04,2050:1.05}},Barley:{meanYield:1.8,basePrice:262,baseYieldType:"mean",variedYield:!1,annualIncrease:!1,annualIncreaseRate:1,droughtYield:.6,opCost:400,baseYieldMultipliers:{rcp45:.87,rcp85:.72},yieldMultipliers:{2026:.96,2027:1.02,2028:.95,2029:1.3,2030:1.27,2031:.95,2032:1.11,2033:.95,2034:1.02,2035:.97,2036:1.08,2037:.93,2038:.88,2039:1.11,2040:1.13,2041:.97,2042:1.06,2043:.88,2044:.95,2045:.88,2046:1.01,2047:1.17,2048:.89,2049:.92,2050:1.18}}},Moora:{Wheat:{meanYield:2.3,basePrice:350,baseYieldType:"mean",variedYield:!1,annualIncrease:!1,annualIncreaseRate:1,droughtYield:.6,opCost:585,baseYieldMultipliers:{rcp45:.95,rcp85:.79},yieldMultipliers:{2026:1.14,2027:.91,2028:1.25,2029:1.15,2030:1.19,2031:1.2,2032:.93,2033:.79,2034:1.13,2035:.91,2036:1.13,2037:.97,2038:.98,2039:1.1,2040:.94,2041:1.16,2042:1.19,2043:.9,2044:.87,2045:1.03,2046:1.07,2047:1.01,2048:.98,2049:.87,2050:1.01}},Canola:{meanYield:1.4,basePrice:611,baseYieldType:"mean",variedYield:!1,annualIncrease:!1,annualIncreaseRate:1,droughtYield:.4,opCost:585,baseYieldMultipliers:{rcp45:.95,rcp85:.79},yieldMultipliers:{2026:1.28,2027:1.18,2028:1.29,2029:1.16,2030:1.14,2031:.87,2032:1.02,2033:1.07,2034:1.16,2035:.99,2036:1.01,2037:1.06,2038:1.25,2039:.91,2040:.84,2041:1.22,2042:.93,2043:.95,2044:.98,2045:.77,2046:.88,2047:.86,2048:1.02,2049:1.11,2050:.85}},Barley:{meanYield:2.9,basePrice:262,baseYieldType:"mean",variedYield:!1,annualIncrease:!1,annualIncreaseRate:1,droughtYield:.9,opCost:585,baseYieldMultipliers:{rcp45:.95,rcp85:.79},yieldMultipliers:{2026:.96,2027:.87,2028:.98,2029:.98,2030:1.28,2031:1.05,2032:1.05,2033:1.06,2034:1.04,2035:.96,2036:1.1,2037:.94,2038:.9,2039:.99,2040:1.02,2041:1.01,2042:.85,2043:1.24,2044:.93,2045:.97,2046:.96,2047:1.17,2048:.91,2049:1.03,2050:.9}}}}};let Q="Merredin",ee="Wheat",D={};function xh(t){return typeof t=="string"&&t.trim()!==""&&(console.log("Setting currentLocation in defaults.js to:",t),Q=t,Ah(t)),Q}function Ch(){return Q}function Mh(t){return typeof t=="string"&&t.trim()!==""&&(console.log("Setting currentCrop in defaults.js to:",t),ee=t,Dh(t)),ee}function Sh(){return ee}function qt(t,e){const a=gt();return a.defaultValues[t]&&a.defaultValues[t][e]?a.defaultValues[t][e]:a.defaultValues.Merredin.Wheat}function Yr(t){const e=gt();e.locations.includes(t)||(e.locations.push(t),e.defaultValues[t]={},Ni(e))}function Rr(t){const e=gt();e.crops.includes(t)||(e.crops.push(t),Ni(e))}function Oi(t,e,a){const i=gt();i.locations.includes(t)||(i.locations.push(t),i.defaultValues[t]={}),i.crops.includes(e)||i.crops.push(e),i.defaultValues[t][e]=a,Ni(i)}function Fi(){return gt().locations}function $i(){return gt().crops}function ya(){Ih(),Rh(),$h()}function $t(){const t=qt(Q,ee);Eh(t),kh(t.yieldMultipliers),Ph(t.baseYieldMultipliers),Lh()}function gt(){const t=localStorage.getItem(Ri);return t?JSON.parse(t):yh}function Ni(t){localStorage.setItem(Ri,JSON.stringify(t))}function Eh(t){const e={meanYield:document.getElementById("meanYield"),basePrice:document.getElementById("basePrice"),droughtYield:document.getElementById("droughtYield"),opCost:document.getElementById("opCost")};Object.entries(e).forEach(([a,i])=>{i&&t[a]!==void 0&&(i.value=t[a])})}function kh(t){window.updateYieldMultipliers?window.updateYieldMultipliers({...t}):window.yieldMultipliers={...t}}function Ph(t){window.updateRcpMultipliers?(window.updateRcpMultipliers(t),console.log("RCP multipliers updated via global function:",t)):console.error("updateRcpMultipliers function not available globally")}function Lh(){window.calculateAndDisplay&&window.calculateAndDisplay()}function Ah(t){const e=document.getElementById("activeLocationSelect");e&&e.value!==t&&(e.value=t)}function Dh(t){const e=document.getElementById("activeCropSelect");e&&e.value!==t&&(e.value=t)}function Ih(){if(document.querySelector('.tab[data-tab="defaults"]'))return;const t=document.createElement("button");t.className="tab",t.setAttribute("data-tab","defaults"),t.textContent="Defaults";const e=document.querySelector(".tabs-container");e&&(e.appendChild(t),t.addEventListener("click",function(){Yh()}));const a=document.createElement("div");a.id="defaultsTab",a.className="tab-content",a.innerHTML=Bh();const i=document.querySelector(".tab-contents-container");i&&i.appendChild(a),Th()}function Bh(){return`
    <div class="card">
      <div class="card-header">
        <h2>Default Values Manager</h2>
      </div>
      <div class="card-body">
        <div id="defaultsContainer">
          <div class="settings-section">
            <h3>Location and Crop Selection</h3>
            <div class="settings-row">
              <div class="settings-field">
                <label for="locationSelect">Location:</label>
                <select id="locationSelect"></select>
                <button id="addLocationBtn" class="small-btn">+</button>
              </div>
              <div class="settings-field">
                <label for="cropSelect">Crop:</label>
                <select id="cropSelect"></select>
                <button id="addCropBtn" class="small-btn">+</button>
              </div>
            </div>
          </div>
          
          <div class="settings-section">
            <h3>Default Values for <span id="currentDefaults">Merredin / Wheat</span></h3>
            <div class="settings-row">
              <div class="settings-field">
                <label for="defaultMeanYield">Mean Yield (t/ha):</label>
                <input type="number" id="defaultMeanYield" step="0.1" min="0">
              </div>
              <div class="settings-field">
                <label for="defaultBasePrice">Base Price ($/t):</label>
                <input type="number" id="defaultBasePrice" step="1" min="0">
              </div>
            </div>
            
            <div class="settings-row">
              <div class="settings-field">
                <label for="defaultOpCost">Operational Cost ($/ha):</label>
                <input type="number" id="defaultOpCost" step="1" min="0">
              </div>
              <div class="settings-field">
                <label for="defaultDroughtYield">Drought Yield (t/ha):</label>
                <input type="number" id="defaultDroughtYield" step="0.01" min="0">
              </div>
            </div>
            
            <div class="settings-row">
              <div class="settings-field">
                <label>RCP 4.5 Multiplier:</label>
                <input type="number" id="defaultRcp45" step="0.01" min="0" max="1">
              </div>
              <div class="settings-field">
                <label>RCP 8.5 Multiplier:</label>
                <input type="number" id="defaultRcp85" step="0.01" min="0" max="1">
              </div>
            </div>
            
            <div class="settings-row">
              <div class="settings-field full-width">
                <button id="saveDefaultsBtn" class="primary">Save Default Values</button>
                <button id="resetDefaultsBtn">Reset to Initial Defaults</button>
              </div>
            </div>
          </div>
          
          <div class="settings-section">
            <h3>Yield Multipliers by Year</h3>
            <p>These multipliers affect yield when "Varied Yield" is enabled:</p>
            <div id="yieldMultipliersContainer">
              <!-- Will be populated by JavaScript -->
            </div>
            <div class="settings-row">
              <div class="settings-field full-width">
                <button id="saveMultipliersBtn" class="primary">Save Multipliers</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function Th(){if(document.getElementById("defaults-tab-styles"))return;const t=document.createElement("style");t.id="defaults-tab-styles",t.textContent=`
    .settings-section {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #e2e8f0;
      border-radius: 5px;
    }
    
    .settings-section h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #2d3748;
    }
    
    .settings-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .settings-field {
      flex: 1;
      min-width: 200px;
    }
    
    .settings-field.full-width {
      flex-basis: 100%;
    }
    
    .settings-field label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    .settings-field input,
    .settings-field select {
      width: 100%;
      padding: 8px;
      border: 1px solid #cbd5e0;
      border-radius: 4px;
    }
    
    .small-btn {
      padding: 2px 8px;
      margin-left: 8px;
    }
    
    .yield-multipliers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .yield-multiplier-item {
      display: flex;
      align-items: center;
    }
    
    .yield-multiplier-item label {
      min-width: 50px;
      margin-right: 10px;
    }
    
    .yield-multiplier-item input {
      flex: 1;
      min-width: 60px;
    }
  `,document.head.appendChild(t)}function Yh(){document.querySelectorAll(".tab").forEach(a=>a.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(a=>a.classList.remove("active"));const t=document.querySelector('.tab[data-tab="defaults"]');t&&t.classList.add("active");const e=document.getElementById("defaultsTab");e&&e.classList.add("active")}function Rh(){Oh(),Fh()}function Oh(){D={locationSelect:document.getElementById("locationSelect"),cropSelect:document.getElementById("cropSelect"),defaultMeanYield:document.getElementById("defaultMeanYield"),defaultBasePrice:document.getElementById("defaultBasePrice"),defaultOpCost:document.getElementById("defaultOpCost"),defaultDroughtYield:document.getElementById("defaultDroughtYield"),defaultRcp45:document.getElementById("defaultRcp45"),defaultRcp85:document.getElementById("defaultRcp85"),addLocationBtn:document.getElementById("addLocationBtn"),addCropBtn:document.getElementById("addCropBtn"),saveDefaultsBtn:document.getElementById("saveDefaultsBtn"),resetDefaultsBtn:document.getElementById("resetDefaultsBtn"),saveMultipliersBtn:document.getElementById("saveMultipliersBtn"),yieldMultipliersContainer:document.getElementById("yieldMultipliersContainer"),currentDefaultsTitle:document.getElementById("currentDefaults")}}function Fh(){D.addLocationBtn&&D.addLocationBtn.addEventListener("click",()=>{const t=prompt("Enter new location name:");t&&t.trim()&&(Yr(t.trim()),Or())}),D.addCropBtn&&D.addCropBtn.addEventListener("click",()=>{const t=prompt("Enter new crop name:");t&&t.trim()&&(Rr(t.trim()),Fr())}),D.saveDefaultsBtn&&D.saveDefaultsBtn.addEventListener("click",Nh),D.resetDefaultsBtn&&D.resetDefaultsBtn.addEventListener("click",()=>{confirm("Reset to initial default values? This will remove all custom locations and crops.")&&(localStorage.removeItem(Ri),location.reload())}),D.saveMultipliersBtn&&D.saveMultipliersBtn.addEventListener("click",zh)}function $h(){D.locationSelect&&D.cropSelect&&(Or(),Fr(),D.locationSelect.addEventListener("change",()=>{Q=D.locationSelect.value,go()}),D.cropSelect.addEventListener("change",()=>{ee=D.cropSelect.value,go()})),Vh()}function Or(){if(!D.locationSelect)return;const t=Fi();D.locationSelect.innerHTML="",t.forEach(e=>{const a=document.createElement("option");a.value=e,a.textContent=e,D.locationSelect.appendChild(a)}),D.locationSelect.value=Q}function Fr(){if(!D.cropSelect)return;const t=$i();D.cropSelect.innerHTML="",t.forEach(e=>{const a=document.createElement("option");a.value=e,a.textContent=e,D.cropSelect.appendChild(a)}),D.cropSelect.value=ee}function go(){const t=qt(Q,ee);D.currentDefaultsTitle&&(D.currentDefaultsTitle.textContent=`${Q} / ${ee}`),D.defaultMeanYield&&(D.defaultMeanYield.value=t.meanYield),D.defaultBasePrice&&(D.defaultBasePrice.value=t.basePrice),D.defaultOpCost&&(D.defaultOpCost.value=t.opCost),D.defaultDroughtYield&&(D.defaultDroughtYield.value=t.droughtYield),D.defaultRcp45&&(D.defaultRcp45.value=t.baseYieldMultipliers.rcp45),D.defaultRcp85&&(D.defaultRcp85.value=t.baseYieldMultipliers.rcp85),Hh(t.yieldMultipliers)}function Nh(){const t={meanYield:parseFloat(D.defaultMeanYield?.value||0),basePrice:parseFloat(D.defaultBasePrice?.value||0),baseYieldType:"mean",variedYield:!1,annualIncrease:!1,annualIncreaseRate:1,droughtYield:parseFloat(D.defaultDroughtYield?.value||0),opCost:parseFloat(D.defaultOpCost?.value||0),baseYieldMultipliers:{rcp45:parseFloat(D.defaultRcp45?.value||0),rcp85:parseFloat(D.defaultRcp85?.value||0)},yieldMultipliers:oi()};Oi(Q,ee,t),$r()&&$t(),alert(`Default values for ${Q} / ${ee} have been saved.`)}function zh(){const t=qt(Q,ee);t.yieldMultipliers=oi(),Oi(Q,ee,t),$r()&&(window.yieldMultipliers=oi()),alert(`Yield multipliers for ${Q} / ${ee} have been saved.`)}function $r(){const t=document.getElementById("activeLocationSelect"),e=document.getElementById("activeCropSelect");return!t||!e?!1:t.value===Q&&e.value===ee}function Wh(){if(!D.yieldMultipliersContainer)return;const e=qt(Q,ee).yieldMultipliers,a=document.createElement("div");a.className="yield-multipliers-grid",Object.keys(e).sort().forEach(i=>{const n=document.createElement("div");n.className="yield-multiplier-item",n.innerHTML=`
      <label for="multiplier-${i}">${i}:</label>
      <input type="number" id="multiplier-${i}" value="${e[i]}" 
             min="0" max="3" step="0.01">
    `,a.appendChild(n)}),D.yieldMultipliersContainer.innerHTML="",D.yieldMultipliersContainer.appendChild(a)}function Hh(t){if(!document.querySelector(".yield-multipliers-grid")){Wh();return}Object.keys(t).sort().forEach(a=>{const i=document.getElementById(`multiplier-${a}`);i&&(i.value=t[a])})}function oi(){const t={};return document.querySelectorAll(".yield-multiplier-item input").forEach(e=>{const a=e.id.replace("multiplier-","");t[a]=parseFloat(e.value)}),t}function Vh(){const t=document.querySelector("#inputTab .card-header");if(t&&!document.getElementById("locationCropSelect")){const e=document.createElement("div");e.id="locationCropSelect",e.className="location-crop-select",e.style.marginBottom="15px",e.innerHTML=jh(),t.appendChild(e),qh()}}function jh(){return`
    <div style="display: flex; gap: 15px; align-items: center;">
      <div style="flex: 1;">
        <label for="activeLocationSelect" style="display: block; margin-bottom: 5px; font-weight: bold;">Location:</label>
        <select id="activeLocationSelect" style="width: 100%; padding: 8px; border: 1px solid #cbd5e0; border-radius: 4px;"></select>
      </div>
      <div style="flex: 1;">
        <label for="activeCropSelect" style="display: block; margin-bottom: 5px; font-weight: bold;">Crop:</label>
        <select id="activeCropSelect" style="width: 100%; padding: 8px; border: 1px solid #cbd5e0; border-radius: 4px;"></select>
      </div>
    </div>
  `}function qh(){const t=document.getElementById("activeLocationSelect"),e=document.getElementById("activeCropSelect");t&&e&&(Uh(),Gh(),t.addEventListener("change",()=>{Q=t.value,$t()}),e.addEventListener("change",()=>{ee=e.value,$t()}))}function Uh(){const t=document.getElementById("activeLocationSelect");if(!t)return;const e=Fi();t.innerHTML="",e.forEach(a=>{const i=document.createElement("option");i.value=a,i.textContent=a,t.appendChild(i)}),t.value=Q}function Gh(){const t=document.getElementById("activeCropSelect");if(!t)return;const e=$i();t.innerHTML="",e.forEach(a=>{const i=document.createElement("option");i.value=a,i.textContent=a,t.appendChild(i)}),t.value=ee}document.addEventListener("DOMContentLoaded",function(){ya(),setTimeout(()=>{$t()},500)});let Ze={profitDistribution:null,cumulativeMargin:null,performanceRadar:null};const Da=[{id:"profitableYearsPercent",category:"Risk Assessment",name:"Profitable Years",description:"Percentage of years with positive gross margin",unit:"%",higherIsBetter:!0,calculate:t=>{const e=t.length;return(t.filter(i=>parseFloat(i.grossMargin)>0).length/e*100).toFixed(1)}},{id:"consecutiveProfitableYears",category:"Risk Assessment",name:"Max Consecutive Profitable Years",description:"Longest streak of consecutive years with positive margins",unit:"years",higherIsBetter:!0,calculate:t=>{let e=0,a=0;return t.forEach(i=>{parseFloat(i.grossMargin)>0?(e++,a=Math.max(a,e)):e=0}),a}},{id:"marginVolatility",category:"Risk Assessment",name:"Margin Volatility",description:"Standard deviation of yearly gross margins",unit:"$",higherIsBetter:!1,calculate:t=>{const e=t.map(a=>parseFloat(a.grossMargin));return Kh(e).toFixed(2)}},{id:"roi",category:"Financial Performance",name:"Return on Investment",description:"Total cumulative margin divided by total costs over the period",unit:"%",higherIsBetter:!0,calculate:t=>{const e=parseFloat(t[t.length-1].cumulativeGrossMargin),a=t.reduce((i,n)=>i+parseFloat(n.costs),0);return a>0?(e/a*100).toFixed(1):"N/A"}},{id:"paybackPeriod",category:"Financial Performance",name:"Payback Period",description:"Years until cumulative margin turns positive",unit:"years",higherIsBetter:!1,calculate:t=>{for(let e=0;e<t.length;e++)if(parseFloat(t[e].cumulativeGrossMargin)>0)return e+1;return"Never"}},{id:"averageAnnualMargin",category:"Financial Performance",name:"Average Annual Margin",description:"Average gross margin per year",unit:"$",higherIsBetter:!0,calculate:t=>(t.reduce((a,i)=>a+parseFloat(i.grossMargin),0)/t.length).toFixed(2)},{id:"droughtImpact",category:"Climate Risk",name:"Drought Financial Impact",description:"Average reduction in margin during drought years vs. non-drought years",unit:"$",higherIsBetter:!1,calculate:(t,e)=>{if(!e.params.droughtYears||e.params.droughtYears.length===0)return"No droughts";const a=e.params.droughtYears.map(String),i=t.filter(s=>a.includes(String(s.year))),n=t.filter(s=>!a.includes(String(s.year)));if(i.length===0||n.length===0)return"N/A";const o=i.reduce((s,l)=>s+parseFloat(l.grossMargin),0)/i.length;return(n.reduce((s,l)=>s+parseFloat(l.grossMargin),0)/n.length-o).toFixed(2)}},{id:"climateScenarioImpact",category:"Climate Risk",name:"Climate Scenario Impact",description:"Shows performance relative to baseline based on selected climate scenario",unit:"%",higherIsBetter:!0,calculate:(t,e)=>{if(e.params.baseYieldType==="mean")return"Baseline";const a=e.params.baseYieldType;return a==="rcp45"?"-13%":a==="rcp85"?"-28%":"Unknown"}},{id:"breakEvenYield",category:"Strategic Planning",name:"Break-Even Yield",description:"Minimum yield needed to cover operational costs",unit:"t/ha",higherIsBetter:!1,calculate:(t,e)=>{const a=parseFloat(e.params.basePrice),i=parseFloat(e.params.opCost);return a<=0?"N/A":(i/a).toFixed(2)}},{id:"yieldSafetyMargin",category:"Strategic Planning",name:"Yield Safety Margin",description:"How much current yield exceeds break-even yield",unit:"%",higherIsBetter:!0,calculate:(t,e)=>{const a=parseFloat(e.params.basePrice),i=parseFloat(e.params.opCost),n=parseFloat(e.params.meanYield);if(a<=0||i<=0)return"N/A";const o=i/a;return o<=0?"N/A":((n/o-1)*100).toFixed(1)}},{id:"marginPerHectare",category:"Strategic Planning",name:"Average Margin per Hectare",description:"Average gross margin per hectare across all years",unit:"$/ha",higherIsBetter:!0,calculate:t=>(t.reduce((a,i)=>a+parseFloat(i.grossMargin),0)/t.length).toFixed(2)}];function Kh(t){const e=t.reduce((n,o)=>n+o,0)/t.length,i=t.map(n=>Math.pow(n-e,2)).reduce((n,o)=>n+o,0)/t.length;return Math.sqrt(i)}let rt,st;const ge=["#38A169","#3182CE","#805AD5","#DD6B20","#E53E3E"];function Xh(){if(document.querySelector('.tab[data-tab="metrics"]'))return;const t=document.createElement("button");t.className="tab",t.setAttribute("data-tab","metrics"),t.textContent="Metric Comparisons";const e=document.querySelector('.tab[data-tab="comparison"]');e&&(e.parentNode.insertBefore(t,e.nextSibling),t.addEventListener("click",function(){document.querySelectorAll(".tab").forEach(n=>n.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(n=>n.classList.remove("active")),t.classList.add("active"),document.getElementById("metricsTab").classList.add("active"),Nr()}));const a=document.createElement("div");a.id="metricsTab",a.className="tab-content",a.innerHTML=`
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">Profile Metrics Comparison</h2>
        <div class="comparison-actions">
          <!-- Will be populated with buttons by JavaScript -->
        </div>
      </div>
      <div class="card-content">
        <div id="noMetricsMessage">Select profiles to compare in the Profiles tab by clicking "Manage Comparison".</div>
        <div id="metricsContent" style="display: none;">
          <!-- Will be populated with metrics by JavaScript -->
        </div>
      </div>
    </div>
  `;const i=document.querySelector(".tab-contents-container")||document.querySelector(".container");i&&i.appendChild(a),Jh()}function Jh(){if(document.getElementById("enhanced-metrics-styles"))return;const t=document.createElement("style");t.id="enhanced-metrics-styles",t.textContent=`
    /* Using variables from the main stylesheet for consistency */
    #metricsTab .card-content {
      padding: 20px;
      overflow-y: auto; /* Enable scrolling */
      max-height: 85vh; /* Limit height to ensure scrolling works */
    }
    
    .metrics-dashboard {
      display: flex;
      flex-direction: column;
      gap: 40px;
      padding-bottom: 100px;
    }
    
    .dashboard-header {
      background-color: #f8fafc;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }
    
    .dashboard-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--primary-dark);
      margin-bottom: 8px;
    }
    
    .dashboard-description {
      color: var(--secondary);
      font-size: 0.9rem;
    }
    
    /* Improved chart section styling */
    .chart-section {
      margin-bottom: 60px;
      position: relative;
      clear: both;
      border: 1px solid #edf2f7;
      border-radius: 8px;
      padding: 20px;
      background-color: white;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      overflow: visible; /* Ensure content doesn't get clipped */
    }
    
    /* Ensure each chart has its own space */
    #profitDistributionSection {
      margin-bottom: 80px;
      min-height: 450px;
      padding-bottom: 40px; /* Extra padding at bottom */
    }
    
    #cumulativeMarginSection {
      margin-bottom: 80px;
      min-height: 450px;
      padding-bottom: 40px; /* Extra padding at bottom */
    }
    
    #performanceRadarSection {
      margin-bottom: 120px; /* Increased bottom margin */
      min-height: 560px; /* Increased height */
      padding-bottom: 60px; /* Extra padding at bottom */
    }
    
    .chart-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary-dark);
      margin-bottom: 15px;
      text-align: center;
    }
    
    .chart-container {
      position: relative;
      width: 100%;
      height: 400px;
      margin-bottom: 30px; /* Add margin below chart container */
    }
    
    .radar-container {
      height: 480px; /* Increased height */
      margin-bottom: 40px; /* Extra margin for radar */
    }
    
    /* Make canvas take up full container height */
    canvas#performanceRadarChart {
      max-height: 100% !important;
    }
    
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
      gap: 24px;
      margin: 30px 0;
    }
    
    @media (max-width: 768px) {
      .metrics-grid {
        grid-template-columns: 1fr;
      }
      
      .chart-container {
        height: 300px;
      }
      
      .radar-container {
        height: 400px;
      }
    }
    
    .metrics-category {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }
    
    .category-header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      font-size: 1.1rem;
      font-weight: 600;
      color: white;
    }
    
    .risk-header {
      background-color: #38A169;
    }
    
    .financial-header {
      background-color: #3182CE;
    }
    
    .climate-header {
      background-color: #805AD5;
    }
    
    .strategic-header {
      background-color: #DD6B20;
    }
    
    .metrics-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .metrics-table th {
      text-align: left;
      padding: 10px 12px;
      background-color: #f8fafc;
      border-bottom: 1px solid var(--border);
      font-weight: 600;
      color: var(--primary-dark);
    }
    
    .metrics-table td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
    }
    
    .metrics-table tr:nth-child(even) td {
      background-color: #f8fafc;
    }
    
    .metric-name {
      font-weight: 600;
      color: var(--dark);
    }
    
    .metric-description {
      font-size: 0.8rem;
      color: var(--secondary);
    }
    
    .value-positive {
      color: var(--success);
    }
    
    .value-negative {
      color: var(--danger);
    }
    
    .value-neutral {
      color: var(--secondary);
    }
    
    .best-value {
      font-weight: 700;
    }

    /* Legend styling */
    .chart-legend {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 16px;
      margin: 15px 0;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.9rem;
    }
    
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
    }
    
    /* Add dividers between sections */
    .section-divider {
      height: 2px;
      background-color: var(--border);
      margin: 40px 0; /* Increased margin */
      width: 100%;
    }
  `,document.head.appendChild(t)}function Zh(){Object.values(Ze).forEach(t=>{t&&t.destroy()}),Ze={profitDistribution:null,cumulativeMargin:null,performanceRadar:null}}function Nr(){if((!rt||!st)&&(rt=document.getElementById("noMetricsMessage"),st=document.getElementById("metricsContent"),!rt||!st))return;Zh();const t=window.getComparisonIds?window.getComparisonIds():[];if(t.length===0){rt.style.display="block",st.style.display="none";return}rt.style.display="none",st.style.display="block";const e=window.getProfileById||function(){return null},a=t.map(o=>e(o)).filter(Boolean),i=window.updateProfile||function(){return!1},n=a.map(o=>{if(o.yearlyResults)return o.yearlyResults;{if(!window.calculateResults)return console.error("calculateResults function not available"),[];const r=window.calculateResults({basePrice:0,baseYield:0,opCost:0},o.params);return i(o.id,{yearlyResults:r}),r}});Qh(a,n),rf()}function Qh(t,e){const a=document.getElementById("metricsContent");if(!a)return;a.innerHTML="";const i=document.createElement("div");i.className="metrics-dashboard";const n=document.createElement("div");n.className="dashboard-header",n.innerHTML=`
    <h2 class="dashboard-title">Metrics Comparison Dashboard</h2>
    <p class="dashboard-description">
      Compare key metrics across ${t.length} selected profiles to identify strengths and opportunities.
    </p>
  `,i.appendChild(n);const o=document.createElement("div");o.id="profitDistributionSection",o.className="chart-section",o.innerHTML=`
    <h3 class="chart-title">Yearly Profit Distribution</h3>
    <div class="chart-container">
      <canvas id="profitDistributionChart"></canvas>
    </div>
    <div id="profitDistributionLegend" class="chart-legend"></div>
  `,i.appendChild(o);const r=document.createElement("div");r.id="cumulativeMarginSection",r.className="chart-section",r.innerHTML=`
    <h3 class="chart-title">Cumulative Margin Over Time</h3>
    <div class="chart-container">
      <canvas id="cumulativeMarginChart"></canvas>
    </div>
    <div id="cumulativeMarginLegend" class="chart-legend"></div>
  `,i.appendChild(r);const s=document.createElement("div");s.className="section-divider",i.appendChild(s);const l=document.createElement("div");l.className="metrics-grid";const c={};Da.forEach(u=>{c[u.category]||(c[u.category]=[]),c[u.category].push(u)}),Object.keys(c).forEach(u=>{const h=tf(u,c[u],t,e);l.appendChild(h)}),i.appendChild(l);const d=document.createElement("div");d.className="section-divider",i.appendChild(d);const p=document.createElement("div");p.id="performanceRadarSection",p.className="chart-section",p.innerHTML=`
    <h3 class="chart-title">Performance Radar</h3>
    <div style="position: relative; padding-top: 20px;">
      <div class="chart-container radar-container">
        <canvas id="performanceRadarChart"></canvas>
      </div>
    </div>
  `,i.appendChild(p),a.appendChild(i),ef(t),requestAnimationFrame(()=>{af(t,e),setTimeout(()=>{nf(t,e),setTimeout(()=>{of(t,e)},100)},100)})}function ef(t){const e=document.getElementById("profitDistributionLegend");e&&t.forEach((i,n)=>{const o=ge[n%ge.length],r=document.createElement("div");r.className="legend-item",r.innerHTML=`
        <div class="legend-color" style="background-color: ${o};"></div>
        <span>${i.name}</span>
      `,e.appendChild(r)});const a=document.getElementById("cumulativeMarginLegend");a&&t.forEach((i,n)=>{const o=ge[n%ge.length],r=document.createElement("div");r.className="legend-item",r.innerHTML=`
        <div class="legend-color" style="background-color: ${o};"></div>
        <span>${i.name}</span>
      `,a.appendChild(r)})}function tf(t,e,a,i){const n=document.createElement("div");n.className="metrics-category";let o="category-header";switch(t){case"Risk Assessment":o+=" risk-header";break;case"Financial Performance":o+=" financial-header";break;case"Climate Risk":o+=" climate-header";break;case"Strategic Planning":o+=" strategic-header";break}const r=document.createElement("div");r.className=o,r.innerHTML=`<h3>${t}</h3>`,n.appendChild(r);const s=document.createElement("table");s.className="metrics-table";const l=document.createElement("thead"),c=document.createElement("tr");c.innerHTML="<th>Metric</th>",a.forEach(p=>{const u=p.location&&p.crop?`<br><span style="font-size: 12px; font-weight: normal;">${p.location} / ${p.crop}</span>`:"";c.innerHTML+=`<th>${p.name}${u}</th>`}),l.appendChild(c),s.appendChild(l);const d=document.createElement("tbody");return e.forEach(p=>{const u=document.createElement("tr");u.innerHTML=`
      <td>
        <div class="metric-name">${p.name}</div>
        <div class="metric-description">${p.description}</div>
      </td>
    `;const h=a.map((m,_)=>{const g=p.calculate(i[_],m);return{profile:m.name,value:g,isNumeric:!isNaN(parseFloat(g))&&g!=="N/A"&&g!=="Never"&&g!=="Baseline"}});let f=null;h.some(m=>m.isNumeric)&&(f=h.reduce((m,_)=>{if(!_.isNumeric)return m;const g=parseFloat(_.value);return m===null?g:p.higherIsBetter?Math.max(m,g):Math.min(m,g)},null)),h.forEach(m=>{let _="value-neutral",g=!1;if(m.isNumeric){const w=parseFloat(m.value);g=w===f,p.higherIsBetter?_=w>0?"value-positive":"value-negative":_=w<0?"value-positive":"value-negative"}const b=g?"best-value":"";u.innerHTML+=`
        <td class="${_} ${b}">
          ${m.value}${p.unit?` ${p.unit}`:""}
        </td>
      `}),d.appendChild(u)}),s.appendChild(d),n.appendChild(s),n}function af(t,e){const a=document.getElementById("profitDistributionChart");if(!a)return;const i=a.getContext("2d");if(!i)return;const n=e[0].map(r=>r.year),o=t.map((r,s)=>{const l=ge[s%ge.length];return{label:r.name,data:e[s].map(c=>parseFloat(c.grossMargin)),backgroundColor:l,borderColor:l,borderWidth:1}});try{Ze.profitDistribution=new Chart(i,{type:"bar",data:{labels:n,datasets:o},options:{plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(r){const s=r.raw;return`${r.dataset.label}: ${s.toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0})}`}}}},responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Year"}},y:{title:{display:!0,text:"Gross Margin ($)"},ticks:{callback:function(r){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",notation:"compact",compactDisplay:"short"}).format(r)}}}}}})}catch(r){console.error("Error creating profit distribution chart:",r)}}function nf(t,e){const a=document.getElementById("cumulativeMarginChart");if(!a)return;const i=a.getContext("2d");if(!i)return;const n=t.map((o,r)=>{const s=ge[r%ge.length];return{label:o.name,data:e[r].map(l=>({x:l.year,y:parseFloat(l.cumulativeGrossMargin)})),borderColor:s,backgroundColor:s+"20",borderWidth:2,fill:!1,tension:.1}});try{Ze.cumulativeMargin=new Chart(i,{type:"line",data:{datasets:n},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{type:"linear",position:"bottom",title:{display:!0,text:"Year"},min:2026,max:2050},y:{title:{display:!0,text:"Cumulative Margin ($)"},ticks:{callback:function(o){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",notation:"compact",compactDisplay:"short"}).format(o)}}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(o){const r=o.parsed.y;return`${o.dataset.label}: ${new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r)}`}}}}}})}catch(o){console.error("Error creating cumulative margin chart:",o)}}function of(t,e){console.log("Creating performance radar chart"),setTimeout(()=>{const a=document.getElementById("performanceRadarChart");if(!a){console.error("Performance radar canvas not found");return}const i=document.getElementById("performanceRadarSection");i&&(i.style.display="block",i.style.minHeight="500px");const n=a.getContext("2d");if(!n){console.error("Could not get canvas context for radar chart");return}const o=[{id:"profitableYearsPercent",label:"Profitable Years",max:100},{id:"roi",label:"Return on Investment",max:50},{id:"paybackPeriod",label:"Payback Period",max:15,invert:!0},{id:"marginVolatility",label:"Margin Stability",max:500,invert:!0},{id:"yieldSafetyMargin",label:"Yield Safety",max:100}],r=[];for(let s=0;s<t.length;s++){const l=t[s],c=e[s],d=ge[s%ge.length],p=[];for(const u of o){const h=Da.find(m=>m.id===u.id);if(!h){p.push(0);continue}let f;try{f=h.calculate(c,l),isNaN(parseFloat(f))||f==="N/A"||f==="Never"||f==="Baseline"?f=0:(f=parseFloat(f),u.invert?f=Math.max(0,(u.max-f)/u.max*100):f=Math.min(100,Math.max(0,f/u.max*100)))}catch(m){console.error(`Error calculating metric ${u.id}:`,m),f=0}p.push(f)}r.push({label:l.name,data:p,backgroundColor:d+"40",borderColor:d,pointBackgroundColor:d,pointHoverBackgroundColor:"#fff",pointHoverBorderColor:d})}console.log("Radar data prepared:",r);try{Ze.performanceRadar&&Ze.performanceRadar.destroy(),Ze.performanceRadar=new Chart(n,{type:"radar",data:{labels:o.map(s=>s.label),datasets:r},options:{plugins:{legend:{position:"top",labels:{font:{size:12}}}},scales:{r:{min:0,max:100,ticks:{stepSize:20}}},responsive:!0,maintainAspectRatio:!1}}),console.log("Performance radar chart created successfully")}catch(s){console.error("Error creating performance radar chart:",s)}},300)}function rf(){const t=document.querySelector("#metricsTab .comparison-actions");if(!t)return;t.innerHTML="";const e=document.createElement("button");e.id="manageMetricsComparisonBtn",e.className="secondary",e.textContent="Manage Comparison",e.addEventListener("click",()=>{window.openComparisonModal?window.openComparisonModal():console.error("openComparisonModal function not available")}),t.appendChild(e);const a=document.createElement("button");a.id="exportMetricsCsvBtn",a.className="secondary",a.textContent="Export CSV",a.style.marginLeft="10px",a.addEventListener("click",sf),t.appendChild(a);const i=document.createElement("button");i.id="exportMetricsPdfBtn",i.className="secondary",i.textContent="Export PDF",i.style.marginLeft="10px",i.addEventListener("click",lf),t.appendChild(i)}function sf(){const t=window.getComparisonIds?window.getComparisonIds():[];if(t.length===0){alert("No profiles selected for comparison. Please select profiles first.");return}const e=t.map(l=>window.getProfileById?window.getProfileById(l):null).filter(Boolean),a=e.map(l=>{if(l.yearlyResults)return l.yearlyResults;{if(!window.calculateResults)return console.error("calculateResults function not available"),[];const c=window.calculateResults({basePrice:0,baseYield:0,opCost:0},l.params);return window.updateProfile&&window.updateProfile(l.id,{yearlyResults:c}),c}});let i="data:text/csv;charset=utf-8,";const n=e.map(l=>{const c=l.location&&l.crop?` (${l.location}/${l.crop})`:"";return l.name+c});i+="Metric Comparison Data,Description,"+n.join(",")+`

`;const o={};Da.forEach(l=>{o[l.category]||(o[l.category]=[]),o[l.category].push(l)}),Object.keys(o).forEach(l=>{i+=l+`
`,o[l].forEach(c=>{const d=e.map((p,u)=>c.calculate(a[u],p).toString().replace(/,/g,""));i+=`${c.name},${c.description},${d.join(",")}
`}),i+=`
`});const r=encodeURI(i),s=document.createElement("a");s.setAttribute("href",r),s.setAttribute("download","metrics_comparison.csv"),document.body.appendChild(s),s.click(),document.body.removeChild(s)}function lf(){const t=window.getComparisonIds?window.getComparisonIds():[];if(t.length===0){alert("No profiles selected for comparison. Please select profiles first.");return}const e=t.map(o=>window.getProfileById?window.getProfileById(o):null).filter(Boolean),a=e.map(o=>{if(o.yearlyResults)return o.yearlyResults;{if(!window.calculateResults)return console.error("calculateResults function not available"),[];const r=window.calculateResults({basePrice:0,baseYield:0,opCost:0},o.params);return window.updateProfile&&window.updateProfile(o.id,{yearlyResults:r}),r}}),i=window.open("","_blank","width=800,height=600");if(!i){alert("Please allow pop-ups to use this feature.");return}i.document.write(`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Agricultural Calculator - Metrics Report</title>
      <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; line-height: 1.6; color: #333; margin: 20px; }
        h1 { color: #2f855a; text-align: center; margin-bottom: 20px; }
        h2 { color: #2f855a; border-bottom: 1px solid #e2e8f0; padding-bottom: 5px; margin-top: 25px; }
        .report-date { text-align: center; color: #718096; margin-bottom: 30px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #e2e8f0; padding: 8px; text-align: left; }
        th { background-color: #f1f5f9; font-weight: bold; }
        tr:nth-child(even) { background-color: #f8fafc; }
        .category-header { background-color: #edf2f7; font-weight: bold; font-size: 16px; }
        .metric-description { color: #718096; font-size: 12px; }
        .positive { color: #38a169; }
        .negative { color: #e53e3e; }
        .neutral { color: #4a5568; }
        .best-value { font-weight: bold; }
        .chart-container { margin: 20px 0; height: 300px; }
        @media print {
          body { font-size: 11pt; }
          h1 { font-size: 18pt; }
          h2 { font-size: 14pt; }
          .page-break { page-break-before: always; }
        }
      </style>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"><\/script>
    </head>
    <body>
      <h1>Agricultural Calculator</h1>
      <div class="report-date">Metrics Comparison Report - ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}</div>
  `),i.document.write(`
    <h2>Profiles Included in Comparison</h2>
    <table>
      <tr>
        <th>Profile Name</th>
        <th>Location</th>
        <th>Crop</th>
        <th>Mean Yield (t/ha)</th>
        <th>Base Price ($/t)</th>
        <th>Final Margin ($)</th>
      </tr>
  `),e.forEach(o=>{i.document.write(`
      <tr>
        <td>${o.name}</td>
        <td>${o.location||"N/A"}</td>
        <td>${o.crop||"N/A"}</td>
        <td>${o.params.meanYield}</td>
        <td>${o.params.basePrice}</td>
        <td>${parseFloat(o.results.finalCumulativeMargin).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}</td>
      </tr>
    `)}),i.document.write("</table>"),i.document.write(`
    <h2>Performance Charts</h2>
    <div id="cumulativeMarginContainer" class="chart-container">
      <canvas id="cumulativeMarginChart"></canvas>
    </div>
    
    <div id="profitDistributionContainer" class="chart-container">
      <canvas id="profitDistributionChart"></canvas>
    </div>
  `);const n={};Da.forEach(o=>{n[o.category]||(n[o.category]=[]),n[o.category].push(o)}),Object.keys(n).forEach(o=>{i.document.write(`<h2>${o} Metrics</h2>`),i.document.write(`
      <table>
        <tr>
          <th>Metric</th>
          <th>Description</th>
    `),e.forEach(r=>{i.document.write(`<th>${r.name}</th>`)}),i.document.write("</tr>"),n[o].forEach(r=>{i.document.write("<tr>"),i.document.write(`<td>${r.name}</td>`),i.document.write(`<td class="metric-description">${r.description}</td>`);const s=e.map((c,d)=>({value:r.calculate(a[d],c),unit:r.unit}));let l=null;s.length>0&&!isNaN(parseFloat(s[0].value))&&(l=s.reduce((c,d)=>{if(isNaN(parseFloat(d.value)))return c;const p=parseFloat(d.value);return c===null?p:r.higherIsBetter?Math.max(c,p):Math.min(c,p)},null)),s.forEach(c=>{const d=!isNaN(parseFloat(c.value));let p="neutral";d?(r.higherIsBetter?p=parseFloat(c.value)>0?"positive":"negative":p=parseFloat(c.value)<0?"positive":"negative",d&&parseFloat(c.value)===l?i.document.write(`<td class="${p} best-value">${c.value}${c.unit?" "+c.unit:""}</td>`):i.document.write(`<td class="${p}">${c.value}${c.unit?" "+c.unit:""}</td>`)):i.document.write(`<td>${c.value}</td>`)}),i.document.write("</tr>")}),i.document.write("</table>")}),i.document.write(`
    <script>
      // Wait for page to load
      window.onload = function() {
        // Prepare data for charts
        const profiles = ${JSON.stringify(e.map(o=>({name:o.name,location:o.location,crop:o.crop})))};
        
        const profileResults = ${JSON.stringify(a)};
        
        // Define colors for profiles
        const profileColors = [
          '#38A169', // green
          '#3182CE', // blue
          '#805AD5', // purple
          '#DD6B20', // orange
          '#E53E3E'  // red
        ];
        
        // Create cumulative margin chart
        const cumulativeMarginCtx = document.getElementById('cumulativeMarginChart').getContext('2d');
        
        // Prepare datasets for line chart
        const cumulativeDatasets = profiles.map((profile, index) => {
          const color = profileColors[index % profileColors.length];
          
          return {
            label: profile.name,
            data: profileResults[index].map(result => ({
              x: result.year,
              y: parseFloat(result.cumulativeGrossMargin)
            })),
            borderColor: color,
            backgroundColor: color + '20',
            borderWidth: 2,
            fill: false,
            tension: 0.1
          };
        });
        
        new Chart(cumulativeMarginCtx, {
          type: 'line',
          data: {
            datasets: cumulativeDatasets
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                type: 'linear',
                position: 'bottom',
                title: {
                  display: true,
                  text: 'Year'
                },
                min: 2026,
                max: 2050
              },
              y: {
                title: {
                  display: true,
                  text: 'Cumulative Margin ($)'
                },
                ticks: {
                  callback: function(value) {
                    return new Intl.NumberFormat('en-US', {
                      style: 'currency',
                      currency: 'USD',
                      notation: 'compact',
                      compactDisplay: 'short'
                    }).format(value);
                  }
                }
              }
            },
            plugins: {
              title: {
                display: true,
                text: 'Cumulative Margin Over Time',
                font: { size: 16 }
              }
            }
          }
        });
        
        // Create profit distribution chart
        const profitDistributionCtx = document.getElementById('profitDistributionChart').getContext('2d');
        
        // Prepare datasets for bar chart
        const years = profileResults[0].map(result => result.year);
        const profitDatasets = profiles.map((profile, index) => {
          const color = profileColors[index % profileColors.length];
          
          return {
            label: profile.name,
            data: profileResults[index].map(result => parseFloat(result.grossMargin)),
            backgroundColor: color,
            borderColor: color,
            borderWidth: 1
          };
        });
        
        new Chart(profitDistributionCtx, {
          type: 'bar',
          data: {
            labels: years,
            datasets: profitDatasets
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                title: {
                  display: true,
                  text: 'Year'
                }
              },
              y: {
                title: {
                  display: true,
                  text: 'Gross Margin ($)'
                },
                ticks: {
                  callback: function(value) {
                    return new Intl.NumberFormat('en-US', {
                      style: 'currency',
                      currency: 'USD',
                      notation: 'compact',
                      compactDisplay: 'short'
                    }).format(value);
                  }
                }
              }
            },
            plugins: {
              title: {
                display: true,
                text: 'Yearly Profit Distribution',
                font: { size: 16 }
              }
            }
          }
        });
        
        // Trigger print after charts are rendered
        setTimeout(() => {
          window.print();
        }, 1000);
      };
    <\/script>
  `),i.document.write(`
    </body>
    </html>
  `),i.document.close()}function bo(){Xh(),document.getElementById("metricsTab"),rt=document.getElementById("noMetricsMessage"),st=document.getElementById("metricsContent")}function Re(t,e={},a=null){const i=document.querySelector("#yearlyTab .card-content");if(!i)return;let n=document.getElementById("yearlyProfileSummary");if(!n){n=document.createElement("div"),n.id="yearlyProfileSummary",n.className="profile-summary elevation-1";const d=i.querySelector(".table-responsive");d&&i.insertBefore(n,d),cf()}const o=document.getElementById("activeLocationSelect"),r=document.getElementById("activeCropSelect"),s=o?o.value:null,l=r?r.value:null,c=uf();if(n.innerHTML=`
      <div class="profile-summary-header">
        <div class="profile-title">
          <i class="fas fa-sliders-h"></i>
          <h3>${a||"Current Parameters"}</h3>
          ${s&&l?`<div class="profile-location-crop">${s} / ${l}</div>`:""}
        </div>
        ${c!==null?`
          <div class="profile-margin ${parseFloat(c)>=0?"positive":"negative"}">
            Final Margin: <span>${hf(c)}</span>
          </div>
        `:""}
      </div>
      <div class="profile-summary-body">
        <div class="param-group-container">
          <!-- Financial Parameters -->
          <div class="param-group">
            <div class="param-group-header finance-gradient">
              <i class="fas fa-coins"></i> Financial
            </div>
            <div class="param-group-content">
              <div class="param-item">
                <span class="param-label">Base Price:</span> 
                <span class="param-value">$${t.basePrice||0}</span>
              </div>
              <div class="param-item">
                <span class="param-label">Operational Cost:</span> 
                <span class="param-value">$${t.opCost||0}</span>
              </div>
            </div>
          </div>
          
          <!-- Yield Parameters -->
          <div class="param-group">
            <div class="param-group-header yield-gradient">
              <i class="fas fa-seedling"></i> Yield
            </div>
            <div class="param-group-content">
              <div class="param-item">
                <span class="param-label">Mean Yield:</span> 
                <span class="param-value">${t.meanYield||0} t/ha</span>
              </div>
              <div class="param-item">
                <span class="param-label">Yield Type:</span> 
                <span class="param-value">${pf(t.baseYieldType||"mean")}</span>
              </div>
            </div>
          </div>
          
          <!-- Adjustments -->
          <div class="param-group">
            <div class="param-group-header adjustment-gradient">
              <i class="fas fa-chart-line"></i> Adjustments
            </div>
            <div class="param-group-content">
              <div class="param-item">
                <span class="param-label">Varied Yield:</span> 
                <span class="param-value">${t.variedYield?"Yes":"No"}</span>
              </div>
              <div class="param-item">
                <span class="param-label">Annual Increase:</span> 
                <span class="param-value">${t.annualIncrease?`Yes (${t.annualIncreaseRate||0}%)`:"No"}</span>
              </div>
              <div class="param-item">
                <span class="param-label">Step Change:</span> 
                <span class="param-value">${t.stepChangeEnabled?`Yes, ${t.stepChangeAmount||0}% in ${t.stepChangeYear||0}`:"No"}</span>
              </div>
            </div>
          </div>
          
          <!-- Drought Settings -->
          <div class="param-group">
            <div class="param-group-header climate-gradient">
              <i class="fas fa-cloud-sun-rain"></i> Drought
            </div>
            <div class="param-group-content">
              <div class="param-item">
                <span class="param-label">Drought Yield:</span> 
                <span class="param-value">${t.droughtYield||0} t/ha</span>
              </div>
              <div class="param-item">
                <span class="param-label">Drought Years:</span> 
                <span class="param-value">${df(t.droughtYears)}</span>
              </div>
            </div>
          </div>
    `,(t.netWorthHa!==void 0||t.equityPercent!==void 0)&&(n.querySelector(".param-group-container").innerHTML+=`
        <!-- Financial Position Parameters -->
        <div class="param-group">
          <div class="param-group-header financial-gradient">
            <i class="fas fa-landmark"></i> Financial Position
          </div>
          <div class="param-group-content">
            <div class="param-item">
              <span class="param-label">Initial Net Worth:</span> 
              <span class="param-value">$${t.netWorthHa||1800}/ha</span>
            </div>
            <div class="param-item">
              <span class="param-label">Initial Equity:</span> 
              <span class="param-value">${t.equityPercent||69}%</span>
            </div>
            <div class="param-item">
              <span class="param-label">Land Appreciation:</span> 
              <span class="param-value">${t.landValueAppreciation?`${t.landAppreciationRate||1}%/year`:"No"}</span>
            </div>
          </div>
        </div>
      `),e){let d=`
      <div class="param-group">
        <div class="param-group-header sensitivity-gradient">
          <i class="fas fa-sliders-h"></i> Sensitivity Adjustments
        </div>
        <div class="param-group-content">
    `;e.basePrice||e.baseYield||e.opCost?(e.basePrice!==void 0&&(d+=`
          <div class="param-item">
            <span class="param-label">Price:</span> 
            <span class="param-value ${e.basePrice>0?"positive":e.basePrice<0?"negative":"neutral"}">${e.basePrice>0?"+":""}${e.basePrice}%</span>
          </div>
        `),e.baseYield!==void 0&&(d+=`
          <div class="param-item">
            <span class="param-label">Yield:</span> 
            <span class="param-value ${e.baseYield>0?"positive":e.baseYield<0?"negative":"neutral"}">${e.baseYield>0?"+":""}${e.baseYield}%</span>
          </div>
        `),e.opCost!==void 0&&(d+=`
          <div class="param-item">
            <span class="param-label">Op Cost:</span> 
            <span class="param-value ${e.opCost>0?"negative":e.opCost<0?"positive":"neutral"}">${e.opCost>0?"+":""}${e.opCost}%</span>
          </div>
        `)):d+=`
        <div class="param-item">
          <span class="param-label">Status:</span> 
          <span class="param-value neutral">No sensitivity adjustments</span>
        </div>
      `,d+=`
        </div>
      </div>
    `,n.querySelector(".param-group-container").innerHTML+=d}n.querySelector(".profile-summary-body").innerHTML+="</div>"}function cf(){if(document.getElementById("profile-summary-styles"))return;const t=document.createElement("style");t.id="profile-summary-styles",t.textContent=`
      /* Profile Summary Styling */
      .profile-summary {
        margin-bottom: 20px;
        background-color: white;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid var(--border);
      }
      
      .profile-summary-header {
        padding: 12px 15px;
        background-color: #f8fafc;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 12px;
      }
      
      .profile-title {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .profile-title h3 {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 600;
      }
      
      .profile-location-crop {
        font-size: 0.85rem;
        color: var(--secondary);
        margin-left: 5px;
      }
      
      .profile-margin {
        padding: 5px 10px;
        border-radius: 5px;
        background-color: #f5f7fa;
        font-weight: 600;
        font-size: 0.9rem;
      }
      
      .profile-margin.positive span {
        color: var(--success);
      }
      
      .profile-margin.negative span {
        color: var(--danger);
      }
      
      .profile-summary-body {
        padding: 15px;
      }
      
      .param-group-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
      }
      
      .param-group {
        border: 1px solid var(--border);
        border-radius: var(--radius);
        overflow: hidden;
      }
      
      .param-group-header {
        padding: 8px 12px;
        font-weight: 600;
        color: white;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .param-group-content {
        padding: 10px;
      }
      
      .param-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 0.85rem;
      }
      
      .param-item:last-child {
        margin-bottom: 0;
      }
      
      .param-label {
        font-weight: 500;
        color: var(--secondary);
        margin-right: 8px;
      }
      
      .param-value {
        font-weight: 600;
        text-align: right;
      }
      
      .param-value.positive {
        color: var(--success);
      }
      
      .param-value.negative {
        color: var(--danger);
      }
      
      @media (max-width: 768px) {
        .param-group-container {
          grid-template-columns: 1fr;
        }
        
        .profile-margin {
          margin-top: 5px;
        }
      }
    `,document.head.appendChild(t)}function df(t=[]){return!t||!Array.isArray(t)||t.length===0?"None":t.sort().join(", ")}function pf(t){return{mean:"Mean Yield",rcp45:"RCP 4.5",rcp85:"RCP 8.5"}[t]||t}function uf(){const t=document.getElementById("yearlyTable");if(t){const a=t.querySelectorAll("tbody tr");if(a.length>0){const n=a[a.length-1].querySelector("td:nth-child(6)");if(n)return n.textContent.trim().replace("$","").replace(/,/g,"")}}const e=document.getElementById("finalMarginValue");return e?e.textContent.trim().replace("$","").replace(/,/g,""):null}function hf(t){const e=typeof t=="string"?parseFloat(t):t;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function ff(){const t=window.loadParams;if(t&&(window.loadParams=function(i,n,o){t(i,n),Re(i,n,o)}),window.calculateAndDisplay){const i=window.calculateAndDisplay;window.calculateAndDisplay=function(){i();const n=ri(),o=si();Re(n,o)}}mf();const e=ri(),a=si();Re(e,a)}function mf(){const t=["#meanYield","#basePrice","#opCost","#droughtYield","#annualIncreaseRate","#stepChangeYear","#stepChangeAmount","#netWorthHa","#equityPercent","#landAppreciationRate","#criticalEquity","#baseYieldType","#variedYield","#variedYieldToggle","#annualIncrease","#annualIncreaseToggle","#stepChangeEnabled","#stepChangeEnabledToggle","#landValueAppreciation","#landValueAppreciationToggle","#basePriceSlider","#baseYieldSlider","#opCostSlider"],e=()=>{const o=ri(),r=si();Re(o,r)};t.forEach(o=>{const r=document.querySelector(o);r&&["input","change"].forEach(s=>{r.addEventListener(s,e)})});const a=document.getElementById("droughtYearsCheckboxes");a&&a.addEventListener("change",e);const i=document.getElementById("selectAllDroughtYears"),n=document.getElementById("clearAllDroughtYears");i&&i.addEventListener("click",e),n&&n.addEventListener("click",e)}function ri(){return{meanYield:parseFloat(document.getElementById("meanYield")?.value||1.4),basePrice:parseFloat(document.getElementById("basePrice")?.value||350),baseYieldType:document.getElementById("baseYieldType")?.value||"mean",variedYield:document.getElementById("variedYield")?.value==="true",annualIncrease:document.getElementById("annualIncrease")?.value==="true",annualIncreaseRate:parseFloat(document.getElementById("annualIncreaseRate")?.value||1),stepChangeEnabled:document.getElementById("stepChangeEnabled")?.value==="true",stepChangeYear:parseInt(document.getElementById("stepChangeYear")?.value||2041),stepChangeAmount:parseFloat(document.getElementById("stepChangeAmount")?.value||10),droughtYears:_f(),droughtYield:parseFloat(document.getElementById("droughtYield")?.value||.53),opCost:parseFloat(document.getElementById("opCost")?.value||400),netWorthHa:parseFloat(document.getElementById("netWorthHa")?.value||1800),equityPercent:parseFloat(document.getElementById("equityPercent")?.value||69),landValueAppreciation:document.getElementById("landValueAppreciation")?.value==="true",landAppreciationRate:parseFloat(document.getElementById("landAppreciationRate")?.value||1),criticalEquity:parseFloat(document.getElementById("criticalEquity")?.value||60)}}function _f(){const t=document.getElementById("droughtYearsCheckboxes");if(!t)return[];const e=[];return t.querySelectorAll('input[type="checkbox"]:checked').forEach(i=>{e.push(parseInt(i.value))}),e}function si(){const t={},e={basePrice:document.getElementById("basePriceSlider"),baseYield:document.getElementById("baseYieldSlider"),opCost:document.getElementById("opCostSlider")};return Object.keys(e).forEach(a=>{e[a]?t[a]=parseInt(e[a].value||0):t[a]=0}),t}if(window.loadProfileParams){const t=window.loadProfileParams;window.loadProfileParams=function(e){const a=window.getProfileById?window.getProfileById(e):null;a?(t(e),setTimeout(()=>{Re(a.params||{},a.sensitivities||{},a.name)},100)):t(e)}}function gf(){const t=document.getElementById("yearlyProfileSummary");if(!t)return;t.querySelectorAll(".param-group").forEach(a=>{const i=a.querySelector(".param-group-header");if(i&&!i.classList.contains("clickable-header")){if(i.classList.add("clickable-header"),i.title="Click to edit in sidebar",!document.getElementById("param-clickable-styles")){const n=document.createElement("style");n.id="param-clickable-styles",n.textContent=`
          /* Hint for clickable headers in profile summary */
          .param-group-header.clickable-header {
            position: relative;
            cursor: pointer !important;
          }
          
          .param-group-header.clickable-header:after {
            content: "\\f085";
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
            position: absolute;
            right: 10px;
            opacity: 0;
            transition: opacity 0.2s;
            color: rgba(255, 255, 255, 0.8);
          }
          
          .param-group-header.clickable-header:hover:after {
            opacity: 0.8;
          }
        `,document.head.appendChild(n)}i.addEventListener("click",function(){let n="",o="";i.classList.contains("finance-gradient")?(n="finance",o="Price & Costs"):i.classList.contains("yield-gradient")?(n="yield",o="Yield Settings"):i.classList.contains("adjustment-gradient")?(n="adjustment",o="Yield Adjustments"):i.classList.contains("climate-gradient")?(n="climate",o="Drought Settings"):i.classList.contains("financial-gradient")?(n="financial",o="Financial Position"):i.classList.contains("sensitivity-gradient")&&(n="sensitivity",o="Sensitivity Adjustments"),window.displaySectionInSidebar&&window.displaySectionInSidebar(n,o,i.className)})}})}const bf=Re;Re=function(...t){bf(...t),setTimeout(gf,50)};window.displaySectionInSidebar=function(t,e,a){console.log("Request to display section:",t,e)};window.updateProfileSummary=Re;function vf(){wf();const t=document.querySelector(".sidebar-content .nav-section:nth-child(2)");if(!t)return;const e=document.createElement("div");e.className="nav-section sidebar-editable-section",e.style.display="none",t.parentNode.insertBefore(e,t),window.displaySectionInSidebar=function(a,i,n){yf(a,i,n,e)}}function wf(){if(document.getElementById("sidebar-editor-styles"))return;const t=document.createElement("style");t.id="sidebar-editor-styles",t.textContent=`
     /* Sidebar Editable Section Styles */
        .sidebar-editable-section {
        margin-bottom: 20px;
        background-color: white;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid var(--border);
        }
  
        .sidebar-editable-section .nav-heading {
        padding: 12px 15px;
        background-color: #f8fafc;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 12px;
        }
  
        .sidebar-close-btn {
        background: none;
        border: none;
        color: var(--secondary);
        cursor: pointer;
        font-size: 14px;
        }
  
        .sidebar-close-btn:hover {
        color: var(--primary-dark);
        }
  
        .sidebar-editable-content {
        padding: 15px;
        }
  
        .sidebar-section-header {
        padding: 8px 12px;
        font-weight: 600;
        color: white;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
        }
  
        .sidebar-input-wrapper {
        margin-bottom: 12px;
        }
  
        .sidebar-input-wrapper label {
        display: block;
        color: var(--secondary);
        font-size: 0.85rem;
        margin-bottom: 5px;
        font-weight: 500;
        }
  
        .sidebar-input-wrapper input,
        .sidebar-input-wrapper select {
        width: 100%;
        padding: 8px;
        background-color: #f5f7fa;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--primary-dark);
        font-size: 0.9rem;
        }
  
        .sidebar-input-wrapper input:focus,
        .sidebar-input-wrapper select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 1px var(--primary);
        }
  
        /* Drought year controls */
        .sidebar-drought-note {
        color: var(--secondary);
        font-size: 0.85rem;
        margin-top: 15px;
        }
  
        .sidebar-drought-buttons {
        display: flex;
        gap: 8px;
        margin-top: 8px;
        }
  
        .sidebar-btn {
        padding: 6px 10px;
        font-size: 0.85rem;
        background-color: #f5f7fa;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--primary-dark);
        cursor: pointer;
        transition: background-color 0.2s ease;
        }
  
        .sidebar-btn:hover {
        background-color: #edf2f7;
        }
  
        /* Ensure consistent styling for options */
        .sidebar-input-wrapper option {
        background-color: white;
        color: var(--primary-dark);
        }
  
        /* Number input spinner styling */
        .sidebar-input-wrapper input[type=number]::-webkit-inner-spin-button,
        .sidebar-input-wrapper input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
        }
  
        .sidebar-input-wrapper input[type=number] {
        -moz-appearance: textfield;
        }
  
        /* NEW: Drought years selector styling */
        .sidebar-drought-years-container {
          max-height: 150px;
          overflow-y: auto;
          border: 1px solid var(--border);
          border-radius: var(--radius);
          padding: 8px;
          background-color: #f5f7fa;
          margin-bottom: 8px;
        }
  
        .sidebar-drought-year-item {
          display: flex;
          align-items: center;
          margin-bottom: 5px;
        }
  
        .sidebar-drought-year-item:last-child {
          margin-bottom: 0;
        }
  
        .sidebar-drought-year-item input[type="checkbox"] {
          margin-right: 8px;
        }
  
        .sidebar-drought-year-item label {
          font-size: 0.85rem;
          cursor: pointer;
          display: inline;
          margin-bottom: 0;
        }
  
        /* Responsive adjustments */
        @media (max-width: 768px) {
        .sidebar-editable-section .nav-heading {
            flex-direction: column;
            align-items: flex-start;
        }
        }
    `,document.head.appendChild(t)}function yf(t,e,a,i){let n="yield-gradient";if(typeof a=="string"){const c=a.split(" ");for(const d of c)if(d.endsWith("-gradient")){n=d;break}}const o=document.querySelector(".sidebar");o&&window.innerWidth<1024&&(o.classList.add("sidebar-visible"),document.body.classList.add("sidebar-open")),i.innerHTML="";const r=document.createElement("h3");r.className="nav-heading",r.innerHTML=`
      <span>EDIT PARAMETERS</span>
      <button class="sidebar-close-btn"><i class="fas fa-times"></i></button>
    `,i.appendChild(r),r.querySelector(".sidebar-close-btn").addEventListener("click",function(){i.style.display="none"});const s=document.createElement("div");s.className=`sidebar-section-header ${n}`,s.innerHTML=`<i class="fas fa-sliders-h"></i> ${e}`,i.appendChild(s);const l=document.createElement("div");switch(l.className="sidebar-editable-content",i.appendChild(l),t){case"finance":xf(l);break;case"yield":Cf(l);break;case"adjustment":Mf(l);break;case"climate":Sf(l);break;case"financial":Ef(l);break;case"sensitivity":kf(l);break}i.style.display="block"}function X(t,e="number",a={}){const i=document.getElementById(t);if(!i)return null;const n=document.querySelector(`label[for="${t}"]`),o=a.label||(n?n.textContent.trim():t),r=document.createElement("div");r.className="sidebar-input-wrapper";const s=document.createElement("label");s.textContent=o,r.appendChild(s);let l;if(e==="select")l=document.createElement("select"),a.options?a.options.forEach(c=>{const d=document.createElement("option");d.value=c.value,d.textContent=c.text,l.appendChild(d)}):i.tagName==="SELECT"&&Array.from(i.options).forEach(c=>{const d=document.createElement("option");d.value=c.value,d.textContent=c.textContent,l.appendChild(d)}),l.value=i.value,l.addEventListener("change",function(){i.value!==this.value&&(i.value=this.value,i.dispatchEvent(new Event("change",{bubbles:!0})))});else if(e==="toggle"){l=document.createElement("select"),l.innerHTML=`
        <option value="true">Yes</option>
        <option value="false">No</option>
      `;const c=document.getElementById(t);l.value=c.value,l.addEventListener("change",function(){if(c.value!==this.value){c.value=this.value,c.dispatchEvent(new Event("change",{bubbles:!0}));const d=`${t}Toggle`,p=document.getElementById(d);p&&(p.checked=this.value==="true")}})}else l=document.createElement("input"),l.type=e,a.min!==void 0&&(l.min=a.min),a.max!==void 0&&(l.max=a.max),a.step!==void 0&&(l.step=a.step),i.placeholder&&(l.placeholder=i.placeholder),l.value=i.value,l.addEventListener("input",function(){i.value!==this.value&&(i.value=this.value,i.dispatchEvent(new Event("input",{bubbles:!0})))});return r.appendChild(l),r}function xf(t){const e=X("basePrice","number",{label:"Base Price ($/tonne)",min:0,step:5}),a=X("opCost","number",{label:"Operational Cost ($/ha)",min:0,step:10});e&&t.appendChild(e),a&&t.appendChild(a)}function Cf(t){const e=X("meanYield","number",{label:"Mean Yield (t/ha)",min:0,step:.1}),a=X("baseYieldType","select");e&&t.appendChild(e),a&&t.appendChild(a)}function Mf(t){const e=X("variedYield","toggle",{label:"Varied Yield"}),a=X("annualIncrease","toggle",{label:"Annual Yield Increase"}),i=X("annualIncreaseRate","number",{label:"Annual Increase Rate (%)",min:0,max:10,step:.1}),n=X("stepChangeEnabled","toggle",{label:"Step Change Enabled"}),o=X("stepChangeYear","number",{label:"Step Change Year",min:2026,max:2050,step:1}),r=X("stepChangeAmount","number",{label:"Step Change Amount (%)",min:0,max:100,step:1});e&&t.appendChild(e),a&&t.appendChild(a),i&&t.appendChild(i),n&&t.appendChild(n),o&&t.appendChild(o),r&&t.appendChild(r)}function Sf(t){const e=X("droughtYield","number",{label:"Drought Yield (t/ha)",min:0,step:.01});e&&t.appendChild(e);const a=document.createElement("div");a.className="sidebar-input-wrapper";const i=document.createElement("label");i.textContent="Drought Years",a.appendChild(i);const n=document.createElement("div");n.className="sidebar-drought-years-container";const o=document.getElementById("droughtYearsCheckboxes");for(let c=2026;c<=2050;c++){const d=document.createElement("div");d.className="sidebar-drought-year-item";const p=document.createElement("input");if(p.type="checkbox",p.id=`sidebar-drought-year-${c}`,p.value=c,o){const h=o.querySelector(`input[value="${c}"]`);h&&(p.checked=h.checked,p.addEventListener("change",function(){h.checked=this.checked,h.dispatchEvent(new Event("change",{bubbles:!0}))}))}const u=document.createElement("label");u.htmlFor=`sidebar-drought-year-${c}`,u.textContent=c,d.appendChild(p),d.appendChild(u),n.appendChild(d)}a.appendChild(n),t.appendChild(a);const r=document.createElement("div");r.className="sidebar-drought-buttons";const s=document.createElement("button");s.className="sidebar-btn",s.id="sidebar-select-all",s.textContent="Select All",s.addEventListener("click",function(){n.querySelectorAll('input[type="checkbox"]').forEach(d=>{d.checked=!0});const c=document.getElementById("selectAllDroughtYears");c&&c.click()});const l=document.createElement("button");l.className="sidebar-btn",l.id="sidebar-clear-all",l.textContent="Clear All",l.addEventListener("click",function(){n.querySelectorAll('input[type="checkbox"]').forEach(d=>{d.checked=!1});const c=document.getElementById("clearAllDroughtYears");c&&c.click()}),r.appendChild(s),r.appendChild(l),a.appendChild(r)}function Ef(t){const e=X("netWorthHa","number",{label:"Net Worth ($/ha)",min:0,step:50}),a=X("equityPercent","number",{label:"Equity (%)",min:0,max:100,step:1}),i=X("landValueAppreciation","toggle",{label:"Land Value Appreciation"}),n=X("landAppreciationRate","number",{label:"Annual Appreciation Rate (%)",min:0,max:10,step:.1}),o=X("criticalEquity","number",{label:"Critical Equity Threshold (%)",min:0,max:100,step:1});e&&t.appendChild(e),a&&t.appendChild(a),i&&t.appendChild(i),n&&t.appendChild(n),o&&t.appendChild(o)}function kf(t){const e=X("basePriceSlider","range",{label:"Price Adjustment (%)",min:-20,max:20,step:1}),a=X("baseYieldSlider","range",{label:"Yield Adjustment (%)",min:-20,max:20,step:1}),i=X("opCostSlider","range",{label:"Op Cost Adjustment (%)",min:-20,max:20,step:1}),n=document.createElement("div");n.className="sidebar-input-wrapper",n.style.marginTop="15px";const o=document.createElement("button");o.className="sidebar-btn",o.style.width="100%",o.innerHTML='<i class="fas fa-redo"></i> Reset All Adjustments',o.addEventListener("click",function(){t.querySelectorAll('input[type="range"]').forEach(l=>{l.value=0,l.dispatchEvent(new Event("input",{bubbles:!0}))});const s={basePrice:document.getElementById("basePriceSlider"),baseYield:document.getElementById("baseYieldSlider"),opCost:document.getElementById("opCostSlider")};Object.values(s).forEach(l=>{l&&(l.value=0,l.dispatchEvent(new Event("input",{bubbles:!0})))}),window.calculateAndDisplay&&window.calculateAndDisplay(),window.showNotification&&window.showNotification("Reset Complete","Sensitivity adjustments have been reset to 0%","info")}),n.appendChild(o),e&&t.appendChild(e),a&&t.appendChild(a),i&&t.appendChild(i),t.appendChild(n)}function zi(t){const e={commonParameters:{},differentiatingParameters:{}};if(!t||t.length<=1)return e;const a=t[0];Object.keys(a.params||{}).forEach(l=>{if(l==="droughtYears")return;const c=t.map(p=>p.params[l]);c.every(p=>typeof p=="boolean"||p==="true"||p==="false"?String(p)===String(c[0]):p===c[0])?e.commonParameters[l]=c[0]:e.differentiatingParameters[l]={values:t.map(p=>({profileName:p.name,location:p.location,crop:p.crop,value:p.params[l]}))}});try{const l=t.map(d=>{const p=d.params.droughtYears||[];return new Set(Array.isArray(p)?p.map(String):[])});console.log("Drought year sets:",l.map(d=>Array.from(d))),l.every((d,p)=>{if(p===0)return!0;const u=l[0];return d.size!==u.size?!1:Array.from(d).every(h=>u.has(h))})?e.commonParameters.droughtYears=Array.from(l[0])||[]:e.differentiatingParameters.droughtYears={values:t.map(d=>({profileName:d.name,location:d.location,crop:d.crop,value:Array.isArray(d.params.droughtYears)?[...d.params.droughtYears]:[]}))}}catch(l){console.error("Error processing drought years:",l),e.differentiatingParameters.droughtYears={values:t.map(c=>({profileName:c.name,location:c.location,crop:c.crop,value:Array.isArray(c.params.droughtYears)?[...c.params.droughtYears]:[]}))}}const n=t.map(l=>l.sensitivities||{});n.every((l,c)=>{if(c===0)return!0;const d=n[0];return JSON.stringify(l)===JSON.stringify(d)})?e.commonParameters.sensitivities=t[0].sensitivities||{}:e.differentiatingParameters.sensitivities={values:t.map(l=>({profileName:l.name,location:l.location,crop:l.crop,value:l.sensitivities||{}}))};const r=new Set(t.map(l=>l.location||"")),s=new Set(t.map(l=>l.crop||""));return r.size>1?e.differentiatingParameters.location={values:t.map(l=>({profileName:l.name,value:l.location||"Unknown"}))}:r.size===1&&!Array.from(r)[0]||(e.commonParameters.location=Array.from(r)[0]),s.size>1?e.differentiatingParameters.crop={values:t.map(l=>({profileName:l.name,value:l.crop||"Unknown"}))}:s.size===1&&!Array.from(s)[0]||(e.commonParameters.crop=Array.from(s)[0]),Pf(e,t),Lf(e),Af(e,t),e}function Pf(t,e){Object.keys(t.differentiatingParameters).forEach(a=>{const i=t.differentiatingParameters[a];if(a==="droughtYears"){const h=i.values.map(_=>(_.value||[]).length),f=Math.min(...h),m=Math.max(...h);i.impact={level:m-f>2?"high":m-f>0?"medium":"low",description:`Drought year count varies from ${f} to ${m}`};return}if(a==="sensitivities"){const h=i.values.some(f=>{const m=f.value||{};return(m.basePrice||0)!==0||(m.baseYield||0)!==0||(m.opCost||0)!==0});i.impact={level:h?"high":"low",description:h?"Different sensitivity adjustments applied":"Minor sensitivity differences"};return}if(a==="location"||a==="crop"){i.impact={level:"high",description:`Different ${a}s compared`};return}if(a==="stepChangeEnabled"){const h=i.values.some(m=>m.value===!0||m.value==="true"),f=i.values.some(m=>m.value===!1||m.value==="false");i.impact={level:h&&f?"high":"medium",description:h&&f?"Step change enabled in some profiles but not others":"Different step change settings"};return}if(a==="stepChangeYear"){const h=i.values.map(g=>parseInt(g.value)),f=Math.min(...h),m=Math.max(...h),_=m-f;i.impact={level:_>5?"high":_>0?"medium":"low",description:`Step change year varies from ${f} to ${m}`};return}if(a==="stepChangeAmount"){const h=i.values.map(g=>parseFloat(g.value)),f=Math.min(...h),m=Math.max(...h),_=m-f;i.impact={level:_>10?"high":_>5?"medium":"low",description:`Step change amount varies from ${f}% to ${m}%`};return}const n=i.values.map(h=>h.value);if(n.some(h=>typeof h!="number"&&typeof h!="boolean")){if(n.every(h=>typeof h=="boolean"||h==="true"||h==="false")){const h=n.some(m=>m===!1||m==="false"),f=n.some(m=>m===!0||m==="true");i.impact={level:h&&f?"medium":"low",description:h&&f?"Feature enabled in some profiles but not others":"Minor boolean difference"}}else i.impact={level:"unknown",description:"Cannot determine impact for this parameter type"};return}const o=n.map(h=>parseFloat(h)),r=Math.min(...o),s=Math.max(...o),l=s-r,c=o.reduce((h,f)=>h+f,0)/o.length,d=c!==0?l/Math.abs(c):0;let p="low",u="";switch(a){case"basePrice":p=d>.1?"high":d>.05?"medium":"low",u=`Price varies by ${(d*100).toFixed(1)}% (${ce(r)} to ${ce(s)})`;break;case"meanYield":p=d>.15?"high":d>.05?"medium":"low",u=`Mean yield varies by ${(d*100).toFixed(1)}% (${r.toFixed(2)} to ${s.toFixed(2)} t/ha)`;break;case"opCost":p=d>.15?"high":d>.05?"medium":"low",u=`Operational cost varies by ${(d*100).toFixed(1)}% (${ce(r)} to ${ce(s)})`;break;case"baseYieldType":p="high",u="Different yield types will significantly affect results";break;case"droughtYield":p=(e[0].params.droughtYears?.length||0)>0?d>.2?"high":d>.1?"medium":"low":"low",u=`Drought yield varies by ${(d*100).toFixed(1)}% (${r.toFixed(2)} to ${s.toFixed(2)} t/ha)`;break;case"annualIncreaseRate":p=e.some(_=>_.params.annualIncrease===!0||_.params.annualIncrease==="true")&&d>.5?"medium":"low",u=`Annual increase rate varies from ${r}% to ${s}%`;break;case"netWorthHa":p=d>.2?"high":d>.1?"medium":"low",u=`Initial net worth varies by ${(d*100).toFixed(1)}% (${ce(r)} to ${ce(s)})`;break;case"equityPercent":p=d>.2?"high":d>.1?"medium":"low",u=`Initial equity varies from ${r}% to ${s}%`;break;case"criticalEquity":p=d>.2?"medium":"low",u=`Critical equity threshold varies from ${r}% to ${s}%`;break;case"landAppreciationRate":p=e.some(_=>_.params.landValueAppreciation===!0||_.params.landValueAppreciation==="true")&&d>.5?"medium":"low",u=`Land appreciation rate varies from ${r}% to ${s}%`;break;default:p=d>.2?"medium":(d>.1,"low"),u=`Parameter varies by ${(d*100).toFixed(1)}%`}i.impact={level:p,relativeVariation:d,range:l,min:r,max:s,description:u}})}function Lf(t){const e={location_crop:{name:"Location & Crop",gradient:"primary-gradient",icon:"fas fa-map-marker-alt",parameters:["location","crop"]},price_cost:{name:"Price & Cost",gradient:"finance-gradient",icon:"fas fa-coins",parameters:["basePrice","opCost"]},yield:{name:"Yield Settings",gradient:"yield-gradient",icon:"fas fa-seedling",parameters:["meanYield","baseYieldType","droughtYield"]},adjustments:{name:"Yield Adjustments",gradient:"adjustment-gradient",icon:"fas fa-chart-line",parameters:["variedYield","annualIncrease","annualIncreaseRate","stepChangeEnabled","stepChangeYear","stepChangeAmount"]},climate:{name:"Climate & Drought",gradient:"climate-gradient",icon:"fas fa-cloud-sun-rain",parameters:["droughtYears"]},financial:{name:"Financial Position",gradient:"financial-gradient",icon:"fas fa-landmark",parameters:["netWorthHa","equityPercent","landValueAppreciation","landAppreciationRate","criticalEquity"]},sensitivity:{name:"Sensitivity Analysis",gradient:"sensitivity-gradient",icon:"fas fa-sliders-h",parameters:["sensitivities"]}},a={};Object.keys(t.differentiatingParameters).forEach(n=>{let o=null;for(const[s,l]of Object.entries(e))if(l.parameters.includes(n)){o=s;break}const r=o||"other";a[r]||(a[r]={name:e[r]?.name||"Other Parameters",gradient:e[r]?.gradient||"profile-gradient",icon:e[r]?.icon||"fas fa-cog",parameters:{}}),a[r].parameters[n]=t.differentiatingParameters[n]}),t.categorizedDiff=a;const i={};Object.keys(t.commonParameters).forEach(n=>{let o=null;for(const[s,l]of Object.entries(e))if(l.parameters.includes(n)){o=s;break}const r=o||"other";i[r]||(i[r]={name:e[r]?.name||"Other Parameters",gradient:e[r]?.gradient||"profile-gradient",icon:e[r]?.icon||"fas fa-cog",parameters:{}}),i[r].parameters[n]=t.commonParameters[n]}),t.categorizedCommon=i}function Af(t,e){if(!e.some(i=>i.results&&i.results.finalCumulativeMargin))return;const a={finalMargin:e.map(i=>({profileName:i.name,value:parseFloat(i.results?.finalCumulativeMargin||0)}))};if(e.some(i=>i.yearlyResults&&i.yearlyResults.length)&&(a.finalEquity=e.map(i=>{const n=i.yearlyResults||[];return{profileName:i.name,value:n.length?parseFloat(n[n.length-1].equityPercent||0):0}}),a.finalNetWorth=e.map(i=>{const n=i.yearlyResults||[];return{profileName:i.name,value:n.length?parseFloat(n[n.length-1].netWorth||0):0}}),a.firstYearBelowThreshold=e.map(i=>{const n=i.yearlyResults||[],o=parseFloat(i.params?.criticalEquity||60),r=n.find(s=>parseFloat(s.equityPercent)<o);return{profileName:i.name,value:r?r.year:"Never"}}),a.yearsBelowThreshold=e.map(i=>{const n=i.yearlyResults||[],o=parseFloat(i.params?.criticalEquity||60),r=n.filter(s=>parseFloat(s.equityPercent)<o).length;return{profileName:i.name,value:r}}),a.negativeMarginYears=e.map(i=>{const n=i.yearlyResults||[];if(n.length===0)return{profileName:i.name,value:0};const r=n.filter(s=>parseFloat(s.grossMargin)<0).length/n.length*100;return{profileName:i.name,value:r}}),a.marginVolatility=e.map(i=>{const n=i.yearlyResults||[];if(n.length<=1)return{profileName:i.name,value:0};const o=n.map(c=>parseFloat(c.grossMargin)),r=o.reduce((c,d)=>c+d,0)/o.length,s=o.reduce((c,d)=>c+Math.pow(d-r,2),0)/o.length,l=Math.sqrt(s);return{profileName:i.name,value:l}})),t.resultDifferences=a,a.finalMargin.length>=2){const i=a.finalMargin.map(u=>u.value),n=Math.min(...i),o=Math.max(...i),r=o-n,s=Math.abs(n),l=Math.abs(o),c=Math.max(s,l),d=c>0?r/c:0;let p="small";d>.5?p="large":d>.2&&(p="medium"),t.resultSummary={marginDifference:r,relativeDifference:d,differenceLevel:p,bestPerforming:a.finalMargin.reduce((u,h)=>h.value>u.value?h:u,a.finalMargin[0]).profileName,worstPerforming:a.finalMargin.reduce((u,h)=>h.value<u.value?h:u,a.finalMargin[0]).profileName}}}function zr(){if(document.getElementById("understandComparisonModal"))return;const t=document.createElement("div");t.id="understandComparisonModal",t.className="modal-overlay",t.innerHTML=`
      <div class="modal elevation-3" style="width: 90%; max-width: 900px;">
        <div class="modal-header">
          <div class="modal-title"><i class="fas fa-lightbulb"></i> Understanding Profile Differences</div>
          <button class="modal-close" id="closeUnderstandBtn"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body" style="max-height: 75vh; overflow-y: auto;">
          <div id="understandComparisonContent">
            <!-- Content will be generated dynamically -->
          </div>
        </div>
        <div class="modal-footer">
          <button id="closeUnderstandModalBtn" class="secondary-btn"><i class="fas fa-times"></i> Close</button>
        </div>
      </div>
    `,document.body.appendChild(t),document.getElementById("closeUnderstandBtn").addEventListener("click",li),document.getElementById("closeUnderstandModalBtn").addEventListener("click",li),Of()}function Df(){zr();const t=Ff("#comparisonTab .card-header .header-actions");if(t&&!document.getElementById("understandComparisonBtn")){const e=document.createElement("button");e.id="understandComparisonBtn",e.className="action-btn elevation-1",e.title="Analyze differences between profiles",e.style.marginLeft="10px",e.innerHTML='<i class="fas fa-lightbulb"></i> Understand Differences',e.addEventListener("click",Wr),t.appendChild(e)}}function Wr(){const t=window.getComparisonIds?window.getComparisonIds():[];if(t.length<=1){window.showNotification?window.showNotification("Not Enough Profiles","Select at least 2 profiles to analyze differences","warning"):alert("Select at least 2 profiles to analyze differences");return}const e=window.getProfileById||function(){return null},a=t.map(n=>e(n)).filter(Boolean),i=document.getElementById("understandComparisonModal");i&&(i.style.display="flex",If(a))}function li(){const t=document.getElementById("understandComparisonModal");t&&(t.style.display="none")}function If(t){const e=document.getElementById("understandComparisonContent");if(!e)return;const a=zi(t);e.innerHTML="",a.categorizedCommon&&Object.keys(a.categorizedCommon).length>0&&jr(e,a),a.categorizedDiff&&Object.keys(a.categorizedDiff).length>0&&Vr(e,a,t);const i=document.createElement("div");i.className="analysis-summary elevation-1";let n="";if(a.resultSummary){const s=a.resultSummary;n=`
        <div class="result-summary ${{large:"result-large-diff",medium:"result-medium-diff",small:"result-small-diff"}[s.differenceLevel]||""}">
          <div class="result-difference">
            <span class="result-diff-value">${ce(Math.abs(s.marginDifference))}</span>
            <span class="result-diff-label">difference in final margin</span>
          </div>
          <div class="result-insight">
            <p><strong>${s.bestPerforming}</strong> performs best with the highest margin.</p>
            <p><strong>${s.worstPerforming}</strong> performs worst with the lowest margin.</p>
          </div>
        </div>
      `}const o=Object.keys(a.differentiatingParameters).length,r=Object.keys(a.commonParameters).length;i.innerHTML=`
      <h3><i class="fas fa-chart-pie"></i> Analysis Summary</h3>
      <p>Comparing ${t.length} profiles: ${t.map(s=>`<strong>${s.name}</strong>`).join(", ")}</p>
      ${n}
      <div class="analysis-stats">
        <div class="stat-item ${o>0?"stat-highlight":""}">
          <span class="stat-value">${o}</span>
          <span class="stat-label">Differentiating Parameters</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">${r}</span>
          <span class="stat-label">Common Parameters</span>
        </div>
      </div>
    `,e.appendChild(i),a.resultDifferences&&a.resultDifferences.finalMargin&&Hr(e,a,t)}function Hr(t,e,a){const i=document.createElement("div");i.className="results-diff-section elevation-1";let n="";[{key:"finalMargin",label:"Final Margin",formatter:ce,lowerIsBetter:!1,gradientClass:"finance-gradient",vizType:"bar"},{key:"marginVolatility",label:"Margin Volatility",formatter:ce,lowerIsBetter:!0,gradientClass:"finance-gradient",vizType:"bar",description:"Lower volatility means more stable returns"},{key:"negativeMarginYears",label:"Negative Margin Years",formatter:r=>`${r.toFixed(1)}%`,lowerIsBetter:!0,gradientClass:"finance-gradient",vizType:"bar",description:"Percentage of years with negative profit"},{key:"finalEquity",label:"Final Equity %",formatter:r=>`${parseFloat(r).toFixed(1)}%`,lowerIsBetter:!1,gradientClass:"financial-gradient",vizType:"bar"},{key:"finalNetWorth",label:"Final Net Worth",formatter:ce,lowerIsBetter:!1,gradientClass:"financial-gradient",vizType:"bar"},{key:"firstYearBelowThreshold",label:"First Year Below Threshold",formatter:r=>r,lowerIsBetter:!1,gradientClass:"financial-gradient",vizType:"dot",hasSpecialValues:!0,specialFormatter:(r,s)=>r==="Never"?`<span class="threshold-indicator threshold-never">
                    <i class="fas fa-check-circle"></i> Never
                  </span>`:`<span class="threshold-indicator threshold-year">
                  <i class="fas fa-exclamation-triangle"></i> ${r}
                </span>`},{key:"yearsBelowThreshold",label:"Years Below Threshold",formatter:r=>`${r} ${r===1?"year":"years"}`,lowerIsBetter:!0,gradientClass:"financial-gradient",vizType:"bar",description:"Fewer years below threshold is better"}].forEach(r=>{e.resultDifferences[r.key]&&(n+=Bf(r.label,e.resultDifferences[r.key],a,r.gradientClass,r.formatter,r.lowerIsBetter,r.hasSpecialValues,r.vizType,r.specialFormatter,r.description))}),i.innerHTML=`
    <h3><i class="fas fa-poll"></i> Result Differences</h3>
    <p>How the final outcomes compare between profiles:</p>
    <div class="results-table">
      ${n}
    </div>
  `,t.appendChild(i)}function Bf(t,e,a,i,n=ce,o=!1,r=!1,s="bar",l=null,c=""){const d=e.map(g=>g.value);let p,u;if(r){const g=d.filter(b=>typeof b=="number"||!isNaN(parseFloat(b)));p=g.length>0?Math.min(...g):null,u=g.length>0?Math.max(...g):null}else p=Math.min(...d),u=Math.max(...d);const h=c?`title="${c}"`:"";let f=`
    <div class="result-row">
      <div class="result-label ${i}" ${h}>
        ${t}
        ${c?'<i class="fas fa-info-circle" style="margin-left: 5px; font-size: 0.8rem;"></i>':""}
      </div>
      <div class="result-values-container">
  `;const m=["Final Margin","Final Equity %","Final Net Worth","Negative Margin Years","Years Below Threshold","Margin Volatility"].includes(t),_=t==="Negative Margin Years"?g=>`${Math.round(g/4)||0}/25`:n;return a.forEach(g=>{const b=e.find(x=>x.profileName===g.name);if(!b)return;const w=b.value;let y=!1;r&&w==="Never"?y=!0:o?y=w===p:y=w===u;const v=y?"positive":"";let M="";if(s==="bar"){let x=50;r&&w==="Never"?x=100:u!==p&&u!==null&&p!==null&&(x=(parseFloat(w)-p)/(u-p)*100,o&&(x=100-x));let C="";m?C=`style="width: ${x}%; background-color: ${Tf(x)};"`:C=`style="width: ${x}%;"`,M=`
        <div class="visualization-container">
          <div class="bar-visualization">
            <div class="bar-fill${!m&&o?" inverse":""}" ${C}></div>
          </div>
        </div>
      `}else if(s==="dot"){let x=5,C=0;if(r&&w==="Never")C=x;else if(u!==p&&u!==null&&p!==null){const P=parseFloat(w);C=Math.round((P-p)/(u-p)*x),o&&(C=x-C)}let E="";for(let P=0;P<x;P++)E+=`<div class="dot${o?" inverse":""}${P<C?" active":""}"></div>`;M=`
        <div class="visualization-container">
          <div class="dot-visualization">
            ${E}
          </div>
        </div>
      `}let S=t==="Negative Margin Years"?_(w):n(w);l&&r&&(S=l(w,g)),f+=`
      <div class="result-value-column">
        <div class="result-profile-name">${g.name}</div>
        <div class="result-value ${v}">${S}</div>
        ${M}
      </div>
    `}),f+=`
      </div>
    </div>
  `,f}function Tf(t){const e=Math.min(100,Math.max(0,t)),a=[220,53,69],i=[255,193,7],n=[40,167,69];let o,r,s;if(e<=50){const l=e/50;o=Math.round(a[0]+l*(i[0]-a[0])),r=Math.round(a[1]+l*(i[1]-a[1])),s=Math.round(a[2]+l*(i[2]-a[2]))}else{const l=(e-50)/50;o=Math.round(i[0]+l*(n[0]-i[0])),r=Math.round(i[1]+l*(n[1]-i[1])),s=Math.round(i[2]+l*(n[2]-i[2]))}return`rgb(${o}, ${r}, ${s})`}function Yf(){const t=document.getElementById("understand-comparison-styles");if(!t)return;const e=`
    /* Remove default background for bars that will use gradient */
    .bar-fill {
      background-color: transparent;
    }
    
    /* Keep the inverse styling for non-gradient bars */
    .bar-fill.inverse:not([style*="background-color"]) {
      background-color: #f56565;
    }
    
    /* Default color for bars without inline style */
    .bar-fill:not([style*="background-color"]) {
      background-color: #4299e1;
    }
  `;t.textContent+=e}function Rf(){setTimeout(Yf,100)}function Vr(t,e,a){const i=document.createElement("div");i.className="diff-parameters-section elevation-1",i.innerHTML=`
    <h3><i class="fas fa-not-equal"></i> Key Differences</h3>
    <p>These parameters vary between profiles and drive the differences in results:</p>
    <div class="diff-parameters-container profile-centered">
      <!-- Profiles will be added here as columns -->
    </div>
  `;const n=i.querySelector(".diff-parameters-container");n.style.display="grid",n.style.gridTemplateColumns=`repeat(${a.length}, 1fr)`,n.style.gap="20px";try{a.forEach((o,r)=>{const s=document.createElement("div");s.className="profile-diff-column";const l=document.createElement("div");l.className="profile-diff-header",l.innerHTML=`
        <h4>${o.name}</h4>
        ${o.location&&o.crop?`<div class="profile-location-crop">${o.location} / ${o.crop}</div>`:""}
      `,s.appendChild(l),Object.keys(e.categorizedDiff).sort((d,p)=>{if(d==="location_crop")return-1;if(p==="location_crop")return 1;const u=Object.values(e.categorizedDiff[d].parameters).some(f=>f.impact&&f.impact.level==="high"),h=Object.values(e.categorizedDiff[p].parameters).some(f=>f.impact&&f.impact.level==="high");return u&&!h?-1:!u&&h?1:0}).forEach(d=>{const p=e.categorizedDiff[d],u=p.parameters;if(Object.keys(u).length===0)return;const h=document.createElement("div");h.className="profile-diff-category",h.innerHTML=`
          <div class="profile-diff-category-header ${p.gradient}">
            <i class="${p.icon}"></i> ${p.name}
          </div>
          <div class="profile-diff-parameters">
            <!-- Parameters will be added here -->
          </div>
        `;const f=h.querySelector(".profile-diff-parameters");Object.keys(u).sort((_,g)=>{const b={high:0,medium:1,low:2,unknown:3},w=b[u[_].impact?.level||"unknown"],y=b[u[g].impact?.level||"unknown"];return w-y}).forEach(_=>{try{const g=u[_],b=g.impact||{level:"unknown",description:"Unknown impact"},y=g.values.find(M=>M.profileName===o.name)?.value,v=document.createElement("div");if(v.className=`profile-diff-parameter ${b.level}-impact-param`,_==="sensitivities"){const M=y||{};let S='<div class="sensitivity-values-clean">';if((M.basePrice||0)===0&&(M.baseYield||0)===0&&(M.opCost||0)===0)S+='<span class="no-sensitivity">None</span>';else{const x=[];if((M.basePrice||0)!==0){const C=M.basePrice>0?"+":"";x.push(`<span class="sensitivity-factor">Price: <span class="${M.basePrice>0?"positive":"negative"}">${C}${M.basePrice}%</span></span>`)}else x.push('<span class="sensitivity-factor">Price: <span class="neutral">0%</span></span>');if((M.baseYield||0)!==0){const C=M.baseYield>0?"+":"";x.push(`<span class="sensitivity-factor">Yield: <span class="${M.baseYield>0?"positive":"negative"}">${C}${M.baseYield}%</span></span>`)}else x.push('<span class="sensitivity-factor">Yield: <span class="neutral">0%</span></span>');if((M.opCost||0)!==0){const C=M.opCost>0?"+":"";x.push(`<span class="sensitivity-factor">Op Cost: <span class="${M.opCost>0?"negative":"positive"}">${C}${M.opCost}%</span></span>`)}else x.push('<span class="sensitivity-factor">Op Cost: <span class="neutral">0%</span></span>');S+=x.join(" · ")}S+="</div>",v.innerHTML=`<div class="param-value sensitivity-container">${S}</div>`}else if(_==="droughtYears"){const M=vo(b.level),S=ci(_);let x=[];if(Array.isArray(y))x=[...y];else if(y&&typeof y=="object")console.log("Unknown drought years format:",y),x=[];else if(y)try{x=[y].flat()}catch(E){console.error("Error handling drought years:",E),x=[]}let C=x.length>0?`<div class="drought-years">${x.sort().join(", ")}</div>`:'<span class="no-drought">None</span>';v.innerHTML=`
                <div class="param-impact" title="${b.description||""}">${M}</div>
                <div class="param-name" title="${b.description||""}">${S}:</div>
                <div class="param-value">${C}</div>
              `}else{const M=vo(b.level),S=ci(_),x=qr(_,y),E=typeof y=="number"&&(y===b.min||y===b.max)&&b.relativeVariation>=.05?"highlight":"";v.innerHTML=`
                <div class="param-impact" title="${b.description||""}">${M}</div>
                <div class="param-name" title="${b.description||""}">${S}:</div>
                <div class="param-value ${E}">${x}</div>
              `}f.appendChild(v)}catch(g){console.error(`Error processing parameter ${_}:`,g);const b=document.createElement("div");b.className="profile-diff-parameter",b.innerHTML=`<div class="param-name">Error with parameter ${_}</div>`,f.appendChild(b)}}),s.appendChild(h)}),n.appendChild(s)})}catch(o){console.error("Error in addDifferentiatingParametersSection:",o),i.innerHTML+=`<p class="error-message">Error rendering comparison: ${o.message}</p>`}t.appendChild(i)}function jr(t,e){const a=document.createElement("div");a.className="common-parameters-section elevation-1",a.innerHTML=`
      <h3><i class="fas fa-equals"></i> Common Values</h3>
      <p>These parameters are the same across all compared profiles:</p>
      <div class="common-parameters-container">
        <!-- Categories will be added here -->
      </div>
    `;const i=a.querySelector(".common-parameters-container");Object.keys(e.categorizedCommon).forEach(n=>{const o=e.categorizedCommon[n],r=o.parameters;if(Object.keys(r).length===0)return;const s=document.createElement("div");s.className="common-category",s.innerHTML=`
        <div class="common-category-header ${o.gradient}">
          <i class="${o.icon}"></i> ${o.name}
        </div>
        <div class="common-parameters-list">
          <!-- Parameters will be added here -->
        </div>
      `;const l=s.querySelector(".common-parameters-list");Object.keys(r).forEach(c=>{const d=r[c];if(c==="waterParameters")return;const p=qr(c,d),u=ci(c),h=document.createElement("div");if(h.className="common-parameter-item",c==="droughtYears"){const f=d||[];h.innerHTML=`
            <div class="common-parameter-name">${u}:</div>
            <div class="common-parameter-value">
              ${f.length>0?f.sort().join(", "):"None"}
            </div>
          `}else if(c==="sensitivities"){const f=d||{};let m="";if((f.basePrice||0)===0&&(f.baseYield||0)===0&&(f.opCost||0)===0)m="None";else{const _=[];if((f.basePrice||0)!==0){const g=f.basePrice>0?"+":"";_.push(`Price: ${g}${f.basePrice}%`)}if((f.baseYield||0)!==0){const g=f.baseYield>0?"+":"";_.push(`Yield: ${g}${f.baseYield}%`)}if((f.opCost||0)!==0){const g=f.opCost>0?"+":"";_.push(`Op Cost: ${g}${f.opCost}%`)}m=_.join(", ")}h.innerHTML=`
            <div class="common-parameter-name">${u}:</div>
            <div class="common-parameter-value">${m}</div>
          `}else h.innerHTML=`
            <div class="common-parameter-name">${u}:</div>
            <div class="common-parameter-value">${p}</div>
          `;l.appendChild(h)}),i.appendChild(s)}),t.appendChild(a)}function Of(){if(document.getElementById("understand-comparison-styles"))return;const t=document.createElement("style");t.id="understand-comparison-styles",t.textContent=`
    /* Understanding Comparison Styles */
    .analysis-summary {
      background-color: #f8fafc;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .analysis-summary h3 {
      margin-top: 0;
      color: #2d3748;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .analysis-stats {
      display: flex;
      gap: 20px;
      margin-top: 15px;
    }
    
    .stat-item {
      background-color: white;
      padding: 15px;
      border-radius: 8px;
      flex: 1;
      text-align: center;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .stat-item.stat-highlight {
      background-color: #ebf8ff;
      border: 1px solid #4299e1;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #4a5568;
      display: block;
    }
    
    .stat-label {
      font-size: 14px;
      color: #718096;
      margin-top: 5px;
    }
    
    /* Common parameters section */
    .common-parameters-section {
      background-color: #f8fafc;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .common-parameters-section h3 {
      margin-top: 0;
      color: #2d3748;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .common-parameters-container {
      margin-top: 15px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }
    
    .common-category {
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      overflow: hidden;
      background-color: white;
    }
    
    .common-category-header {
      padding: 12px 15px;
      color: white;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .common-parameters-list {
      padding: 15px;
    }
    
    .common-parameter-item {
      display: flex;
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    .common-parameter-item:last-child {
      margin-bottom: 0;
    }
    
    .common-parameter-name {
      font-weight: 500;
      margin-right: 8px;
      min-width: 150px;
    }
    
    .common-parameter-value {
      color: #4a5568;
    }
    
    /* Differentiating parameters section - Profile-centered styles */
    .diff-parameters-section {
      background-color: #f8fafc;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .diff-parameters-section h3 {
      margin-top: 0;
      color: #2d3748;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Profile column layout */
    .profile-diff-column {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .profile-diff-header {
      background-color: #4a5568;
      color: white;
      padding: 15px;
      text-align: center;
    }
    
    .profile-diff-header h4 {
      margin: 0;
      color: white;
      font-size: 1.1rem;
    }
    
    .profile-location-crop {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-top: 5px;
    }
    
    /* Category styling within profile */
    .profile-diff-category {
      margin: 15px;
      border: 1px solid #fafafa;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .profile-diff-category-header {
      padding: 10px 15px;
      color: white;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
    }
    
    .profile-diff-parameters {
      padding: 10px;
    }
    
    /* Individual parameter styling */
    .profile-diff-parameter {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 8px;
      align-items: center;
      padding: 8px;
      border-bottom: 1px solid #f7fafc;
      position: relative;
    }
    
    .profile-diff-parameter:last-child {
      border-bottom: none;
    }
    
    .param-impact {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }
    
    .param-name {
      font-weight: 500;
      font-size: 0.9rem;
    }
    
    .param-value {
      text-align: right;
      font-size: 0.9rem;
    }
    
    .param-value.highlight {
      background-color: #fefcbf;
      padding: 3px 6px;
      border-radius: 4px;
      font-weight: 500;
    }
    
    /* Sensitivity styles - new improved version */
    .sensitivity-values-clean {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      width: 100%;
      font-size: 0.85rem;
    }
    
    .sensitivity-factor {
      white-space: nowrap;
    }
    
    .sensitivity-container {
      padding: 8px;
      width: 100%;
      grid-column: 1 / -1;
    }
    
    .neutral {
      color: #a0aec0;
    }
    
    /* Impact level styling */
    .high-impact {
      color: #e53e3e;
    }
    
    .medium-impact {
      color: #dd6b20;
    }
    
    .low-impact {
      color: #68d391;
    }
    
    .unknown-impact {
      color: #a0aec0;
    }
    
    .high-impact-param {
      background-color: rgba(229, 62, 62, 0.05);
    }
    
    .medium-impact-param {
      background-color: rgba(221, 107, 32, 0.05);
    }
    
    /* Original sensitivity values display - kept for backwards compatibility */
    .sensitivity-values {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    
    .sensitivity-item {
      font-size: 12px;
    }
    
    .no-sensitivity, .no-drought {
      color: #a0aec0;
      font-style: italic;
      font-size: 12px;
    }
    
    /* Drought years display */
    .drought-years {
      font-size: 12px;
      line-height: 1.3;
    }
    
    /* Result summary styling */
    .result-summary {
      display: flex;
      margin: 15px 0;
      padding: 15px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      gap: 20px;
      align-items: center;
    }
    
    .result-large-diff {
      border-left: 4px solidrgb(134, 63, 63);
    }
    
    .result-medium-diff {
      border-left: 4px solid #ed8936;
    }
    
    .result-small-diff {
      border-left: 4px solid #38a169;
    }
    
    .result-difference {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 15px;
      background-color: #f7fafc;
      border-radius: 8px;
      min-width: 180px;
    }
    
    .result-diff-value {
      font-size: 20px;
      font-weight: bold;
      color: #4a5568;
    }
    
    .result-diff-label {
      font-size: 12px;
      color: #718096;
      text-align: center;
      margin-top: 5px;
    }
    
    .result-insight {
      flex: 1;
    }
    
    .result-insight p {
      margin: 5px 0;
    }
    
    /* ===== IMPROVED RESULTS COMPARISON TABLE STYLES ===== */
    .results-diff-section {
      background-color: #f8fafc;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .results-diff-section h3 {
      margin-top: 0;
      color: #2d3748;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .results-table {
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      width: 100%;
      margin: 15px 0;
      background-color: white;
    }
    
    /* Consistent row structure */
    .result-row {
      display: flex;
      border-bottom: 1px solid #e2e8f0;
      min-height: 60px; /* Ensure consistent height */
    }
    
    .result-row:last-child {
      border-bottom: none;
    }
    
    /* Fixed width label column with consistent styling */
    .result-label {
      width: 200px;
      min-width: 200px;
      background-color: #2b6cb0; /* Consistent blue color */
      color: white;
      font-weight: 600;
      padding: 16px;
      display: flex;
      align-items: center;
      border-right: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Category-based styling for labels */
    .category-financial .result-label {
      background-color: #2b6cb0;
    }
    
    .category-risk .result-label {
      background-color: #3182ce;
    }
    
    /* Value columns container */
    .result-values-container {
      display: flex;
      flex: 1;
    }
    
    /* Individual value columns */
    .result-value-column {
      flex: 1;
      padding: 12px 16px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      border-right: 1px solid #e2e8f0;
    }
    
    .result-value-column:last-child {
      border-right: none;
    }
    
    /* Profile name styling */
    .result-profile-name {
      font-size: 0.85rem;
      color: #718096;
      margin-bottom: 5px;
    }
    
    /* Value display with proper spacing */
    .result-value {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 8px;
    }
    
    /* Positive/negative value styling */
    .result-value.positive {
      color: #38a169;
    }
    
    .result-value.negative {
      color: #e53e3e;
    }
    
    /* Special threshold indicators */
    .threshold-indicator {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.85rem;
    }
    
    .threshold-never {
      background-color: #c6f6d5;
      color: #2f855a;
    }
    
    .threshold-year {
      background-color: #fed7d7;
      color: #c53030;
    }
    
    /* Visualization elements */
    .visualization-container {
      height: 8px;
      width: 100%;
      margin-top: auto;
    }
    
    .bar-visualization {
      background-color: #edf2f7;
      border-radius: 4px;
      overflow: hidden;
      height: 100%;
    }
    
    .bar-fill {
      height: 100%;
      background-color: #4299e1;
      border-radius: 4px;
      min-width: 5px;
      transition: width 0.3s ease;
    }
    
    .bar-fill.inverse {
      background-color: #f56565;
    }
    
    /* Add subtle zebra striping for better readability */
    .result-row:nth-child(even) .result-values-container {
      background-color: #f9fafc;
    }
    
    /* Fixed color gradients */
    .primary-gradient {
      background: linear-gradient(to right, #38a169, #2f855a);
    }
    
    .finance-gradient {
      background: linear-gradient(to right, #3182ce, #2c5282);
    }
    
    .yield-gradient {
      background: linear-gradient(to right, var(--yield-gradient-from), var(--yield-gradient-to));
    }
    
    .adjustment-gradient {
      background: linear-gradient(to right, var(--adjustment-gradient-from), var(--adjustment-gradient-to));
    }
    
    .climate-gradient {
      background: linear-gradient(to right, var(--climate-gradient-from), var(--climate-gradient-to));
    }
    
    .financial-gradient {
      background: linear-gradient(135deg, #2c3e50 0%, #4ca1af 100%);
    }
    
    .sensitivity-gradient {
      background: linear-gradient(to right, var(--sensitivity-gradient-from), var(--sensitivity-gradient-to));
    }
    
    .profile-gradient {
      background: linear-gradient(to right, var(--profile-gradient-from), var(--profile-gradient-to));
    }
    
    .positive {
      color: #38a169;
    }
    
    .negative {
      color: #e53e3e;
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
      .result-summary {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .result-difference {
        width: 100%;
      }
      
      .analysis-stats {
        flex-direction: column;
      }
      
      .common-parameters-container {
        grid-template-columns: 1fr;
      }
      
      .diff-parameters-container {
        grid-template-columns: 1fr !important;
      }
      
      .profile-diff-column {
        margin-bottom: 20px;
      }
      
      /* Mobile optimization for results table */
      .results-table {
        overflow-x: auto;
      }
      
      .result-row {
        flex-direction: column;
      }
      
      .result-label {
        width: 100%;
        min-width: 100%;
      }
      
      .result-values-container {
        flex-direction: column;
        border-left: 4px solid #e2e8f0;
      }
      
      .result-value-column {
        border-right: none;
        border-bottom: 1px solid #e2e8f0;
      }
      
      .result-value-column:last-child {
        border-bottom: none;
      }
    }
  `,document.head.appendChild(t)}function ci(t){return{basePrice:"Base Price",baseYield:"Base Yield",meanYield:"Mean Yield",opCost:"Operational Cost",baseYieldType:"Base Yield Type",variedYield:"Varied Yield",annualIncrease:"Annual Yield Increase",annualIncreaseRate:"Annual Increase Rate",stepChangeEnabled:"Step Change Enabled",stepChangeYear:"Step Change Year",stepChangeAmount:"Step Change Amount",droughtYears:"Drought Years",droughtYield:"Drought Yield",netWorthHa:"Net Worth per Hectare",equityPercent:"Equity Percentage",landValueAppreciation:"Land Value Appreciation",landAppreciationRate:"Land Appreciation Rate",criticalEquity:"Critical Equity Threshold",sensitivities:"Sensitivity Adjustments",location:"Location",crop:"Crop"}[t]||t.replace(/([A-Z])/g," $1").replace(/^./,a=>a.toUpperCase())}function qr(t,e){if(e==null)return"N/A";switch(t){case"basePrice":case"opCost":case"netWorthHa":return ce(e);case"meanYield":case"droughtYield":return`${parseFloat(e).toFixed(2)} t/ha`;case"baseYieldType":return{mean:"Mean Yield",rcp45:"RCP 4.5",rcp85:"RCP 8.5"}[e]||e;case"variedYield":case"annualIncrease":case"landValueAppreciation":case"stepChangeEnabled":return e===!0||e==="true"?"Yes":"No";case"annualIncreaseRate":case"landAppreciationRate":case"equityPercent":case"criticalEquity":case"stepChangeAmount":return`${e}%`;case"droughtYears":return Array.isArray(e)&&e.length>0?e.sort().join(", "):"None";default:return typeof e=="boolean"?e?"Yes":"No":typeof e=="number"?e.toString():typeof e=="string"?e:Array.isArray(e)?e.join(", "):typeof e=="object"?JSON.stringify(e):String(e)}}function vo(t){switch(t){case"high":return'<i class="fas fa-exclamation-circle"></i>';case"medium":return'<i class="fas fa-exclamation-triangle"></i>';case"low":return'<i class="fas fa-info-circle"></i>';default:return'<i class="fas fa-question-circle"></i>'}}function ce(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}function Ff(t,e="comparison-actions"){const a=document.querySelector(t);if(!a)return null;let i=a.querySelector(`.${e}`);return i||(i=document.createElement("div"),i.className=e,a.appendChild(i)),i}function $f(){Df(),zr(),Rf()}function Nf(t,e){if(!e||!t||t.length<=1)return;e.innerHTML="";const a=zi(t),i=document.createElement("h3");i.innerHTML='<i class="fas fa-lightbulb"></i> Understanding Profile Differences',e.appendChild(i);const n=document.createElement("div");n.className="analysis-summary elevation-1";let o="";if(a.resultSummary){const l=a.resultSummary;o=`
      <div class="result-summary ${{large:"result-large-diff",medium:"result-medium-diff",small:"result-small-diff"}[l.differenceLevel]||""}">
        <div class="result-difference">
          <span class="result-diff-value">${ce(Math.abs(l.marginDifference))}</span>
          <span class="result-diff-label">difference in final margin</span>
        </div>
        <div class="result-insight">
          <p><strong>${l.bestPerforming}</strong> performs best with the highest margin.</p>
          <p><strong>${l.worstPerforming}</strong> performs worst with the lowest margin.</p>
        </div>
      </div>
    `}const r=Object.keys(a.differentiatingParameters).length,s=Object.keys(a.commonParameters).length;n.innerHTML=`
    <p>Comparing ${t.length} profiles: ${t.map(l=>`<strong>${l.name}</strong>`).join(", ")}</p>
    ${o}
    <div class="analysis-stats">
      <div class="stat-item ${r>0?"stat-highlight":""}">
        <span class="stat-value">${r}</span>
        <span class="stat-label">Differentiating Parameters</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">${s}</span>
        <span class="stat-label">Common Parameters</span>
      </div>
    </div>
  `,e.appendChild(n),a.categorizedCommon&&Object.keys(a.categorizedCommon).length>0&&jr(e,a),a.categorizedDiff&&Object.keys(a.categorizedDiff).length>0&&Vr(e,a,t),a.resultDifferences&&a.resultDifferences.finalMargin&&Hr(e,a,t)}window.generateUnderstandContent=Nf;window.analyzeComparisonProfiles=zi;window.openUnderstandComparisonModal=Wr;window.closeUnderstandComparisonModal=li;window.initializeUnderstandComparisonFeature=$f;const Wi=[{town_name:"Albany",operational_cost:400,soil_evaporation:110,current_plant_available_water:734,rcp45_available_water:642,rcp85_available_water:587},{town_name:"Albany Airport",operational_cost:400,soil_evaporation:110,current_plant_available_water:734,rcp45_available_water:642,rcp85_available_water:587},{town_name:"Allanooka",operational_cost:400,soil_evaporation:110,current_plant_available_water:379,rcp45_available_water:345,rcp85_available_water:299},{town_name:"Amery Acres",operational_cost:300,soil_evaporation:100,current_plant_available_water:274,rcp45_available_water:264,rcp85_available_water:236},{town_name:"Amrista Park",operational_cost:400,soil_evaporation:110,current_plant_available_water:273,rcp45_available_water:248,rcp85_available_water:229},{town_name:"Ardath",operational_cost:400,soil_evaporation:110,current_plant_available_water:259,rcp45_available_water:233,rcp85_available_water:215},{town_name:"Arena",operational_cost:400,soil_evaporation:110,current_plant_available_water:305,rcp45_available_water:281,rcp85_available_water:244},{town_name:"Arthur River Comp",operational_cost:400,soil_evaporation:110,current_plant_available_water:364,rcp45_available_water:348,rcp85_available_water:315},{town_name:"Babakin",operational_cost:400,soil_evaporation:110,current_plant_available_water:271,rcp45_available_water:245,rcp85_available_water:225},{town_name:"Badgebup",operational_cost:400,soil_evaporation:110,current_plant_available_water:310,rcp45_available_water:284,rcp85_available_water:260},{town_name:"Badgingarra",operational_cost:400,soil_evaporation:110,current_plant_available_water:449,rcp45_available_water:421,rcp85_available_water:374},{town_name:"Badgingarra Research Stn",operational_cost:400,soil_evaporation:110,current_plant_available_water:449,rcp45_available_water:421,rcp85_available_water:374},{town_name:"Balingdale",operational_cost:400,soil_evaporation:110,current_plant_available_water:352,rcp45_available_water:335,rcp85_available_water:309},{town_name:"Balingup",operational_cost:400,soil_evaporation:110,current_plant_available_water:715,rcp45_available_water:676,rcp85_available_water:611},{town_name:"Balingup Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:715,rcp45_available_water:676,rcp85_available_water:611},{town_name:"Balkuling North",operational_cost:400,soil_evaporation:110,current_plant_available_water:323,rcp45_available_water:305,rcp85_available_water:276},{town_name:"Bannister",operational_cost:400,soil_evaporation:110,current_plant_available_water:529,rcp45_available_water:536,rcp85_available_water:481},{town_name:"Barberton",operational_cost:400,soil_evaporation:110,current_plant_available_water:382,rcp45_available_water:364,rcp85_available_water:323},{town_name:"Barooga",operational_cost:400,soil_evaporation:110,current_plant_available_water:405,rcp45_available_water:380,rcp85_available_water:343},{town_name:"Barrett Meadows",operational_cost:400,soil_evaporation:110,current_plant_available_water:827,rcp45_available_water:723,rcp85_available_water:660},{town_name:"Beacon",operational_cost:400,soil_evaporation:110,current_plant_available_water:230,rcp45_available_water:215,rcp85_available_water:194},{town_name:"Belka",operational_cost:400,soil_evaporation:110,current_plant_available_water:252,rcp45_available_water:248,rcp85_available_water:216},{town_name:"Belka East",operational_cost:400,soil_evaporation:110,current_plant_available_water:252,rcp45_available_water:248,rcp85_available_water:216},{town_name:"Bencubbin",operational_cost:400,soil_evaporation:110,current_plant_available_water:232,rcp45_available_water:214,rcp85_available_water:196},{town_name:"Berkshire Valley 2",operational_cost:400,soil_evaporation:110,current_plant_available_water:321,rcp45_available_water:307,rcp85_available_water:271},{town_name:"Beverley",operational_cost:400,soil_evaporation:110,current_plant_available_water:330,rcp45_available_water:316,rcp85_available_water:285},{town_name:"Bickley",operational_cost:400,soil_evaporation:110,current_plant_available_water:879,rcp45_available_water:746,rcp85_available_water:669},{town_name:"Bilbarin",operational_cost:400,soil_evaporation:110,current_plant_available_water:266,rcp45_available_water:240,rcp85_available_water:221},{town_name:"Bindi Bindi",operational_cost:400,soil_evaporation:110,current_plant_available_water:310,rcp45_available_water:298,rcp85_available_water:263},{town_name:"Bindi Bindi East",operational_cost:400,soil_evaporation:110,current_plant_available_water:310,rcp45_available_water:298,rcp85_available_water:263},{town_name:"Bindoon",operational_cost:400,soil_evaporation:110,current_plant_available_water:555,rcp45_available_water:492,rcp85_available_water:439},{town_name:"Binnu",operational_cost:400,soil_evaporation:110,current_plant_available_water:290,rcp45_available_water:284,rcp85_available_water:242},{town_name:"Bodallin South",operational_cost:400,soil_evaporation:110,current_plant_available_water:269,rcp45_available_water:237,rcp85_available_water:217},{town_name:"Bokerup",operational_cost:400,soil_evaporation:110,current_plant_available_water:526,rcp45_available_water:499,rcp85_available_water:451},{town_name:"Bolgart",operational_cost:400,soil_evaporation:110,current_plant_available_water:351,rcp45_available_water:330,rcp85_available_water:294},{town_name:"Bonnie Rock",operational_cost:400,soil_evaporation:110,current_plant_available_water:224,rcp45_available_water:200,rcp85_available_water:183},{town_name:"Boodarockin",operational_cost:400,soil_evaporation:110,current_plant_available_water:221,rcp45_available_water:203,rcp85_available_water:185},{town_name:"Booralee",operational_cost:400,soil_evaporation:110,current_plant_available_water:268,rcp45_available_water:234,rcp85_available_water:217},{town_name:"Borden Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:300,rcp45_available_water:279,rcp85_available_water:256},{town_name:"Boscabel",operational_cost:400,soil_evaporation:110,current_plant_available_water:398,rcp45_available_water:362,rcp85_available_water:328},{town_name:"Bowgada",operational_cost:400,soil_evaporation:110,current_plant_available_water:246,rcp45_available_water:237,rcp85_available_water:206},{town_name:"Boyanup Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:744,rcp45_available_water:695,rcp85_available_water:628},{town_name:"Boyatup",operational_cost:400,soil_evaporation:110,current_plant_available_water:421,rcp45_available_water:387,rcp85_available_water:369},{town_name:"Boyup Brook",operational_cost:400,soil_evaporation:110,current_plant_available_water:517,rcp45_available_water:496,rcp85_available_water:449},{town_name:"Bremer Bay",operational_cost:400,soil_evaporation:110,current_plant_available_water:514,rcp45_available_water:446,rcp85_available_water:411},{town_name:"Bridgetown",operational_cost:400,soil_evaporation:110,current_plant_available_water:655,rcp45_available_water:608,rcp85_available_water:549},{town_name:"Bridgetown Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:655,rcp45_available_water:608,rcp85_available_water:549},{town_name:"Brookton",operational_cost:400,soil_evaporation:110,current_plant_available_water:345,rcp45_available_water:310,rcp85_available_water:288},{town_name:"Broomehill Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:347,rcp45_available_water:317,rcp85_available_water:289},{town_name:"Bruce Rock",operational_cost:400,soil_evaporation:110,current_plant_available_water:250,rcp45_available_water:234,rcp85_available_water:216},{town_name:"Brunswick Junction",operational_cost:400,soil_evaporation:110,current_plant_available_water:812,rcp45_available_water:725,rcp85_available_water:655},{town_name:"Bullfinch",operational_cost:400,soil_evaporation:110,current_plant_available_water:232,rcp45_available_water:213,rcp85_available_water:196},{town_name:"Bulyee",operational_cost:400,soil_evaporation:110,current_plant_available_water:279,rcp45_available_water:263,rcp85_available_water:239},{town_name:"Bunbury",operational_cost:400,soil_evaporation:110,current_plant_available_water:683,rcp45_available_water:661,rcp85_available_water:597},{town_name:"Bungulla",operational_cost:400,soil_evaporation:110,current_plant_available_water:265,rcp45_available_water:244,rcp85_available_water:222},{town_name:"Bunkin",operational_cost:400,soil_evaporation:110,current_plant_available_water:323,rcp45_available_water:319,rcp85_available_water:304},{town_name:"Buntine West",operational_cost:400,soil_evaporation:110,current_plant_available_water:255,rcp45_available_water:234,rcp85_available_water:205},{town_name:"Burakin",operational_cost:400,soil_evaporation:110,current_plant_available_water:240,rcp45_available_water:230,rcp85_available_water:206},{town_name:"Burracoppin Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:265,rcp45_available_water:235,rcp85_available_water:216},{town_name:"Burracoppin South",operational_cost:400,soil_evaporation:110,current_plant_available_water:265,rcp45_available_water:235,rcp85_available_water:216},{town_name:"Busselton Aero",operational_cost:400,soil_evaporation:110,current_plant_available_water:653,rcp45_available_water:660,rcp85_available_water:598},{town_name:"Busselton Shire",operational_cost:400,soil_evaporation:110,current_plant_available_water:653,rcp45_available_water:660,rcp85_available_water:598},{town_name:"Cadoux",operational_cost:400,soil_evaporation:110,current_plant_available_water:261,rcp45_available_water:252,rcp85_available_water:225},{town_name:"Calingiri",operational_cost:400,soil_evaporation:110,current_plant_available_water:354,rcp45_available_water:327,rcp85_available_water:290},{town_name:"Canna",operational_cost:400,soil_evaporation:110,current_plant_available_water:263,rcp45_available_water:254,rcp85_available_water:219},{town_name:"Canna East",operational_cost:400,soil_evaporation:110,current_plant_available_water:263,rcp45_available_water:254,rcp85_available_water:219},{town_name:"Cape Leeuwin",operational_cost:400,soil_evaporation:110,current_plant_available_water:850,rcp45_available_water:843,rcp85_available_water:764},{town_name:"Cape Naturaliste",operational_cost:400,soil_evaporation:110,current_plant_available_water:730,rcp45_available_water:726,rcp85_available_water:657},{town_name:"Capel",operational_cost:400,soil_evaporation:110,current_plant_available_water:653,rcp45_available_water:644,rcp85_available_water:583},{town_name:"Capel Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:653,rcp45_available_water:644,rcp85_available_water:583},{town_name:"Cardonia",operational_cost:400,soil_evaporation:110,current_plant_available_water:261,rcp45_available_water:250,rcp85_available_water:227},{town_name:"Carmendale",operational_cost:400,soil_evaporation:110,current_plant_available_water:616,rcp45_available_water:550,rcp85_available_water:502},{town_name:"Carnamah",operational_cost:400,soil_evaporation:110,current_plant_available_water:283,rcp45_available_water:273,rcp85_available_water:239},{town_name:"Carterville",operational_cost:400,soil_evaporation:110,current_plant_available_water:293,rcp45_available_water:274,rcp85_available_water:247},{town_name:"Cascade",operational_cost:400,soil_evaporation:110,current_plant_available_water:305,rcp45_available_water:281,rcp85_available_water:266},{town_name:"Chamingup",operational_cost:400,soil_evaporation:110,current_plant_available_water:426,rcp45_available_water:385,rcp85_available_water:350},{town_name:"Chapman",operational_cost:400,soil_evaporation:110,current_plant_available_water:280,rcp45_available_water:268,rcp85_available_water:230},{town_name:"Chapman Hill",operational_cost:400,soil_evaporation:110,current_plant_available_water:752,rcp45_available_water:718,rcp85_available_water:651},{town_name:"Chelsea",operational_cost:400,soil_evaporation:110,current_plant_available_water:438,rcp45_available_water:417,rcp85_available_water:367},{town_name:"Cherry Tree",operational_cost:400,soil_evaporation:110,current_plant_available_water:426,rcp45_available_water:385,rcp85_available_water:350},{town_name:"Chesalon",operational_cost:400,soil_evaporation:110,current_plant_available_water:257,rcp45_available_water:229,rcp85_available_water:215},{town_name:"Chidlow",operational_cost:400,soil_evaporation:110,current_plant_available_water:724,rcp45_available_water:662,rcp85_available_water:592},{town_name:"Chillinup",operational_cost:400,soil_evaporation:110,current_plant_available_water:352,rcp45_available_water:335,rcp85_available_water:309},{town_name:"Circle Valley",operational_cost:400,soil_evaporation:110,current_plant_available_water:253,rcp45_available_water:246,rcp85_available_water:234},{town_name:"Cloughton",operational_cost:400,soil_evaporation:110,current_plant_available_water:330,rcp45_available_water:316,rcp85_available_water:285},{town_name:"Codg Codgen",operational_cost:400,soil_evaporation:110,current_plant_available_water:232,rcp45_available_water:231,rcp85_available_water:211},{town_name:"Collie",operational_cost:400,soil_evaporation:110,current_plant_available_water:733,rcp45_available_water:695,rcp85_available_water:627},{town_name:"Collie East",operational_cost:400,soil_evaporation:110,current_plant_available_water:733,rcp45_available_water:695,rcp85_available_water:627},{town_name:"Colorado",operational_cost:400,soil_evaporation:110,current_plant_available_water:279,rcp45_available_water:263,rcp85_available_water:239},{town_name:"Condingup",operational_cost:400,soil_evaporation:110,current_plant_available_water:448,rcp45_available_water:411,rcp85_available_water:389},{town_name:"Coolangatta 2",operational_cost:400,soil_evaporation:110,current_plant_available_water:289,rcp45_available_water:272,rcp85_available_water:236},{town_name:"Coomalbidgup",operational_cost:400,soil_evaporation:110,current_plant_available_water:431,rcp45_available_water:379,rcp85_available_water:357},{town_name:"Coorow",operational_cost:400,soil_evaporation:110,current_plant_available_water:284,rcp45_available_water:271,rcp85_available_water:238},{town_name:"Coorow Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:284,rcp45_available_water:271,rcp85_available_water:238},{town_name:"Coppin Rock",operational_cost:400,soil_evaporation:110,current_plant_available_water:221,rcp45_available_water:203,rcp85_available_water:185},{town_name:"Cordering",operational_cost:400,soil_evaporation:110,current_plant_available_water:463,rcp45_available_water:432,rcp85_available_water:389},{town_name:"Corrigin",operational_cost:400,soil_evaporation:110,current_plant_available_water:277,rcp45_available_water:253,rcp85_available_water:232},{town_name:"Corrigin East",operational_cost:400,soil_evaporation:110,current_plant_available_water:277,rcp45_available_water:253,rcp85_available_water:232},{town_name:"Cowaramup",operational_cost:400,soil_evaporation:110,current_plant_available_water:910,rcp45_available_water:823,rcp85_available_water:745},{town_name:"Cowcowing",operational_cost:400,soil_evaporation:110,current_plant_available_water:236,rcp45_available_water:225,rcp85_available_water:203},{town_name:"Cranbrook",operational_cost:400,soil_evaporation:110,current_plant_available_water:397,rcp45_available_water:360,rcp85_available_water:329},{town_name:"Cranham",operational_cost:400,soil_evaporation:110,current_plant_available_water:426,rcp45_available_water:385,rcp85_available_water:350},{town_name:"Cuballing Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:365,rcp45_available_water:324,rcp85_available_water:294},{town_name:"Culford",operational_cost:400,soil_evaporation:110,current_plant_available_water:529,rcp45_available_water:536,rcp85_available_water:481},{town_name:"Cunderdin Airfield",operational_cost:400,soil_evaporation:110,current_plant_available_water:280,rcp45_available_water:257,rcp85_available_water:232},{town_name:"Dalwallinu",operational_cost:400,soil_evaporation:110,current_plant_available_water:267,rcp45_available_water:245,rcp85_available_water:216},{town_name:"Dandaragan West",operational_cost:400,soil_evaporation:110,current_plant_available_water:452,rcp45_available_water:418,rcp85_available_water:376},{town_name:"Dardanup",operational_cost:400,soil_evaporation:110,current_plant_available_water:742,rcp45_available_water:687,rcp85_available_water:621},{town_name:"Dardanup 2",operational_cost:400,soil_evaporation:110,current_plant_available_water:742,rcp45_available_water:687,rcp85_available_water:621},{town_name:"Darkan",operational_cost:400,soil_evaporation:110,current_plant_available_water:439,rcp45_available_water:421,rcp85_available_water:380},{town_name:"Darkan Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:439,rcp45_available_water:421,rcp85_available_water:380},{town_name:"Dartmoor",operational_cost:400,soil_evaporation:110,current_plant_available_water:227,rcp45_available_water:219,rcp85_available_water:187},{town_name:"Dellyanine",operational_cost:400,soil_evaporation:110,current_plant_available_water:369,rcp45_available_water:354,rcp85_available_water:321},{town_name:"Denbarker",operational_cost:400,soil_evaporation:110,current_plant_available_water:593,rcp45_available_water:539,rcp85_available_water:492},{town_name:"Denmark",operational_cost:400,soil_evaporation:110,current_plant_available_water:868,rcp45_available_water:750,rcp85_available_water:684},{town_name:"Denmark Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:868,rcp45_available_water:750,rcp85_available_water:684},{town_name:"Dininnup",operational_cost:400,soil_evaporation:110,current_plant_available_water:473,rcp45_available_water:452,rcp85_available_water:409},{town_name:"Dobra Scritia",operational_cost:400,soil_evaporation:110,current_plant_available_water:259,rcp45_available_water:237,rcp85_available_water:217},{town_name:"Dongara",operational_cost:400,soil_evaporation:110,current_plant_available_water:384,rcp45_available_water:357,rcp85_available_water:311},{town_name:"Donnybrook",operational_cost:400,soil_evaporation:110,current_plant_available_water:761,rcp45_available_water:713,rcp85_available_water:646},{town_name:"Doodlakine",operational_cost:400,soil_evaporation:110,current_plant_available_water:234,rcp45_available_water:236,rcp85_available_water:215},{town_name:"Doongin Peak",operational_cost:400,soil_evaporation:110,current_plant_available_water:257,rcp45_available_water:240,rcp85_available_water:218},{town_name:"Dowerin Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:274,rcp45_available_water:264,rcp85_available_water:236},{town_name:"Dragon Rocks",operational_cost:400,soil_evaporation:110,current_plant_available_water:283,rcp45_available_water:243,rcp85_available_water:225},{town_name:"Dudawa",operational_cost:400,soil_evaporation:110,current_plant_available_water:289,rcp45_available_water:274,rcp85_available_water:239},{town_name:"Dumbleyung",operational_cost:400,soil_evaporation:110,current_plant_available_water:288,rcp45_available_water:280,rcp85_available_water:257},{town_name:"Dumbleyung Grdc",operational_cost:400,soil_evaporation:110,current_plant_available_water:288,rcp45_available_water:280,rcp85_available_water:257},{town_name:"Dumbleyung Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:288,rcp45_available_water:280,rcp85_available_water:257},{town_name:"Dunelm",operational_cost:400,soil_evaporation:110,current_plant_available_water:280,rcp45_available_water:259,rcp85_available_water:239},{town_name:"Dwellingup Forestry",operational_cost:400,soil_evaporation:110,current_plant_available_water:991,rcp45_available_water:878,rcp85_available_water:788},{town_name:"East Beverley",operational_cost:400,soil_evaporation:110,current_plant_available_water:330,rcp45_available_water:316,rcp85_available_water:285},{town_name:"Ejanding",operational_cost:400,soil_evaporation:110,current_plant_available_water:252,rcp45_available_water:240,rcp85_available_water:216},{town_name:"Elaroo",operational_cost:400,soil_evaporation:110,current_plant_available_water:302,rcp45_available_water:289,rcp85_available_water:264},{town_name:"Eneabba",operational_cost:400,soil_evaporation:110,current_plant_available_water:404,rcp45_available_water:374,rcp85_available_water:331},{town_name:"Eradu",operational_cost:400,soil_evaporation:110,current_plant_available_water:313,rcp45_available_water:294,rcp85_available_water:253},{town_name:"Eradu 2",operational_cost:400,soil_evaporation:110,current_plant_available_water:313,rcp45_available_water:294,rcp85_available_water:253},{town_name:"Erangy Springs",operational_cost:400,soil_evaporation:110,current_plant_available_water:336,rcp45_available_water:305,rcp85_available_water:265},{town_name:"Erinair",operational_cost:400,soil_evaporation:110,current_plant_available_water:473,rcp45_available_water:417,rcp85_available_water:391},{town_name:"Esperance",operational_cost:400,soil_evaporation:110,current_plant_available_water:538,rcp45_available_water:474,rcp85_available_water:446},{town_name:"Esperance Aero",operational_cost:400,soil_evaporation:110,current_plant_available_water:538,rcp45_available_water:474,rcp85_available_water:446},{town_name:"Esperance Downs",operational_cost:400,soil_evaporation:110,current_plant_available_water:538,rcp45_available_water:474,rcp85_available_water:446},{town_name:"Esperance Downs Research Stn",operational_cost:400,soil_evaporation:110,current_plant_available_water:538,rcp45_available_water:474,rcp85_available_water:446},{town_name:"Esperia",operational_cost:400,soil_evaporation:110,current_plant_available_water:274,rcp45_available_water:239,rcp85_available_water:221},{town_name:"Ferguson",operational_cost:400,soil_evaporation:110,current_plant_available_water:790,rcp45_available_water:723,rcp85_available_water:654},{town_name:"Five Gums - Walbula Stud",operational_cost:400,soil_evaporation:110,current_plant_available_water:246,rcp45_available_water:237,rcp85_available_water:206},{town_name:"Floreat Park",operational_cost:400,soil_evaporation:110,current_plant_available_water:630,rcp45_available_water:631,rcp85_available_water:565},{town_name:"Forest Grove",operational_cost:400,soil_evaporation:110,current_plant_available_water:978,rcp45_available_water:862,rcp85_available_water:780},{town_name:"Fouracres",operational_cost:400,soil_evaporation:110,current_plant_available_water:932,rcp45_available_water:835,rcp85_available_water:754},{town_name:"Frankland",operational_cost:400,soil_evaporation:110,current_plant_available_water:481,rcp45_available_water:453,rcp85_available_water:412},{town_name:"Frankland Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:481,rcp45_available_water:453,rcp85_available_water:412},{town_name:"Gabbin",operational_cost:400,soil_evaporation:110,current_plant_available_water:231,rcp45_available_water:215,rcp85_available_water:195},{town_name:"Gairdner",operational_cost:400,soil_evaporation:110,current_plant_available_water:352,rcp45_available_water:335,rcp85_available_water:309},{town_name:"Geraldton Airport",operational_cost:400,soil_evaporation:110,current_plant_available_water:368,rcp45_available_water:339,rcp85_available_water:292},{town_name:"Geraldton Water Supply",operational_cost:400,soil_evaporation:110,current_plant_available_water:368,rcp45_available_water:339,rcp85_available_water:292},{town_name:"Ghurka",operational_cost:400,soil_evaporation:110,current_plant_available_water:367,rcp45_available_water:334,rcp85_available_water:283},{town_name:"Gidgegannup 3",operational_cost:400,soil_evaporation:110,current_plant_available_water:748,rcp45_available_water:685,rcp85_available_water:612},{town_name:"Gingin",operational_cost:400,soil_evaporation:110,current_plant_available_water:556,rcp45_available_water:506,rcp85_available_water:451},{town_name:"Gingin Aero",operational_cost:400,soil_evaporation:110,current_plant_available_water:556,rcp45_available_water:506,rcp85_available_water:451},{town_name:"Gingin West",operational_cost:400,soil_evaporation:110,current_plant_available_water:556,rcp45_available_water:506,rcp85_available_water:451},{town_name:"Glamoff",operational_cost:400,soil_evaporation:110,current_plant_available_water:240,rcp45_available_water:224,rcp85_available_water:199},{town_name:"Glen Eagle",operational_cost:400,soil_evaporation:110,current_plant_available_water:896,rcp45_available_water:817,rcp85_available_water:733},{town_name:"Glenmore",operational_cost:400,soil_evaporation:110,current_plant_available_water:279,rcp45_available_water:263,rcp85_available_water:239},{town_name:"Gnowangerup Grdc",operational_cost:400,soil_evaporation:110,current_plant_available_water:303,rcp45_available_water:276,rcp85_available_water:253},{town_name:"Gnowangerup Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:303,rcp45_available_water:276,rcp85_available_water:253},{town_name:"Goodlands",operational_cost:400,soil_evaporation:110,current_plant_available_water:235,rcp45_available_water:216,rcp85_available_water:192},{town_name:"Goomalling",operational_cost:400,soil_evaporation:110,current_plant_available_water:300,rcp45_available_water:287,rcp85_available_water:256},{town_name:"Gorya Valley",operational_cost:400,soil_evaporation:110,current_plant_available_water:252,rcp45_available_water:242,rcp85_available_water:229},{town_name:"Gosnells City",operational_cost:400,soil_evaporation:110,current_plant_available_water:696,rcp45_available_water:662,rcp85_available_water:593},{town_name:"Graham Rock",operational_cost:400,soil_evaporation:110,current_plant_available_water:274,rcp45_available_water:238,rcp85_available_water:220},{town_name:"Grass Patch",operational_cost:400,soil_evaporation:110,current_plant_available_water:279,rcp45_available_water:277,rcp85_available_water:263},{town_name:"Grass Valley",operational_cost:400,soil_evaporation:110,current_plant_available_water:322,rcp45_available_water:303,rcp85_available_water:272},{town_name:"Green Grove",operational_cost:400,soil_evaporation:110,current_plant_available_water:384,rcp45_available_water:357,rcp85_available_water:311},{town_name:"Green Hills",operational_cost:400,soil_evaporation:110,current_plant_available_water:303,rcp45_available_water:282,rcp85_available_water:255},{town_name:"Greenbushes",operational_cost:400,soil_evaporation:110,current_plant_available_water:728,rcp45_available_water:687,rcp85_available_water:622},{town_name:"Gutha West",operational_cost:400,soil_evaporation:110,current_plant_available_water:253,rcp45_available_water:238,rcp85_available_water:206},{town_name:"Happy Valley",operational_cost:400,soil_evaporation:110,current_plant_available_water:274,rcp45_available_water:264,rcp85_available_water:236},{town_name:"Harvey",operational_cost:400,soil_evaporation:110,current_plant_available_water:827,rcp45_available_water:764,rcp85_available_water:687},{town_name:"Highbury East",operational_cost:400,soil_evaporation:110,current_plant_available_water:340,rcp45_available_water:314,rcp85_available_water:286},{town_name:"Highfields",operational_cost:400,soil_evaporation:110,current_plant_available_water:283,rcp45_available_water:273,rcp85_available_water:239},{town_name:"Hines Hill",operational_cost:400,soil_evaporation:110,current_plant_available_water:235,rcp45_available_water:230,rcp85_available_water:211},{town_name:"Holt Rock",operational_cost:400,soil_evaporation:110,current_plant_available_water:253,rcp45_available_water:231,rcp85_available_water:215},{town_name:"Hopetoun North",operational_cost:400,soil_evaporation:110,current_plant_available_water:388,rcp45_available_water:340,rcp85_available_water:316},{town_name:"Hopetoun Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:388,rcp45_available_water:340,rcp85_available_water:316},{town_name:"Hyden",operational_cost:400,soil_evaporation:110,current_plant_available_water:273,rcp45_available_water:236,rcp85_available_water:219},{town_name:"I Dunno",operational_cost:400,soil_evaporation:110,current_plant_available_water:252,rcp45_available_water:242,rcp85_available_water:229},{town_name:"Jacup",operational_cost:400,soil_evaporation:110,current_plant_available_water:343,rcp45_available_water:302,rcp85_available_water:279},{town_name:"Jandakot Aero",operational_cost:400,soil_evaporation:110,current_plant_available_water:681,rcp45_available_water:654,rcp85_available_water:585},{town_name:"Jarrahdale",operational_cost:400,soil_evaporation:110,current_plant_available_water:896,rcp45_available_water:817,rcp85_available_water:733},{town_name:"Jarrahdale 2",operational_cost:400,soil_evaporation:110,current_plant_available_water:896,rcp45_available_water:817,rcp85_available_water:733},{town_name:"Jarrahwood",operational_cost:400,soil_evaporation:110,current_plant_available_water:787,rcp45_available_water:726,rcp85_available_water:658},{town_name:"Jerramungup",operational_cost:400,soil_evaporation:110,current_plant_available_water:327,rcp45_available_water:304,rcp85_available_water:281},{town_name:"Jerramungup Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:327,rcp45_available_water:304,rcp85_available_water:281},{town_name:"Jourerdine",operational_cost:400,soil_evaporation:110,current_plant_available_water:224,rcp45_available_water:200,rcp85_available_water:183},{town_name:"Jurien",operational_cost:400,soil_evaporation:110,current_plant_available_water:457,rcp45_available_water:441,rcp85_available_water:391},{town_name:"Jurien Bay",operational_cost:400,soil_evaporation:110,current_plant_available_water:457,rcp45_available_water:441,rcp85_available_water:391},{town_name:"Jurokine",operational_cost:400,soil_evaporation:110,current_plant_available_water:352,rcp45_available_water:343,rcp85_available_water:305},{town_name:"Kalannie",operational_cost:400,soil_evaporation:110,current_plant_available_water:235,rcp45_available_water:222,rcp85_available_water:197},{town_name:"Kalbarri",operational_cost:400,soil_evaporation:110,current_plant_available_water:291,rcp45_available_water:275,rcp85_available_water:233},{town_name:"Karlgarin Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:268,rcp45_available_water:234,rcp85_available_water:217},{town_name:"Karnet",operational_cost:400,soil_evaporation:110,current_plant_available_water:786,rcp45_available_water:718,rcp85_available_water:643},{town_name:"Karridale",operational_cost:400,soil_evaporation:110,current_plant_available_water:937,rcp45_available_water:858,rcp85_available_water:777},{town_name:"Katandra",operational_cost:400,soil_evaporation:110,current_plant_available_water:253,rcp45_available_water:231,rcp85_available_water:215},{town_name:"Katanning",operational_cost:400,soil_evaporation:110,current_plant_available_water:367,rcp45_available_water:330,rcp85_available_water:302},{town_name:"Katanning Grdc",operational_cost:400,soil_evaporation:110,current_plant_available_water:367,rcp45_available_water:330,rcp85_available_water:302},{town_name:"Katanning Ng In",operational_cost:400,soil_evaporation:110,current_plant_available_water:367,rcp45_available_water:330,rcp85_available_water:302},{town_name:"Katanning Ng Out",operational_cost:400,soil_evaporation:110,current_plant_available_water:367,rcp45_available_water:330,rcp85_available_water:302},{town_name:"Katta Barega",operational_cost:400,soil_evaporation:110,current_plant_available_water:343,rcp45_available_water:332,rcp85_available_water:315},{town_name:"Kellerberrin",operational_cost:400,soil_evaporation:110,current_plant_available_water:246,rcp45_available_water:239,rcp85_available_water:218},{town_name:"Kellerberrin North",operational_cost:400,soil_evaporation:110,current_plant_available_water:246,rcp45_available_water:239,rcp85_available_water:218},{town_name:"Kenandra",operational_cost:400,soil_evaporation:110,current_plant_available_water:231,rcp45_available_water:218,rcp85_available_water:198},{town_name:"Kendenup Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:439,rcp45_available_water:413,rcp85_available_water:377},{town_name:"Kendenup West",operational_cost:400,soil_evaporation:110,current_plant_available_water:439,rcp45_available_water:413,rcp85_available_water:377},{town_name:"Kenilworth Tu",operational_cost:400,soil_evaporation:110,current_plant_available_water:345,rcp45_available_water:310,rcp85_available_water:288},{town_name:"Kenine Hill",operational_cost:400,soil_evaporation:110,current_plant_available_water:398,rcp45_available_water:362,rcp85_available_water:328},{town_name:"Kimberley",operational_cost:400,soil_evaporation:110,current_plant_available_water:868,rcp45_available_water:750,rcp85_available_water:684},{town_name:"King Rocks",operational_cost:400,soil_evaporation:110,current_plant_available_water:276,rcp45_available_water:248,rcp85_available_water:230},{town_name:"Kings Park",operational_cost:400,soil_evaporation:110,current_plant_available_water:647,rcp45_available_water:639,rcp85_available_water:573},{town_name:"Kitlane",operational_cost:400,soil_evaporation:110,current_plant_available_water:250,rcp45_available_water:234,rcp85_available_water:216},{town_name:"Kojaneerup",operational_cost:400,soil_evaporation:110,current_plant_available_water:414,rcp45_available_water:368,rcp85_available_water:338},{town_name:"Kojonolokan Hills",operational_cost:400,soil_evaporation:110,current_plant_available_water:334,rcp45_available_water:329,rcp85_available_water:298},{town_name:"Kojonup",operational_cost:400,soil_evaporation:110,current_plant_available_water:426,rcp45_available_water:385,rcp85_available_water:350},{town_name:"Kokardine",operational_cost:400,soil_evaporation:110,current_plant_available_water:253,rcp45_available_water:241,rcp85_available_water:216},{town_name:"Kondinin",operational_cost:400,soil_evaporation:110,current_plant_available_water:258,rcp45_available_water:237,rcp85_available_water:218},{town_name:"Kondinin Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:258,rcp45_available_water:237,rcp85_available_water:218},{town_name:"Kondut",operational_cost:400,soil_evaporation:110,current_plant_available_water:268,rcp45_available_water:253,rcp85_available_water:225},{town_name:"Konnongorring",operational_cost:400,soil_evaporation:110,current_plant_available_water:278,rcp45_available_water:267,rcp85_available_water:238},{town_name:"Koorda",operational_cost:400,soil_evaporation:110,current_plant_available_water:232,rcp45_available_water:219,rcp85_available_water:196},{town_name:"Koorikin",operational_cost:400,soil_evaporation:110,current_plant_available_water:251,rcp45_available_water:233,rcp85_available_water:214},{town_name:"Kukerin Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:280,rcp45_available_water:259,rcp85_available_water:239},{town_name:"Kulin",operational_cost:400,soil_evaporation:110,current_plant_available_water:274,rcp45_available_water:252,rcp85_available_water:232},{town_name:"Kulin Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:274,rcp45_available_water:252,rcp85_available_water:232},{town_name:"Kununoppin",operational_cost:400,soil_evaporation:110,current_plant_available_water:238,rcp45_available_water:220,rcp85_available_water:202},{town_name:"Kweda",operational_cost:400,soil_evaporation:110,current_plant_available_water:276,rcp45_available_water:256,rcp85_available_water:232},{town_name:"Lake Camm",operational_cost:400,soil_evaporation:110,current_plant_available_water:249,rcp45_available_water:229,rcp85_available_water:213},{town_name:"Lake Grace",operational_cost:400,soil_evaporation:110,current_plant_available_water:252,rcp45_available_water:230,rcp85_available_water:213},{town_name:"Lake King",operational_cost:400,soil_evaporation:110,current_plant_available_water:251,rcp45_available_water:228,rcp85_available_water:214},{town_name:"Lake King Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:251,rcp45_available_water:228,rcp85_available_water:214},{town_name:"Lancelin",operational_cost:400,soil_evaporation:110,current_plant_available_water:524,rcp45_available_water:494,rcp85_available_water:441},{town_name:"Lancelin East",operational_cost:400,soil_evaporation:110,current_plant_available_water:524,rcp45_available_water:494,rcp85_available_water:441},{town_name:"Latham",operational_cost:400,soil_evaporation:110,current_plant_available_water:243,rcp45_available_water:232,rcp85_available_water:203},{town_name:"Latham Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:243,rcp45_available_water:232,rcp85_available_water:203},{town_name:"Lochnagar",operational_cost:400,soil_evaporation:110,current_plant_available_water:255,rcp45_available_water:231,rcp85_available_water:214},{town_name:"Logue Brook",operational_cost:400,soil_evaporation:110,current_plant_available_water:892,rcp45_available_water:795,rcp85_available_water:714},{town_name:"Lorinna",operational_cost:400,soil_evaporation:110,current_plant_available_water:517,rcp45_available_water:454,rcp85_available_water:428},{town_name:"Lort River",operational_cost:400,soil_evaporation:110,current_plant_available_water:281,rcp45_available_water:279,rcp85_available_water:265},{town_name:"Ludlow",operational_cost:400,soil_evaporation:110,current_plant_available_water:654,rcp45_available_water:651,rcp85_available_water:590},{town_name:"Lynton",operational_cost:400,soil_evaporation:110,current_plant_available_water:355,rcp45_available_water:334,rcp85_available_water:285},{town_name:"Magenta",operational_cost:400,soil_evaporation:110,current_plant_available_water:279,rcp45_available_water:248,rcp85_available_water:231},{town_name:"Mallee Vale",operational_cost:400,soil_evaporation:110,current_plant_available_water:298,rcp45_available_water:272,rcp85_available_water:237},{town_name:"Manavi",operational_cost:400,soil_evaporation:110,current_plant_available_water:305,rcp45_available_water:294,rcp85_available_water:260},{town_name:"Mandurah",operational_cost:400,soil_evaporation:110,current_plant_available_water:629,rcp45_available_water:673,rcp85_available_water:604},{town_name:"Manjimup",operational_cost:400,soil_evaporation:110,current_plant_available_water:794,rcp45_available_water:725,rcp85_available_water:654},{town_name:"Manjimup Hrs",operational_cost:400,soil_evaporation:110,current_plant_available_water:794,rcp45_available_water:725,rcp85_available_water:654},{town_name:"Manypeaks",operational_cost:400,soil_evaporation:110,current_plant_available_water:605,rcp45_available_water:533,rcp85_available_water:489},{town_name:"Margaret River",operational_cost:400,soil_evaporation:110,current_plant_available_water:937,rcp45_available_water:840,rcp85_available_water:761},{town_name:"Margaret River Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:937,rcp45_available_water:840,rcp85_available_water:761},{town_name:"Marradong",operational_cost:400,soil_evaporation:110,current_plant_available_water:585,rcp45_available_water:576,rcp85_available_water:517},{town_name:"Mayanup South",operational_cost:400,soil_evaporation:110,current_plant_available_water:496,rcp45_available_water:484,rcp85_available_water:437},{town_name:"Maysboro",operational_cost:400,soil_evaporation:110,current_plant_available_water:394,rcp45_available_water:376,rcp85_available_water:334},{town_name:"Mcalinden",operational_cost:400,soil_evaporation:110,current_plant_available_water:569,rcp45_available_water:548,rcp85_available_water:495},{town_name:"Meckering",operational_cost:400,soil_evaporation:110,current_plant_available_water:293,rcp45_available_water:274,rcp85_available_water:247},{town_name:"Meckering North",operational_cost:400,soil_evaporation:110,current_plant_available_water:293,rcp45_available_water:274,rcp85_available_water:247},{town_name:"Medina",operational_cost:400,soil_evaporation:110,current_plant_available_water:645,rcp45_available_water:641,rcp85_available_water:573},{town_name:"Medina Research Centre",operational_cost:400,soil_evaporation:110,current_plant_available_water:645,rcp45_available_water:641,rcp85_available_water:573},{town_name:"Merredin",operational_cost:400,soil_evaporation:110,current_plant_available_water:262,rcp45_available_water:235,rcp85_available_water:215},{town_name:"Merredin Ng In",operational_cost:400,soil_evaporation:110,current_plant_available_water:262,rcp45_available_water:235,rcp85_available_water:215},{town_name:"Merredin Ng Out",operational_cost:400,soil_evaporation:110,current_plant_available_water:262,rcp45_available_water:235,rcp85_available_water:215},{town_name:"Mettler",operational_cost:400,soil_evaporation:110,current_plant_available_water:459,rcp45_available_water:406,rcp85_available_water:373},{town_name:"Midland",operational_cost:400,soil_evaporation:110,current_plant_available_water:641,rcp45_available_water:617,rcp85_available_water:552},{town_name:"Miling Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:278,rcp45_available_water:267,rcp85_available_water:236},{town_name:"Milyeannup",operational_cost:400,soil_evaporation:110,current_plant_available_water:845,rcp45_available_water:780,rcp85_available_water:705},{town_name:"Mindara",operational_cost:400,soil_evaporation:110,current_plant_available_water:334,rcp45_available_water:304,rcp85_available_water:264},{town_name:"Mingenew",operational_cost:400,soil_evaporation:110,current_plant_available_water:305,rcp45_available_water:281,rcp85_available_water:244},{town_name:"Mingenew Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:305,rcp45_available_water:281,rcp85_available_water:244},{town_name:"Mollerin Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:230,rcp45_available_water:213,rcp85_available_water:191},{town_name:"Moningarin",operational_cost:400,soil_evaporation:110,current_plant_available_water:251,rcp45_available_water:238,rcp85_available_water:213},{town_name:"Moora",operational_cost:400,soil_evaporation:110,current_plant_available_water:356,rcp45_available_water:341,rcp85_available_water:302},{town_name:"Moorine Rock",operational_cost:400,soil_evaporation:110,current_plant_available_water:236,rcp45_available_water:225,rcp85_available_water:206},{town_name:"Morawa",operational_cost:400,soil_evaporation:110,current_plant_available_water:255,rcp45_available_water:242,rcp85_available_water:211},{town_name:"Morawa Airport",operational_cost:400,soil_evaporation:110,current_plant_available_water:255,rcp45_available_water:242,rcp85_available_water:211},{town_name:"Mordetta",operational_cost:400,soil_evaporation:110,current_plant_available_water:259,rcp45_available_water:236,rcp85_available_water:219},{town_name:"Moree",operational_cost:400,soil_evaporation:110,current_plant_available_water:259,rcp45_available_water:237,rcp85_available_water:217},{town_name:"Mount Barker",operational_cost:400,soil_evaporation:110,current_plant_available_water:553,rcp45_available_water:509,rcp85_available_water:464},{town_name:"Mount Buraminya",operational_cost:400,soil_evaporation:110,current_plant_available_water:248,rcp45_available_water:254,rcp85_available_water:242},{town_name:"Mount Burdett",operational_cost:400,soil_evaporation:110,current_plant_available_water:308,rcp45_available_water:305,rcp85_available_water:291},{town_name:"Mount Howick",operational_cost:400,soil_evaporation:110,current_plant_available_water:476,rcp45_available_water:424,rcp85_available_water:402},{town_name:"Mount Walker",operational_cost:400,soil_evaporation:110,current_plant_available_water:255,rcp45_available_water:231,rcp85_available_water:214},{town_name:"Mt Madden East",operational_cost:400,soil_evaporation:110,current_plant_available_water:257,rcp45_available_water:229,rcp85_available_water:215},{town_name:"Mt Walker",operational_cost:400,soil_evaporation:110,current_plant_available_water:255,rcp45_available_water:231,rcp85_available_water:214},{town_name:"Muchea Tree Farm",operational_cost:400,soil_evaporation:110,current_plant_available_water:617,rcp45_available_water:564,rcp85_available_water:503},{town_name:"Muja Power Station",operational_cost:400,soil_evaporation:110,current_plant_available_water:596,rcp45_available_water:576,rcp85_available_water:519},{town_name:"Mukinbudin",operational_cost:400,soil_evaporation:110,current_plant_available_water:221,rcp45_available_water:202,rcp85_available_water:185},{town_name:"Mullewa",operational_cost:400,soil_evaporation:110,current_plant_available_water:263,rcp45_available_water:247,rcp85_available_water:212},{town_name:"Mumby",operational_cost:400,soil_evaporation:110,current_plant_available_water:312,rcp45_available_water:298,rcp85_available_water:254},{town_name:"Mundaring",operational_cost:400,soil_evaporation:110,current_plant_available_water:844,rcp45_available_water:755,rcp85_available_water:676},{town_name:"Munglinup Melaleuca",operational_cost:400,soil_evaporation:110,current_plant_available_water:403,rcp45_available_water:352,rcp85_available_water:331},{town_name:"Munglinup West",operational_cost:400,soil_evaporation:110,current_plant_available_water:403,rcp45_available_water:352,rcp85_available_water:331},{town_name:"Muresk",operational_cost:400,soil_evaporation:110,current_plant_available_water:369,rcp45_available_water:365,rcp85_available_water:327},{town_name:"Muresk Agric.College",operational_cost:400,soil_evaporation:110,current_plant_available_water:369,rcp45_available_water:365,rcp85_available_water:327},{town_name:"Murrumbah",operational_cost:400,soil_evaporation:110,current_plant_available_water:334,rcp45_available_water:304,rcp85_available_water:264},{town_name:"Myalup",operational_cost:400,soil_evaporation:110,current_plant_available_water:702,rcp45_available_water:693,rcp85_available_water:625},{town_name:"Myrup",operational_cost:400,soil_evaporation:110,current_plant_available_water:517,rcp45_available_water:454,rcp85_available_water:428},{town_name:"Nabawa",operational_cost:400,soil_evaporation:110,current_plant_available_water:354,rcp45_available_water:325,rcp85_available_water:280},{town_name:"Nangeenan",operational_cost:400,soil_evaporation:110,current_plant_available_water:238,rcp45_available_water:226,rcp85_available_water:207},{town_name:"Nannup",operational_cost:400,soil_evaporation:110,current_plant_available_water:756,rcp45_available_water:712,rcp85_available_water:644},{town_name:"Nannup 2 (Carlotta)",operational_cost:400,soil_evaporation:110,current_plant_available_water:756,rcp45_available_water:712,rcp85_available_water:644},{town_name:"Narembeen",operational_cost:400,soil_evaporation:110,current_plant_available_water:256,rcp45_available_water:236,rcp85_available_water:219},{town_name:"Narrogin",operational_cost:400,soil_evaporation:110,current_plant_available_water:369,rcp45_available_water:333,rcp85_available_water:301},{town_name:"New Norcia",operational_cost:400,soil_evaporation:110,current_plant_available_water:394,rcp45_available_water:376,rcp85_available_water:334},{town_name:"New Norcia Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:394,rcp45_available_water:376,rcp85_available_water:334},{town_name:"Newbicup",operational_cost:400,soil_evaporation:110,current_plant_available_water:517,rcp45_available_water:496,rcp85_available_water:449},{town_name:"Newdegate",operational_cost:400,soil_evaporation:110,current_plant_available_water:281,rcp45_available_water:243,rcp85_available_water:226},{town_name:"Newdegate Res.Station",operational_cost:400,soil_evaporation:110,current_plant_available_water:281,rcp45_available_water:243,rcp85_available_water:226},{town_name:"Newlands",operational_cost:400,soil_evaporation:110,current_plant_available_water:767,rcp45_available_water:733,rcp85_available_water:663},{town_name:"Noongaar",operational_cost:400,soil_evaporation:110,current_plant_available_water:259,rcp45_available_water:237,rcp85_available_water:217},{town_name:"Nornalup",operational_cost:400,soil_evaporation:110,current_plant_available_water:1012,rcp45_available_water:889,rcp85_available_water:809},{town_name:"Northam",operational_cost:400,soil_evaporation:110,current_plant_available_water:347,rcp45_available_water:340,rcp85_available_water:304},{town_name:"Northampton",operational_cost:400,soil_evaporation:110,current_plant_available_water:367,rcp45_available_water:334,rcp85_available_water:283},{town_name:"Northcliffe",operational_cost:400,soil_evaporation:110,current_plant_available_water:1069,rcp45_available_water:924,rcp85_available_water:836},{town_name:"Nungarin Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:236,rcp45_available_water:217,rcp85_available_water:199},{town_name:"Nyabing",operational_cost:400,soil_evaporation:110,current_plant_available_water:292,rcp45_available_water:278,rcp85_available_water:255},{town_name:"Nyabing Grdc",operational_cost:400,soil_evaporation:110,current_plant_available_water:292,rcp45_available_water:278,rcp85_available_water:255},{town_name:"Nyabing Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:292,rcp45_available_water:278,rcp85_available_water:255},{town_name:"Nyerilup",operational_cost:400,soil_evaporation:110,current_plant_available_water:293,rcp45_available_water:278,rcp85_available_water:256},{town_name:"Oakland",operational_cost:400,soil_evaporation:110,current_plant_available_water:330,rcp45_available_water:316,rcp85_available_water:285},{town_name:"Ogilvie",operational_cost:400,soil_evaporation:110,current_plant_available_water:312,rcp45_available_water:298,rcp85_available_water:254},{town_name:"One Tree Bridge (Hazelmere)",operational_cost:400,soil_evaporation:110,current_plant_available_water:860,rcp45_available_water:786,rcp85_available_water:708},{town_name:"Ongerup",operational_cost:400,soil_evaporation:110,current_plant_available_water:300,rcp45_available_water:278,rcp85_available_water:256},{town_name:"Ongerup Grdc",operational_cost:400,soil_evaporation:110,current_plant_available_water:300,rcp45_available_water:278,rcp85_available_water:256},{town_name:"Ongerup North",operational_cost:400,soil_evaporation:110,current_plant_available_water:300,rcp45_available_water:278,rcp85_available_water:256},{town_name:"Pearce Raaf",operational_cost:400,soil_evaporation:110,current_plant_available_water:617,rcp45_available_water:564,rcp85_available_water:503},{town_name:"Pemberton",operational_cost:400,soil_evaporation:110,current_plant_available_water:1005,rcp45_available_water:892,rcp85_available_water:806},{town_name:"Peppermint Grove",operational_cost:400,soil_evaporation:110,current_plant_available_water:514,rcp45_available_water:446,rcp85_available_water:411},{town_name:"Perenjori",operational_cost:400,soil_evaporation:110,current_plant_available_water:232,rcp45_available_water:229,rcp85_available_water:200},{town_name:"Perenjori Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:232,rcp45_available_water:229,rcp85_available_water:200},{town_name:"Perth Airport",operational_cost:400,soil_evaporation:110,current_plant_available_water:647,rcp45_available_water:639,rcp85_available_water:573},{town_name:"Perth Metro",operational_cost:400,soil_evaporation:110,current_plant_available_water:647,rcp45_available_water:639,rcp85_available_water:573},{town_name:"Pingaring",operational_cost:400,soil_evaporation:110,current_plant_available_water:273,rcp45_available_water:248,rcp85_available_water:229},{town_name:"Pingaring Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:273,rcp45_available_water:248,rcp85_available_water:229},{town_name:"Pingelly",operational_cost:400,soil_evaporation:110,current_plant_available_water:355,rcp45_available_water:317,rcp85_available_water:286},{town_name:"Pingelly West",operational_cost:400,soil_evaporation:110,current_plant_available_water:355,rcp45_available_water:317,rcp85_available_water:286},{town_name:"Pingrup",operational_cost:400,soil_evaporation:110,current_plant_available_water:256,rcp45_available_water:245,rcp85_available_water:226},{town_name:"Pingrup East",operational_cost:400,soil_evaporation:110,current_plant_available_water:256,rcp45_available_water:245,rcp85_available_water:226},{town_name:"Pingrup South",operational_cost:400,soil_evaporation:110,current_plant_available_water:256,rcp45_available_water:245,rcp85_available_water:226},{town_name:"Pinjarra",operational_cost:400,soil_evaporation:110,current_plant_available_water:691,rcp45_available_water:705,rcp85_available_water:632},{town_name:"Pleasant Valley",operational_cost:400,soil_evaporation:110,current_plant_available_water:478,rcp45_available_water:422,rcp85_available_water:397},{town_name:"Popanyinning",operational_cost:400,soil_evaporation:110,current_plant_available_water:356,rcp45_available_water:315,rcp85_available_water:284},{town_name:"Porongorup",operational_cost:400,soil_evaporation:110,current_plant_available_water:545,rcp45_available_water:472,rcp85_available_water:433},{town_name:"Quairading",operational_cost:400,soil_evaporation:110,current_plant_available_water:282,rcp45_available_water:259,rcp85_available_water:236},{town_name:"Quairading Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:282,rcp45_available_water:259,rcp85_available_water:236},{town_name:"Qualeup",operational_cost:400,soil_evaporation:110,current_plant_available_water:454,rcp45_available_water:421,rcp85_available_water:381},{town_name:"Quellington",operational_cost:400,soil_evaporation:110,current_plant_available_water:312,rcp45_available_water:305,rcp85_available_water:274},{town_name:"Quininup",operational_cost:400,soil_evaporation:110,current_plant_available_water:853,rcp45_available_water:760,rcp85_available_water:687},{town_name:"Ravensthorpe",operational_cost:400,soil_evaporation:110,current_plant_available_water:321,rcp45_available_water:280,rcp85_available_water:262},{town_name:"Richfields",operational_cost:400,soil_evaporation:110,current_plant_available_water:403,rcp45_available_water:352,rcp85_available_water:331},{town_name:"Riverdale",operational_cost:400,soil_evaporation:110,current_plant_available_water:398,rcp45_available_water:362,rcp85_available_water:328},{town_name:"Riverside",operational_cost:400,soil_evaporation:110,current_plant_available_water:270,rcp45_available_water:267,rcp85_available_water:227},{town_name:"Rocky Gully",operational_cost:400,soil_evaporation:110,current_plant_available_water:590,rcp45_available_water:545,rcp85_available_water:495},{town_name:"Roelands",operational_cost:400,soil_evaporation:110,current_plant_available_water:818,rcp45_available_water:756,rcp85_available_water:682},{town_name:"Roleystone",operational_cost:400,soil_evaporation:110,current_plant_available_water:851,rcp45_available_water:814,rcp85_available_water:730},{town_name:"Rolling Green",operational_cost:400,soil_evaporation:110,current_plant_available_water:555,rcp45_available_water:492,rcp85_available_water:439},{town_name:"Rosa Brook",operational_cost:400,soil_evaporation:110,current_plant_available_water:905,rcp45_available_water:827,rcp85_available_water:749},{town_name:"Rushy Pool",operational_cost:400,soil_evaporation:110,current_plant_available_water:309,rcp45_available_water:295,rcp85_available_water:269},{town_name:"Salmon Gums",operational_cost:400,soil_evaporation:110,current_plant_available_water:252,rcp45_available_water:242,rcp85_available_water:229},{town_name:"Salmon Gums Res.Stn.",operational_cost:400,soil_evaporation:110,current_plant_available_water:252,rcp45_available_water:242,rcp85_available_water:229},{town_name:"Sandsprings",operational_cost:400,soil_evaporation:110,current_plant_available_water:361,rcp45_available_water:326,rcp85_available_water:281},{town_name:"Scaddan",operational_cost:400,soil_evaporation:110,current_plant_available_water:338,rcp45_available_water:322,rcp85_available_water:304},{town_name:"Scaddan West",operational_cost:400,soil_evaporation:110,current_plant_available_water:338,rcp45_available_water:322,rcp85_available_water:304},{town_name:"Scott River",operational_cost:400,soil_evaporation:110,current_plant_available_water:870,rcp45_available_water:818,rcp85_available_water:741},{town_name:"Serpentine",operational_cost:400,soil_evaporation:110,current_plant_available_water:786,rcp45_available_water:718,rcp85_available_water:643},{town_name:"Seven Oaks",operational_cost:400,soil_evaporation:110,current_plant_available_water:265,rcp45_available_water:235,rcp85_available_water:216},{town_name:"Shackelton",operational_cost:400,soil_evaporation:110,current_plant_available_water:247,rcp45_available_water:240,rcp85_available_water:219},{town_name:"Shannon",operational_cost:400,soil_evaporation:110,current_plant_available_water:1069,rcp45_available_water:924,rcp85_available_water:836},{town_name:"South Holmwood",operational_cost:400,soil_evaporation:110,current_plant_available_water:287,rcp45_available_water:268,rcp85_available_water:233},{town_name:"South Perth",operational_cost:400,soil_evaporation:110,current_plant_available_water:647,rcp45_available_water:639,rcp85_available_water:573},{town_name:"Southern Cross Airfield",operational_cost:400,soil_evaporation:110,current_plant_available_water:239,rcp45_available_water:221,rcp85_available_water:203},{town_name:"Stirlings North",operational_cost:400,soil_evaporation:110,current_plant_available_water:303,rcp45_available_water:276,rcp85_available_water:253},{town_name:"Stirlings South",operational_cost:400,soil_evaporation:110,current_plant_available_water:586,rcp45_available_water:523,rcp85_available_water:478},{town_name:"Swanara",operational_cost:400,soil_evaporation:110,current_plant_available_water:255,rcp45_available_water:231,rcp85_available_water:214},{town_name:"Tallangatta",operational_cost:400,soil_evaporation:110,current_plant_available_water:388,rcp45_available_water:340,rcp85_available_water:316},{town_name:"Tamar",operational_cost:400,soil_evaporation:110,current_plant_available_water:605,rcp45_available_water:533,rcp85_available_water:489},{town_name:"Tamaru",operational_cost:400,soil_evaporation:110,current_plant_available_water:605,rcp45_available_water:533,rcp85_available_water:489},{town_name:"Tambellup",operational_cost:400,soil_evaporation:110,current_plant_available_water:327,rcp45_available_water:306,rcp85_available_water:279},{town_name:"Tambrey",operational_cost:400,soil_evaporation:110,current_plant_available_water:452,rcp45_available_water:418,rcp85_available_water:376},{town_name:"Tammin",operational_cost:400,soil_evaporation:110,current_plant_available_water:265,rcp45_available_water:244,rcp85_available_water:222},{town_name:"Tammin Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:265,rcp45_available_water:244,rcp85_available_water:222},{town_name:"Tardun",operational_cost:400,soil_evaporation:110,current_plant_available_water:258,rcp45_available_water:251,rcp85_available_water:217},{town_name:"Tenindewa",operational_cost:400,soil_evaporation:110,current_plant_available_water:264,rcp45_available_water:247,rcp85_available_water:211},{town_name:"The Oaks",operational_cost:400,soil_evaporation:110,current_plant_available_water:323,rcp45_available_water:319,rcp85_available_water:304},{town_name:"Three Springs",operational_cost:400,soil_evaporation:110,current_plant_available_water:293,rcp45_available_water:283,rcp85_available_water:248},{town_name:"Tone Bridge",operational_cost:400,soil_evaporation:110,current_plant_available_water:536,rcp45_available_water:501,rcp85_available_water:454},{town_name:"Toodyay",operational_cost:400,soil_evaporation:110,current_plant_available_water:419,rcp45_available_water:401,rcp85_available_water:358},{town_name:"Trayning",operational_cost:400,soil_evaporation:110,current_plant_available_water:251,rcp45_available_water:226,rcp85_available_water:206},{town_name:"Trayning West",operational_cost:400,soil_evaporation:110,current_plant_available_water:251,rcp45_available_water:226,rcp85_available_water:206},{town_name:"Truro",operational_cost:400,soil_evaporation:110,current_plant_available_water:257,rcp45_available_water:229,rcp85_available_water:215},{town_name:"Tulloke",operational_cost:400,soil_evaporation:110,current_plant_available_water:790,rcp45_available_water:723,rcp85_available_water:654},{town_name:"Tunney",operational_cost:400,soil_evaporation:110,current_plant_available_water:452,rcp45_available_water:409,rcp85_available_water:370},{town_name:"Twolganup",operational_cost:400,soil_evaporation:110,current_plant_available_water:300,rcp45_available_water:280,rcp85_available_water:255},{town_name:"Valern",operational_cost:400,soil_evaporation:110,current_plant_available_water:439,rcp45_available_water:421,rcp85_available_water:380},{town_name:"Vasse",operational_cost:400,soil_evaporation:110,current_plant_available_water:702,rcp45_available_water:698,rcp85_available_water:633},{town_name:"Wagin",operational_cost:400,soil_evaporation:110,current_plant_available_water:326,rcp45_available_water:313,rcp85_available_water:285},{town_name:"Walpole",operational_cost:400,soil_evaporation:110,current_plant_available_water:1040,rcp45_available_water:889,rcp85_available_water:808},{town_name:"Wanarra",operational_cost:400,soil_evaporation:110,current_plant_available_water:243,rcp45_available_water:232,rcp85_available_water:203},{town_name:"Wandana",operational_cost:400,soil_evaporation:110,current_plant_available_water:226,rcp45_available_water:218,rcp85_available_water:186},{town_name:"Wandering",operational_cost:400,soil_evaporation:110,current_plant_available_water:439,rcp45_available_water:421,rcp85_available_water:378},{town_name:"Wannamal",operational_cost:400,soil_evaporation:110,current_plant_available_water:479,rcp45_available_water:456,rcp85_available_water:405},{town_name:"Wanneroo",operational_cost:400,soil_evaporation:110,current_plant_available_water:649,rcp45_available_water:601,rcp85_available_water:537},{town_name:"Warner Glen",operational_cost:400,soil_evaporation:110,current_plant_available_water:909,rcp45_available_water:828,rcp85_available_water:750},{town_name:"Waroona",operational_cost:400,soil_evaporation:110,current_plant_available_water:776,rcp45_available_water:739,rcp85_available_water:666},{town_name:"Waroona Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:776,rcp45_available_water:739,rcp85_available_water:666},{town_name:"Warradarge East",operational_cost:400,soil_evaporation:110,current_plant_available_water:450,rcp45_available_water:411,rcp85_available_water:365},{town_name:"Watheroo",operational_cost:400,soil_evaporation:110,current_plant_available_water:305,rcp45_available_water:294,rcp85_available_water:260},{town_name:"Wattening",operational_cost:400,soil_evaporation:110,current_plant_available_water:352,rcp45_available_water:343,rcp85_available_water:305},{town_name:"Wattoning",operational_cost:400,soil_evaporation:110,current_plant_available_water:224,rcp45_available_water:201,rcp85_available_water:185},{town_name:"Welcome Downs",operational_cost:400,soil_evaporation:110,current_plant_available_water:343,rcp45_available_water:332,rcp85_available_water:315},{town_name:"Wellstead",operational_cost:400,soil_evaporation:110,current_plant_available_water:393,rcp45_available_water:365,rcp85_available_water:335},{town_name:"West Lort River",operational_cost:400,soil_evaporation:110,current_plant_available_water:281,rcp45_available_water:279,rcp85_available_water:265},{town_name:"West River",operational_cost:400,soil_evaporation:110,current_plant_available_water:321,rcp45_available_water:287,rcp85_available_water:267},{town_name:"Westbourne",operational_cost:400,soil_evaporation:110,current_plant_available_water:517,rcp45_available_water:496,rcp85_available_water:449},{town_name:"Westonia",operational_cost:400,soil_evaporation:110,current_plant_available_water:261,rcp45_available_water:233,rcp85_available_water:214},{town_name:"White Gums",operational_cost:400,soil_evaporation:110,current_plant_available_water:545,rcp45_available_water:472,rcp85_available_water:433},{town_name:"Wialki",operational_cost:400,soil_evaporation:110,current_plant_available_water:237,rcp45_available_water:222,rcp85_available_water:200},{town_name:"Wialki South",operational_cost:400,soil_evaporation:110,current_plant_available_water:237,rcp45_available_water:222,rcp85_available_water:200},{town_name:"Wickepin",operational_cost:400,soil_evaporation:110,current_plant_available_water:308,rcp45_available_water:284,rcp85_available_water:259},{town_name:"Wickepin East",operational_cost:400,soil_evaporation:110,current_plant_available_water:308,rcp45_available_water:284,rcp85_available_water:259},{town_name:"Wickepin North",operational_cost:400,soil_evaporation:110,current_plant_available_water:308,rcp45_available_water:284,rcp85_available_water:259},{town_name:"Willi Gulli North",operational_cost:400,soil_evaporation:110,current_plant_available_water:367,rcp45_available_water:331,rcp85_available_water:283},{town_name:"Williams",operational_cost:400,soil_evaporation:110,current_plant_available_water:405,rcp45_available_water:380,rcp85_available_water:343},{town_name:"Williams Post Office",operational_cost:400,soil_evaporation:110,current_plant_available_water:405,rcp45_available_water:380,rcp85_available_water:343},{town_name:"Wilyabrup",operational_cost:400,soil_evaporation:110,current_plant_available_water:866,rcp45_available_water:794,rcp85_available_water:718},{town_name:"Windrush",operational_cost:400,soil_evaporation:110,current_plant_available_water:605,rcp45_available_water:533,rcp85_available_water:489},{town_name:"Windy Harbour",operational_cost:400,soil_evaporation:110,current_plant_available_water:994,rcp45_available_water:933,rcp85_available_water:846},{town_name:"Witchcliffe",operational_cost:400,soil_evaporation:110,current_plant_available_water:973,rcp45_available_water:862,rcp85_available_water:780},{town_name:"Wokalup",operational_cost:400,soil_evaporation:110,current_plant_available_water:827,rcp45_available_water:764,rcp85_available_water:687},{town_name:"Wongan Hills",operational_cost:400,soil_evaporation:110,current_plant_available_water:295,rcp45_available_water:273,rcp85_available_water:243},{town_name:"Woodanilling",operational_cost:400,soil_evaporation:110,current_plant_available_water:352,rcp45_available_water:334,rcp85_available_water:304},{town_name:"Woodperry",operational_cost:400,soil_evaporation:110,current_plant_available_water:740,rcp45_available_water:700,rcp85_available_water:633},{town_name:"Wyalkatchem",operational_cost:400,soil_evaporation:110,current_plant_available_water:252,rcp45_available_water:242,rcp85_available_water:219},{town_name:"Xantippe",operational_cost:400,soil_evaporation:110,current_plant_available_water:228,rcp45_available_water:214,rcp85_available_water:191},{town_name:"Yandanooka",operational_cost:400,soil_evaporation:110,current_plant_available_water:314,rcp45_available_water:280,rcp85_available_water:245},{town_name:"Yanmah",operational_cost:400,soil_evaporation:110,current_plant_available_water:860,rcp45_available_water:786,rcp85_available_water:708},{town_name:"Ygnattering",operational_cost:400,soil_evaporation:110,current_plant_available_water:266,rcp45_available_water:251,rcp85_available_water:226},{town_name:"Yilgarn",operational_cost:400,soil_evaporation:110,current_plant_available_water:265,rcp45_available_water:242,rcp85_available_water:221},{town_name:"Yoongarillup",operational_cost:400,soil_evaporation:110,current_plant_available_water:671,rcp45_available_water:666,rcp85_available_water:604},{town_name:"York",operational_cost:400,soil_evaporation:110,current_plant_available_water:353,rcp45_available_water:347,rcp85_available_water:311},{town_name:"York East",operational_cost:400,soil_evaporation:110,current_plant_available_water:353,rcp45_available_water:347,rcp85_available_water:311},{town_name:"Yorkrakine",operational_cost:400,soil_evaporation:110,current_plant_available_water:248,rcp45_available_water:235,rcp85_available_water:212},{town_name:"Youanmi",operational_cost:400,soil_evaporation:110,current_plant_available_water:264,rcp45_available_water:264,rcp85_available_water:242},{town_name:"Youanmi Valley",operational_cost:400,soil_evaporation:110,current_plant_available_water:269,rcp45_available_water:237,rcp85_available_water:217},{town_name:"Yuna",operational_cost:500,soil_evaporation:120,current_plant_available_water:280,rcp45_available_water:268,rcp85_available_water:230},{town_name:"Yuna Ne",operational_cost:400,soil_evaporation:110,current_plant_available_water:280,rcp45_available_water:268,rcp85_available_water:230}];document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){console.log("Initializing custom location management..."),Wf(),zf().then(()=>{di(),Ut()}).catch(t=>{console.error("Failed to load yield multiplier script:",t),di()})},1e3)});function zf(){return new Promise((t,e)=>{const a=document.createElement("script");a.src="yield-multiplier-generator.js",a.onload=()=>{console.log("Yield multiplier generator loaded"),t()},a.onerror=i=>{console.error("Error loading yield multiplier script:",i),e(i)},document.head.appendChild(a)})}function Wf(){const t="custom-location-styles";if(document.getElementById(t))return;const e=document.createElement("style");e.id=t,e.textContent=`
    /* Custom Location Modal Styles */
    .location-parameters {
      padding: 15px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 20px;
      background-color: #f0f9ff; /* Light blue background for location parameters */
    }
    
    .location-parameters h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #2c5282; /* Dark blue color for location parameter headers */
    }
    
    .crop-section {
      padding: 15px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 20px;
      background-color: #f8fafc;
    }

    .crop-section h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #38a169;
    }

    /* Yield variation chart */
    .yield-variation-chart {
      margin-top: 15px;
      border: 1px solid #e2e8f0;
      border-radius: 5px;
      padding: 10px;
      background-color: #f8fafc;
    }

    .yield-variation-chart h4 {
      margin-top: 0;
      margin-bottom: 10px;
      color: #4a5568;
      font-size: 0.9rem;
    }

    .yield-bar-container {
      display: flex;
      align-items: center;
      height: 30px;
      margin-bottom: 5px;
    }

    .yield-bar-year {
      width: 50px;
      text-align: right;
      padding-right: 10px;
      font-size: 0.75rem;
      color: #4a5568;
    }

    .yield-bar-graph {
      flex: 1;
      height: 20px;
      background-color: #edf2f7;
      position: relative;
    }

    .yield-bar {
      position: absolute;
      top: 0;
      left: 50%;
      height: 100%;
      background-color: #38a169;
      transform: translateX(-50%);
      transition: width 0.3s;
    }

    .yield-bar-value {
      width: 50px;
      text-align: left;
      padding-left: 10px;
      font-size: 0.75rem;
      color: #4a5568;
    }

    /* Custom Locations Grid */
    .custom-locations-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .custom-location-card {
      border: 1px solid #e2e8f0;
      border-radius: 5px;
      overflow: hidden;
    }

    .custom-location-header {
      padding: 10px 15px;
      background-color: #4a5568;
      color: white;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .custom-location-content {
      padding: 10px 15px;
    }

    .custom-location-crop {
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e2e8f0;
    }

    .custom-location-crop:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .custom-location-crop-name {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .custom-location-param {
      display: flex;
      justify-content: space-between;
      font-size: 0.9em;
      margin-bottom: 3px;
    }

    .custom-location-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding: 10px 15px;
      background-color: #f7fafc;
      border-top: 1px solid #e2e8f0;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .custom-locations-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Small button variant */
    .small-btn {
      padding: 5px 10px;
      font-size: 0.85em;
    }
    
    /* Section divider */
    .section-divider {
      border-top: 1px solid #e2e8f0;
      margin: 20px 0;
    }
    
    /* Helper text for inputs */
    .helper-text {
      font-size: 0.8rem;
      color: #718096;
      margin-top: 3px;
    }

    /* Location search styles */
    .location-search-container {
      margin-bottom: 20px;
    }
    
    .location-search-input {
      width: 100%;
      padding: 10px;
      border: 1px solid #e2e8f0;
      border-radius: 5px;
      margin-bottom: 5px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .location-search-results {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #e2e8f0;
      border-radius: 5px;
      background-color: white;
      margin-bottom: 10px;
    }
    
    .search-result-item {
      padding: 8px 12px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .search-result-item:hover {
      background-color: #f0f9ff;
    }
    
    .search-no-results {
      padding: 10px;
      text-align: center;
      color: #718096;
      font-style: italic;
    }
    
    .location-search-hint {
      font-size: 0.8rem;
      color: #718096;
      margin-top: 5px;
    }
  `,document.head.appendChild(e),console.log("Custom location styles added")}function di(){console.log("Initializing custom location management..."),document.querySelectorAll("#openAddLocationBtn, #manageLocationsBtn").forEach(r=>r.remove());const t=document.querySelector("#locationCropSelect");if(!t){console.error("Location container not found");return}const e=t.querySelector("div:first-child");if(!e)return;const a=document.createElement("div");a.className="location-buttons",a.style.display="inline-flex",a.style.marginLeft="5px";const i=document.createElement("button");i.id="openAddLocationBtn",i.className="action-btn elevation-1",i.innerHTML='<i class="fas fa-plus"></i>',i.title="Add Custom Location",i.style.padding="8px",i.style.height="38px",i.style.marginRight="5px",i.addEventListener("click",Zr);const n=document.createElement("button");n.id="manageLocationsBtn",n.className="action-btn elevation-1",n.innerHTML='<i class="fas fa-cog"></i>',n.title="Manage Custom Locations",n.style.padding="8px",n.style.height="38px",n.addEventListener("click",es),a.appendChild(i),a.appendChild(n);const o=e.querySelector("select");if(o&&o.parentNode){const r=document.createElement("div");r.style.display="flex",r.style.alignItems="center";const s=o.parentNode;s.removeChild(o),r.appendChild(o),r.appendChild(a),s.appendChild(r)}document.getElementById("addLocationModal")||Xr(),document.getElementById("manageLocationsModal")||Jr(),Ut()}function Ur(t,e,a,i,n){n=n||110;const o=e-n,r=o>0?t/o:.01,s=Math.max(0,a-n),l=Math.max(0,i-n),c=r*s,d=r*l,p=t>0?c/t:.87,u=t>0?d/t:.72;return{rcp45:Math.round(Math.max(.5,Math.min(1,p))*100)/100,rcp85:Math.round(Math.max(.5,Math.min(.9,u))*100)/100}}function Gr(){return Wi.map(t=>t.town_name)}function Hf(t){if(!t)return Gr();const e=t.toLowerCase();return Wi.filter(a=>a.town_name.toLowerCase().includes(e)).map(a=>a.town_name)}function Vf(t){return Wi.find(e=>e.town_name.toLowerCase()===t.toLowerCase())}function wo(t,e,a){if(e.innerHTML="",t.length===0){e.innerHTML='<div class="search-no-results">No locations found</div>';return}t.forEach(i=>{const n=document.createElement("div");n.className="search-result-item",n.textContent=i,n.addEventListener("click",()=>{typeof a=="function"&&a(i)}),e.appendChild(n)})}function Kr(){const t=document.getElementById("locationSearchInput"),e=document.getElementById("locationSearchResults");if(!t||!e){console.error("Location search elements not found");return}t.addEventListener("input",function(){const a=this.value,i=Hf(a);wo(i,e,yo)}),wo(Gr(),e,yo)}function yo(t){console.log("Location selected:",t);const e=Vf(t);if(!e){console.error("Location data not found for:",t);return}const a=document.getElementById("locationSearchInput");a&&(a.value=t),document.getElementById("location-opCost").value=e.operational_cost||"",document.getElementById("location-evaporation").value=e.soil_evaporation||"",document.getElementById("location-currentWater").value=e.current_plant_available_water||"",document.getElementById("location-rcp45Water").value=e.rcp45_available_water||"",document.getElementById("location-rcp85Water").value=e.rcp85_available_water||"";const i=document.getElementById("newLocationName");i&&!i.value&&(i.value=t),window.showNotification&&window.showNotification("Location Found",`Parameters for "${t}" have been loaded`,"success")}function Xr(){if(document.getElementById("addLocationModal"))return;const t=document.createElement("div");t.id="addLocationModal",t.className="modal-overlay",t.innerHTML=`
    <div class="modal elevation-3">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-map-marker-alt"></i> Add Custom Location</div>
        <button class="modal-close" id="closeAddLocationBtn"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
        <div class="form-group">
          <label for="newLocationName">Location Name:</label>
          <input type="text" id="newLocationName" class="elevation-1" placeholder="Enter location name" required>
        </div>
        
        <div class="form-group">
          <label for="copyFromLocation">Copy defaults from:</label>
          <select id="copyFromLocation" class="elevation-1">
            <option value="">-- Start from scratch --</option>
            <!-- Existing locations will be populated here -->
          </select>
        </div>
        
        <!-- Location-wide parameters section with plant available water inputs -->
        <div class="location-parameters" style="margin-top: 20px;">
          <h3 style="padding: 10px; background-color: #2C5282; color: white; border-radius: 4px; margin-bottom: 15px;">Location Parameters</h3>
          
          <!-- MOVED: Location Search Feature inside the parameters section -->
          <div class="location-search-container" style="margin-bottom: 20px; padding: 10px; background-color: #EBF8FF; border-radius: 5px;">
            <h4 style="margin-top: 0; margin-bottom: 10px; color: #2C5282;">Find Location Data</h4>
            <div class="helper-text" style="margin-bottom: 5px;">Search for a location to auto-populate parameters</div>
            
            <input type="text" id="locationSearchInput" class="location-search-input elevation-1" placeholder="Type to search locations...">
            <div id="locationSearchResults" class="location-search-results"></div>
            <div class="location-search-hint">Click on a location to auto-populate its parameters</div>
          </div>
          
          <div class="input-group">
            <div class="form-group">
              <label for="location-opCost">Operational Cost ($/ha):</label>
              <input type="number" id="location-opCost" class="elevation-1" value="400" step="10" min="0">
            </div>
            <div class="form-group">
              <label for="location-evaporation">Soil Evaporation (mm):</label>
              <input type="number" id="location-evaporation" class="elevation-1" value="110" step="1" min="0">
              <div class="helper-text">Standard value is 110mm</div>
            </div>
            <div class="form-group">
              <label for="location-currentWater">Current Plant Available Water (mm):</label>
              <input type="number" id="location-currentWater" class="elevation-1" value="255" step="1" min="0">
              <div class="helper-text">For Merredin: 255mm, Moora: 343mm</div>
            </div>
            <div class="form-group">
              <label for="location-rcp45Water">RCP 4.5 Plant Available Water (mm):</label>
              <input type="number" id="location-rcp45Water" class="elevation-1" value="218" step="1" min="0">
              <div class="helper-text">For Merredin: 218mm, Moora: 340mm</div>
            </div>
            <div class="form-group">
              <label for="location-rcp85Water">RCP 8.5 Plant Available Water (mm):</label>
              <input type="number" id="location-rcp85Water" class="elevation-1" value="200" step="1" min="0">
              <div class="helper-text">For Merredin: 200mm, Moora: 306mm</div>
            </div>
          </div>
        </div>
        
        <!-- Unified crop settings section - no tabs -->
        <div id="cropDefaultsContainer">
          <!-- Wheat Settings -->
          <div class="crop-section">
            <h3 style="padding: 10px; background-color: #38A169; color: white; border-radius: 4px; margin-bottom: 15px;">Wheat Settings</h3>
            <div class="input-group">
              <div class="form-group">
                <label for="wheat-meanYield">Mean Yield (t/ha):</label>
                <input type="number" id="wheat-meanYield" class="elevation-1" value="1.4" step="0.1" min="0" oninput="updateYieldMultiplierValues('wheat')">
              </div>
              <div class="form-group">
                <label for="wheat-droughtYield">Drought Yield (t/ha):</label>
                <input type="number" id="wheat-droughtYield" class="elevation-1" value="0.53" step="0.01" min="0">
              </div>
              <div class="form-group">
                <label for="wheat-minYield">Minimum Expected Yield (t/ha):</label>
                <input type="number" id="wheat-minYield" class="elevation-1" value="0.67" step="0.01" min="0" oninput="updateYieldMultiplierValues('wheat')">
              </div>
              <div class="form-group">
                <label for="wheat-maxYield">Maximum Expected Yield (t/ha):</label>
                <input type="number" id="wheat-maxYield" class="elevation-1" value="2.30" step="0.01" min="0" oninput="updateYieldMultiplierValues('wheat')">
              </div>
            </div>
            
            <!-- Hidden fields to store the calculated multipliers -->
            <input type="hidden" id="wheat-minYieldMultiplier" value="0.48">
            <input type="hidden" id="wheat-maxYieldMultiplier" value="1.64">
            
            <div class="yield-variation-header" onclick="toggleYieldPreview('wheat-yield-preview')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px; background-color: #f1f5f9; border-radius: 4px; margin-top: 15px;">
              <h4 style="margin: 0;">Yield Variation Preview</h4>
              <i class="fas fa-chevron-down" id="wheat-yield-preview-icon"></i>
            </div>
            <div id="wheat-yield-preview" class="yield-variation-chart" style="display: none;"></div>
          </div>
          
          <!-- Canola Settings -->
          <div class="crop-section" style="margin-top: 30px;">
            <h3 style="padding: 10px; background-color: #F6E05E; color: #744210; border-radius: 4px; margin-bottom: 15px;">Canola Settings</h3>
            <div class="input-group">
              <div class="form-group">
                <label for="canola-meanYield">Mean Yield (t/ha):</label>
                <input type="number" id="canola-meanYield" class="elevation-1" value="0.85" step="0.1" min="0" oninput="updateYieldMultiplierValues('canola')">
              </div>
              <div class="form-group">
                <label for="canola-droughtYield">Drought Yield (t/ha):</label>
                <input type="number" id="canola-droughtYield" class="elevation-1" value="0.35" step="0.01" min="0">
              </div>
              <div class="form-group">
                <label for="canola-minYield">Minimum Expected Yield (t/ha):</label>
                <input type="number" id="canola-minYield" class="elevation-1" value="0.42" step="0.01" min="0" oninput="updateYieldMultiplierValues('canola')">
              </div>
              <div class="form-group">
                <label for="canola-maxYield">Maximum Expected Yield (t/ha):</label>
                <input type="number" id="canola-maxYield" class="elevation-1" value="1.11" step="0.01" min="0" oninput="updateYieldMultiplierValues('canola')">
              </div>
            </div>
            
            <!-- Hidden fields to store the calculated multipliers -->
            <input type="hidden" id="canola-minYieldMultiplier" value="0.85">
            <input type="hidden" id="canola-maxYieldMultiplier" value="1.31">
            
            <div class="yield-variation-header" onclick="toggleYieldPreview('canola-yield-preview')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px; background-color: #f1f5f9; border-radius: 4px; margin-top: 15px;">
              <h4 style="margin: 0;">Yield Variation Preview</h4>
              <i class="fas fa-chevron-down" id="canola-yield-preview-icon"></i>
            </div>
            <div id="canola-yield-preview" class="yield-variation-chart" style="display: none;"></div>
          </div>
          
          <!-- Barley Settings -->
          <div class="crop-section" style="margin-top: 30px;">
            <h3 style="padding: 10px; background-color: #9F7AEA; color: white; border-radius: 4px; margin-bottom: 15px;">Barley Settings</h3>
            <div class="input-group">
              <div class="form-group">
                <label for="barley-meanYield">Mean Yield (t/ha):</label>
                <input type="number" id="barley-meanYield" class="elevation-1" value="1.8" step="0.1" min="0" oninput="updateYieldMultiplierValues('barley')">
              </div>
              <div class="form-group">
                <label for="barley-droughtYield">Drought Yield (t/ha):</label>
                <input type="number" id="barley-droughtYield" class="elevation-1" value="0.6" step="0.01" min="0">
              </div>
              <div class="form-group">
                <label for="barley-minYield">Minimum Expected Yield (t/ha):</label>
                <input type="number" id="barley-minYield" class="elevation-1" value="0.88" step="0.01" min="0" oninput="updateYieldMultiplierValues('barley')">
              </div>
              <div class="form-group">
                <label for="barley-maxYield">Maximum Expected Yield (t/ha):</label>
                <input type="number" id="barley-maxYield" class="elevation-1" value="2.34" step="0.01" min="0" oninput="updateYieldMultiplierValues('barley')">
              </div>
            </div>
            
            <!-- Hidden fields to store the calculated multipliers -->
            <input type="hidden" id="barley-minYieldMultiplier" value="0.88">
            <input type="hidden" id="barley-maxYieldMultiplier" value="1.30">
            
            <div class="yield-variation-header" onclick="toggleYieldPreview('barley-yield-preview')" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; padding: 10px; background-color: #f1f5f9; border-radius: 4px; margin-top: 15px;">
              <h4 style="margin: 0;">Yield Variation Preview</h4>
              <i class="fas fa-chevron-down" id="barley-yield-preview-icon"></i>
            </div>
            <div id="barley-yield-preview" class="yield-variation-chart" style="display: none;"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="cancelLocationBtn" class="secondary-btn"><i class="fas fa-times"></i> Cancel</button>
        <button id="saveLocationBtn" class="primary-btn"><i class="fas fa-check"></i> Add Location</button>
      </div>
    </div>
  `,document.body.appendChild(t),document.getElementById("closeAddLocationBtn").addEventListener("click",xa),document.getElementById("cancelLocationBtn").addEventListener("click",xa),document.getElementById("saveLocationBtn").addEventListener("click",Qr),setTimeout(Kr,100),window.toggleYieldPreview=function(e){const a=document.getElementById(e),i=e+"-icon",n=document.getElementById(i);if(a.style.display==="none"){if(a.style.display="block",n&&n.classList.replace("fa-chevron-down","fa-chevron-up"),a.innerHTML.trim()===""){const o=e.split("-")[0];window.generateYieldMultipliers&&window.generateYieldMultipliers(o.charAt(0).toUpperCase()+o.slice(1))}}else a.style.display="none",n&&n.classList.replace("fa-chevron-up","fa-chevron-down")},console.log("Custom location modal added with location search feature repositioned"),da("wheat"),da("canola"),da("barley")}function Jr(){if(document.getElementById("manageLocationsModal"))return;const t=document.createElement("div");t.id="manageLocationsModal",t.className="modal-overlay",t.innerHTML=`
    <div class="modal elevation-3">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-cog"></i> Manage Custom Locations</div>
        <button class="modal-close" id="closeManageLocationsBtn"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <p>The following custom locations are available in the system:</p>
        <div id="manageLocationsContainer" style="margin-top: 15px;">
          <!-- Custom locations will be listed here -->
        </div>
      </div>
      <div class="modal-footer">
        <button id="closeManageBtn" class="secondary-btn"><i class="fas fa-times"></i> Close</button>
      </div>
    </div>
  `,document.body.appendChild(t),document.getElementById("closeManageLocationsBtn").addEventListener("click",pi),document.getElementById("closeManageBtn").addEventListener("click",pi)}function Zr(){const t=document.getElementById("addLocationModal");t||Xr(),document.getElementById("newLocationName").value="";const e=document.getElementById("locationSearchInput");e&&(e.value=""),Kr();const a=document.getElementById("copyFromLocation");a&&(a.innerHTML='<option value="">-- Start from scratch --</option>',(window.getLocations?window.getLocations():["Merredin","Moora"]).forEach(n=>{const o=document.createElement("option");o.value=n,o.textContent=n,a.appendChild(o)}),a.addEventListener("change",jf)),t.style.display="flex"}function xa(){const t=document.getElementById("addLocationModal");t&&(t.style.display="none")}function jf(){const t=document.getElementById("copyFromLocation").value;if(!t)return;const e=window.getCrops?window.getCrops()[0]:"Wheat",a=window.getDefaultValues?window.getDefaultValues(t,e):_e(e);document.getElementById("location-opCost").value=a.opCost,a.waterParameters?(document.getElementById("location-evaporation").value=a.waterParameters.evaporation||110,document.getElementById("location-currentWater").value=a.waterParameters.currentWater||255,document.getElementById("location-rcp45Water").value=a.waterParameters.rcp45Water||218,document.getElementById("location-rcp85Water").value=a.waterParameters.rcp85Water||200):(document.getElementById("location-evaporation").value=110,t==="Moora"?(document.getElementById("location-currentWater").value=343,document.getElementById("location-rcp45Water").value=340,document.getElementById("location-rcp85Water").value=306):(document.getElementById("location-currentWater").value=255,document.getElementById("location-rcp45Water").value=218,document.getElementById("location-rcp85Water").value=200)),(window.getCrops?window.getCrops():["Wheat","Canola","Barley"]).forEach(n=>{const o=window.getDefaultValues?window.getDefaultValues(t,n):_e(n);qf(n,o)})}function qf(t,e){const a=t.toLowerCase(),i=document.getElementById(`${a}-meanYield`),n=document.getElementById(`${a}-droughtYield`);i&&(i.value=e.meanYield),n&&(n.value=e.droughtYield);const o=Object.values(e.yieldMultipliers||{});if(o.length>0){const r=Math.min(...o),s=Math.max(...o);Uf(a,e.meanYield,r,s),Hi(a)}}function _e(t){const e={Wheat:{meanYield:1.4,opCost:400,droughtYield:.53,baseYieldMultipliers:{rcp45:.87,rcp85:.72}},Canola:{meanYield:.85,opCost:400,droughtYield:.35,baseYieldMultipliers:{rcp45:.87,rcp85:.72}},Barley:{meanYield:1.8,opCost:400,droughtYield:.6,baseYieldMultipliers:{rcp45:.87,rcp85:.72}}};return e[t]||e.Wheat}function Qr(){const t=document.getElementById("newLocationName").value.trim();if(!t){alert("Please enter a location name");return}const e=window.getLocations?window.getLocations():[];if(e.includes(t)&&!confirm(`Location "${t}" already exists. Do you want to update it?`))return;window.addLocation&&window.addLocation(t);const a=parseFloat(document.getElementById("location-opCost").value),i=parseFloat(document.getElementById("location-evaporation").value),n=parseFloat(document.getElementById("location-currentWater").value),o=parseFloat(document.getElementById("location-rcp45Water").value),r=parseFloat(document.getElementById("location-rcp85Water").value),s=i>0?i:110,l=n>0?n:255,c=o>0?o:218,d=r>0?r:200;(window.getCrops?window.getCrops():["Wheat","Canola","Barley"]).forEach(u=>{const h=u.toLowerCase(),f=parseFloat(document.getElementById(`${h}-meanYield`).value),m=parseFloat(document.getElementById(`${h}-droughtYield`).value),_=parseFloat(document.getElementById(`${h}-minYield`).value),g=parseFloat(document.getElementById(`${h}-maxYield`).value),b=_/f,w=g/f,y=Ur(f,l,c,d,s);let v={};if(typeof window.generateRealisticMultipliers=="function"){const S=window.generateRealisticMultipliers(b,w);for(let x=0;x<25;x++){const C=2026+x;v[C]=S[x]}}else{Array.from({length:25},(P,A)=>2026+A).forEach(P=>{const A=Math.random(),R=b+(w-b)*A;v[P]=Math.round(R*100)/100});const x=Object.values(v),E=1/(x.reduce((P,A)=>P+A,0)/x.length);Object.keys(v).forEach(P=>{v[P]=Math.round(v[P]*E*100)/100})}const M={meanYield:f,basePrice:u==="Wheat"?350:u==="Canola"?611:262,baseYieldType:"mean",variedYield:!1,annualIncrease:!1,annualIncreaseRate:1,droughtYield:m,opCost:a,baseYieldMultipliers:y,yieldMultipliers:v,waterParameters:{evaporation:s,currentWater:l,rcp45Water:c,rcp85Water:d},stepChangeEnabled:!1,stepChangeYear:2041,stepChangeAmount:10};window.setDefaultValues&&window.setDefaultValues(t,u,M)}),xa(),is(),Xf(),Ut(),window.showNotification&&window.showNotification("Location Added",`Custom location "${t}" has been ${e.includes(t)?"updated":"added"}`,"success")}function da(t){const e=document.getElementById(`${t}-meanYield`),a=document.getElementById(`${t}-minYield`),i=document.getElementById(`${t}-maxYield`),n=document.getElementById(`${t}-minYieldMultiplier`),o=document.getElementById(`${t}-maxYieldMultiplier`);if(!e||!a||!i||!n||!o){console.error(`Missing elements for ${t} yield calculations`);return}const r=parseFloat(e.value);if(!r||r<=0){console.error(`Invalid mean yield for ${t}: ${r}`);return}const s=parseFloat(a.value),l=parseFloat(i.value);let c=s>0?s/r:.3,d=l>0?l/r:1.7;c=Math.max(.1,Math.min(.9,c)),d=Math.max(1.1,Math.min(3,d)),c=Math.round(c*100)/100,d=Math.round(d*100)/100,n.value=c,o.value=d,console.log(`Updated ${t} multipliers: min=${c}, max=${d}`),Hi(t)}function Uf(t,e,a,i){const n=document.getElementById(`${t}-minYield`),o=document.getElementById(`${t}-maxYield`);if(!n||!o)return;const r=(e*a).toFixed(2),s=(e*i).toFixed(2);n.value=r,o.value=s,document.getElementById(`${t}-minYieldMultiplier`).value=a,document.getElementById(`${t}-maxYieldMultiplier`).value=i}function Hi(t){const e=t.toLowerCase(),a=document.getElementById(`${e}-yield-preview`);if(!a)return;const i=parseFloat(document.getElementById(`${e}-meanYield`).value),n=parseFloat(document.getElementById(`${e}-minYield`).value),o=parseFloat(document.getElementById(`${e}-maxYield`).value);if(!i||!n||!o)return;const r=Math.max(.1,Math.min(.9,n/i)),s=Math.max(1.1,Math.min(3,o/i));let l;if(typeof window.generateRealisticMultipliers=="function")l=window.generateRealisticMultipliers(r,s);else{l=[];for(let m=0;m<25;m++){const _=Math.random(),g=r+(s-r)*_;l.push(Math.round(g*100)/100)}const f=1/(l.reduce((m,_)=>m+_,0)/l.length);l=l.map(m=>Math.round(m*f*100)/100)}const c=Array.from({length:25},(h,f)=>2026+f);let d="";c.slice(0,8).forEach((h,f)=>{const m=l[f],_=Math.abs(m-1)*100,g=m<1?"left":"right",b=m<1?"#FC8181":"#68D391";d+=`
      <div class="yield-bar-container">
        <div class="yield-bar-year">${h}</div>
        <div class="yield-bar-graph">
          <div class="yield-bar" style="width: ${_}%; ${g}: 50%; transform: translateX(${g==="left"?"-100%":"0%"}); background-color: ${b};"></div>
        </div>
        <div class="yield-bar-value">${m.toFixed(2)}</div>
      </div>
    `});const p=Math.min(...l).toFixed(2),u=Math.max(...l).toFixed(2);(l.reduce((h,f)=>h+f,0)/l.length).toFixed(2),d+=`
    <div style="margin-top: 10px; font-size: 0.8rem;">
      <div><strong>Range:</strong> ${p} to ${u} multiplier (preview only)</div>
      <div style="margin-top: 5px; color: #666;">Full dataset will be generated when you click "Add Location"</div>
    </div>
  `,a.innerHTML=d}function es(){document.getElementById("manageLocationsModal")||Jr(),ts(),document.getElementById("manageLocationsModal").style.display="flex"}function pi(){const t=document.getElementById("manageLocationsModal");t&&(t.style.display="none")}function ts(){const t=document.getElementById("manageLocationsContainer");if(!t)return;t.innerHTML="";const e=["Merredin","Moora"],n=(Vi().locations||[]).filter(o=>!e.includes(o));if(n.length===0){t.innerHTML="<p>No custom locations have been added to the system.</p>";return}n.forEach(o=>{const r=document.createElement("div");r.style.cssText="display: flex; justify-content: space-between; align-items: center; padding: 12px; border: 1px solid #e2e8f0; border-radius: 5px; margin-bottom: 10px; background-color: #f8fafc;",r.innerHTML=`
      <div>
        <span style="font-weight: 600;"><i class="fas fa-map-marker-alt"></i> ${o}</span>
      </div>
      <button class="danger-btn small-btn" onclick="deleteCustomLocationAndRefresh('${o}')">
        <i class="fas fa-trash"></i> Delete
      </button>
    `,t.appendChild(r)})}function Gf(t){as(t),ts(),Ut()}function as(t){if(t&&confirm(`Are you sure you want to delete the location "${t}"?`))try{const e=Vi();return e.locations=e.locations.filter(a=>a!==t),delete e.defaultValues[t],Kf(e),Ut(),window.showNotification?window.showNotification("Location Deleted",`"${t}" has been removed from your custom locations`,"success"):alert(`Location "${t}" has been deleted successfully.`),!0}catch(e){return console.error("Error deleting location:",e),alert(`Error: Unable to delete location. ${e.message}`),!1}}function is(){const t=document.getElementById("customLocationsContainer");if(!t)return;t.innerHTML="";const e=["Merredin","Moora"],i=(window.getLocations?window.getLocations():[]).filter(n=>!e.includes(n));if(i.length===0){t.innerHTML='<p>No custom locations added yet. Click "Add New Location" to create one.</p>';return}i.forEach(n=>{const o=document.createElement("div");o.className="custom-location-card elevation-1";const r=document.createElement("div");r.className="custom-location-header",r.innerHTML=`
      <span><i class="fas fa-map-marker-alt"></i> ${n}</span>
    `;const s=document.createElement("div");s.className="custom-location-content";const l=window.getCrops?window.getCrops()[0]:"Wheat",c=window.getDefaultValues?window.getDefaultValues(n,l):_e(l),d=document.createElement("div");d.className="custom-location-section";const p=c.waterParameters||{};p.currentWater?d.innerHTML=`
        <div class="custom-location-section-name">Location Parameters</div>
        <div class="custom-location-param">
          <span>Operational Cost:</span>
          <span>$${c.opCost}/ha</span>
        </div>
        <div class="custom-location-param">
          <span>Current Water:</span>
          <span>${p.currentWater}mm</span>
        </div>
        <div class="custom-location-param">
          <span>RCP 4.5 Water:</span>
          <span>${p.rcp45Water}mm</span>
        </div>
        <div class="custom-location-param">
          <span>RCP 8.5 Water:</span>
          <span>${p.rcp85Water}mm</span>
        </div>
      `:d.innerHTML=`
        <div class="custom-location-section-name">Location Parameters</div>
        <div class="custom-location-param">
          <span>Operational Cost:</span>
          <span>$${c.opCost}/ha</span>
        </div>
        <div class="custom-location-param">
          <span>RCP 4.5:</span>
          <span>${c.baseYieldMultipliers?.rcp45||.87}</span>
        </div>
        <div class="custom-location-param">
          <span>RCP 8.5:</span>
          <span>${c.baseYieldMultipliers?.rcp85||.72}</span>
        </div>
      `,s.appendChild(d);const u=document.createElement("div");u.className="section-divider",s.appendChild(u),(window.getCrops?window.getCrops():["Wheat","Canola","Barley"]).forEach(m=>{const _=window.getDefaultValues?window.getDefaultValues(n,m):_e(m),g=document.createElement("div");g.className="custom-location-crop";const b=Object.values(_.yieldMultipliers||{});if(b.length>0){const w=Math.min(...b),y=Math.max(...b),v=(_.meanYield*w).toFixed(2),M=(_.meanYield*y).toFixed(2);g.innerHTML=`
          <div class="custom-location-crop-name">${m}</div>
          <div class="custom-location-param">
            <span>Mean Yield:</span>
            <span>${_.meanYield} t/ha</span>
          </div>
          <div class="custom-location-param">
            <span>Drought Yield:</span>
            <span>${_.droughtYield} t/ha</span>
          </div>
          <div class="custom-location-param">
            <span>Yield Range:</span>
            <span>${v} - ${M} t/ha</span>
          </div>
        `}else g.innerHTML=`
          <div class="custom-location-crop-name">${m}</div>
          <div class="custom-location-param">
            <span>Mean Yield:</span>
            <span>${_.meanYield} t/ha</span>
          </div>
          <div class="custom-location-param">
            <span>Drought Yield:</span>
            <span>${_.droughtYield} t/ha</span>
          </div>
        `;s.appendChild(g)});const f=document.createElement("div");f.className="custom-location-actions",f.innerHTML=`
      <button class="danger-btn small-btn" onclick="deleteCustomLocation('${n}')">
        <i class="fas fa-trash"></i> Delete
      </button>
    `,o.appendChild(r),o.appendChild(s),o.appendChild(f),t.appendChild(o)})}function Vi(){const t=localStorage.getItem("agCalculatorDefaults"),e={locations:["Merredin","Moora"],crops:["Wheat","Canola","Barley"],defaultValues:{Merredin:{Wheat:_e("Wheat"),Canola:_e("Canola"),Barley:_e("Barley")},Moora:{Wheat:{..._e("Wheat"),meanYield:2.3,opCost:585},Canola:{..._e("Canola"),meanYield:1.4,opCost:585},Barley:{..._e("Barley"),meanYield:2.9,opCost:585}}}};return t?JSON.parse(t):e}function Kf(t){localStorage.setItem("agCalculatorDefaults",JSON.stringify(t))}function Xf(){const t=document.getElementById("locationSelect");if(!t)return;const e=window.getLocations?window.getLocations():["Merredin","Moora"];t.innerHTML="",e.forEach(a=>{const i=document.createElement("option");i.value=a,i.textContent=a,t.appendChild(i)})}function Ut(){const t=document.getElementById("activeLocationSelect");if(!t)return;console.log("Updating active location dropdown");const e=t.value,i=Vi().locations||["Merredin","Moora"];console.log("Available locations:",i),t.innerHTML="",i.forEach(n=>{const o=document.createElement("option");o.value=n,o.textContent=n,t.appendChild(o)}),i.includes(e)&&(t.value=e)}function Jf(t){const e=t.trim().split(`
`),a=e[0].split(",").map(n=>n.trim()),i=[];for(let n=1;n<e.length;n++){const o=e[n].split(",").map(s=>s.trim());if(o.length!==a.length)continue;const r={};a.forEach((s,l)=>{const c=o[l];s==="Location"?r.town_name=c:s==="Operational cost"?r.operational_cost=isNaN(c)?0:parseFloat(c):s==="Evaporation"?r.soil_evaporation=isNaN(c)?0:parseFloat(c):s==="Current plant available water"?r.current_plant_available_water=isNaN(c)?0:parseFloat(c):s==="RCP 4.5 available water"?r.rcp45_available_water=isNaN(c)?0:parseFloat(c):s==="RCP 8.5 available water"&&(r.rcp85_available_water=isNaN(c)?0:parseFloat(c))}),i.push(r)}return i}function Zf(t){fetch(t).then(e=>e.text()).then(e=>{const a=Jf(e);window.locationDatabase=a,console.log(`Location database loaded with ${a.length} locations`)}).catch(e=>{console.error("Error loading location database:",e)})}window.openLocationModal=Zr;window.closeLocationModal=xa;window.saveCustomLocation=Qr;window.deleteCustomLocation=as;window.deleteCustomLocationAndRefresh=Gf;window.refreshCustomLocationsList=is;window.openManageLocationsModal=es;window.closeManageLocationsModal=pi;window.initializeCustomLocationManagement=di;window.updateYieldMultiplierValues=da;window.previewYieldVariation=Hi;window.calculateRcpMultipliers=Ur;window.loadLocationDatabaseFromCSV=Zf;window.Chart=Pi;window.adjustSensitivity=Ru;window.resetSensitivity=Cr;window.calculateAndDisplay=ue;window.closeComparisonModal=mt;window.openComparisonModal=Ti;window.updateComparison=ph;window.loadProfileParams=sh;window.deleteProfileConfirm=lh;window.yieldMultipliers=Te;window.calculateResults=Mr;window.loadParams=Fu;window.addProfile=ah;window.refreshProfilesList=ft;window.refreshComparisonView=at;window.getComparisonIds=ht;window.getProfileById=jt;window.updateProfile=kr;window.initializeDefaultsUI=ya;window.applyDefaultsToCalculator=$t;window.getDefaultValues=qt;window.setDefaultValues=Oi;window.getLocations=Fi;window.getCrops=$i;window.addLocation=Yr;window.addCrop=Rr;window.setCurrentCrop=Mh;window.getCurrentCrop=Sh;window.setCurrentLocation=xh;window.getCurrentLocation=Ch;window.updateYieldMultipliers=Tu;window.updateRcpMultipliers=Yu;window.generateYearlyRcpMultiplier=ai;window.refreshMetricsView=Nr;document.addEventListener("DOMContentLoaded",()=>{ff(),setTimeout(()=>{vf()},500),ii?ii():ue(),_o&&_o(),ya&&ya(),bo&&bo(),window.initializeCustomLocationManagement&&setTimeout(()=>window.initializeCustomLocationManagement(),500),window.initializeUnderstandComparisonFeature&&window.initializeUnderstandComparisonFeature()});

</script>
  <style>
:root{--primary: #38a169;--primary-dark: #2f855a;--primary-light: #9ae6b4;--primary-lightest: #f0fff4;--secondary: #4a5568;--secondary-dark: #2d3748;--secondary-light: #a0aec0;--light: #f7fafc;--lighter: #f8fafc;--lightest: #ffffff;--dark: #1a202c;--dark-light: #2d3748;--success: #48bb78;--success-light: #c6f6d5;--danger: #e53e3e;--danger-light: #fed7d7;--warning: #ed8936;--warning-light: #feebc8;--info: #4299e1;--info-light: #bee3f8;--border: #e2e8f0;--border-dark: #cbd5e0;--finance-gradient-from: #3182ce;--finance-gradient-to: #2c5282;--yield-gradient-from: #38a169;--yield-gradient-to: #276749;--adjustment-gradient-from: #805ad5;--adjustment-gradient-to: #553c9a;--climate-gradient-from: #dd6b20;--climate-gradient-to: #c05621;--sensitivity-gradient-from: #3182ce;--sensitivity-gradient-to: #2b6cb0;--profile-gradient-from: #4a5568;--profile-gradient-to: #2d3748;.financial-gradient{background:linear-gradient(135deg,#2c3e50 0%,#4ca1af 100%);color:#fff}.equity-warning{color:#e53e3e;font-weight:700}.equity-healthy{color:#38a169}.financial-charts-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(450px,1fr));gap:20px;margin:20px 0}.financial-chart{height:300px;background:white;border-radius:8px;padding:15px;box-shadow:0 1px 3px #0000001f}--shadow-xs: 0 0 0 1px rgba(0, 0, 0, .05);--shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, .05);--shadow: 0 1px 3px 0 rgba(0, 0, 0, .1), 0 1px 2px 0 rgba(0, 0, 0, .06);--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, .1), 0 2px 4px -1px rgba(0, 0, 0, .06);--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, .1), 0 4px 6px -2px rgba(0, 0, 0, .05);--shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, .1), 0 10px 10px -5px rgba(0, 0, 0, .04);--transition-fast: .15s ease;--transition-medium: .25s ease;--transition-slow: .4s ease;--radius-xs: 2px;--radius-sm: 4px;--radius: 6px;--radius-md: 8px;--radius-lg: 12px;--radius-full: 9999px;--sidebar-width: 280px;--header-height: 60px;--mobile-tab-height: 56px}*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif}body{background-color:#f5f7fa;color:var(--dark);line-height:1.6;font-size:16px;overflow-x:hidden}body.sidebar-open{overflow:hidden}h1,h2,h3,h4,h5,h6{font-weight:600;line-height:1.3;color:var(--dark)}h1{font-size:1.5rem}h2{font-size:1.3rem}h3{font-size:1.1rem}a{color:var(--primary);text-decoration:none;transition:color var(--transition-fast)}a:hover{color:var(--primary-dark)}.app-container{display:flex;min-height:100vh;position:relative}.main-content{flex:1;padding:0;display:flex;flex-direction:column;width:100%}.elevation-1{box-shadow:var(--shadow-sm)}.elevation-2{box-shadow:var(--shadow-md)}.elevation-3{box-shadow:var(--shadow-lg)}.elevation-4{box-shadow:var(--shadow-xl)}.sidebar{width:var(--sidebar-width);background-color:#fff;box-shadow:var(--shadow-lg);position:fixed;top:0;left:0;bottom:0;z-index:100;transform:translate(-100%);transition:transform var(--transition-medium);display:flex;flex-direction:column}.sidebar-visible{transform:translate(0)}.sidebar-header{height:var(--header-height);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 20px}.logo{display:flex;align-items:center;gap:10px;font-weight:600;font-size:1.2rem;color:var(--primary-dark)}.logo i{color:var(--primary)}.close-sidebar-btn{background:none;border:none;color:var(--secondary);cursor:pointer;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color var(--transition-fast)}.close-sidebar-btn:hover{background-color:#0000000d}.sidebar-content{flex:1;overflow-y:auto;padding:20px}.sidebar-nav{display:flex;flex-direction:column;gap:30px}.nav-section{display:flex;flex-direction:column;gap:10px}.nav-heading{font-size:.8rem;font-weight:600;text-transform:uppercase;color:var(--secondary-light);margin-bottom:5px;padding-left:10px}.nav-links{list-style:none;display:flex;flex-direction:column;gap:5px}.nav-item{width:100%}.nav-link{display:flex;align-items:center;gap:12px;padding:10px;border-radius:var(--radius-md);color:var(--secondary);font-weight:500;transition:all var(--transition-fast)}.nav-link i{font-size:1rem;width:20px;text-align:center}.nav-link:hover{background-color:var(--light);color:var(--primary-dark)}.nav-link.active{background-color:var(--primary-lightest);color:var(--primary-dark)}.quick-actions{display:flex;flex-direction:column;gap:8px}.quick-action-btn{display:flex;align-items:center;gap:10px;padding:10px;border-radius:var(--radius-md);background-color:var(--light);color:var(--secondary-dark);border:1px solid var(--border);cursor:pointer;font-weight:500;transition:all var(--transition-fast)}.quick-action-btn:hover{background-color:var(--secondary-light);color:#fff}.quick-action-btn i{font-size:1rem;width:20px;text-align:center}.sidebar-result-card{background-color:var(--light);border-radius:var(--radius-md);padding:15px;border:1px solid var(--border)}.sidebar-result-title{font-size:.9rem;font-weight:600;color:var(--secondary);margin-bottom:5px}.sidebar-result-value{font-size:1.5rem;font-weight:700;margin-bottom:5px}.sidebar-result-value.positive{color:var(--success)}.sidebar-result-value.negative{color:var(--danger)}.sidebar-result-meta{font-size:.8rem;color:var(--secondary-light)}.main-header{background-color:#fff;height:var(--header-height);box-shadow:var(--shadow);padding:0 20px;display:flex;flex-direction:column;justify-content:center;position:sticky;top:0;z-index:50}.mobile-header{display:flex;align-items:center;gap:15px;height:100%}.toggle-sidebar-btn{background:none;border:none;color:var(--secondary);cursor:pointer;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color var(--transition-fast)}.toggle-sidebar-btn:hover{background-color:#0000000d}.breadcrumb{display:none;align-items:center;font-size:.9rem;color:var(--secondary)}.breadcrumb-item{color:var(--secondary)}.breadcrumb-item.current{font-weight:600;color:var(--primary-dark)}.breadcrumb-separator{margin:0 8px;font-size:.7rem;color:var(--secondary-light)}.mobile-tabs{display:flex;background-color:#fff;border-top:1px solid var(--border);position:fixed;bottom:0;left:0;right:0;z-index:50;height:var(--mobile-tab-height)}.mobile-tab{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;padding:8px 0;background:none;border:none;color:var(--secondary);font-size:.7rem;cursor:pointer;transition:all var(--transition-fast)}.mobile-tab i{font-size:1.1rem}.mobile-tab.active{color:var(--primary)}.tab-contents{flex:1;padding:15px;margin-bottom:var(--mobile-tab-height)}.tab-content{display:none}.tab-content.active{display:block}.card{background-color:#fff;border-radius:var(--radius-md);margin-bottom:20px;overflow:hidden;width:100%}.input-card{position:relative}.card-header{background-color:var(--lighter);padding:15px;border-bottom:1px solid var(--border)}.primary-header{background-color:var(--primary-lightest);border-bottom:1px solid var(--primary-light)}.header-content{display:flex;flex-direction:column;gap:10px;justify-content:space-between;align-items:flex-start;width:100%}.card-title{color:var(--primary-dark);margin:0;display:flex;align-items:center;gap:8px}.card-title i{color:var(--primary)}.final-margin{font-size:1.1rem;font-weight:600;padding:8px 12px;border-radius:var(--radius-sm);background-color:#fff;border:1px solid var(--border)}.header-actions{display:flex;gap:10px}.action-btn{background-color:#fff;color:var(--secondary);border:1px solid var(--border);border-radius:var(--radius-sm);padding:6px 12px;font-size:.9rem;cursor:pointer;display:flex;align-items:center;gap:6px;transition:all var(--transition-fast)}.action-btn:hover{background-color:var(--lighter);color:var(--primary-dark)}.status-bar{display:flex;justify-content:space-between;margin-top:10px}.status-chip{display:flex;align-items:center;gap:6px;padding:4px 8px;border-radius:var(--radius-full);background-color:#fff;font-size:.8rem;color:var(--secondary);border:1px solid var(--border)}.status-chip i{color:var(--secondary-light)}.view-toggle{display:flex;border-radius:var(--radius-sm);overflow:hidden;border:1px solid var(--border)}.view-btn{background:white;border:none;padding:4px 10px;cursor:pointer;color:var(--secondary);transition:all var(--transition-fast)}.view-btn:hover{background-color:var(--lighter)}.view-btn.active{background-color:var(--secondary);color:#fff}.card-content{padding:15px}.location-crop-select{margin:10px 0;border-top:1px solid var(--border);padding-top:10px}.select-group{display:flex;flex-direction:column;gap:10px}.select-container{flex:1}.select-container label{display:block;margin-bottom:4px;font-weight:500;color:var(--secondary);font-size:.9rem}.select-container select{width:100%;padding:8px 12px;border:1px solid var(--border);border-radius:var(--radius-sm);font-size:.9rem;background-color:#fff}.accordion-container{display:flex;flex-direction:column;gap:15px}.accordion-section{border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;transition:box-shadow var(--transition-medium)}.accordion-section:hover{box-shadow:var(--shadow-sm)}.accordion-header{display:flex;justify-content:space-between;align-items:center;padding:12px 15px;background-color:var(--lighter);cursor:pointer;border-bottom:1px solid var(--border);transition:background-color var(--transition-fast)}.finance-gradient{background:linear-gradient(to right,var(--finance-gradient-from),var(--finance-gradient-to));color:#fff;border-bottom:none}.finance-gradient h3,.finance-gradient h3 i{color:#fff}.yield-gradient{background:linear-gradient(to right,var(--yield-gradient-from),var(--yield-gradient-to));color:#fff;border-bottom:none}.yield-gradient h3,.yield-gradient h3 i{color:#fff}.adjustment-gradient{background:linear-gradient(to right,var(--adjustment-gradient-from),var(--adjustment-gradient-to));color:#fff;border-bottom:none}.adjustment-gradient h3,.adjustment-gradient h3 i{color:#fff}.climate-gradient{background:linear-gradient(to right,var(--climate-gradient-from),var(--climate-gradient-to));color:#fff;border-bottom:none}.climate-gradient h3,.climate-gradient h3 i{color:#fff}.sensitivity-gradient{background:linear-gradient(to right,var(--sensitivity-gradient-from),var(--sensitivity-gradient-to));color:#fff;border-bottom:none}.sensitivity-gradient h3,.sensitivity-gradient h3 i{color:#fff}.profile-gradient{background:linear-gradient(to right,var(--profile-gradient-from),var(--profile-gradient-to));color:#fff;border-bottom:none}.profile-gradient h3,.profile-gradient h3 i{color:#fff}.accordion-toggle{background:none;border:none;color:currentColor;cursor:pointer;font-size:.9rem;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color var(--transition-fast)}.accordion-toggle:hover{background-color:#fff3}.accordion-content{max-height:0;overflow:hidden;transition:max-height var(--transition-medium),padding var(--transition-medium);padding:0 15px}.accordion-content.expanded{max-height:1000px;padding:15px}.input-group{display:flex;flex-direction:column;gap:15px}.form-group{margin-bottom:0}label{display:block;margin-bottom:5px;font-weight:500;color:var(--secondary)}input,select{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:var(--radius-sm);font-size:.95rem;transition:border-color var(--transition-fast),box-shadow var(--transition-fast)}input:focus,select:focus{border-color:var(--primary);outline:none;box-shadow:0 0 0 3px #38a16926}.input-with-icon{position:relative}.input-with-icon input{padding-right:30px}.input-icon{position:absolute;right:10px;top:50%;transform:translateY(-50%);color:var(--secondary);pointer-events:none}.input-with-info{position:relative}.info-tooltip{position:absolute;right:-25px;top:50%;transform:translateY(-50%);color:var(--info);cursor:help}.info-tooltip:before{content:attr(data-tooltip);position:absolute;bottom:100%;right:0;background-color:var(--dark);color:#fff;padding:5px 10px;border-radius:var(--radius-sm);font-size:.8rem;width:200px;opacity:0;pointer-events:none;transition:opacity var(--transition-fast);z-index:100}.info-tooltip:hover:before{opacity:1}.hidden{display:none}.toggle-group{display:flex;flex-direction:column}.toggle-switch-container{display:flex;align-items:center;gap:10px}.toggle-switch{position:relative;display:inline-block;width:40px;height:22px}.toggle-switch input{opacity:0;width:0;height:0}.toggle-switch label{position:absolute;cursor:pointer;inset:0;background-color:#ccc;transition:background-color var(--transition-fast);border-radius:22px;margin:0}.toggle-switch label:before{position:absolute;content:"";height:18px;width:18px;left:2px;bottom:2px;background-color:#fff;transition:transform var(--transition-fast);border-radius:50%}.toggle-switch input:checked+label{background-color:var(--primary)}.toggle-switch input:checked+label:before{transform:translate(18px)}.toggle-label{font-weight:500;font-size:.9rem}.drought-group{flex-basis:100%}.drought-years-container{border:1px solid var(--border);border-radius:var(--radius-sm);padding:10px;background-color:var(--lighter);max-height:250px;overflow-y:auto}.drought-years-header{display:flex;justify-content:space-between;margin-bottom:10px}.drought-years-header button{font-size:.8rem;padding:5px 8px}.drought-years-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}.drought-years-grid>div{display:flex;align-items:center;background-color:#fff;padding:5px 8px;border-radius:var(--radius-sm);border:1px solid var(--border)}.drought-years-grid input[type=checkbox]{width:auto;margin-right:5px}.sensitivity-controls{display:grid;grid-template-columns:1fr;gap:15px}.sensitivity-item{display:flex;flex-direction:column;gap:8px}.sensitivity-label{font-weight:500;color:var(--secondary)}.sensitivity-slider-container{display:flex;align-items:center;gap:10px;width:100%}.sensitivity-slider{flex:1;-webkit-appearance:none;height:6px;background:var(--border);border-radius:3px;outline:none}.sensitivity-slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:16px;height:16px;background:var(--primary);border-radius:50%;cursor:pointer;transition:background var(--transition-fast)}.sensitivity-slider::-moz-range-thumb{width:16px;height:16px;background:var(--primary);border-radius:50%;cursor:pointer;transition:background var(--transition-fast);border:none}.sensitivity-slider::-webkit-slider-thumb:hover{background:var(--primary-dark)}.sensitivity-slider::-moz-range-thumb:hover{background:var(--primary-dark)}.sensitivity-value{min-width:45px;text-align:right;font-weight:500;font-size:.9rem}.reset-btn{background-color:var(--secondary);color:#fff;border:none;border-radius:var(--radius-sm);padding:8px 12px;cursor:pointer;font-weight:500;transition:background-color var(--transition-fast);display:flex;align-items:center;justify-content:center;gap:5px}.reset-btn:hover{background-color:var(--secondary-dark)}.profile-controls{display:flex;flex-direction:column;gap:15px}.profile-name-input{flex:1}button{background-color:var(--secondary);color:#fff;border:none;padding:10px 16px;border-radius:var(--radius-sm);cursor:pointer;font-weight:500;transition:background-color var(--transition-fast);display:inline-flex;align-items:center;justify-content:center;gap:6px}button:hover{background-color:var(--secondary-dark)}.primary-btn{background-color:var(--primary)}.primary-btn:hover{background-color:var(--primary-dark)}.secondary-btn{background-color:var(--secondary)}.secondary-btn:hover{background-color:var(--secondary-dark)}.danger-btn{background-color:var(--danger)}.danger-btn:hover{background-color:#c53030}.btn-group{display:flex;justify-content:flex-end;margin-top:20px;gap:10px}.table-responsive{overflow-x:auto;width:100%}.data-table{width:100%;border-collapse:collapse;margin-top:10px;font-size:.95rem}.data-table th,.data-table td{padding:12px 15px;text-align:left;border-bottom:1px solid var(--border)}.data-table th{background-color:var(--lighter);font-weight:600;position:sticky;top:0;z-index:10}.data-table tr:hover{background-color:var(--lighter)}.data-table tr:last-child td{border-bottom:none}.profile-list{display:flex;flex-direction:column;gap:15px}.profile-list-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:15px}.positive{color:var(--success)}.negative{color:var(--danger)}.empty-message{padding:30px 20px;text-align:center;color:var(--secondary);background-color:var(--lighter);border-radius:var(--radius-sm);margin:10px 0;display:flex;flex-direction:column;align-items:center;gap:10px}.empty-icon{font-size:3rem;color:var(--secondary-light);opacity:.5}.modal-overlay{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000;display:none}.modal{background-color:#fff;border-radius:var(--radius-md);width:90%;max-width:600px;max-height:90vh;display:flex;flex-direction:column}.modal-header{padding:15px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.modal-title{font-weight:600;font-size:1.2rem;display:flex;align-items:center;gap:8px}.modal-title i{color:var(--primary)}.modal-close{background:none;border:none;color:var(--secondary);cursor:pointer;font-size:1.2rem;padding:5px;display:flex;align-items:center;justify-content:center}.modal-body{padding:15px;overflow-y:auto;flex:1}.modal-footer{padding:15px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:10px}.notification-toast{position:fixed;bottom:20px;right:20px;padding:15px;border-radius:var(--radius-md);background-color:#fff;display:flex;align-items:center;gap:15px;min-width:300px;max-width:450px;transform:translateY(100px);opacity:0;transition:transform var(--transition-medium),opacity var(--transition-medium);z-index:1000}.notification-toast.show{transform:translateY(0);opacity:1}.notification-toast.notification-success .notification-icon{background-color:var(--success-light);color:var(--success)}.notification-toast.notification-warning .notification-icon{background-color:var(--warning-light);color:var(--warning)}.notification-toast.notification-error .notification-icon{background-color:var(--danger-light);color:var(--danger)}.notification-toast.notification-info .notification-icon{background-color:var(--info-light);color:var(--info)}.notification-icon{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.3rem}.notification-content{flex:1}.notification-title{font-weight:600;margin-bottom:2px}.notification-message{font-size:.9rem;color:var(--secondary)}.notification-close{background:none;border:none;color:var(--secondary);cursor:pointer;font-size:1rem;padding:5px;display:flex;align-items:center;justify-content:center}@media (min-width: 640px){.main-header{padding:0 25px}.tab-contents{padding:20px}.header-content{flex-direction:row;align-items:center}.select-group{flex-direction:row}.drought-years-grid{grid-template-columns:repeat(5,1fr)}.sensitivity-controls{grid-template-columns:repeat(2,1fr)}.profile-controls{flex-direction:row;align-items:flex-end}.breadcrumb{display:flex;margin-top:5px}}@media (min-width: 768px){.input-group{display:grid;grid-template-columns:repeat(2,1fr)}.drought-group{grid-column:span 2}.drought-years-grid{grid-template-columns:repeat(6,1fr)}.sensitivity-controls{grid-template-columns:repeat(2,1fr)}.notification-toast{bottom:calc(var(--mobile-tab-height) + 20px)}}@media (min-width: 1024px){body{padding:0}.app-container{padding-left:var(--sidebar-width)}.sidebar{transform:translate(0)}.close-sidebar-btn,.toggle-sidebar-btn{display:none}.drought-years-grid{grid-template-columns:repeat(8,1fr)}.sensitivity-controls{grid-template-columns:repeat(4,1fr)}.mobile-tabs{display:none}.tab-contents{margin-bottom:0;padding:25px}.notification-toast{bottom:20px}.profile-list{display:flex;flex-direction:column;gap:16px;width:100%}.profile-list-list .profile-item{display:flex;flex-direction:column;padding:0;border-radius:8px;overflow:hidden;transition:transform .2s,box-shadow .2s}.profile-list-list .profile-item:hover{transform:translateY(-2px);box-shadow:0 8px 16px #0000001a}.profile-item .profile-header{background:linear-gradient(to right,#38a169,#2f855a);padding:12px 16px;color:#fff;display:flex;justify-content:space-between;align-items:center}.profile-item .profile-title{font-size:1.2rem;font-weight:600;margin:0}.profile-item .profile-created{font-size:.8rem;opacity:.8}.profile-item .profile-content{padding:16px;background-color:#fff}.profile-item .profile-params{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;margin-bottom:16px}.profile-param{display:flex;flex-direction:column}.param-label{font-size:.75rem;color:#718096;margin-bottom:2px}.param-value{font-weight:500}.profile-item .profile-margin{display:flex;justify-content:space-between;align-items:center;padding-top:12px;border-top:1px solid #e2e8f0}.margin-label{font-weight:600;color:#4a5568}.margin-value{font-size:1.2rem;font-weight:700}.profile-item .profile-actions{display:flex;gap:8px;padding:12px 16px;background-color:#f7fafc;border-top:1px solid #e2e8f0}.profile-list-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}.profile-list-grid .profile-item{height:100%;display:flex;flex-direction:column}.profile-list-grid .profile-content{flex:1}@media (max-width: 768px){.profile-list-grid{grid-template-columns:1fr}.profile-item .profile-params{grid-template-columns:1fr 1fr}}.profile-tag{display:inline-block;padding:3px 8px;font-size:.75rem;font-weight:500;border-radius:4px;margin-right:4px;margin-bottom:4px}.sensitivity-values-clean{display:flex;flex-wrap:wrap;gap:10px;width:100%;font-size:.85rem}.sensitivity-factor{white-space:nowrap}.sensitivity-container{padding:8px;width:100%;grid-column:1 / -1}.neutral{color:#a0aec0}#comparisonModal .modal-body{padding:0;max-height:70vh;overflow-y:auto}.comparison-modal-actions{display:flex;justify-content:space-between;align-items:center;padding:15px;background-color:#f8fafc;border-bottom:1px solid #e2e8f0;position:sticky;top:0;z-index:10}.modal-action-buttons{display:flex;gap:10px}.selection-count{font-weight:500;color:#4a5568}.comparison-profiles-grid{display:flex;flex-direction:column;gap:10px;padding:15px}.comparison-group-header{padding:10px 15px;background-color:#f1f5f9;border-radius:6px;margin-top:10px;color:#4a5568;font-weight:600;font-size:.9rem}.profile-item{border:1px solid #e2e8f0;border-radius:8px;background-color:#fff;transition:all .2s ease;cursor:pointer}.profile-item:hover{transform:translateY(-2px);box-shadow:0 4px 6px #0000001a}.profile-item.selected{border-color:var(--primary);background-color:var(--primary-lightest)}.profile-item-content{display:flex;align-items:center;padding:12px 15px}.profile-checkbox{margin-right:15px}.profile-details{flex:1}.profile-name{font-weight:600;font-size:1rem;margin-bottom:3px}.profile-location-crop{font-size:.8rem;color:#718096;margin-bottom:5px}.profile-metrics{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}.profile-tag{display:inline-block;padding:4px 8px;border-radius:4px;background-color:#edf2f7;font-size:.75rem;font-weight:500}.profile-tag.positive{background-color:#d1fae5;color:#065f46}.profile-tag.negative{background-color:#fee2e2;color:#b91c1c}.profile-checkbox input[type=checkbox]{width:20px;height:20px;cursor:pointer}#comparisonModal .modal-footer{border-top:1px solid #e2e8f0;background-color:#f8fafc}@media (max-width: 640px){.comparison-modal-actions{flex-direction:column;gap:10px;align-items:flex-start}.modal-action-buttons{width:100%;justify-content:space-between}}#comparisonTab .comparison-actions button{background-color:#4a5568;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;font-size:14px;margin-right:10px;display:inline-flex;align-items:center;gap:5px;font-weight:400}#comparisonTab .comparison-actions button:hover{background-color:#2d3748}#comparisonTab .comparison-actions button.elevation-1{background-color:#4a5568!important;color:#fff!important;box-shadow:none!important}#comparisonTab .comparison-actions button.action-btn,#comparisonTab .comparison-actions button.secondary{background-color:#4a5568!important;color:#fff!important}}

</style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar Navigation (shows on tablet and larger) -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <i class="fas fa-seedling"></i>
          <span>Cli-mate 25</span>
        </div>
        <button id="closeSidebarBtn" class="close-sidebar-btn">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="sidebar-content">
        <nav class="sidebar-nav">
          <div class="nav-section">
            <h3 class="nav-heading">Navigation</h3>
            <ul class="nav-links">
              <li class="nav-item">
                <a href="#" class="nav-link active" data-tab="input">
                  <i class="fas fa-sliders-h"></i>
                  <span>Input Parameters</span>
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link" data-tab="yearly">
                  <i class="fas fa-table"></i>
                  <span>Yearly Results</span>
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link" data-tab="profiles">
                  <i class="fas fa-folder"></i>
                  <span>Profiles</span>
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link" data-tab="comparison">
                  <i class="fas fa-chart-bar"></i>
                  <span>Comparison</span>
                </a>
              </li>
              <li class="nav-item">
                <a href="#" class="nav-link" data-tab="metrics">
                  <i class="fas fa-tachometer-alt"></i>
                  <span>Metric Comparisons</span>
                </a>
              </li>
            </ul>
          </div>
          
         
          <div class="nav-section">
            <h3 class="nav-heading">Current Result</h3>
            <div class="sidebar-result-card">
              <div class="sidebar-result-title">Final Margin</div>
              <div id="sidebarMarginValue" class="sidebar-result-value">$0.00</div>
              <div class="sidebar-result-meta">Based on current inputs</div>
            </div>
          </div>
        </nav>
      </div>
    </aside>
    
    <!-- Main Content Area -->
    <main class="main-content">
      <header class="main-header">
        <div class="mobile-header">
          <button id="toggleSidebarBtn" class="toggle-sidebar-btn">
            <i class="fas fa-bars"></i>
          </button>
          <h1>2026 to 2050</h1>
        </div>
        
        <!-- Breadcrumb navigation -->
        <div class="breadcrumb">
          <span class="breadcrumb-item">Home</span>
          <i class="fas fa-chevron-right breadcrumb-separator"></i>
          <span id="currentBreadcrumb" class="breadcrumb-item current">Input Parameters</span>
        </div>
      </header>
      
      <!-- Mobile Navigation Tabs -->
      <div class="mobile-tabs">
        <button class="mobile-tab active" data-tab="input">
          <i class="fas fa-sliders-h"></i>
          <span>Input</span>
        </button>
        <button class="mobile-tab" data-tab="yearly">
          <i class="fas fa-table"></i>
          <span>Results</span>
        </button>
        <button class="mobile-tab" data-tab="profiles">
          <i class="fas fa-folder"></i>
          <span>Profiles</span>
        </button>
        <button class="mobile-tab" data-tab="comparison">
          <i class="fas fa-chart-bar"></i>
          <span>Compare</span>
        </button>
        <button class="mobile-tab" data-tab="metrics">
          <i class="fas fa-tachometer-alt"></i>
          <span>Metrics</span>
        </button>
      </div>
      
      <!-- Tab Contents -->
      <div class="tab-contents">
        <!-- Input Parameters Tab -->
        <div id="inputTab" class="tab-content active">
          <div class="card input-card elevation-2">
            <div class="card-header primary-header">
              <div class="header-content">
                <h2 class="card-title"><i class="fas fa-sliders-h"></i> Input Parameters</h2>
                <div id="finalMarginDisplay" class="final-margin elevation-1">
                  Final Margin: <span id="finalMarginValue" class=""></span>
                </div>
              </div>
              
              <!-- Location and Crop Selector -->
              <div id="locationCropSelect" class="location-crop-select">
                <div class="select-group">
                  <div class="select-container">
                    <label for="activeLocationSelect">Location:</label>
                    <select id="activeLocationSelect" class="elevation-1"></select>
                  </div>
                  <div class="select-container">
                    <label for="activeCropSelect">Crop:</label>
                    <select id="activeCropSelect" class="elevation-1"></select>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card-content">
              <!-- Input Parameters Accordion -->
              <div class="accordion-container">
                <!-- Price and Cost Section -->
                <div class="accordion-section elevation-1">
                  <div class="accordion-header finance-gradient">
                    <h3><i class="fas fa-coins"></i> Price and Operational Costs</h3>
                    <button class="accordion-toggle" aria-label="Toggle section"><i class="fas fa-chevron-down"></i></button>
                  </div>
                  <div class="accordion-content expanded">
                    <div class="input-group">
                      <div class="form-group">
                        <label for="basePrice">Base Price ($/tonne)</label>
                        <div class="input-with-icon">
                          <input type="number" id="basePrice" value="350" min="0" step="5" class="elevation-1">
                          <i class="fas fa-dollar-sign input-icon"></i>
                        </div>
                      </div>
                      
                      <div class="form-group">
                        <label for="opCost">Operational Cost ($/ha)</label>
                        <div class="input-with-icon">
                          <input type="number" id="opCost" value="400" min="0" step="10" class="elevation-1">
                          <i class="fas fa-dollar-sign input-icon"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Base Yield Section -->
                <div class="accordion-section elevation-1">
                  <div class="accordion-header yield-gradient">
                    <h3><i class="fas fa-seedling"></i> Base Yield Settings</h3>
                    <button class="accordion-toggle" aria-label="Toggle section"><i class="fas fa-chevron-down"></i></button>
                  </div>
                  <div class="accordion-content expanded">
                    <div class="input-group">
                      <div class="form-group">
                        <label for="meanYield">Mean Yield (t/ha)</label>
                        <div class="input-with-icon">
                          <input type="number" id="meanYield" value="1.4" min="0" step="0.1" class="elevation-1">
                          <i class="fas fa-weight-hanging input-icon"></i>
                        </div>
                      </div>

                      <div class="form-group">
                        <label for="baseYieldType">Base Yield Type</label>
                        <div class="input-with-info">
                          <select id="baseYieldType" class="elevation-1">
                            <option value="mean">Mean Yield</option>
                            <option value="rcp45">RCP 4.5</option>
                            <option value="rcp85">RCP 8.5</option>
                          </select>
                          <span class="info-tooltip" data-tooltip="RCP climate scenarios adjust yield expectations based on climate projections">
                            <i class="fas fa-info-circle"></i>
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Yield Adjustments Section -->
                <div class="accordion-section elevation-1">
                  <div class="accordion-header adjustment-gradient">
                    <h3><i class="fas fa-chart-line"></i> Yield Adjustments</h3>
                    <button class="accordion-toggle" aria-label="Toggle section"><i class="fas fa-chevron-down"></i></button>
                  </div>
                  <div class="accordion-content expanded">
                    <div class="input-group">
                      <div class="form-group toggle-group">
                        <label for="variedYield">Varied Yield</label>
                        <div class="toggle-switch-container">
                          <div class="toggle-switch elevation-1">
                            <input type="checkbox" id="variedYieldToggle" checked>
                            <label for="variedYieldToggle"></label>
                          </div>
                          <span class="toggle-label" id="variedYieldLabel">Yes</span>
                          <!-- Hidden original select for compatibility -->
                          <select id="variedYield" class="hidden">
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                          </select>
                        </div>
                      </div>

                      <div class="form-group toggle-group">
                        <label for="stepChangeEnabled">Step Change Increase</label>
                        <div class="toggle-switch-container">
                          <div class="toggle-switch elevation-1">
                            <input type="checkbox" id="stepChangeEnabledToggle">
                            <label for="stepChangeEnabledToggle"></label>
                          </div>
                          <span class="toggle-label" id="stepChangeEnabledLabel">No</span>
                          <!-- Hidden original select for compatibility -->
                          <select id="stepChangeEnabled" class="hidden">
                            <option value="false">No</option>
                            <option value="true">Yes</option>
                          </select>
                        </div>
                      </div>
                      
                      <div class="form-group">
                        <label for="stepChangeYear">Step Change Year</label>
                        <div class="input-with-icon">
                          <input type="number" id="stepChangeYear" value="2041" min="2026" max="2050" step="1" class="elevation-1">
                          <i class="fas fa-calendar-alt input-icon"></i>
                        </div>
                      </div>
                      
                      <div class="form-group">
                        <label for="stepChangeAmount">Step Change Amount (%)</label>
                        <div class="input-with-icon">
                          <input type="number" id="stepChangeAmount" value="10" min="0" max="100" step="1" class="elevation-1">
                          <i class="fas fa-percentage input-icon"></i>
                        </div>
                      </div>
                      
                      <div class="form-group toggle-group">
                        <label for="annualIncrease">Annual Yield Increase</label>
                        <div class="toggle-switch-container">
                          <div class="toggle-switch elevation-1">
                            <input type="checkbox" id="annualIncreaseToggle" checked>
                            <label for="annualIncreaseToggle"></label>
                          </div>
                          <span class="toggle-label" id="annualIncreaseLabel">Yes</span>
                          <!-- Hidden original select for compatibility -->
                          <select id="annualIncrease" class="hidden">
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                          </select>
                        </div>
                      </div>
                      
                      <div class="form-group">
                        <label for="annualIncreaseRate">Annual Increase Rate (%)</label>
                        <div class="input-with-icon">
                          <input type="number" id="annualIncreaseRate" value="1" min="0" max="10" step="0.1" class="elevation-1">
                          <i class="fas fa-percentage input-icon"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Climate Settings Section -->
                 <!-- Financial Position Section -->
                <div class="accordion-section elevation-1">
                  <div class="accordion-header financial-gradient">
                    <h3><i class="fas fa-chart-line"></i> Financial Position</h3>
                    <button class="accordion-toggle" aria-label="Toggle section"><i class="fas fa-chevron-down"></i></button>
                  </div>
                  <div class="accordion-content expanded">
                    <div class="input-group">
                      <div class="form-group">
                        <label for="netWorthHa">Net Worth ($/ha)</label>
                        <div class="input-with-icon">
                          <input type="number" id="netWorthHa" value="1800" min="0" step="50" class="elevation-1">
                          <i class="fas fa-dollar-sign input-icon"></i>
                        </div>
                        <div class="helper-text">Initial net worth per hectare</div>
                      </div>
                      
                      <div class="form-group">
                        <label for="equityPercent">Equity (%)</label>
                        <div class="input-with-icon">
                          <input type="number" id="equityPercent" value="69" min="0" max="100" step="1" class="elevation-1">
                          <i class="fas fa-percentage input-icon"></i>
                        </div>
                        <div class="helper-text">Initial equity percentage</div>
                      </div>
                      
                      <div class="form-group toggle-group">
                        <label for="landValueAppreciation">Land Value Appreciation</label>
                        <div class="toggle-switch-container">
                          <div class="toggle-switch elevation-1">
                            <input type="checkbox" id="landValueAppreciationToggle" checked>
                            <label for="landValueAppreciationToggle"></label>
                          </div>
                          <span class="toggle-label" id="landValueAppreciationLabel">Yes</span>
                          <!-- Hidden original select for compatibility -->
                          <select id="landValueAppreciation" class="hidden">
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                          </select>
                        </div>
                      </div>
                      
                      <div class="form-group">
                        <label for="landAppreciationRate">Annual Appreciation Rate (%)</label>
                        <div class="input-with-icon">
                          <input type="number" id="landAppreciationRate" value="1" min="0" max="10" step="0.1" class="elevation-1">
                          <i class="fas fa-percentage input-icon"></i>
                        </div>
                        <div class="helper-text">Yearly land value increase percentage</div>
                      </div>
                      
                      <div class="form-group">
                        <label for="criticalEquity">Critical Equity Threshold (%)</label>
                        <div class="input-with-icon">
                          <input type="number" id="criticalEquity" value="60" min="0" max="100" step="1" class="elevation-1">
                          <i class="fas fa-exclamation-triangle input-icon"></i>
                        </div>
                        <div class="helper-text">Equity level that may concern lenders</div>
                      </div>
                    </div>
                  </div>
                </div>


                <!-- Drought Settings Section -->
                <div class="accordion-section elevation-1">
                  <div class="accordion-header climate-gradient">
                    <h3><i class="fas fa-cloud-sun-rain"></i> Drought Settings</h3>
                    <button class="accordion-toggle" aria-label="Toggle section"><i class="fas fa-chevron-down"></i></button>
                  </div>
                  <div class="accordion-content expanded">
                    <div class="input-group">
                      <div class="form-group">
                        <label for="droughtYield">Drought Yield (t/ha)</label>
                        <div class="input-with-icon">
                          <input type="number" id="droughtYield" value="0.53" min="0" step="0.01" class="elevation-1">
                          <i class="fas fa-tint-slash input-icon"></i>
                        </div>
                      </div>

                      <div class="form-group drought-group">
                        <label>Drought Years</label>
                        <div id="droughtYearsContainer" class="drought-years-container elevation-1">
                          <div class="drought-years-header">
                            <button type="button" id="selectAllDroughtYears" class="secondary"><i class="fas fa-check-square"></i> Select All</button>
                            <button type="button" id="clearAllDroughtYears" class="secondary"><i class="fas fa-ban"></i> Clear All</button>
                          </div>
                          <div id="droughtYearsCheckboxes" class="drought-years-grid">
                            <!-- Checkboxes will be added by JavaScript -->
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Sensitivity Analysis Section -->
                <div class="accordion-section elevation-1">
                  <div class="accordion-header sensitivity-gradient">
                    <h3><i class="fas fa-sliders-h"></i> Sensitivity Analysis</h3>
                    <button class="accordion-toggle" aria-label="Toggle section"><i class="fas fa-chevron-down"></i></button>
                  </div>
                  <div class="accordion-content expanded">
                    <div class="sensitivity-controls">
                      <div class="sensitivity-item">
                        <div class="sensitivity-label">Base Price</div>
                        <div class="sensitivity-slider-container">
                          <input type="range" min="-20" max="20" value="0" step="1" class="sensitivity-slider elevation-1" id="basePriceSlider" 
                                 oninput="adjustSensitivity('basePrice', this.value)" onchange="this.dispatchEvent(new Event('input'))">
                          <div id="basePriceAdjustment" class="sensitivity-value">0%</div>
                        </div>
                      </div>

                      <div class="sensitivity-item">
                        <div class="sensitivity-label">Base Yield</div>
                        <div class="sensitivity-slider-container">
                          <input type="range" min="-20" max="20" value="0" step="1" class="sensitivity-slider elevation-1" id="baseYieldSlider"
                                 oninput="adjustSensitivity('baseYield', this.value)" onchange="this.dispatchEvent(new Event('input'))">
                          <div id="baseYieldAdjustment" class="sensitivity-value">0%</div>
                        </div>
                      </div>

                      <div class="sensitivity-item">
                        <div class="sensitivity-label">Operational Costs</div>
                        <div class="sensitivity-slider-container">
                          <input type="range" min="-20" max="20" value="0" step="1" class="sensitivity-slider elevation-1" id="opCostSlider"
                                 oninput="adjustSensitivity('opCost', this.value)" onchange="this.dispatchEvent(new Event('input'))">
                          <div id="opCostAdjustment" class="sensitivity-value">0%</div>
                        </div>
                      </div>

                      <div class="sensitivity-item">
                        <button class="reset-btn" onclick="resetSensitivity()"><i class="fas fa-redo"></i> Reset</button>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Profile Management Section -->
                <div class="accordion-section elevation-1">
                  <div class="accordion-header profile-gradient">
                    <h3><i class="fas fa-save"></i> Save Profile</h3>
                    <button class="accordion-toggle" aria-label="Toggle section"><i class="fas fa-chevron-down"></i></button>
                  </div>
                  <div class="accordion-content expanded">
                    <div class="profile-controls">
                      <div class="form-group profile-name-input">
                        <label for="profileName">Profile Name</label>
                        <div class="input-with-icon">
                          <input type="text" id="profileName" placeholder="e.g., Base Scenario" class="elevation-1">
                          <i class="fas fa-pencil-alt input-icon"></i>
                        </div>
                      </div>
                      <button id="saveProfileBtn" class="primary-btn"><i class="fas fa-save"></i> Save Profile</button>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="btn-group">
                <button id="calculateBtn" class="primary-btn elevation-2"><i class="fas fa-calculator"></i> Calculate Results</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Yearly Results Tab -->
        <div id="yearlyTab" class="tab-content">
          <div class="card elevation-2">
            <div class="card-header">
              <div class="header-content">
                <h2 class="card-title"><i class="fas fa-table"></i> Yearly Results</h2>
                <div class="header-actions">
                  <button class="action-btn elevation-1"><i class="fas fa-download"></i> Export</button>
                  <button class="action-btn elevation-1"><i class="fas fa-print"></i> Print</button>
                </div>
              </div>
              <div class="status-bar">
                <div class="status-chip elevation-1">
                  <i class="fas fa-check-circle"></i>
                  <span>Calculated</span>
                </div>
                <div class="status-chip elevation-1">
                  <i class="fas fa-clock"></i>
                  <span>Updated: <time id="lastCalculatedTime">Just now</time></span>
                </div>
              </div>
            </div>
            <div class="card-content">
              <div class="table-responsive">
                <table id="yearlyTable" class="data-table elevation-1">
                  <thead>
                    <tr>
                      <th>Year</th>
                      <th>Yield (t/ha)</th>
                      <th>Revenue ($)</th>
                      <th>Costs ($)</th>
                      <th>Gross Margin ($)</th>
                      <th>Cumulative Margin ($)</th>
                      <th>Assets ($/ha)</th>
                      <th>Liabilities ($/ha)</th>
                      <th>Net Worth ($/ha)</th>
                      <th>Equity (%)</th>
                    </tr>
                  </thead>
                  <tbody id="yearlyTableBody">
                    <!-- Data will be populated by JavaScript -->
                  </tbody>
                </table>
                <!-- Add this after the yearly table in index.html -->
                <div class="financial-metrics-summary elevation-1">
                  <h3><i class="fas fa-chart-line"></i> Financial Position Summary</h3>
                  <div class="financial-charts-container">
                    <div class="financial-chart">
                      <canvas id="equityChart"></canvas>
                    </div>
                    <div class="financial-chart">
                      <canvas id="netWorthChart"></canvas>
                    </div>
                  </div>
                  <div class="financial-charts-container">
                    <div class="financial-chart">
                      <canvas id="assetsLiabilitiesChart"></canvas>
                    </div>
                    <div class="financial-chart">
                      <canvas id="debtToAssetChart"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Profiles Tab -->
<div id="profilesTab" class="tab-content">
  <div class="card elevation-2">
    <div class="card-header">
      <div class="header-content">
        <h2 class="card-title"><i class="fas fa-folder"></i> Saved Profiles</h2>
        <div class="header-actions">
          <button id="manageComparisonBtn" class="action-btn elevation-1"><i class="fas fa-cog"></i> Manage Comparison</button>
        </div>
      </div>
      <div class="status-bar">
        <div class="view-toggle elevation-1">
          <button class="view-btn active" data-view="list"><i class="fas fa-list"></i></button>
          <button class="view-btn" data-view="grid"><i class="fas fa-th-large"></i></button>
        </div>
      </div>
    </div>
    <div class="card-content">
      <div id="profilesList" class="profile-list profile-list-list">
        <!-- Profiles will be populated by JavaScript -->
      </div>
      <div id="noProfilesMessage" class="empty-message elevation-1">
        <i class="fas fa-folder-open empty-icon"></i>
        <p>No profiles saved yet. Create a profile by configuring parameters and saving them.</p>
      </div>
    </div>
  </div>
</div>

        <!-- Comparison Tab -->
        <div id="comparisonTab" class="tab-content">
          <div class="card elevation-2">
            <div class="card-header">
              <div class="header-content">
                <h2 class="card-title"><i class="fas fa-chart-bar"></i> Profiles Comparison</h2>
                <div class="comparison-actions header-actions">
                  <!-- Will be populated with buttons by JavaScript -->
                </div>
              </div>
              <div class="status-bar">
                <div id="comparisonStatus" class="status-chip elevation-1">
                  <i class="fas fa-exclamation-circle"></i>
                  <span>No profiles selected</span>
                </div>
              </div>
            </div>
            <div class="card-content">
              <div id="noComparisonMessage" class="empty-message elevation-1">
                <i class="fas fa-chart-bar empty-icon"></i>
                <p>Select profiles to compare in the Profiles tab by clicking "Manage Comparison".</p>
              </div>
              <div id="comparisonContent" style="display: none;">
                <div class="comparison-table">
                  <table id="comparisonTable" class="data-table elevation-1">
                    <!-- Will be populated by JavaScript -->
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Metrics Tab -->
        <div id="metricsTab" class="tab-content">
          <div class="card elevation-2">
            <div class="card-header">
              <div class="header-content">
                <h2 class="card-title"><i class="fas fa-tachometer-alt"></i> Profile Metrics Comparison</h2>
                <div class="comparison-actions header-actions">
                  <!-- Will be populated with buttons by JavaScript -->
                </div>
              </div>
              <div class="status-bar">
                <div id="metricsStatus" class="status-chip elevation-1">
                  <i class="fas fa-exclamation-circle"></i>
                  <span>No profiles selected</span>
                </div>
              </div>
            </div>
            <div class="card-content">
              <div id="noMetricsMessage" class="empty-message elevation-1">
                <i class="fas fa-tachometer-alt empty-icon"></i>
                <p>Select profiles to compare in the Profiles tab by clicking "Manage Comparison".</p>
              </div>
              <div id="metricsContent" style="display: none;">
                <!-- Will be populated with metrics by JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal for managing comparisons -->
  <div id="comparisonModal" class="modal-overlay">
    <div class="modal elevation-3">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-check-square"></i> Select Profiles to Compare</div>
        <button class="modal-close" onclick="closeComparisonModal()"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div id="compareProfilesList">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="closeComparisonModal()" class="secondary-btn"><i class="fas fa-times"></i> Cancel</button>
        <button onclick="updateComparison()" id="updateComparisonBtn" class="primary-btn"><i class="fas fa-check"></i> Update Comparison</button>
      </div>
    </div>
  </div>

  <!-- Notification Toast -->
  <div id="notificationToast" class="notification-toast elevation-3">
    <div class="notification-icon">
      <i class="fas fa-check-circle"></i>
    </div>
    <div class="notification-content">
      <div class="notification-title">Success</div>
      <div class="notification-message">Operation completed successfully</div>
    </div>
    <button class="notification-close">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <script>
    // Script to handle accordion toggle, toggle switches, and navigation
    document.addEventListener('DOMContentLoaded', function() {
      // Configure toggle switches
      function setupToggleSwitch(toggleId, selectId, labelId) {
        const toggle = document.getElementById(toggleId);
        const select = document.getElementById(selectId);
        const label = document.getElementById(labelId);
        
        if (toggle && select) {
          // Initialize toggle based on select value
          toggle.checked = select.value === 'true';
          label.textContent = toggle.checked ? 'Yes' : 'No';
          
          // Update select when toggle changes
          toggle.addEventListener('change', function() {
            select.value = this.checked ? 'true' : 'false';
            label.textContent = this.checked ? 'Yes' : 'No';
            
            // Trigger change event on select for any listeners
            select.dispatchEvent(new Event('change'));
          });
        }
      }
    
      // Setup all toggle switches
      setupToggleSwitch('stepChangeEnabledToggle', 'stepChangeEnabled', 'stepChangeEnabledLabel');
      setupToggleSwitch('landValueAppreciationToggle', 'landValueAppreciation', 'landValueAppreciationLabel');
      setupToggleSwitch('variedYieldToggle', 'variedYield', 'variedYieldLabel');
      setupToggleSwitch('annualIncreaseToggle', 'annualIncrease', 'annualIncreaseLabel');
      
      // Sidebar toggle for mobile
      const toggleSidebarBtn = document.getElementById('toggleSidebarBtn');
      const closeSidebarBtn = document.getElementById('closeSidebarBtn');
      const sidebar = document.querySelector('.sidebar');
      
      if (toggleSidebarBtn && sidebar) {
        toggleSidebarBtn.addEventListener('click', function() {
          sidebar.classList.add('sidebar-visible');
          document.body.classList.add('sidebar-open');
        });
      }
      
      if (closeSidebarBtn && sidebar) {
        closeSidebarBtn.addEventListener('click', function() {
          sidebar.classList.remove('sidebar-visible');
          document.body.classList.remove('sidebar-open');
        });
      }
      
      // Navigation functionality
      const navLinks = document.querySelectorAll('.nav-link');
      const mobileTabs = document.querySelectorAll('.mobile-tab');
      const tabContents = document.querySelectorAll('.tab-content');
      const currentBreadcrumb = document.getElementById('currentBreadcrumb');
      
      function setActiveTab(tabId) {
        // Update nav links
        navLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('data-tab') === tabId) {
            link.classList.add('active');
          }
        });
        
        // Update mobile tabs
        mobileTabs.forEach(tab => {
          tab.classList.remove('active');
          if (tab.getAttribute('data-tab') === tabId) {
            tab.classList.add('active');
          }
        });
        
        // Update tab contents
        tabContents.forEach(content => {
          content.classList.remove('active');
          if (content.id === tabId + 'Tab') {
            content.classList.add('active');
          }
        });
        
        // Update breadcrumb
        if (currentBreadcrumb) {
          let tabName = '';
          switch(tabId) {
            case 'input': tabName = 'Input Parameters'; break;
            case 'yearly': tabName = 'Yearly Results'; break;
            case 'profiles': tabName = 'Profiles'; break;
            case 'comparison': tabName = 'Comparison'; break;
            case 'metrics': tabName = 'Metric Comparisons'; break;
            default: tabName = 'Input Parameters';
          }
          currentBreadcrumb.textContent = tabName;
        }
        
        // Close sidebar on mobile after tab change
        if (window.innerWidth < 1024) {
          if (sidebar) {
            sidebar.classList.remove('sidebar-visible');
            document.body.classList.remove('sidebar-open');
          }
        }
      }
      
      // Add click event to nav links
      navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const tabId = this.getAttribute('data-tab');
          setActiveTab(tabId);
        });
      });
      
      // Add click event to mobile tabs
      mobileTabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const tabId = this.getAttribute('data-tab');
          setActiveTab(tabId);
        });
      });
      
      // Quick action buttons
      const quickCalculateBtn = document.getElementById('quickCalculateBtn');
      const quickSaveBtn = document.getElementById('quickSaveBtn');
      const quickResetBtn = document.getElementById('quickResetBtn');
      const calculateBtn = document.getElementById('calculateBtn');
      const saveProfileBtn = document.getElementById('saveProfileBtn');
      
      if (quickCalculateBtn && calculateBtn) {
        quickCalculateBtn.addEventListener('click', function() {
          calculateBtn.click();
          showNotification('Calculation', 'Results have been updated', 'success');
        });
      }
      
      if (quickSaveBtn && saveProfileBtn) {
        quickSaveBtn.addEventListener('click', function() {
          // First check if the profile name is set
          const profileName = document.getElementById('profileName');
          if (profileName && profileName.value.trim() === '') {
            showNotification('Save Profile', 'Please enter a profile name', 'warning');
          } else {
            saveProfileBtn.click();
          }
        });
      }
      
      if (quickResetBtn) {
        quickResetBtn.addEventListener('click', function() {
          if (window.resetSensitivity) {
            window.resetSensitivity();
            showNotification('Reset', 'Sensitivity values have been reset', 'info');
          }
        });
      }
      
      // Profile view toggle
      const viewToggleBtns = document.querySelectorAll('.view-btn');
      const profilesList = document.getElementById('profilesList');
      
      if (viewToggleBtns.length && profilesList) {
        viewToggleBtns.forEach(btn => {
          btn.addEventListener('click', function() {
            viewToggleBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const viewType = this.getAttribute('data-view');
            profilesList.classList.remove('profile-list-grid', 'profile-list-list');
            profilesList.classList.add('profile-list-' + viewType);
          });
        });
      }
      
      // Notification toast functionality
      function showNotification(title, message, type = 'success') {
        const toast = document.getElementById('notificationToast');
        const toastTitle = toast.querySelector('.notification-title');
        const toastMessage = toast.querySelector('.notification-message');
        const toastIcon = toast.querySelector('.notification-icon i');
        
        // Set content
        toastTitle.textContent = title;
        toastMessage.textContent = message;
        
        // Set icon and color based on type
        toast.className = 'notification-toast elevation-3';
        toast.classList.add('notification-' + type);
        
        switch(type) {
          case 'success':
            toastIcon.className = 'fas fa-check-circle';
            break;
          case 'warning':
            toastIcon.className = 'fas fa-exclamation-triangle';
            break;
          case 'error':
            toastIcon.className = 'fas fa-times-circle';
            break;
          case 'info':
            toastIcon.className = 'fas fa-info-circle';
            break;
        }
        
        // Show the toast
        toast.classList.add('show');
        
        // Hide after 3 seconds
        setTimeout(() => {
          toast.classList.remove('show');
        }, 3000);
        
        // Add close button functionality
        const closeBtn = toast.querySelector('.notification-close');
        if (closeBtn) {
          closeBtn.addEventListener('click', () => {
            toast.classList.remove('show');
          });
        }
      }
      
      // Make showNotification globally available
      window.showNotification = showNotification;
      
      // Update sidebar margin value when finalMarginValue changes
      const finalMarginValue = document.getElementById('finalMarginValue');
      const sidebarMarginValue = document.getElementById('sidebarMarginValue');
      
      if (finalMarginValue && sidebarMarginValue) {
        // Create a MutationObserver to watch for changes to finalMarginValue
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (mutation.type === 'childList' || mutation.type === 'characterData') {
              sidebarMarginValue.textContent = finalMarginValue.textContent;
              
              // Also update the class
              if (finalMarginValue.classList.contains('positive')) {
                sidebarMarginValue.classList.add('positive');
                sidebarMarginValue.classList.remove('negative');
              } else if (finalMarginValue.classList.contains('negative')) {
                sidebarMarginValue.classList.add('negative');
                sidebarMarginValue.classList.remove('positive');
              }
            }
          });
        });
        
        // Start observing
        observer.observe(finalMarginValue, {
          childList: true,
          characterData: true,
          subtree: true
        });
      }
    });
    </script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Wait a short time for other initialization to complete
    setTimeout(function() {
      // Initialize both location and crop select dropdowns
      initializeLocationDropdown();
      initializeCropDropdown();
      
      // Force an initial update to ensure values match the current selection
      if (window.applyDefaultsToCalculator) {
        console.log('Applying defaults on initial load');
        window.applyDefaultsToCalculator();
      }
    }, 1000); // Increased timeout to ensure modules are fully loaded
  });
  
  // Initialize the location dropdown
  function initializeLocationDropdown() {
    const locationSelect = document.getElementById('activeLocationSelect');
    if (!locationSelect) {
      console.error('Location select dropdown not found');
      return;
    }
    
    // Make sure the options exist
    if (locationSelect.options.length === 0) {
      // Add location options
      const locations = ['Merredin', 'Moora'];
      locations.forEach(location => {
        const option = document.createElement('option');
        option.value = location;
        option.textContent = location;
        locationSelect.appendChild(option);
      });
    } else {
      // Check if Moora option already exists
      let mooraExists = false;
      for (let i = 0; i < locationSelect.options.length; i++) {
        if (locationSelect.options[i].value === 'Moora') {
          mooraExists = true;
          break;
        }
      }
      
      // If Moora option doesn't exist, add it
      if (!mooraExists) {
        const mooraOption = document.createElement('option');
        mooraOption.value = 'Moora';
        mooraOption.textContent = 'Moora';
        locationSelect.appendChild(mooraOption);
      }
    }
    
    // Set the correct event handler that uses the exported function
    // Remove any existing event listeners by creating a new element
    const newLocationSelect = locationSelect.cloneNode(true);
    locationSelect.parentNode.replaceChild(newLocationSelect, locationSelect);
    
    // Add the corrected event handler
    newLocationSelect.addEventListener('change', function() {
      const selectedLocation = this.value;
      console.log('Location dropdown changed to:', selectedLocation);
      
      // Use the exported function to update the currentLocation in defaults.js
      if (window.setCurrentLocation) {
        window.setCurrentLocation(selectedLocation);
        console.log('Set current location using exported function');
        
        // Now apply the defaults with the updated location
        if (window.applyDefaultsToCalculator) {
          window.applyDefaultsToCalculator();
          console.log('Applied defaults to calculator after location change');
        } else {
          console.error('applyDefaultsToCalculator function not available');
        }
      } else {
        console.error('setCurrentLocation function not available - check your module exports');
      }
    });
    
    console.log('Location dropdown initialized with connection to defaults.js');
  }
  
  // Initialize the crop dropdown
  function initializeCropDropdown() {
    // Get the crop select dropdown
    const cropSelect = document.getElementById('activeCropSelect');
    if (!cropSelect) {
      console.error('Crop select dropdown not found');
      return;
    }
    
    // Make sure the options exist
    if (cropSelect.options.length === 0) {
      // Add the options if they don't exist
      const crops = ['Wheat', 'Canola', 'Barley'];
      crops.forEach(crop => {
        const option = document.createElement('option');
        option.value = crop;
        option.textContent = crop;
        cropSelect.appendChild(option);
      });
    } else {
      // Check if Barley option already exists
      let barleyExists = false;
      for (let i = 0; i < cropSelect.options.length; i++) {
        if (cropSelect.options[i].value === 'Barley') {
          barleyExists = true;
          break;
        }
      }
      
      // If Barley option doesn't exist, add it
      if (!barleyExists) {
        const barleyOption = document.createElement('option');
        barleyOption.value = 'Barley';
        barleyOption.textContent = 'Barley';
        cropSelect.appendChild(barleyOption);
      }
    }
    
    // The key part: ensure the change event handler is connected to defaults.js
    // Remove any existing event listeners by creating a new element
    const newCropSelect = cropSelect.cloneNode(true);
    cropSelect.parentNode.replaceChild(newCropSelect, cropSelect);
    
    // Add the corrected event handler that uses the exported function
    newCropSelect.addEventListener('change', function() {
      const selectedCrop = this.value;
      console.log('Crop dropdown changed to:', selectedCrop);
      
      // Use the exported function to update the currentCrop in defaults.js
      if (window.setCurrentCrop) {
        window.setCurrentCrop(selectedCrop);
        console.log('Set current crop using exported function');
        
        // Now apply the defaults with the updated crop
        if (window.applyDefaultsToCalculator) {
          window.applyDefaultsToCalculator();
          console.log('Applied defaults to calculator after crop change');
        } else {
          console.error('applyDefaultsToCalculator function not available');
        }
      } else {
        console.error('setCurrentCrop function not available - check your module exports');
      }
    });
    
    console.log('Crop dropdown initialized with proper connection to defaults.js');
  }
  </script>  
</body>
</html>
